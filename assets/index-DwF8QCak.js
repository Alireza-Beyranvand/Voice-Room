(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))u(l);new MutationObserver(l=>{for(const f of l)if(f.type==="childList")for(const E of f.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&u(E)}).observe(document,{childList:!0,subtree:!0});function s(l){const f={};return l.integrity&&(f.integrity=l.integrity),l.referrerPolicy&&(f.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?f.credentials="include":l.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function u(l){if(l.ep)return;l.ep=!0;const f=s(l);fetch(l.href,f)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var AgoraRTC_NProduction={exports:{}};(function(i,r){(function(s,u){i.exports=u()})(commonjsGlobal,function(){function s(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(o){if(o!=="default"&&!(o in t)){var a=Object.getOwnPropertyDescriptor(n,o);Object.defineProperty(t,o,a.get?a:{enumerable:!0,get:function(){return n[o]}})}})}),Object.freeze(t)}var u=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var f=function(t){try{return!!t()}catch{return!0}},E=!f(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),T=E,v=Function.prototype,w=v.call,k=T&&v.bind.bind(w,w),B=T?k:function(t){return function(){return w.apply(t,arguments)}},Q=B({}.isPrototypeOf),X=function(t){return t&&t.Math==Math&&t},_e=X(typeof globalThis=="object"&&globalThis)||X(typeof window=="object"&&window)||X(typeof self=="object"&&self)||X(typeof u=="object"&&u)||function(){return this}()||u||Function("return this")(),aa=E,_i=Function.prototype,_a=_i.apply,ga=_i.call,_d=typeof Reflect=="object"&&Reflect.apply||(aa?ga.bind(_a):function(){return ga.apply(_a,arguments)}),d_=B,T_=d_({}.toString),P_=d_("".slice),g_=function(t){return P_(T_(t),8,-1)},j_=g_,wS=B,_m=function(t){if(j_(t)==="Function")return wS(t)},l_=typeof document=="object"&&document.all,a_={all:l_,IS_HTMLDDA:l_===void 0&&l_!==void 0},y_=a_.all,_c=a_.IS_HTMLDDA?function(t){return typeof t=="function"||t===y_}:function(t){return typeof t=="function"},_f={},r_=!f(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),v_=E,S_=Function.prototype.call,U_=v_?S_.bind(S_):function(){return S_.apply(S_,arguments)},w_={},RT={}.propertyIsEnumerable,Q_=Object.getOwnPropertyDescriptor,aS=Q_&&!RT.call({1:2},1);w_.f=aS?function(t){var e=Q_(this,t);return!!e&&e.enumerable}:RT;var X0,sL,tI=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},CQ=f,IQ=g_,FM=Object,wQ=B("".split),aL=CQ(function(){return!FM("z").propertyIsEnumerable(0)})?function(t){return IQ(t)=="String"?wQ(t,""):FM(t)}:FM,RO=function(t){return t==null},OQ=RO,AQ=TypeError,CO=function(t){if(OQ(t))throw AQ("Can't call method on "+t);return t},NQ=aL,PQ=CO,eI=function(t){return NQ(PQ(t))},X3=_c,DQ=a_.all,t0=a_.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:X3(t)||t===DQ}:function(t){return typeof t=="object"?t!==null:X3(t)},Q0={},BM=Q0,GM=_e,kQ=_c,Q3=function(t){return kQ(t)?t:void 0},zS=function(t,e){return arguments.length<2?Q3(BM[t])||Q3(GM[t]):BM[t]&&BM[t][e]||GM[t]&&GM[t][e]},VI=typeof navigator<"u"&&String(navigator.userAgent)||"",Z3=_e,HM=VI,$3=Z3.process,t6=Z3.Deno,e6=$3&&$3.versions||t6&&t6.version,n6=e6&&e6.v8;n6&&(sL=(X0=n6.split("."))[0]>0&&X0[0]<4?1:+(X0[0]+X0[1])),!sL&&HM&&(!(X0=HM.match(/Edge\/(\d+)/))||X0[1]>=74)&&(X0=HM.match(/Chrome\/(\d+)/))&&(sL=+X0[1]);var FI=sL,r6=FI,LQ=f,MQ=_e.String,IO=!!Object.getOwnPropertySymbols&&!LQ(function(){var t=Symbol();return!MQ(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&r6&&r6<41}),i6=IO&&!Symbol.sham&&typeof Symbol.iterator=="symbol",UQ=zS,xQ=_c,jQ=Q,VQ=Object,VN=i6?function(t){return typeof t=="symbol"}:function(t){var e=UQ("Symbol");return xQ(e)&&jQ(e.prototype,VQ(t))},FQ=String,wO=function(t){try{return FQ(t)}catch{return"Object"}},BQ=_c,GQ=wO,HQ=TypeError,I0=function(t){if(BQ(t))return t;throw HQ(GQ(t)+" is not a function")},WQ=I0,qQ=RO,cL=function(t,e){var n=t[e];return qQ(n)?void 0:WQ(n)},o6=U_,s6=_c,a6=t0,KQ=TypeError,c6={exports:{}},u6=_e,zQ=Object.defineProperty,YQ=function(t,e){try{zQ(u6,t,{value:e,configurable:!0,writable:!0})}catch{u6[t]=e}return e},d6="__core-js_shared__",WM=_e[d6]||YQ(d6,{}),l6=WM;(c6.exports=function(t,e){return l6[t]||(l6[t]=e!==void 0?e:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"Â© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var OO=c6.exports,JQ=CO,XQ=Object,fR=function(t){return XQ(JQ(t))},QQ=fR,ZQ=B({}.hasOwnProperty),mS=Object.hasOwn||function(t,e){return ZQ(QQ(t),e)},$Q=B,tZ=0,eZ=Math.random(),nZ=$Q(1 .toString),qM=function(t){return"Symbol("+(t===void 0?"":t)+")_"+nZ(++tZ+eZ,36)},rZ=OO,h6=mS,iZ=qM,oZ=IO,sZ=i6,AO=_e.Symbol,KM=rZ("wks"),aZ=sZ?AO.for||AO:AO&&AO.withoutSetter||iZ,UT=function(t){return h6(KM,t)||(KM[t]=oZ&&h6(AO,t)?AO[t]:aZ("Symbol."+t)),KM[t]},cZ=U_,p6=t0,f6=VN,uZ=cL,dZ=function(t,e){var n,o;if(s6(n=t.toString)&&!a6(o=o6(n,t))||s6(n=t.valueOf)&&!a6(o=o6(n,t)))return o;throw KQ("Can't convert object to primitive value")},lZ=TypeError,hZ=UT("toPrimitive"),pZ=function(t,e){if(!p6(t)||f6(t))return t;var n,o=uZ(t,hZ);if(o){if(n=cZ(o,t,e),!p6(n)||f6(n))return n;throw lZ("Can't convert object to primitive value")}return dZ(t)},fZ=VN,uL=function(t){var e=pZ(t,"string");return fZ(e)?e:e+""},m6=t0,zM=_e.document,mZ=m6(zM)&&m6(zM.createElement),YM=function(t){return mZ?zM.createElement(t):{}},EZ=YM,E6=!r_&&!f(function(){return Object.defineProperty(EZ("div"),"a",{get:function(){return 7}}).a!=7}),_Z=r_,gZ=U_,vZ=w_,bZ=tI,yZ=eI,TZ=uL,SZ=mS,RZ=E6,_6=Object.getOwnPropertyDescriptor;_f.f=_Z?_6:function(t,e){if(t=yZ(t),e=TZ(e),RZ)try{return _6(t,e)}catch{}if(SZ(t,e))return bZ(!gZ(vZ.f,t,e),t[e])};var CZ=f,IZ=_c,wZ=/#|\.prototype\./,FN=function(t,e){var n=AZ[OZ(t)];return n==PZ||n!=NZ&&(IZ(e)?CZ(e):!!e)},OZ=FN.normalize=function(t){return String(t).replace(wZ,".").toLowerCase()},AZ=FN.data={},NZ=FN.NATIVE="N",PZ=FN.POLYFILL="P",g6=FN,DZ=I0,kZ=E,LZ=_m(_m.bind),nI=function(t,e){return DZ(t),e===void 0?t:kZ?LZ(t,e):function(){return t.apply(e,arguments)}},w0={},v6=r_&&f(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),MZ=t0,UZ=String,xZ=TypeError,VS=function(t){if(MZ(t))return t;throw xZ(UZ(t)+" is not an object")},jZ=r_,VZ=E6,FZ=v6,dL=VS,b6=uL,BZ=TypeError,JM=Object.defineProperty,GZ=Object.getOwnPropertyDescriptor,XM="enumerable",QM="configurable",ZM="writable";w0.f=jZ?FZ?function(t,e,n){if(dL(t),e=b6(e),dL(n),typeof t=="function"&&e==="prototype"&&"value"in n&&ZM in n&&!n[ZM]){var o=GZ(t,e);o&&o[ZM]&&(t[e]=n.value,n={configurable:QM in n?n[QM]:o[QM],enumerable:XM in n?n[XM]:o[XM],writable:!1})}return JM(t,e,n)}:JM:function(t,e,n){if(dL(t),e=b6(e),dL(n),VZ)try{return JM(t,e,n)}catch{}if("get"in n||"set"in n)throw BZ("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var HZ=w0,WZ=tI,rI=r_?function(t,e,n){return HZ.f(t,e,WZ(1,n))}:function(t,e,n){return t[e]=n,t},lL=_e,qZ=_d,KZ=_m,zZ=_c,YZ=_f.f,JZ=g6,NO=Q0,XZ=nI,PO=rI,y6=mS,QZ=function(t){var e=function(n,o,a){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,o)}return new t(n,o,a)}return qZ(t,this,arguments)};return e.prototype=t.prototype,e},uT=function(t,e){var n,o,a,d,h,p,m,_,g,y=t.target,C=t.global,O=t.stat,q=t.proto,L=C?lL:O?lL[y]:(lL[y]||{}).prototype,U=C?NO:NO[y]||PO(NO,y,{})[y],K=U.prototype;for(d in e)o=!(n=JZ(C?d:y+(O?".":"#")+d,t.forced))&&L&&y6(L,d),p=U[d],o&&(m=t.dontCallGetSet?(g=YZ(L,d))&&g.value:L[d]),h=o&&m?m:e[d],o&&typeof p==typeof h||(_=t.bind&&o?XZ(h,lL):t.wrap&&o?QZ(h):q&&zZ(h)?KZ(h):h,(t.sham||h&&h.sham||p&&p.sham)&&PO(_,"sham",!0),PO(U,d,_),q&&(y6(NO,a=y+"Prototype")||PO(NO,a,{}),PO(NO[a],d,h),t.real&&K&&(n||!K[d])&&PO(K,d,h)))},ZZ=Math.ceil,$Z=Math.floor,t$=Math.trunc||function(t){var e=+t;return(e>0?$Z:ZZ)(e)},e$=t$,$M=function(t){var e=+t;return e!=e||e===0?0:e$(e)},n$=$M,r$=Math.max,i$=Math.min,tU=function(t,e){var n=n$(t);return n<0?r$(n+e,0):i$(n,e)},o$=$M,s$=Math.min,T6=function(t){return t>0?s$(o$(t),9007199254740991):0},a$=T6,jR=function(t){return a$(t.length)},c$=eI,u$=tU,d$=jR,S6=function(t){return function(e,n,o){var a,d=c$(e),h=d$(d),p=u$(o,h);if(t&&n!=n){for(;h>p;)if((a=d[p++])!=a)return!0}else for(;h>p;p++)if((t||p in d)&&d[p]===n)return t||p||0;return!t&&-1}},eU={includes:S6(!0),indexOf:S6(!1)},l$=eU.includes;uT({target:"Array",proto:!0,forced:f(function(){return!Array(1).includes()})},{includes:function(t){return l$(this,t,arguments.length>1?arguments[1]:void 0)}});var h$=Q0,O0=function(t){return h$[t+"Prototype"]},p$=O0("Array").includes,f$=t0,m$=g_,E$=UT("match"),R6=function(t){var e;return f$(t)&&((e=t[E$])!==void 0?!!e:m$(t)=="RegExp")},_$=R6,g$=TypeError,C6={};C6[UT("toStringTag")]="z";var nU=String(C6)==="[object z]",v$=nU,b$=_c,hL=g_,y$=UT("toStringTag"),T$=Object,S$=hL(function(){return arguments}())=="Arguments",mR=v$?hL:function(t){var e,n,o;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(a,d){try{return a[d]}catch{}}(e=T$(t),y$))=="string"?n:S$?hL(e):(o=hL(e))=="Object"&&b$(e.callee)?"Arguments":o},R$=mR,C$=String,f0=function(t){if(R$(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return C$(t)},I$=UT("match"),w$=uT,O$=function(t){if(_$(t))throw g$("The method doesn't accept regular expressions");return t},A$=CO,I6=f0,N$=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[I$]=!1,"/./"[t](e)}catch{}}return!1},P$=B("".indexOf);w$({target:"String",proto:!0,forced:!N$("includes")},{includes:function(t){return!!~P$(I6(A$(this)),I6(O$(t)),arguments.length>1?arguments[1]:void 0)}});var D$=O0("String").includes,w6=Q,k$=p$,L$=D$,rU=Array.prototype,iU=String.prototype,M$=function(t){var e=t.includes;return t===rU||w6(rU,t)&&e===rU.includes?k$:typeof t=="string"||t===iU||w6(iU,t)&&e===iU.includes?L$:e},o_=l(M$),U$=I0,x$=fR,j$=aL,V$=jR,F$=TypeError,O6=function(t){return function(e,n,o,a){U$(n);var d=x$(e),h=j$(d),p=V$(d),m=t?p-1:0,_=t?-1:1;if(o<2)for(;;){if(m in h){a=h[m],m+=_;break}if(m+=_,t?m<0:p<=m)throw F$("Reduce of empty array with no initial value")}for(;t?m>=0:p>m;m+=_)m in h&&(a=n(a,h[m],m,d));return a}},B$={left:O6(!1),right:O6(!0)},G$=f,pL=function(t,e){var n=[][t];return!!n&&G$(function(){n.call(null,e||function(){return 1},1)})},BN=typeof process<"u"&&g_(process)=="process",H$=B$.left;uT({target:"Array",proto:!0,forced:!BN&&FI>79&&FI<83||!pL("reduce")},{reduce:function(t){var e=arguments.length;return H$(this,t,e,e>1?arguments[1]:void 0)}});var W$=O0("Array").reduce,q$=Q,K$=W$,oU=Array.prototype,z$=function(t){var e=t.reduce;return t===oU||q$(oU,t)&&e===oU.reduce?K$:e},A6=z$,Z0=l(A6);let N6=!0,P6=!0;function fL(t,e,n){const o=t.match(e);return o&&o.length>=n&&parseInt(o[n],10)}function BI(t,e,n){if(!t.RTCPeerConnection)return;const o=t.RTCPeerConnection.prototype,a=o.addEventListener;o.addEventListener=function(h,p){if(h!==e)return a.apply(this,arguments);const m=_=>{const g=n(_);g&&(p.handleEvent?p.handleEvent(g):p(g))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(p,m),a.apply(this,[h,m])};const d=o.removeEventListener;o.removeEventListener=function(h,p){if(h!==e||!this._eventMap||!this._eventMap[e])return d.apply(this,arguments);if(!this._eventMap[e].has(p))return d.apply(this,arguments);const m=this._eventMap[e].get(p);return this._eventMap[e].delete(p),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,m])},Object.defineProperty(o,"on"+e,{get(){return this["_on"+e]},set(h){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),h&&this.addEventListener(e,this["_on"+e]=h)},enumerable:!0,configurable:!0})}function Y$(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(N6=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function J$(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(P6=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function D6(){if(typeof window=="object"){if(N6)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function sU(t,e){P6&&console.warn(t+" is deprecated, please use "+e+" instead.")}function k6(t){return Object.prototype.toString.call(t)==="[object Object]"}function L6(t){var e;return k6(t)?Z0(e=Object.keys(t)).call(e,function(n,o){const a=k6(t[o]),d=a?L6(t[o]):t[o],h=a&&!Object.keys(d).length;return d===void 0||h?n:Object.assign(n,{[o]:d})},{}):t}function aU(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(o=>{o.endsWith("Id")?aU(t,t.get(e[o]),n):o.endsWith("Ids")&&e[o].forEach(a=>{aU(t,t.get(a),n)})}))}function M6(t,e,n){const o=n?"outbound-rtp":"inbound-rtp",a=new Map;if(e===null)return a;const d=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===e.id&&d.push(h)}),d.forEach(h=>{t.forEach(p=>{p.type===o&&p.trackId===h.id&&aU(t,p,a)})}),a}var X$=qM,U6=OO("keys"),mL=function(t){return U6[t]||(U6[t]=X$(t))},Q$=!f(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Z$=mS,$$=_c,ttt=fR,ett=Q$,x6=mL("IE_PROTO"),cU=Object,ntt=cU.prototype,uU=ett?cU.getPrototypeOf:function(t){var e=ttt(t);if(Z$(e,x6))return e[x6];var n=e.constructor;return $$(n)&&e instanceof n?n.prototype:e instanceof cU?ntt:null},rtt=B,itt=I0,ott=_c,stt=String,att=TypeError,ctt=function(t,e,n){try{return rtt(itt(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},utt=VS,dtt=function(t){if(typeof t=="object"||ott(t))return t;throw att("Can't set "+stt(t)+" as a prototype")},ltt=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=ctt(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(o,a){return utt(o),dtt(a),e?t(o,a):o.__proto__=a,o}}():void 0),EL={},_L={},dU=mS,htt=eI,ptt=eU.indexOf,ftt=_L,j6=B([].push),V6=function(t,e){var n,o=htt(t),a=0,d=[];for(n in o)!dU(ftt,n)&&dU(o,n)&&j6(d,n);for(;e.length>a;)dU(o,n=e[a++])&&(~ptt(d,n)||j6(d,n));return d},lU=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],mtt=V6,Ett=lU.concat("length","prototype");EL.f=Object.getOwnPropertyNames||function(t){return mtt(t,Ett)};var GN={};GN.f=Object.getOwnPropertySymbols;var _tt=zS,gtt=EL,vtt=GN,btt=VS,ytt=B([].concat),Ttt=_tt("Reflect","ownKeys")||function(t){var e=gtt.f(btt(t)),n=vtt.f;return n?ytt(e,n(t)):e},F6=mS,Stt=Ttt,Rtt=_f,Ctt=w0,hU={},Itt=V6,wtt=lU,gL=Object.keys||function(t){return Itt(t,wtt)},Ott=r_,Att=v6,Ntt=w0,Ptt=VS,Dtt=eI,ktt=gL;hU.f=Ott&&!Att?Object.defineProperties:function(t,e){Ptt(t);for(var n,o=Dtt(e),a=ktt(e),d=a.length,h=0;d>h;)Ntt.f(t,n=a[h++],o[n]);return t};var vL,B6=zS("document","documentElement"),Ltt=VS,Mtt=hU,G6=lU,Utt=_L,xtt=B6,jtt=YM,pU="prototype",fU="script",H6=mL("IE_PROTO"),mU=function(){},W6=function(t){return"<"+fU+">"+t+"</"+fU+">"},q6=function(t){t.write(W6("")),t.close();var e=t.parentWindow.Object;return t=null,e},bL=function(){try{vL=new ActiveXObject("htmlfile")}catch{}var t,e,n;bL=typeof document<"u"?document.domain&&vL?q6(vL):(e=jtt("iframe"),n="java"+fU+":",e.style.display="none",xtt.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(W6("document.F=Object")),t.close(),t.F):q6(vL);for(var o=G6.length;o--;)delete bL[pU][G6[o]];return bL()};Utt[H6]=!0;var HN=Object.create||function(t,e){var n;return t!==null?(mU[pU]=Ltt(t),n=new mU,mU[pU]=null,n[H6]=t):n=bL(),e===void 0?n:Mtt.f(n,e)},Vtt=t0,Ftt=rI,K6=Error,Btt=B("".replace),Gtt=String(K6("zxcasd").stack),z6=/\n\s*at [^:]*:[^\n]*/,Htt=z6.test(Gtt),Wtt=tI,qtt=!f(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",Wtt(1,7)),t.stack!==7)}),Ktt=rI,ztt=function(t,e){if(Htt&&typeof t=="string"&&!K6.prepareStackTrace)for(;e--;)t=Btt(t,z6,"");return t},Ytt=qtt,Y6=Error.captureStackTrace,GI={},Jtt=GI,Xtt=UT("iterator"),Qtt=Array.prototype,J6=function(t){return t!==void 0&&(Jtt.Array===t||Qtt[Xtt]===t)},Ztt=mR,X6=cL,$tt=RO,tet=GI,eet=UT("iterator"),yL=function(t){if(!$tt(t))return X6(t,eet)||X6(t,"@@iterator")||tet[Ztt(t)]},net=U_,ret=I0,iet=VS,oet=wO,set=yL,aet=TypeError,EU=function(t,e){var n=arguments.length<2?set(t):e;if(ret(n))return iet(net(n,t));throw aet(oet(t)+" is not iterable")},cet=U_,Q6=VS,uet=cL,Z6=function(t,e,n){var o,a;Q6(t);try{if(!(o=uet(t,"return"))){if(e==="throw")throw n;return n}o=cet(o,t)}catch(d){a=!0,o=d}if(e==="throw")throw n;if(a)throw o;return Q6(o),n},det=nI,het=U_,pet=VS,fet=wO,met=J6,Eet=jR,$6=Q,_et=EU,get=yL,t5=Z6,vet=TypeError,TL=function(t,e){this.stopped=t,this.result=e},e5=TL.prototype,WN=function(t,e,n){var o,a,d,h,p,m,_,g=n&&n.that,y=!(!n||!n.AS_ENTRIES),C=!(!n||!n.IS_RECORD),O=!(!n||!n.IS_ITERATOR),q=!(!n||!n.INTERRUPTED),L=det(e,g),U=function(J){return o&&t5(o,"normal",J),new TL(!0,J)},K=function(J){return y?(pet(J),q?L(J[0],J[1],U):L(J[0],J[1])):q?L(J,U):L(J)};if(C)o=t.iterator;else if(O)o=t;else{if(!(a=get(t)))throw vet(fet(t)+" is not iterable");if(met(a)){for(d=0,h=Eet(t);h>d;d++)if((p=K(t[d]))&&$6(e5,p))return p;return new TL(!1)}o=_et(t,a)}for(m=C?t.next:o.next;!(_=het(m,o)).done;){try{p=K(_.value)}catch(J){t5(o,"throw",J)}if(typeof p=="object"&&p&&$6(e5,p))return p}return new TL(!1)},bet=f0,yet=uT,Tet=Q,Ret=uU,SL=ltt,Cet=function(t,e,n){for(var o=Stt(e),a=Ctt.f,d=Rtt.f,h=0;h<o.length;h++){var p=o[h];F6(t,p)||n&&F6(n,p)||a(t,p,d(e,p))}},n5=HN,_U=rI,gU=tI,Iet=function(t,e){Vtt(e)&&"cause"in e&&Ftt(t,"cause",e.cause)},wet=function(t,e,n,o){Ytt&&(Y6?Y6(t,e):Ktt(t,"stack",ztt(n,o)))},Oet=WN,Aet=function(t,e){return t===void 0?arguments.length<2?"":e:bet(t)},Net=UT("toStringTag"),RL=Error,Pet=[].push,DO=function(t,e){var n,o=Tet(vU,this);SL?n=SL(RL(),o?Ret(this):vU):(n=o?this:n5(vU),_U(n,Net,"Error")),e!==void 0&&_U(n,"message",Aet(e)),wet(n,DO,n.stack,1),arguments.length>2&&Iet(n,arguments[2]);var a=[];return Oet(t,Pet,{that:a}),_U(n,"errors",a),n};SL?SL(DO,RL):Cet(DO,RL,{name:!0});var vU=DO.prototype=n5(RL.prototype,{constructor:gU(1,DO),message:gU(1,""),name:gU(1,"AggregateError")});yet({global:!0,constructor:!0,arity:2},{AggregateError:DO});var CL,qN,IL,Det=_c,r5=_e.WeakMap,ket=Det(r5)&&/native code/.test(String(r5)),i5=_e,Let=t0,Met=rI,bU=mS,yU=WM,Uet=mL,xet=_L,o5="Object already initialized",TU=i5.TypeError,jet=i5.WeakMap;if(ket||yU.state){var ER=yU.state||(yU.state=new jet);ER.get=ER.get,ER.has=ER.has,ER.set=ER.set,CL=function(t,e){if(ER.has(t))throw TU(o5);return e.facade=t,ER.set(t,e),e},qN=function(t){return ER.get(t)||{}},IL=function(t){return ER.has(t)}}else{var kO=Uet("state");xet[kO]=!0,CL=function(t,e){if(bU(t,kO))throw TU(o5);return e.facade=t,Met(t,kO,e),e},qN=function(t){return bU(t,kO)?t[kO]:{}},IL=function(t){return bU(t,kO)}}var HI,s5,a5,WI={set:CL,get:qN,has:IL,enforce:function(t){return IL(t)?qN(t):CL(t,{})},getterFor:function(t){return function(e){var n;if(!Let(e)||(n=qN(e)).type!==t)throw TU("Incompatible receiver, "+t+" required");return n}}},SU=r_,Vet=mS,c5=Function.prototype,Fet=SU&&Object.getOwnPropertyDescriptor,RU=Vet(c5,"name"),u5={EXISTS:RU,PROPER:RU&&(function(){}).name==="something",CONFIGURABLE:RU&&(!SU||SU&&Fet(c5,"name").configurable)},Bet=rI,iI=function(t,e,n,o){return o&&o.enumerable?t[e]=n:Bet(t,e,n),t},Get=f,Het=_c,Wet=t0,qet=HN,d5=uU,Ket=iI,CU=UT("iterator"),l5=!1;[].keys&&("next"in(a5=[].keys())?(s5=d5(d5(a5)))!==Object.prototype&&(HI=s5):l5=!0);var zet=!Wet(HI)||Get(function(){var t={};return HI[CU].call(t)!==t});Het((HI=zet?{}:qet(HI))[CU])||Ket(HI,CU,function(){return this});var h5={IteratorPrototype:HI,BUGGY_SAFARI_ITERATORS:l5},Yet=mR,Jet=nU?{}.toString:function(){return"[object "+Yet(this)+"]"},Xet=nU,Qet=w0.f,Zet=rI,$et=mS,tnt=Jet,p5=UT("toStringTag"),oI=function(t,e,n,o){if(t){var a=n?t:t.prototype;$et(a,p5)||Qet(a,p5,{configurable:!0,value:e}),o&&!Xet&&Zet(a,"toString",tnt)}},ent=h5.IteratorPrototype,nnt=HN,rnt=tI,int=oI,ont=GI,snt=function(){return this},IU=function(t,e,n,o){var a=e+" Iterator";return t.prototype=nnt(ent,{next:rnt(+!o,n)}),int(t,a,!1,!0),ont[a]=snt,t},ant=uT,cnt=U_,unt=u5,dnt=IU,lnt=uU,hnt=oI,f5=iI,m5=GI,pnt=h5,fnt=unt.PROPER,wL=pnt.BUGGY_SAFARI_ITERATORS,wU=UT("iterator"),E5="keys",OL="values",_5="entries",mnt=function(){return this},g5=function(t,e,n,o,a,d,h){dnt(n,e,o);var p,m,_,g=function(K){if(K===a&&L)return L;if(!wL&&K in O)return O[K];switch(K){case E5:case OL:case _5:return function(){return new n(this,K)}}return function(){return new n(this)}},y=e+" Iterator",C=!1,O=t.prototype,q=O[wU]||O["@@iterator"]||a&&O[a],L=!wL&&q||g(a),U=e=="Array"&&O.entries||q;if(U&&(p=lnt(U.call(new t)))!==Object.prototype&&p.next&&(hnt(p,y,!0,!0),m5[y]=mnt),fnt&&a==OL&&q&&q.name!==OL&&(C=!0,L=function(){return cnt(q,this)}),a)if(m={values:g(OL),keys:d?L:g(E5),entries:g(_5)},h)for(_ in m)(wL||C||!(_ in O))&&f5(O,_,m[_]);else ant({target:e,proto:!0,forced:wL||C},m);return h&&O[wU]!==L&&f5(O,wU,L,{name:a}),m5[e]=L,m},OU=function(t,e){return{value:t,done:e}},Ent=eI,v5=GI,b5=WI;w0.f;var _nt=g5,y5=OU,T5="Array Iterator",gnt=b5.set,vnt=b5.getterFor(T5);_nt(Array,"Array",function(t,e){gnt(this,{type:T5,target:Ent(t),index:0,kind:e})},function(){var t=vnt(this),e=t.target,n=t.kind,o=t.index++;return!e||o>=e.length?(t.target=void 0,y5(void 0,!0)):y5(n=="keys"?o:n=="values"?e[o]:[o,e[o]],!1)},"values"),v5.Arguments=v5.Array;var bnt=w0,AL=function(t,e,n){return bnt.f(t,e,n)},ynt=zS,Tnt=AL,Snt=r_,S5=UT("species"),Rnt=Q,Cnt=TypeError,AU=function(t,e){if(Rnt(e,t))return t;throw Cnt("Incorrect invocation")},Int=_c,NU=WM,wnt=B(Function.toString);Int(NU.inspectSource)||(NU.inspectSource=function(t){return wnt(t)});var R5=NU.inspectSource,Ont=B,Ant=f,C5=_c,Nnt=mR,Pnt=R5,I5=function(){},Dnt=[],w5=zS("Reflect","construct"),PU=/^\s*(?:class|function)\b/,knt=Ont(PU.exec),Lnt=!PU.exec(I5),KN=function(t){if(!C5(t))return!1;try{return w5(I5,Dnt,t),!0}catch{return!1}},O5=function(t){if(!C5(t))return!1;switch(Nnt(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Lnt||!!knt(PU,Pnt(t))}catch{return!0}};O5.sham=!0;var zN,LO,A5,DU,NL=!w5||Ant(function(){var t;return KN(KN.call)||!KN(Object)||!KN(function(){t=!0})||t})?O5:KN,Mnt=NL,Unt=wO,xnt=TypeError,N5=VS,jnt=function(t){if(Mnt(t))return t;throw xnt(Unt(t)+" is not a constructor")},Vnt=RO,Fnt=UT("species"),kU=function(t,e){var n,o=N5(t).constructor;return o===void 0||Vnt(n=N5(o)[Fnt])?e:jnt(n)},LU=B([].slice),Bnt=TypeError,PL=function(t,e){if(t<e)throw Bnt("Not enough arguments");return t},P5=/(?:ipad|iphone|ipod).*applewebkit/i.test(VI),m0=_e,Gnt=_d,Hnt=nI,D5=_c,Wnt=mS,k5=f,L5=B6,qnt=LU,M5=YM,Knt=PL,znt=P5,Ynt=BN,MU=m0.setImmediate,UU=m0.clearImmediate,Jnt=m0.process,xU=m0.Dispatch,Xnt=m0.Function,U5=m0.MessageChannel,Qnt=m0.String,jU=0,YN={},x5="onreadystatechange";k5(function(){zN=m0.location});var VU=function(t){if(Wnt(YN,t)){var e=YN[t];delete YN[t],e()}},FU=function(t){return function(){VU(t)}},j5=function(t){VU(t.data)},V5=function(t){m0.postMessage(Qnt(t),zN.protocol+"//"+zN.host)};MU&&UU||(MU=function(t){Knt(arguments.length,1);var e=D5(t)?t:Xnt(t),n=qnt(arguments,1);return YN[++jU]=function(){Gnt(e,void 0,n)},LO(jU),jU},UU=function(t){delete YN[t]},Ynt?LO=function(t){Jnt.nextTick(FU(t))}:xU&&xU.now?LO=function(t){xU.now(FU(t))}:U5&&!znt?(DU=(A5=new U5).port2,A5.port1.onmessage=j5,LO=Hnt(DU.postMessage,DU)):m0.addEventListener&&D5(m0.postMessage)&&!m0.importScripts&&zN&&zN.protocol!=="file:"&&!k5(V5)?(LO=V5,m0.addEventListener("message",j5,!1)):LO=x5 in M5("script")?function(t){L5.appendChild(M5("script"))[x5]=function(){L5.removeChild(this),VU(t)}}:function(t){setTimeout(FU(t),0)});var F5={set:MU,clear:UU},B5=function(){this.head=null,this.tail=null};B5.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var MO,BU,GU,HU,G5,H5=B5,Znt=/ipad|iphone|ipod/i.test(VI)&&typeof Pebble<"u",$nt=/web0s(?!.*chrome)/i.test(VI),qI=_e,W5=nI,trt=_f.f,WU=F5.set,ert=H5,nrt=P5,rrt=Znt,irt=$nt,qU=BN,q5=qI.MutationObserver||qI.WebKitMutationObserver,K5=qI.document,z5=qI.process,DL=qI.Promise,Y5=trt(qI,"queueMicrotask"),KU=Y5&&Y5.value;if(!KU){var kL=new ert,LL=function(){var t,e;for(qU&&(t=z5.domain)&&t.exit();e=kL.get();)try{e()}catch(n){throw kL.head&&MO(),n}t&&t.enter()};nrt||qU||irt||!q5||!K5?!rrt&&DL&&DL.resolve?((HU=DL.resolve(void 0)).constructor=DL,G5=W5(HU.then,HU),MO=function(){G5(LL)}):qU?MO=function(){z5.nextTick(LL)}:(WU=W5(WU,qI),MO=function(){WU(LL)}):(BU=!0,GU=K5.createTextNode(""),new q5(LL).observe(GU,{characterData:!0}),MO=function(){GU.data=BU=!BU}),KU=function(t){kL.head||MO(),kL.add(t)}}var ort=KU,UO=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},KI=_e.Promise,J5=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",srt=!J5&&!BN&&typeof window=="object"&&typeof document=="object",art=_e,JN=KI,crt=_c,urt=g6,drt=R5,lrt=UT,hrt=srt,prt=J5,zU=FI,X5=JN&&JN.prototype,frt=lrt("species"),Q5=!1,Z5=crt(art.PromiseRejectionEvent),mrt=urt("Promise",function(){var t=drt(JN),e=t!==String(JN);if(!e&&zU===66||!X5.catch||!X5.finally)return!0;if(!zU||zU<51||!/native code/.test(t)){var n=new JN(function(a){a(1)}),o=function(a){a(function(){},function(){})};if((n.constructor={})[frt]=o,!(Q5=n.then(function(){})instanceof o))return!0}return!e&&(hrt||prt)&&!Z5}),XN={CONSTRUCTOR:mrt,REJECTION_EVENT:Z5,SUBCLASSING:Q5},_R={},$5=I0,Ert=TypeError,_rt=function(t){var e,n;this.promise=new t(function(o,a){if(e!==void 0||n!==void 0)throw Ert("Bad Promise constructor");e=o,n=a}),this.resolve=$5(e),this.reject=$5(n)};_R.f=function(t){return new _rt(t)};var YU,t2,grt=uT,ML=BN,sI=_e,QN=U_,vrt=iI,brt=oI,yrt=function(t){var e=ynt(t);Snt&&e&&!e[S5]&&Tnt(e,S5,{configurable:!0,get:function(){return this}})},Trt=I0,JU=_c,Srt=t0,Rrt=AU,Crt=kU,e2=F5.set,XU=ort,Irt=function(t,e){try{arguments.length==1?console.error(t):console.error(t,e)}catch{}},wrt=UO,Ort=H5,n2=WI,QU=KI,r2=XN,i2=_R,UL="Promise",o2=r2.CONSTRUCTOR,Art=r2.REJECTION_EVENT,ZU=n2.getterFor(UL),Nrt=n2.set,Prt=QU&&QU.prototype,ZN=QU,$U=Prt,s2=sI.TypeError,_x=sI.document,_j=sI.process,$j=i2.f,Drt=$j,krt=!!(_x&&_x.createEvent&&sI.dispatchEvent),a2="unhandledrejection",c2=function(t){var e;return!(!Srt(t)||!JU(e=t.then))&&e},u2=function(t,e){var n,o,a,d=e.value,h=e.state==1,p=h?t.ok:t.fail,m=t.resolve,_=t.reject,g=t.domain;try{p?(h||(e.rejection===2&&Mrt(e),e.rejection=1),p===!0?n=d:(g&&g.enter(),n=p(d),g&&(g.exit(),a=!0)),n===t.promise?_(s2("Promise-chain cycle")):(o=c2(n))?QN(o,n,m,_):m(n)):_(d)}catch(y){g&&!a&&g.exit(),_(y)}},d2=function(t,e){t.notified||(t.notified=!0,XU(function(){for(var n,o=t.reactions;n=o.get();)u2(n,t);t.notified=!1,e&&!t.rejection&&Lrt(t)}))},l2=function(t,e,n){var o,a;krt?((o=_x.createEvent("Event")).promise=e,o.reason=n,o.initEvent(t,!1,!0),sI.dispatchEvent(o)):o={promise:e,reason:n},!Art&&(a=sI["on"+t])?a(o):t===a2&&Irt("Unhandled promise rejection",n)},Lrt=function(t){QN(e2,sI,function(){var e,n=t.facade,o=t.value;if(h2(t)&&(e=wrt(function(){ML?_j.emit("unhandledRejection",o,n):l2(a2,n,o)}),t.rejection=ML||h2(t)?2:1,e.error))throw e.value})},h2=function(t){return t.rejection!==1&&!t.parent},Mrt=function(t){QN(e2,sI,function(){var e=t.facade;ML?_j.emit("rejectionHandled",e):l2("rejectionhandled",e,t.value)})},xO=function(t,e,n){return function(o){t(e,o,n)}},jO=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,d2(t,!0))},tV=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw s2("Promise can't be resolved itself");var o=c2(e);o?XU(function(){var a={done:!1};try{QN(o,e,xO(tV,a,t),xO(jO,a,t))}catch(d){jO(a,d,t)}}):(t.value=e,t.state=1,d2(t,!1))}catch(a){jO({done:!1},a,t)}}};o2&&($U=(ZN=function(t){Rrt(this,$U),Trt(t),QN(YU,this);var e=ZU(this);try{t(xO(tV,e),xO(jO,e))}catch(n){jO(e,n)}}).prototype,(YU=function(t){Nrt(this,{type:UL,done:!1,notified:!1,parent:!1,reactions:new Ort,rejection:!1,state:0,value:void 0})}).prototype=vrt($U,"then",function(t,e){var n=ZU(this),o=$j(Crt(this,ZN));return n.parent=!0,o.ok=!JU(t)||t,o.fail=JU(e)&&e,o.domain=ML?_j.domain:void 0,n.state==0?n.reactions.add(o):XU(function(){u2(o,n)}),o.promise}),t2=function(){var t=new YU,e=ZU(t);this.promise=t,this.resolve=xO(tV,e),this.reject=xO(jO,e)},i2.f=$j=function(t){return t===ZN||t===void 0?new t2(t):Drt(t)}),grt({global:!0,constructor:!0,wrap:!0,forced:o2},{Promise:ZN}),brt(ZN,UL,!1,!0),yrt(UL);var p2=UT("iterator"),f2=!1;try{var Urt=0,m2={next:function(){return{done:!!Urt++}},return:function(){f2=!0}};m2[p2]=function(){return this},Array.from(m2,function(){throw 2})}catch{}var xrt=KI,jrt=function(t,e){if(!f2)return!1;var n=!1;try{var o={};o[p2]=function(){return{next:function(){return{done:n=!0}}}},t(o)}catch{}return n},xL=XN.CONSTRUCTOR||!jrt(function(t){xrt.all(t).then(void 0,function(){})}),Vrt=U_,Frt=I0,Brt=_R,Grt=UO,Hrt=WN;uT({target:"Promise",stat:!0,forced:xL},{all:function(t){var e=this,n=Brt.f(e),o=n.resolve,a=n.reject,d=Grt(function(){var h=Frt(e.resolve),p=[],m=0,_=1;Hrt(t,function(g){var y=m++,C=!1;_++,Vrt(h,e,g).then(function(O){C||(C=!0,p[y]=O,--_||o(p))},a)}),--_||o(p)});return d.error&&a(d.value),n.promise}});var Wrt=uT,qrt=XN.CONSTRUCTOR;KI&&KI.prototype,Wrt({target:"Promise",proto:!0,forced:qrt,real:!0},{catch:function(t){return this.then(void 0,t)}});var Krt=U_,zrt=I0,Yrt=_R,Jrt=UO,Xrt=WN;uT({target:"Promise",stat:!0,forced:xL},{race:function(t){var e=this,n=Yrt.f(e),o=n.reject,a=Jrt(function(){var d=zrt(e.resolve);Xrt(t,function(h){Krt(d,e,h).then(n.resolve,o)})});return a.error&&o(a.value),n.promise}});var Qrt=U_,Zrt=_R;uT({target:"Promise",stat:!0,forced:XN.CONSTRUCTOR},{reject:function(t){var e=Zrt.f(this);return Qrt(e.reject,void 0,t),e.promise}});var $rt=VS,tit=t0,eit=_R,E2=function(t,e){if($rt(t),tit(e)&&e.constructor===t)return e;var n=eit.f(t);return(0,n.resolve)(e),n.promise},nit=uT,rit=KI,iit=XN.CONSTRUCTOR,oit=E2,sit=zS("Promise"),ait=!iit;nit({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return oit(ait&&this===sit?rit:this,t)}});var cit=U_,uit=I0,dit=_R,lit=UO,hit=WN;uT({target:"Promise",stat:!0,forced:xL},{allSettled:function(t){var e=this,n=dit.f(e),o=n.resolve,a=n.reject,d=lit(function(){var h=uit(e.resolve),p=[],m=0,_=1;hit(t,function(g){var y=m++,C=!1;_++,cit(h,e,g).then(function(O){C||(C=!0,p[y]={status:"fulfilled",value:O},--_||o(p))},function(O){C||(C=!0,p[y]={status:"rejected",reason:O},--_||o(p))})}),--_||o(p)});return d.error&&a(d.value),n.promise}});var pit=U_,fit=I0,mit=zS,Eit=_R,_it=UO,git=WN,_2="No one promise resolved";uT({target:"Promise",stat:!0,forced:xL},{any:function(t){var e=this,n=mit("AggregateError"),o=Eit.f(e),a=o.resolve,d=o.reject,h=_it(function(){var p=fit(e.resolve),m=[],_=0,g=1,y=!1;git(t,function(C){var O=_++,q=!1;g++,pit(p,e,C).then(function(L){q||y||(y=!0,a(L))},function(L){q||y||(q=!0,m[O]=L,--g||d(new n(m,_2)))})}),--g||d(new n(m,_2))});return h.error&&d(h.value),o.promise}});var vit=uT,eV=KI,bit=f,yit=zS,Tit=_c,Sit=kU,g2=E2,Rit=eV&&eV.prototype;vit({target:"Promise",proto:!0,real:!0,forced:!!eV&&bit(function(){Rit.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=Sit(this,yit("Promise")),n=Tit(t);return this.then(n?function(o){return g2(e,t()).then(function(){return o})}:t,n?function(o){return g2(e,t()).then(function(){throw o})}:t)}});var nV=B,Cit=$M,Iit=f0,wit=CO,Oit=nV("".charAt),v2=nV("".charCodeAt),Ait=nV("".slice),b2=function(t){return function(e,n){var o,a,d=Iit(wit(e)),h=Cit(n),p=d.length;return h<0||h>=p?t?"":void 0:(o=v2(d,h))<55296||o>56319||h+1===p||(a=v2(d,h+1))<56320||a>57343?t?Oit(d,h):o:t?Ait(d,h,h+2):a-56320+(o-55296<<10)+65536}},rV={codeAt:b2(!1),charAt:b2(!0)},Nit=rV.charAt,Pit=f0,y2=WI,Dit=g5,T2=OU,S2="String Iterator",kit=y2.set,Lit=y2.getterFor(S2);Dit(String,"String",function(t){kit(this,{type:S2,string:Pit(t),index:0})},function(){var t,e=Lit(this),n=e.string,o=e.index;return o>=n.length?T2(void 0,!0):(t=Nit(n,o),e.index+=t.length,T2(t,!1))});var Mit=Q0.Promise,Uit={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},xit=_e,jit=mR,Vit=rI,R2=GI,C2=UT("toStringTag");for(var iV in Uit){var I2=xit[iV],oV=I2&&I2.prototype;oV&&jit(oV)!==C2&&Vit(oV,C2,iV),R2[iV]=R2.Array}var w2=Mit,n_=l(w2);const O2=D6;function A2(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const p={};return Object.keys(h).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;const _=typeof h[m]=="object"?h[m]:{ideal:h[m]};_.exact!==void 0&&typeof _.exact=="number"&&(_.min=_.max=_.exact);const g=function(y,C){return y?y+C.charAt(0).toUpperCase()+C.slice(1):C==="deviceId"?"sourceId":C};if(_.ideal!==void 0){p.optional=p.optional||[];let y={};typeof _.ideal=="number"?(y[g("min",m)]=_.ideal,p.optional.push(y),y={},y[g("max",m)]=_.ideal,p.optional.push(y)):(y[g("",m)]=_.ideal,p.optional.push(y))}_.exact!==void 0&&typeof _.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[g("",m)]=_.exact):["min","max"].forEach(y=>{_[y]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[g(y,m)]=_[y])})}),h.advanced&&(p.optional=(p.optional||[]).concat(h.advanced)),p},a=function(h,p){if(e.version>=61)return p(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const m=function(_,g,y){g in _&&!(y in _)&&(_[y]=_[g],delete _[g])};m((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),m(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let m=h.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});const _=e.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||_)){let g;if(delete h.video.facingMode,m.exact==="environment"||m.ideal==="environment"?g=["back","rear"]:m.exact!=="user"&&m.ideal!=="user"||(g=["front"]),g)return n.mediaDevices.enumerateDevices().then(y=>{let C=(y=y.filter(O=>O.kind==="videoinput")).find(O=>g.some(q=>{var L;return o_(L=O.label.toLowerCase()).call(L,q)}));return!C&&y.length&&o_(g).call(g,"back")&&(C=y[y.length-1]),C&&(h.video.deviceId=m.exact?{exact:C.deviceId}:{ideal:C.deviceId}),h.video=o(h.video),O2("chrome: "+JSON.stringify(h)),p(h)})}h.video=o(h.video)}return O2("chrome: "+JSON.stringify(h)),p(h)},d=function(h){return e.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(h,p,m){a(h,_=>{n.webkitGetUserMedia(_,p,g=>{m&&m(d(g))})})}).bind(n),n.mediaDevices.getUserMedia){const h=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(p){return a(p,m=>h(m).then(_=>{if(m.audio&&!_.getAudioTracks().length||m.video&&!_.getVideoTracks().length)throw _.getTracks().forEach(g=>{g.stop()}),new DOMException("","NotFoundError");return _},_=>n_.reject(d(_))))}}}function N2(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function P2(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",o=>{let a;a=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const d=new Event("track");d.track=o.track,d.receiver=a,d.transceiver={receiver:a},d.streams=[n.stream],this.dispatchEvent(d)}),n.stream.getTracks().forEach(o=>{let a;a=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const d=new Event("track");d.track=o,d.receiver=a,d.transceiver={receiver:a},d.streams=[n.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else BI(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function D2(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(a,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=a.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:a}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const a=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,p){let m=a.apply(this,arguments);return m||(m=e(this,h),this._senders.push(m)),m};const d=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const p=this._senders.indexOf(h);p!==-1&&this._senders.splice(p,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],n.apply(this,[a]),a.getTracks().forEach(d=>{this._senders.push(e(this,d))})};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],o.apply(this,[a]),a.getTracks().forEach(d=>{const h=this._senders.find(p=>p.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(o=>o._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function k2(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,o,a]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const d=function(p){const m={};return p.result().forEach(_=>{const g={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(y=>{g[y]=_.stat(y)}),m[g.id]=g}),m},h=function(p){return new Map(Object.keys(p).map(m=>[m,p[m]]))};if(arguments.length>=2){const p=function(m){o(h(d(m)))};return e.apply(this,[p,n])}return new n_((p,m)=>{e.apply(this,[function(_){p(h(d(_)))},m])}).then(o,a)}}function L2(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const a=n.apply(this,[]);return a.forEach(d=>d._pc=this),a});const o=t.RTCPeerConnection.prototype.addTrack;o&&(t.RTCPeerConnection.prototype.addTrack=function(){const a=o.apply(this,arguments);return a._pc=this,a}),t.RTCRtpSender.prototype.getStats=function(){const a=this;return this._pc.getStats().then(d=>M6(d,a.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const o=n.apply(this,[]);return o.forEach(a=>a._pc=this),o}),BI(t,"track",o=>(o.receiver._pc=o.srcElement,o)),t.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>M6(a,o.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let o,a,d;return this.getSenders().forEach(h=>{h.track===n&&(o?d=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===n&&(a?d=!0:a=h),h.track===n)),d||o&&a?n_.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():a?a.getStats():n_.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function M2(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=e.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(p)===-1&&this._shimmedLocalStreams[h.id].push(p):this._shimmedLocalStreams[h.id]=[h,p],p};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(m=>{if(this.getSenders().find(g=>g.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();n.apply(this,arguments);const p=this.getSenders().filter(m=>h.indexOf(m)===-1);this._shimmedLocalStreams[d.id]=[d].concat(p)};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],o.apply(this,arguments)};const a=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const p=this._shimmedLocalStreams[h].indexOf(d);p!==-1&&this._shimmedLocalStreams[h].splice(p,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),a.apply(this,arguments)}}function U2(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return M2(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const m=n.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(_=>this._reverseStreams[_.id])};const o=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(_=>{if(this.getSenders().find(y=>y.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const _=new t.MediaStream(m.getTracks());this._streams[m.id]=_,this._reverseStreams[_.id]=m,m=_}o.apply(this,[m])};const a=t.RTCPeerConnection.prototype.removeStream;function d(m,_){let g=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(y=>{const C=m._reverseStreams[y],O=m._streams[C.id];g=g.replace(new RegExp(O.id,"g"),C.id)}),new RTCSessionDescription({type:_.type,sdp:g})}t.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},t.RTCPeerConnection.prototype.addTrack=function(m,_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const g=[].slice.call(arguments,1);if(g.length!==1||!g[0].getTracks().find(O=>O===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(O=>O.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const C=this._streams[_.id];if(C)C.addTrack(m),n_.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const O=new t.MediaStream([m]);this._streams[_.id]=O,this._reverseStreams[O.id]=_,this.addStream(O)}return this.getSenders().find(O=>O.track===m)},["createOffer","createAnswer"].forEach(function(m){const _=t.RTCPeerConnection.prototype[m],g={[m](){const y=arguments;return arguments.length&&typeof arguments[0]=="function"?_.apply(this,[C=>{const O=d(this,C);y[0].apply(null,[O])},C=>{y[1]&&y[1].apply(null,C)},arguments[2]]):_.apply(this,arguments).then(C=>d(this,C))}};t.RTCPeerConnection.prototype[m]=g[m]});const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,_){let g=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(y=>{const C=m._reverseStreams[y],O=m._streams[C.id];g=g.replace(new RegExp(C.id,"g"),O.id)}),new RTCSessionDescription({type:_.type,sdp:g})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const p=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const m=p.get.apply(this);return m.type===""?m:d(this,m)}}),t.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let _;this._streams=this._streams||{},Object.keys(this._streams).forEach(g=>{this._streams[g].getTracks().find(y=>m.track===y)&&(_=this._streams[g])}),_&&(_.getTracks().length===1?this.removeStream(this._reverseStreams[_.id]):_.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function sV(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const o=t.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=a[n]})}function x2(t,e){BI(t,"negotiationneeded",n=>{const o=n.target;if(!(e.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return n})}var j2=Object.freeze({__proto__:null,fixNegotiationNeeded:x2,shimAddTrackRemoveTrack:U2,shimAddTrackRemoveTrackWithNative:M2,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(o=>{const a=n.video&&n.video.width,d=n.video&&n.video.height,h=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},a&&(n.video.mandatory.maxWidth=a),d&&(n.video.mandatory.maxHeight=d),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:D2,shimGetStats:k2,shimGetUserMedia:A2,shimMediaStream:N2,shimOnTrack:P2,shimPeerConnection:sV,shimSenderReceiverGetStats:L2});function V2(t,e){const n=t&&t.navigator,o=t&&t.MediaStreamTrack;if(n.getUserMedia=function(a,d,h){sU("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(a).then(d,h)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const a=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])},d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),a(h.audio,"autoGainControl","mozAutoGainControl"),a(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const p=h.apply(this,arguments);return a(p,"mozAutoGainControl","autoGainControl"),a(p,"mozNoiseSuppression","noiseSuppression"),p}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(p){return this.kind==="audio"&&typeof p=="object"&&(p=JSON.parse(JSON.stringify(p)),a(p,"autoGainControl","mozAutoGainControl"),a(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function F2(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function aV(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const d=t.RTCPeerConnection.prototype[a],h={[a](){return arguments[0]=new(a==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};t.RTCPeerConnection.prototype[a]=h[a]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[a,d,h]=arguments;return o.apply(this,[a||null]).then(p=>{if(e.version<53&&!d)try{p.forEach(m=>{m.type=n[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;p.forEach((_,g)=>{p.set(g,Object.assign({},_,{type:n[_.type]||_.type}))})}return p}).then(d,h)}}function B2(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=e.apply(this,[]);return o.forEach(a=>a._pc=this),o});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=n.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):n_.resolve(new Map)}}function G2(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(o=>o._pc=this),n}),BI(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function H2(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){sU("removeStream","removeTrack"),this.getSenders().forEach(n=>{var o;n.track&&o_(o=e.getTracks()).call(o,n.track)&&this.removeTrack(n)})})}function W2(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function q2(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const o=n.length>0;o&&n.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const a=e.apply(this,arguments);if(o){const{sender:d}=a,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=n,d.sendEncodings=n,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return a})}function K2(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function z2(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?n_.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Y2(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?n_.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var J2=Object.freeze({__proto__:null,shimAddTransceiver:q2,shimCreateAnswer:Y2,shimCreateOffer:z2,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,n_.reject(o)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:K2,shimGetUserMedia:V2,shimOnTrack:F2,shimPeerConnection:aV,shimRTCDataChannel:W2,shimReceiverGetStats:G2,shimRemoveStream:H2,shimSenderGetStats:B2});function X2(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var o;this._localStreams||(this._localStreams=[]),o_(o=this._localStreams).call(o,n)||this._localStreams.push(n),n.getAudioTracks().forEach(a=>e.call(this,a,n)),n.getVideoTracks().forEach(a=>e.call(this,a,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var o=arguments.length,a=new Array(o>1?o-1:0),d=1;d<o;d++)a[d-1]=arguments[d];return a&&a.forEach(h=>{var p;this._localStreams?o_(p=this._localStreams).call(p,h)||this._localStreams.push(h):this._localStreams=[h]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const o=e.getTracks();this.getSenders().forEach(a=>{o_(o).call(o,a.track)&&this.removeTrack(a)})})}}function Q2(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(a=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),o_(d=this._remoteStreams).call(d,a))return;this._remoteStreams.push(a);const h=new Event("addstream");h.stream=a,this.dispatchEvent(h)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(a=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(a)>=0)return;n._remoteStreams.push(a);const d=new Event("addstream");d.stream=a,n.dispatchEvent(d)})}),e.apply(n,arguments)}}}function Z2(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,o=e.createAnswer,a=e.setLocalDescription,d=e.setRemoteDescription,h=e.addIceCandidate;e.createOffer=function(m,_){const g=arguments.length>=2?arguments[2]:arguments[0],y=n.apply(this,[g]);return _?(y.then(m,_),n_.resolve()):y},e.createAnswer=function(m,_){const g=arguments.length>=2?arguments[2]:arguments[0],y=o.apply(this,[g]);return _?(y.then(m,_),n_.resolve()):y};let p=function(m,_,g){const y=a.apply(this,[m]);return g?(y.then(_,g),n_.resolve()):y};e.setLocalDescription=p,p=function(m,_,g){const y=d.apply(this,[m]);return g?(y.then(_,g),n_.resolve()):y},e.setRemoteDescription=p,p=function(m,_,g){const y=h.apply(this,[m]);return g?(y.then(_,g),n_.resolve()):y},e.addIceCandidate=p}function $2(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,o=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=a=>o(tH(a))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,o,a){e.mediaDevices.getUserMedia(n).then(o,a)}).bind(e))}function tH(t){return t&&t.video!==void 0?Object.assign({},t,{video:L6(t.video)}):t}function eH(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,o){if(n&&n.iceServers){const a=[];for(let d=0;d<n.iceServers.length;d++){let h=n.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(sU("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,a.push(h)):a.push(n.iceServers[d])}n.iceServers=a}return new e(n,o)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function nH(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function rH(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const o=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const a=this.getTransceivers().find(d=>d.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):n.offerToReceiveVideo!==!0||a||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function iH(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var oH=Object.freeze({__proto__:null,shimAudioContext:iH,shimCallbacksAPI:Z2,shimConstraints:tH,shimCreateOfferLegacy:rH,shimGetUserMedia:$2,shimLocalStreamsAPI:X2,shimRTCIceServerUrls:eH,shimRemoteStreamsAPI:Q2,shimTrackEventTransceiver:nH}),sH=`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF`,Fit=CO,Bit=f0,cV=sH,aH=B("".replace),Git=RegExp("^["+cV+"]+"),Hit=RegExp("(^|[^"+cV+"])["+cV+"]+$"),uV=function(t){return function(e){var n=Bit(Fit(e));return 1&t&&(n=aH(n,Git,"")),2&t&&(n=aH(n,Hit,"$1")),n}},Wit={start:uV(1),end:uV(2),trim:uV(3)},qit=u5.PROPER,Kit=f,cH=sH,zit=Wit.trim;uT({target:"String",proto:!0,forced:function(t){return Kit(function(){return!!cH[t]()||"âÂá "[t]()!=="âÂá "||qit&&cH[t].name!==t})}("trim")},{trim:function(){return zit(this)}});var Yit=O0("String").trim,Jit=Q,Xit=Yit,dV=String.prototype,Qit=function(t){var e=t.trim;return typeof t=="string"||t===dV||Jit(dV,t)&&e===dV.trim?Xit:e},TS=l(Qit),uH={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(o=>o.trim())},e.splitSections=function(n){return n.split(`
m=`).map((o,a)=>(a>0?"m="+o:o).trim()+`\r
`)},e.getDescription=function(n){const o=e.splitSections(n);return o&&o[0]},e.getMediaSections=function(n){const o=e.splitSections(n);return o.shift(),o},e.matchPrefix=function(n,o){return e.splitLines(n).filter(a=>a.indexOf(o)===0)},e.parseCandidate=function(n){let o;o=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const a={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let d=8;d<o.length;d+=2)switch(o[d]){case"raddr":a.relatedAddress=o[d+1];break;case"rport":a.relatedPort=parseInt(o[d+1],10);break;case"tcptype":a.tcpType=o[d+1];break;case"ufrag":a.ufrag=o[d+1],a.usernameFragment=o[d+1];break;default:a[o[d]]===void 0&&(a[o[d]]=o[d+1])}return a},e.writeCandidate=function(n){const o=[];o.push(n.foundation);const a=n.component;a==="rtp"?o.push(1):a==="rtcp"?o.push(2):o.push(a),o.push(n.protocol.toUpperCase()),o.push(n.priority),o.push(n.address||n.ip),o.push(n.port);const d=n.type;return o.push("typ"),o.push(d),d!=="host"&&n.relatedAddress&&n.relatedPort&&(o.push("raddr"),o.push(n.relatedAddress),o.push("rport"),o.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(o.push("ufrag"),o.push(n.usernameFragment||n.ufrag)),"candidate:"+o.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let o=n.substring(9).split(" ");const a={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),a.name=o[0],a.clockRate=parseInt(o[1],10),a.channels=o.length===3?parseInt(o[2],10):1,a.numChannels=a.channels,a},e.writeRtpMap=function(n){let o=n.payloadType;n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType);const a=n.channels||n.numChannels||1;return"a=rtpmap:"+o+" "+n.name+"/"+n.clockRate+(a!==1?"/"+a:"")+`\r
`},e.parseExtmap=function(n){const o=n.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const o={};let a;const d=n.substring(n.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)a=d[h].trim().split("="),o[a[0].trim()]=a[1];return o},e.writeFmtp=function(n){let o="",a=n.payloadType;if(n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const d=[];Object.keys(n.parameters).forEach(h=>{n.parameters[h]!==void 0?d.push(h+"="+n.parameters[h]):d.push(h)}),o+="a=fmtp:"+a+" "+d.join(";")+`\r
`}return o},e.parseRtcpFb=function(n){const o=n.substring(n.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},e.writeRtcpFb=function(n){let o="",a=n.payloadType;return n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(d=>{o+="a=rtcp-fb:"+a+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),o},e.parseSsrcMedia=function(n){const o=n.indexOf(" "),a={ssrc:parseInt(n.substring(7,o),10)},d=n.indexOf(":",o);return d>-1?(a.attribute=n.substring(o+1,d),a.value=n.substring(d+1)):a.attribute=n.substring(o+1),a},e.parseSsrcGroup=function(n){const o=n.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(a=>parseInt(a,10))}},e.getMid=function(n){const o=e.matchPrefix(n,"a=mid:")[0];if(o)return o.substring(6)},e.parseFingerprint=function(n){const o=n.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},e.getDtlsParameters=function(n,o){return{role:"auto",fingerprints:e.matchPrefix(n+o,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,o){let a="a=setup:"+o+`\r
`;return n.fingerprints.forEach(d=>{a+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),a},e.parseCryptoLine=function(n){const o=n.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const o=n.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,o){return e.matchPrefix(n+o,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,o){const a=e.matchPrefix(n+o,"a=ice-ufrag:")[0],d=e.matchPrefix(n+o,"a=ice-pwd:")[0];return a&&d?{usernameFragment:a.substring(12),password:d.substring(10)}:null},e.writeIceParameters=function(n){let o="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(o+=`a=ice-lite\r
`),o},e.parseRtpParameters=function(n){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=e.splitLines(n)[0].split(" ");o.profile=a[2];for(let h=3;h<a.length;h++){const p=a[h],m=e.matchPrefix(n,"a=rtpmap:"+p+" ")[0];if(m){const _=e.parseRtpMap(m),g=e.matchPrefix(n,"a=fmtp:"+p+" ");switch(_.parameters=g.length?e.parseFmtp(g[0]):{},_.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+p+" ").map(e.parseRtcpFb),o.codecs.push(_),_.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(_.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(h=>{o.headerExtensions.push(e.parseExtmap(h))});const d=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return o.codecs.forEach(h=>{d.forEach(p=>{h.rtcpFeedback.find(m=>m.type===p.type&&m.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),o},e.writeRtpDescription=function(n,o){let a="";a+="m="+n+" ",a+=o.codecs.length>0?"9":"0",a+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",a+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{a+=e.writeRtpMap(h),a+=e.writeFmtp(h),a+=e.writeRtcpFb(h)});let d=0;return o.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(a+="a=maxptime:"+d+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{a+=e.writeExtmap(h)}),a},e.parseRtpEncodingParameters=function(n){const o=[],a=e.parseRtpParameters(n),d=a.fecMechanisms.indexOf("RED")!==-1,h=a.fecMechanisms.indexOf("ULPFEC")!==-1,p=e.matchPrefix(n,"a=ssrc:").map(C=>e.parseSsrcMedia(C)).filter(C=>C.attribute==="cname"),m=p.length>0&&p[0].ssrc;let _;const g=e.matchPrefix(n,"a=ssrc-group:FID").map(C=>C.substring(17).split(" ").map(O=>parseInt(O,10)));g.length>0&&g[0].length>1&&g[0][0]===m&&(_=g[0][1]),a.codecs.forEach(C=>{if(C.name.toUpperCase()==="RTX"&&C.parameters.apt){let O={ssrc:m,codecPayloadType:parseInt(C.parameters.apt,10)};m&&_&&(O.rtx={ssrc:_}),o.push(O),d&&(O=JSON.parse(JSON.stringify(O)),O.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},o.push(O))}}),o.length===0&&m&&o.push({ssrc:m});let y=e.matchPrefix(n,"b=");return y.length&&(y=y[0].indexOf("b=TIAS:")===0?parseInt(y[0].substring(7),10):y[0].indexOf("b=AS:")===0?1e3*parseInt(y[0].substring(5),10)*.95-16e3:void 0,o.forEach(C=>{C.maxBitrate=y})),o},e.parseRtcpParameters=function(n){const o={},a=e.matchPrefix(n,"a=ssrc:").map(p=>e.parseSsrcMedia(p)).filter(p=>p.attribute==="cname")[0];a&&(o.cname=a.value,o.ssrc=a.ssrc);const d=e.matchPrefix(n,"a=rtcp-rsize");o.reducedSize=d.length>0,o.compound=d.length===0;const h=e.matchPrefix(n,"a=rtcp-mux");return o.mux=h.length>0,o},e.writeRtcpParameters=function(n){let o="";return n.reducedSize&&(o+=`a=rtcp-rsize\r
`),n.mux&&(o+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(o+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),o},e.parseMsid=function(n){let o;const a=e.matchPrefix(n,"a=msid:");if(a.length===1)return o=a[0].substring(7).split(" "),{stream:o[0],track:o[1]};const d=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return d.length>0?(o=d[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},e.parseSctpDescription=function(n){const o=e.parseMLine(n),a=e.matchPrefix(n,"a=max-message-size:");let d;a.length>0&&(d=parseInt(a[0].substring(19),10)),isNaN(d)&&(d=65536);const h=e.matchPrefix(n,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:d};const p=e.matchPrefix(n,"a=sctpmap:");if(p.length>0){const m=p[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:d}}},e.writeSctpDescription=function(n,o){let a=[];return a=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&a.push("a=max-message-size:"+o.maxMessageSize+`\r
`),a.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,o,a){let d;const h=o!==void 0?o:2;return d=n||e.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,o){const a=e.splitLines(n);for(let d=0;d<a.length;d++)switch(a[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[d].substring(2)}return o?e.getDirection(o):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const o=e.splitLines(n)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},e.parseOLine=function(n){const o=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const o=e.splitLines(n);for(let a=0;a<o.length;a++)if(o[a].length<2||o[a].charAt(1)!=="=")return!1;return!0},t.exports=e})(uH);var dH=uH.exports,VO=l(dH),Zit=s({__proto__:null,default:VO},[dH]);function jL(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const o=new e(n),a=VO.parseCandidate(n.candidate),d=Object.assign(o,a);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,BI(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function lV(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||BI(t,"icecandidate",e=>{if(e.candidate){const n=VO.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function VL(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(p){if(!p||!p.sdp)return!1;const m=VO.splitSections(p.sdp);return m.shift(),m.some(_=>{const g=VO.parseMLine(_);return g&&g.kind==="application"&&g.protocol.indexOf("SCTP")!==-1})},o=function(p){const m=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(m===null||m.length<2)return-1;const _=parseInt(m[1],10);return _!=_?-1:_},a=function(p){let m=65536;return e.browser==="firefox"&&(m=e.version<57?p===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),m},d=function(p,m){let _=65536;e.browser==="firefox"&&e.version===57&&(_=65535);const g=VO.matchPrefix(p.sdp,"a=max-message-size:");return g.length>0?_=parseInt(g[0].substr(19),10):e.browser==="firefox"&&m!==-1&&(_=2147483637),_},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const p=o(arguments[0]),m=a(p),_=d(arguments[0],p);let g;g=m===0&&_===0?Number.POSITIVE_INFINITY:m===0||_===0?Math.max(m,_):Math.min(m,_);const y={};Object.defineProperty(y,"maxMessageSize",{get:()=>g}),this._sctp=y}return h.apply(this,arguments)}}function FL(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(o,a){const d=o.send;o.send=function(){const h=arguments[0],p=h.length||h.size||h.byteLength;if(o.readyState==="open"&&a.sctp&&p>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return d.apply(o,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const o=n.apply(this,arguments);return e(o,this),o},BI(t,"datachannel",o=>(e(o.channel,o.target),o))}function hV(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const o=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{const d=a.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",a);d.dispatchEvent(h)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function pV(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const a=o.sdp.split(`
`).filter(d=>TS(d).call(d)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&o instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:o.type,sdp:a}):o.sdp=a}return n.apply(this,arguments)}}function BL(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?n_.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),n_.resolve())})}function GL(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return n.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?n.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var $it=Object.freeze({__proto__:null,removeExtmapAllowMixed:pV,shimAddIceCandidateNullOrEmpty:BL,shimConnectionState:hV,shimMaxMessageSize:VL,shimParameterlessSetLocalDescription:GL,shimRTCIceCandidate:jL,shimRTCIceCandidateRelayProtocol:lV,shimSendThrowTypeError:FL});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=D6,o=function(d){const h={browser:null,version:null};if(d===void 0||!d.navigator)return h.browser="Not a browser.",h;const{navigator:p}=d;if(p.mozGetUserMedia)h.browser="firefox",h.version=fL(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=fL(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=fL(p.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(t),a={browserDetails:o,commonShim:$it,extractVersion:fL,disableLog:Y$,disableWarnings:J$,sdp:Zit};switch(o.browser){case"chrome":if(!j2||!sV||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),a;if(o.version===null)return n("Chrome shim can not determine version, not shimming."),a;n("adapter.js shimming chrome."),a.browserShim=j2,BL(t,o),GL(t),A2(t,o),N2(t),sV(t,o),P2(t),U2(t,o),D2(t),k2(t),L2(t),x2(t,o),jL(t),lV(t),hV(t),VL(t,o),FL(t),pV(t,o);break;case"firefox":if(!J2||!aV||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),a;n("adapter.js shimming firefox."),a.browserShim=J2,BL(t,o),GL(t),V2(t,o),aV(t,o),F2(t),H2(t),B2(t),G2(t),W2(t),q2(t),K2(t),z2(t),Y2(t),jL(t),hV(t),VL(t,o),FL(t);break;case"safari":if(!oH||!e.shimSafari)return n("Safari shim is not included in this adapter release."),a;n("adapter.js shimming safari."),a.browserShim=oH,BL(t,o),GL(t),eH(t),rH(t),Z2(t),X2(t),Q2(t),nH(t),$2(t),iH(t),jL(t),lV(t),VL(t,o),FL(t),pV(t,o);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var tot=O0("Array").keys,eot=mR,not=mS,rot=Q,iot=tot,fV=Array.prototype,oot={DOMTokenList:!0,NodeList:!0},sot=function(t){var e=t.keys;return t===fV||rot(fV,t)&&e===fV.keys||not(oot,eot(t))?iot:e},e0=l(sot),lH=wO,aot=TypeError,cot=uL,uot=w0,dot=tI,HL=function(t,e,n){var o=cot(e);o in t?uot.f(t,o,dot(0,n)):t[o]=n},hH=tU,lot=jR,hot=HL,pot=Array,fot=Math.max,mV=function(t,e,n){for(var o=lot(t),a=hH(e,o),d=hH(n===void 0?o:n,o),h=pot(fot(d-a,0)),p=0;a<d;a++,p++)hot(h,p,t[a]);return h.length=p,h},pH=mV,mot=Math.floor,EV=function(t,e){var n=t.length,o=mot(n/2);return n<8?Eot(t,e):_ot(t,EV(pH(t,0,o),e),EV(pH(t,o),e),e)},Eot=function(t,e){for(var n,o,a=t.length,d=1;d<a;){for(o=d,n=t[d];o&&e(t[o-1],n)>0;)t[o]=t[--o];o!==d++&&(t[o]=n)}return t},_ot=function(t,e,n,o){for(var a=e.length,d=n.length,h=0,p=0;h<a||p<d;)t[h+p]=h<a&&p<d?o(e[h],n[p])<=0?e[h++]:n[p++]:h<a?e[h++]:n[p++];return t},fH=EV,mH=VI.match(/firefox\/(\d+)/i),got=!!mH&&+mH[1],vot=/MSIE|Trident/.test(VI),EH=VI.match(/AppleWebKit\/(\d+)\./),bot=!!EH&&+EH[1],yot=uT,_H=B,Tot=I0,Sot=fR,gH=jR,Rot=function(t,e){if(!delete t[e])throw aot("Cannot delete property "+lH(e)+" of "+lH(t))},vH=f0,_V=f,Cot=fH,Iot=pL,bH=got,wot=vot,yH=FI,TH=bot,aI=[],SH=_H(aI.sort),Oot=_H(aI.push),Aot=_V(function(){aI.sort(void 0)}),Not=_V(function(){aI.sort(null)}),Pot=Iot("sort"),RH=!_V(function(){if(yH)return yH<70;if(!(bH&&bH>3)){if(wot)return!0;if(TH)return TH<603;var t,e,n,o,a="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(o=0;o<47;o++)aI.push({k:e+o,v:n})}for(aI.sort(function(d,h){return h.v-d.v}),o=0;o<aI.length;o++)e=aI[o].k.charAt(0),a.charAt(a.length-1)!==e&&(a+=e);return a!=="DGBEFHACIJK"}});yot({target:"Array",proto:!0,forced:Aot||!Not||!Pot||!RH},{sort:function(t){t!==void 0&&Tot(t);var e=Sot(this);if(RH)return t===void 0?SH(e):SH(e,t);var n,o,a=[],d=gH(e);for(o=0;o<d;o++)o in e&&Oot(a,e[o]);for(Cot(a,function(h){return function(p,m){return m===void 0?-1:p===void 0?1:h!==void 0?+h(p,m)||0:vH(p)>vH(m)?1:-1}}(t)),n=gH(a),o=0;o<n;)e[o]=a[o++];for(;o<d;)Rot(e,o++);return e}});var Dot=O0("Array").sort,kot=Q,Lot=Dot,gV=Array.prototype,Mot=function(t){var e=t.sort;return t===gV||kot(gV,t)&&e===gV.sort?Lot:e},$N=l(Mot),vV={exports:{}};(function(t,e){(function(n,o){var a="function",d="undefined",h="object",p="string",m="major",_="model",g="name",y="type",C="vendor",O="version",q="architecture",L="console",U="mobile",K="tablet",J="smarttv",_r="wearable",_o="embedded",na="Amazon",ba="Apple",_u="ASUS",_l="BlackBerry",_p="Browser",u_="Chrome",W_="Firefox",_v="Google",hT="Huawei",FT="LG",ST="Microsoft",J0="Motorola",_h="Opera",t_="Samsung",f_="Sharp",A_="Sony",$_="Xiaomi",i_="Zebra",j="Facebook",_t="Chromium OS",_n="Mac OS",wE=function(LT){for(var qT={},mT=0;mT<LT.length;mT++)qT[LT[mT].toUpperCase()]=LT[mT];return qT},N_=function(LT,qT){return typeof LT===p&&eT(qT).indexOf(eT(LT))!==-1},eT=function(LT){return LT.toLowerCase()},XT=function(LT,qT){if(typeof LT===p)return LT=LT.replace(/^\s\s*/,""),typeof qT===d?LT:LT.substring(0,350)},qS=function(LT,qT){for(var mT,$S,xR,MT,_g,KS,jI=0;jI<qT.length&&!_g;){var pR=qT[jI],TQ=qT[jI+1];for(mT=$S=0;mT<pR.length&&!_g&&pR[mT];)if(_g=pR[mT++].exec(LT))for(xR=0;xR<TQ.length;xR++)KS=_g[++$S],typeof(MT=TQ[xR])===h&&MT.length>0?MT.length===2?typeof MT[1]==a?this[MT[0]]=MT[1].call(this,KS):this[MT[0]]=MT[1]:MT.length===3?typeof MT[1]!==a||MT[1].exec&&MT[1].test?this[MT[0]]=KS?KS.replace(MT[1],MT[2]):o:this[MT[0]]=KS?MT[1].call(this,KS,MT[2]):o:MT.length===4&&(this[MT[0]]=KS?MT[3].call(this,KS.replace(MT[1],MT[2])):o):this[MT]=KS||o;jI+=2}},_C=function(LT,qT){for(var mT in qT)if(typeof qT[mT]===h&&qT[mT].length>0){for(var $S=0;$S<qT[mT].length;$S++)if(N_(qT[mT][$S],LT))return mT==="?"?o:mT}else if(N_(qT[mT],LT))return mT==="?"?o:mT;return LT},UM={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},xM={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[O,[g,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[O,[g,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[g,O],[/opios[\/ ]+([\w\.]+)/i],[O,[g,_h+" Mini"]],[/\bopr\/([\w\.]+)/i],[O,[g,_h]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[g,O],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[O,[g,"UC"+_p]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[O,[g,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[O,[g,"WeChat"]],[/konqueror\/([\w\.]+)/i],[O,[g,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[O,[g,"IE"]],[/yabrowser\/([\w\.]+)/i],[O,[g,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[g,/(.+)/,"$1 Secure "+_p],O],[/\bfocus\/([\w\.]+)/i],[O,[g,W_+" Focus"]],[/\bopt\/([\w\.]+)/i],[O,[g,_h+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[O,[g,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[O,[g,"Dolphin"]],[/coast\/([\w\.]+)/i],[O,[g,_h+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[O,[g,"MIUI "+_p]],[/fxios\/([-\w\.]+)/i],[O,[g,W_]],[/\bqihu|(qi?ho?o?|360)browser/i],[[g,"360 "+_p]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[g,/(.+)/,"$1 "+_p],O],[/(comodo_dragon)\/([\w\.]+)/i],[[g,/_/g," "],O],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[g,O],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[g],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[g,j],O],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[g,O],[/\bgsa\/([\w\.]+) .*safari\//i],[O,[g,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[O,[g,u_+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[g,u_+" WebView"],O],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[O,[g,"Android "+_p]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[g,O],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[O,[g,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[O,g],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[g,[O,_C,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[g,O],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[g,"Netscape"],O],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[O,[g,W_+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[g,O],[/(cobalt)\/([\w\.]+)/i],[g,[O,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[q,"amd64"]],[/(ia32(?=;))/i],[[q,eT]],[/((?:i[346]|x)86)[;\)]/i],[[q,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[q,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[q,"armhf"]],[/windows (ce|mobile); ppc;/i],[[q,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[q,/ower/,"",eT]],[/(sun4\w)[;\)]/i],[[q,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[q,eT]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[_,[C,t_],[y,K]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[_,[C,t_],[y,U]],[/\((ip(?:hone|od)[\w ]*);/i],[_,[C,ba],[y,U]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[_,[C,ba],[y,K]],[/(macintosh);/i],[_,[C,ba]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[_,[C,f_],[y,U]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[_,[C,hT],[y,K]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[_,[C,hT],[y,U]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[_,/_/g," "],[C,$_],[y,U]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[_,/_/g," "],[C,$_],[y,K]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[_,[C,"OPPO"],[y,U]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[_,[C,"Vivo"],[y,U]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[_,[C,"Realme"],[y,U]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[_,[C,J0],[y,U]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[_,[C,J0],[y,K]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[_,[C,FT],[y,K]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[_,[C,FT],[y,U]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[_,[C,"Lenovo"],[y,K]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[_,/_/g," "],[C,"Nokia"],[y,U]],[/(pixel c)\b/i],[_,[C,_v],[y,K]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[_,[C,_v],[y,U]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[_,[C,A_],[y,U]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[_,"Xperia Tablet"],[C,A_],[y,K]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[_,[C,"OnePlus"],[y,U]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[_,[C,na],[y,K]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[_,/(.+)/g,"Fire Phone $1"],[C,na],[y,U]],[/(playbook);[-\w\),; ]+(rim)/i],[_,C,[y,K]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[_,[C,_l],[y,U]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[_,[C,_u],[y,K]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[_,[C,_u],[y,U]],[/(nexus 9)/i],[_,[C,"HTC"],[y,K]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[C,[_,/_/g," "],[y,U]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[_,[C,"Acer"],[y,K]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[_,[C,"Meizu"],[y,U]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[C,_,[y,U]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[C,_,[y,K]],[/(surface duo)/i],[_,[C,ST],[y,K]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[_,[C,"Fairphone"],[y,U]],[/(u304aa)/i],[_,[C,"AT&T"],[y,U]],[/\bsie-(\w*)/i],[_,[C,"Siemens"],[y,U]],[/\b(rct\w+) b/i],[_,[C,"RCA"],[y,K]],[/\b(venue[\d ]{2,7}) b/i],[_,[C,"Dell"],[y,K]],[/\b(q(?:mv|ta)\w+) b/i],[_,[C,"Verizon"],[y,K]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[_,[C,"Barnes & Noble"],[y,K]],[/\b(tm\d{3}\w+) b/i],[_,[C,"NuVision"],[y,K]],[/\b(k88) b/i],[_,[C,"ZTE"],[y,K]],[/\b(nx\d{3}j) b/i],[_,[C,"ZTE"],[y,U]],[/\b(gen\d{3}) b.+49h/i],[_,[C,"Swiss"],[y,U]],[/\b(zur\d{3}) b/i],[_,[C,"Swiss"],[y,K]],[/\b((zeki)?tb.*\b) b/i],[_,[C,"Zeki"],[y,K]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[C,"Dragon Touch"],_,[y,K]],[/\b(ns-?\w{0,9}) b/i],[_,[C,"Insignia"],[y,K]],[/\b((nxa|next)-?\w{0,9}) b/i],[_,[C,"NextBook"],[y,K]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[C,"Voice"],_,[y,U]],[/\b(lvtel\-)?(v1[12]) b/i],[[C,"LvTel"],_,[y,U]],[/\b(ph-1) /i],[_,[C,"Essential"],[y,U]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[_,[C,"Envizen"],[y,K]],[/\b(trio[-\w\. ]+) b/i],[_,[C,"MachSpeed"],[y,K]],[/\btu_(1491) b/i],[_,[C,"Rotor"],[y,K]],[/(shield[\w ]+) b/i],[_,[C,"Nvidia"],[y,K]],[/(sprint) (\w+)/i],[C,_,[y,U]],[/(kin\.[onetw]{3})/i],[[_,/\./g," "],[C,ST],[y,U]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[_,[C,i_],[y,K]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[_,[C,i_],[y,U]],[/smart-tv.+(samsung)/i],[C,[y,J]],[/hbbtv.+maple;(\d+)/i],[[_,/^/,"SmartTV"],[C,t_],[y,J]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[C,FT],[y,J]],[/(apple) ?tv/i],[C,[_,ba+" TV"],[y,J]],[/crkey/i],[[_,u_+"cast"],[C,_v],[y,J]],[/droid.+aft(\w)( bui|\))/i],[_,[C,na],[y,J]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[_,[C,f_],[y,J]],[/(bravia[\w ]+)( bui|\))/i],[_,[C,A_],[y,J]],[/(mitv-\w{5}) bui/i],[_,[C,$_],[y,J]],[/Hbbtv.*(technisat) (.*);/i],[C,_,[y,J]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[C,XT],[_,XT],[y,J]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[y,J]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[C,_,[y,L]],[/droid.+; (shield) bui/i],[_,[C,"Nvidia"],[y,L]],[/(playstation [345portablevi]+)/i],[_,[C,A_],[y,L]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[_,[C,ST],[y,L]],[/((pebble))app/i],[C,_,[y,_r]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[_,[C,ba],[y,_r]],[/droid.+; (glass) \d/i],[_,[C,_v],[y,_r]],[/droid.+; (wt63?0{2,3})\)/i],[_,[C,i_],[y,_r]],[/(quest( 2| pro)?)/i],[_,[C,j],[y,_r]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[C,[y,_o]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[_,[y,U]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[_,[y,K]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[y,K]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[y,U]],[/(android[-\w\. ]{0,9});.+buil/i],[_,[C,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[O,[g,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[O,[g,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[g,O],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[O,g]],os:[[/microsoft (windows) (vista|xp)/i],[g,O],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[g,[O,_C,UM]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,"Windows"],[O,_C,UM]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[O,/_/g,"."],[g,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[g,_n],[O,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[O,g],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[g,O],[/\(bb(10);/i],[O,[g,_l]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[O,[g,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[O,[g,W_+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[O,[g,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[O,[g,"watchOS"]],[/crkey\/([\d\.]+)/i],[O,[g,u_+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[g,_t],O],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[g,O],[/(sunos) ?([\w\.\d]*)/i],[[g,"Solaris"],O],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[g,O]]},C0=function(LT,qT){if(typeof LT===h&&(qT=LT,LT=o),!(this instanceof C0))return new C0(LT,qT).getResult();var mT=typeof n!==d&&n.navigator?n.navigator:o,$S=LT||(mT&&mT.userAgent?mT.userAgent:""),xR=mT&&mT.userAgentData?mT.userAgentData:o,MT=qT?function(_g,KS){var jI={};for(var pR in _g)KS[pR]&&KS[pR].length%2==0?jI[pR]=KS[pR].concat(_g[pR]):jI[pR]=_g[pR];return jI}(xM,qT):xM;return this.getBrowser=function(){var _g={};return _g[g]=o,_g[O]=o,qS.call(_g,$S,MT.browser),_g[m]=function(KS){return typeof KS===p?KS.replace(/[^\d\.]/g,"").split(".")[0]:o}(_g[O]),mT&&mT.brave&&typeof mT.brave.isBrave==a&&(_g[g]="Brave"),_g},this.getCPU=function(){var _g={};return _g[q]=o,qS.call(_g,$S,MT.cpu),_g},this.getDevice=function(){var _g={};return _g[C]=o,_g[_]=o,_g[y]=o,qS.call(_g,$S,MT.device),!_g[y]&&xR&&xR.mobile&&(_g[y]=U),_g[_]=="Macintosh"&&mT&&typeof mT.standalone!==d&&mT.maxTouchPoints&&mT.maxTouchPoints>2&&(_g[_]="iPad",_g[y]=K),_g},this.getEngine=function(){var _g={};return _g[g]=o,_g[O]=o,qS.call(_g,$S,MT.engine),_g},this.getOS=function(){var _g={};return _g[g]=o,_g[O]=o,qS.call(_g,$S,MT.os),!_g[g]&&xR&&xR.platform!="Unknown"&&(_g[g]=xR.platform.replace(/chrome os/i,_t).replace(/macos/i,_n)),_g},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return $S},this.setUA=function(_g){return $S=typeof _g===p&&_g.length>350?XT(_g,350):_g,this},this.setUA($S),this};C0.VERSION="0.7.34",C0.BROWSER=wE([g,O,m]),C0.CPU=wE([q]),C0.DEVICE=wE([_,C,y,L,U,J,K,_r,_o]),C0.ENGINE=C0.OS=wE([g,O]),t.exports&&(e=t.exports=C0),e.UAParser=C0;var xI=typeof n!==d&&(n.jQuery||n.Zepto);if(xI&&!xI.ua){var xN=new C0;xI.ua=xN.getResult(),xI.ua.get=function(){return xN.getUA()},xI.ua.set=function(LT){xN.setUA(LT);var qT=xN.getResult();for(var mT in qT)xI.ua[mT]=qT[mT]}}})(typeof window=="object"?window:u)})(vV,vV.exports);var Uot=l(vV.exports),xot=mR,jot=mS,Vot=RO,Fot=GI,Bot=UT("iterator"),Got=Object,Hot=function(t){if(Vot(t))return!1;var e=Got(t);return e[Bot]!==void 0||"@@iterator"in e||jot(Fot,xot(e))},Wot=l(Hot),bV=_e;uT({global:!0,forced:bV.globalThis!==bV},{globalThis:bV});var CH=l(_e);function IH(t,e){return function(){return t.apply(e,arguments)}}const{toString:qot}=Object.prototype,{getPrototypeOf:yV}=Object,WL=(TV=Object.create(null),t=>{const e=qot.call(t);return TV[e]||(TV[e]=e.slice(8,-1).toLowerCase())});var TV;const gR=t=>(t=t.toLowerCase(),e=>WL(e)===t),qL=t=>e=>typeof e===t,{isArray:FO}=Array,tP=qL("undefined"),wH=gR("ArrayBuffer"),Kot=qL("string"),A0=qL("function"),OH=qL("number"),KL=t=>t!==null&&typeof t=="object",zL=t=>{if(WL(t)!=="object")return!1;const e=yV(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.toStringTag in t||Wot(t))},zot=gR("Date"),Yot=gR("File"),Jot=gR("Blob"),Xot=gR("FileList"),Qot=gR("URLSearchParams");function eP(t,e){let n,o,{allOwnKeys:a=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),FO(t))for(n=0,o=t.length;n<o;n++)e.call(null,t[n],n,t);else{const d=a?Object.getOwnPropertyNames(t):Object.keys(t),h=d.length;let p;for(n=0;n<h;n++)p=d[n],e.call(null,t[p],p,t)}}function AH(t,e){e=e.toLowerCase();const n=Object.keys(t);let o,a=n.length;for(;a-- >0;)if(o=n[a],e===o.toLowerCase())return o;return null}const NH=CH!==void 0?CH:typeof self<"u"?self:typeof window<"u"?window:commonjsGlobal,PH=t=>!tP(t)&&t!==NH,Zot=(SV=typeof Uint8Array<"u"&&yV(Uint8Array),t=>SV&&t instanceof SV);var SV;const $ot=gR("HTMLFormElement"),DH=(t=>{let{hasOwnProperty:e}=t;return(n,o)=>e.call(n,o)})(Object.prototype),tst=gR("RegExp"),kH=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),o={};eP(n,(a,d)=>{let h;(h=e(a,d,t))!==!1&&(o[d]=h||a)}),Object.defineProperties(t,o)},RV="abcdefghijklmnopqrstuvwxyz",LH="0123456789",MH={DIGIT:LH,ALPHA:RV,ALPHA_DIGIT:RV+RV.toUpperCase()+LH},est=gR("AsyncFunction");var p_={isArray:FO,isArrayBuffer:wH,isBuffer:function(t){return t!==null&&!tP(t)&&t.constructor!==null&&!tP(t.constructor)&&A0(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||A0(t.append)&&((e=WL(t))==="formdata"||e==="object"&&A0(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&wH(t.buffer),e},isString:Kot,isNumber:OH,isBoolean:t=>t===!0||t===!1,isObject:KL,isPlainObject:zL,isUndefined:tP,isDate:zot,isFile:Yot,isBlob:Jot,isRegExp:tst,isFunction:A0,isStream:t=>KL(t)&&A0(t.pipe),isURLSearchParams:Qot,isTypedArray:Zot,isFileList:Xot,forEach:eP,merge:function t(){const{caseless:e}=PH(this)&&this||{},n={},o=(a,d)=>{const h=e&&AH(n,d)||d;zL(n[h])&&zL(a)?n[h]=t(n[h],a):zL(a)?n[h]=t({},a):FO(a)?n[h]=a.slice():n[h]=a};for(let a=0,d=arguments.length;a<d;a++)arguments[a]&&eP(arguments[a],o);return n},extend:function(t,e,n){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return eP(e,(a,d)=>{n&&A0(a)?t[d]=IH(a,n):t[d]=a},{allOwnKeys:o}),t},trim:t=>TS(t)?TS(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,o)=>{t.prototype=Object.create(e.prototype,o),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,o)=>{let a,d,h;const p={};if(e=e||{},t==null)return e;do{for(a=Object.getOwnPropertyNames(t),d=a.length;d-- >0;)h=a[d],o&&!o(h,t,e)||p[h]||(e[h]=t[h],p[h]=!0);t=n!==!1&&yV(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:WL,kindOfTest:gR,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const o=t.indexOf(e,n);return o!==-1&&o===n},toArray:t=>{if(!t)return null;if(FO(t))return t;let e=t.length;if(!OH(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let o;for(;(o=n.next())&&!o.done;){const a=o.value;e.call(t,a[0],a[1])}},matchAll:(t,e)=>{let n;const o=[];for(;(n=t.exec(e))!==null;)o.push(n);return o},isHTMLForm:$ot,hasOwnProperty:DH,hasOwnProp:DH,reduceDescriptors:kH,freezeMethods:t=>{kH(t,(e,n)=>{if(A0(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const o=t[n];A0(o)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},o=a=>{a.forEach(d=>{n[d]=!0})};return FO(t)?o(t):o(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,o){return n.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(t,e)=>(t=+t,Number.isFinite(t)?t:e),findKey:AH,global:NH,isContextDefined:PH,ALPHABET:MH,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:MH.ALPHA_DIGIT,n="";const{length:o}=e;for(;t--;)n+=e[Math.random()*o|0];return n},isSpecCompliantForm:function(t){return!!(t&&A0(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),n=(o,a)=>{if(KL(o)){if(e.indexOf(o)>=0)return;if(!("toJSON"in o)){e[a]=o;const d=FO(o)?[]:{};return eP(o,(h,p)=>{const m=n(h,a+1);!tP(m)&&(d[p]=m)}),e[a]=void 0,d}}return o};return n(t,0)},isAsyncFn:est,isThenable:t=>t&&(KL(t)||A0(t))&&A0(t.then)&&A0(t.catch)};function bT(t,e,n,o,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),o&&(this.request=o),a&&(this.response=a)}p_.inherits(bT,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:p_.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const UH=bT.prototype,xH={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{xH[t]={value:t}}),Object.defineProperties(bT,xH),Object.defineProperty(UH,"isAxiosError",{value:!0}),bT.from=(t,e,n,o,a,d)=>{const h=Object.create(UH);return p_.toFlatObject(t,h,function(p){return p!==Error.prototype},p=>p!=="isAxiosError"),bT.call(h,t.message,e,n,o,a),h.cause=t,h.name=t.name,d&&Object.assign(h,d),h};function CV(t){return p_.isPlainObject(t)||p_.isArray(t)}function jH(t){return p_.endsWith(t,"[]")?t.slice(0,-2):t}function VH(t,e,n){return t?t.concat(e).map(function(o,a){return o=jH(o),!n&&a?"["+o+"]":o}).join(n?".":""):e}const nst=p_.toFlatObject(p_,{},null,function(t){return/^is[A-Z]/.test(t)});function YL(t,e,n){if(!p_.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const o=(n=p_.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(C,O){return!p_.isUndefined(O[C])})).metaTokens,a=n.visitor||_,d=n.dots,h=n.indexes,p=(n.Blob||typeof Blob<"u"&&Blob)&&p_.isSpecCompliantForm(e);if(!p_.isFunction(a))throw new TypeError("visitor must be a function");function m(C){if(C===null)return"";if(p_.isDate(C))return C.toISOString();if(!p&&p_.isBlob(C))throw new bT("Blob is not supported. Use a Buffer instead.");return p_.isArrayBuffer(C)||p_.isTypedArray(C)?p&&typeof Blob=="function"?new Blob([C]):Buffer.from(C):C}function _(C,O,q){let L=C;if(C&&!q&&typeof C=="object"){if(p_.endsWith(O,"{}"))O=o?O:O.slice(0,-2),C=JSON.stringify(C);else if(p_.isArray(C)&&function(U){return p_.isArray(U)&&!U.some(CV)}(C)||(p_.isFileList(C)||p_.endsWith(O,"[]"))&&(L=p_.toArray(C)))return O=jH(O),L.forEach(function(U,K){!p_.isUndefined(U)&&U!==null&&e.append(h===!0?VH([O],K,d):h===null?O:O+"[]",m(U))}),!1}return!!CV(C)||(e.append(VH(q,O,d),m(C)),!1)}const g=[],y=Object.assign(nst,{defaultVisitor:_,convertValue:m,isVisitable:CV});if(!p_.isObject(t))throw new TypeError("data must be an object");return function C(O,q){if(!p_.isUndefined(O)){if(g.indexOf(O)!==-1)throw Error("Circular reference detected in "+q.join("."));g.push(O),p_.forEach(O,function(L,U){(!(p_.isUndefined(L)||L===null)&&a.call(e,L,p_.isString(U)?TS(U).call(U):U,q,y))===!0&&C(L,q?q.concat(U):[U])}),g.pop()}}(t),e}function FH(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function IV(t,e){this._pairs=[],t&&YL(t,this,e)}const BH=IV.prototype;function rst(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function GH(t,e,n){if(!e)return t;const o=n&&n.encode||rst,a=n&&n.serialize;let d;if(d=a?a(e,n):p_.isURLSearchParams(e)?e.toString():new IV(e,n).toString(o),d){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+d}return t}BH.append=function(t,e){this._pairs.push([t,e])},BH.toString=function(t){const e=t?function(n){return t.call(this,n,FH)}:FH;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var HH=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){p_.forEach(this.handlers,function(e){e!==null&&t(e)})}},WH={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},qH={exports:{}},ist=uT,ost=r_,KH=w0.f;ist({target:"Object",stat:!0,forced:Object.defineProperty!==KH,sham:!ost},{defineProperty:KH});var zH=Q0.Object,sst=qH.exports=function(t,e,n){return zH.defineProperty(t,e,n)};zH.defineProperty.sham&&(sst.sham=!0);var YH=l(qH.exports),ast=g_,nP=Array.isArray||function(t){return ast(t)=="Array"},cst=TypeError,JH=nP,ust=NL,dst=t0,lst=UT("species"),XH=Array,hst=function(t){var e;return JH(t)&&(e=t.constructor,(ust(e)&&(e===XH||JH(e.prototype))||dst(e)&&(e=e[lst])===null)&&(e=void 0)),e===void 0?XH:e},QH=function(t,e){return new(hst(t))(e===0?0:e)},pst=f,fst=FI,mst=UT("species"),ZH=function(t){return fst>=51||!pst(function(){var e=[];return(e.constructor={})[mst]=function(){return{foo:1}},e[t](Boolean).foo!==1})},Est=uT,_st=f,gst=nP,vst=t0,bst=fR,yst=jR,$H=function(t){if(t>9007199254740991)throw cst("Maximum allowed index exceeded");return t},tW=HL,Tst=QH,Sst=ZH,Rst=FI,eW=UT("isConcatSpreadable"),Cst=Rst>=51||!_st(function(){var t=[];return t[eW]=!1,t.concat()[0]!==t}),Ist=function(t){if(!vst(t))return!1;var e=t[eW];return e!==void 0?!!e:gst(t)};Est({target:"Array",proto:!0,arity:1,forced:!Cst||!Sst("concat")},{concat:function(t){var e,n,o,a,d,h=bst(this),p=Tst(h,0),m=0;for(e=-1,o=arguments.length;e<o;e++)if(Ist(d=e===-1?h:arguments[e]))for(a=yst(d),$H(m+a),n=0;n<a;n++,m++)n in d&&tW(p,m,d[n]);else $H(m+1),tW(p,m++,d);return p.length=m,p}});var nW={},wst=g_,Ost=eI,rW=EL.f,Ast=mV,iW=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];nW.f=function(t){return iW&&wst(t)=="Window"?function(e){try{return rW(e)}catch{return Ast(iW)}}(t):rW(Ost(t))};var BO={},Nst=UT;BO.f=Nst;var oW=Q0,Pst=mS,Dst=BO,kst=w0.f,dS=function(t){var e=oW.Symbol||(oW.Symbol={});Pst(e,t)||kst(e,t,{value:Dst.f(t)})},Lst=U_,Mst=zS,Ust=UT,xst=iI,sW=function(){var t=Mst("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,o=Ust("toPrimitive");e&&!e[o]&&xst(e,o,function(a){return Lst(n,this)},{arity:1})},jst=nI,Vst=aL,Fst=fR,Bst=jR,Gst=QH,aW=B([].push),cI=function(t){var e=t==1,n=t==2,o=t==3,a=t==4,d=t==6,h=t==7,p=t==5||d;return function(m,_,g,y){for(var C,O,q=Fst(m),L=Vst(q),U=jst(_,g),K=Bst(L),J=0,_r=y||Gst,_o=e?_r(m,K):n||h?_r(m,0):void 0;K>J;J++)if((p||J in L)&&(O=U(C=L[J],J,q),t))if(e)_o[J]=O;else if(O)switch(t){case 3:return!0;case 5:return C;case 6:return J;case 2:aW(_o,C)}else switch(t){case 4:return!1;case 7:aW(_o,C)}return d?-1:o||a?a:_o}},cW={forEach:cI(0),map:cI(1),filter:cI(2),some:cI(3),every:cI(4),find:cI(5),findIndex:cI(6),filterReject:cI(7)},JL=uT,wV=_e,OV=U_,Hst=B,GO=r_,HO=IO,Wst=f,OS=mS,qst=Q,AV=VS,XL=eI,NV=uL,Kst=f0,PV=tI,rP=HN,uW=gL,zst=EL,dW=nW,Yst=GN,lW=_f,hW=w0,Jst=hU,pW=w_,fW=iI,Xst=AL,DV=OO,mW=_L,EW=qM,Qst=UT,Zst=BO,$st=dS,tat=sW,eat=oI,_W=WI,QL=cW.forEach,n0=mL("hidden"),ZL="Symbol",iP="prototype",nat=_W.set,gW=_W.getterFor(ZL),$0=Object[iP],zI=wV.Symbol,$L=zI&&zI[iP],rat=wV.TypeError,kV=wV.QObject,vW=lW.f,YI=hW.f,bW=dW.f,iat=pW.f,yW=Hst([].push),VR=DV("symbols"),oP=DV("op-symbols"),oat=DV("wks"),LV=!kV||!kV[iP]||!kV[iP].findChild,MV=GO&&Wst(function(){return rP(YI({},"a",{get:function(){return YI(this,"a",{value:7}).a}})).a!=7})?function(t,e,n){var o=vW($0,e);o&&delete $0[e],YI(t,e,n),o&&t!==$0&&YI($0,e,o)}:YI,UV=function(t,e){var n=VR[t]=rP($L);return nat(n,{type:ZL,tag:t,description:e}),GO||(n.description=e),n},t1=function(t,e,n){t===$0&&t1(oP,e,n),AV(t);var o=NV(e);return AV(n),OS(VR,o)?(n.enumerable?(OS(t,n0)&&t[n0][o]&&(t[n0][o]=!1),n=rP(n,{enumerable:PV(0,!1)})):(OS(t,n0)||YI(t,n0,PV(1,{})),t[n0][o]=!0),MV(t,o,n)):YI(t,o,n)},xV=function(t,e){AV(t);var n=XL(e),o=uW(n).concat(CW(n));return QL(o,function(a){GO&&!OV(TW,n,a)||t1(t,a,n[a])}),t},TW=function(t){var e=NV(t),n=OV(iat,this,e);return!(this===$0&&OS(VR,e)&&!OS(oP,e))&&(!(n||!OS(this,e)||!OS(VR,e)||OS(this,n0)&&this[n0][e])||n)},SW=function(t,e){var n=XL(t),o=NV(e);if(n!==$0||!OS(VR,o)||OS(oP,o)){var a=vW(n,o);return!a||!OS(VR,o)||OS(n,n0)&&n[n0][o]||(a.enumerable=!0),a}},RW=function(t){var e=bW(XL(t)),n=[];return QL(e,function(o){OS(VR,o)||OS(mW,o)||yW(n,o)}),n},CW=function(t){var e=t===$0,n=bW(e?oP:XL(t)),o=[];return QL(n,function(a){!OS(VR,a)||e&&!OS($0,a)||yW(o,VR[a])}),o};HO||(zI=function(){if(qst($L,this))throw rat("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?Kst(arguments[0]):void 0,e=EW(t),n=function(o){this===$0&&OV(n,oP,o),OS(this,n0)&&OS(this[n0],e)&&(this[n0][e]=!1),MV(this,e,PV(1,o))};return GO&&LV&&MV($0,e,{configurable:!0,set:n}),UV(e,t)},fW($L=zI[iP],"toString",function(){return gW(this).tag}),fW(zI,"withoutSetter",function(t){return UV(EW(t),t)}),pW.f=TW,hW.f=t1,Jst.f=xV,lW.f=SW,zst.f=dW.f=RW,Yst.f=CW,Zst.f=function(t){return UV(Qst(t),t)},GO&&Xst($L,"description",{configurable:!0,get:function(){return gW(this).description}})),JL({global:!0,constructor:!0,wrap:!0,forced:!HO,sham:!HO},{Symbol:zI}),QL(uW(oat),function(t){$st(t)}),JL({target:ZL,stat:!0,forced:!HO},{useSetter:function(){LV=!0},useSimple:function(){LV=!1}}),JL({target:"Object",stat:!0,forced:!HO,sham:!GO},{create:function(t,e){return e===void 0?rP(t):xV(rP(t),e)},defineProperty:t1,defineProperties:xV,getOwnPropertyDescriptor:SW}),JL({target:"Object",stat:!0,forced:!HO},{getOwnPropertyNames:RW}),tat(),eat(zI,ZL),mW[n0]=!0;var IW=IO&&!!Symbol.for&&!!Symbol.keyFor,sat=uT,aat=zS,cat=mS,uat=f0,wW=OO,dat=IW,jV=wW("string-to-symbol-registry"),lat=wW("symbol-to-string-registry");sat({target:"Symbol",stat:!0,forced:!dat},{for:function(t){var e=uat(t);if(cat(jV,e))return jV[e];var n=aat("Symbol")(e);return jV[e]=n,lat[n]=e,n}});var hat=uT,pat=mS,fat=VN,mat=wO,Eat=IW,OW=OO("symbol-to-string-registry");hat({target:"Symbol",stat:!0,forced:!Eat},{keyFor:function(t){if(!fat(t))throw TypeError(mat(t)+" is not a symbol");if(pat(OW,t))return OW[t]}});var AW=nP,_at=_c,NW=g_,gat=f0,PW=B([].push),vat=uT,DW=zS,kW=_d,bat=U_,sP=B,LW=f,MW=_c,UW=VN,xW=LU,yat=function(t){if(_at(t))return t;if(AW(t)){for(var e=t.length,n=[],o=0;o<e;o++){var a=t[o];typeof a=="string"?PW(n,a):typeof a!="number"&&NW(a)!="Number"&&NW(a)!="String"||PW(n,gat(a))}var d=n.length,h=!0;return function(p,m){if(h)return h=!1,m;if(AW(this))return m;for(var _=0;_<d;_++)if(n[_]===p)return m}}},Tat=IO,Sat=String,uI=DW("JSON","stringify"),e1=sP(/./.exec),jW=sP("".charAt),Rat=sP("".charCodeAt),Cat=sP("".replace),Iat=sP(1 .toString),wat=/[\uD800-\uDFFF]/g,VW=/^[\uD800-\uDBFF]$/,FW=/^[\uDC00-\uDFFF]$/,BW=!Tat||LW(function(){var t=DW("Symbol")();return uI([t])!="[null]"||uI({a:t})!="{}"||uI(Object(t))!="{}"}),GW=LW(function(){return uI("\uDF06\uD834")!=='"\\udf06\\ud834"'||uI("\uDEAD")!=='"\\udead"'}),Oat=function(t,e){var n=xW(arguments),o=yat(e);if(MW(o)||t!==void 0&&!UW(t))return n[1]=function(a,d){if(MW(o)&&(d=bat(o,this,Sat(a),d)),!UW(d))return d},kW(uI,null,n)},Aat=function(t,e,n){var o=jW(n,e-1),a=jW(n,e+1);return e1(VW,t)&&!e1(FW,a)||e1(FW,t)&&!e1(VW,o)?"\\u"+Iat(Rat(t,0),16):t};uI&&vat({target:"JSON",stat:!0,arity:3,forced:BW||GW},{stringify:function(t,e,n){var o=xW(arguments),a=kW(BW?Oat:uI,null,o);return GW&&typeof a=="string"?Cat(a,wat,Aat):a}});var HW=GN,Nat=fR;uT({target:"Object",stat:!0,forced:!IO||f(function(){HW.f(1)})},{getOwnPropertySymbols:function(t){var e=HW.f;return e?e(Nat(t)):[]}}),dS("asyncIterator"),dS("hasInstance"),dS("isConcatSpreadable"),dS("iterator"),dS("match"),dS("matchAll"),dS("replace"),dS("search"),dS("species"),dS("split");var Pat=sW;dS("toPrimitive"),Pat();var Dat=zS,kat=oI;dS("toStringTag"),kat(Dat("Symbol"),"Symbol"),dS("unscopables"),oI(_e.JSON,"JSON",!0);var Lat=Q0.Symbol,Mat=UT,Uat=w0.f,WW=Mat("metadata"),qW=Function.prototype;qW[WW]===void 0&&Uat(qW,WW,{value:null}),dS("dispose"),dS("metadata");var xat=Lat;dS("asyncDispose");var jat=B,VV=zS("Symbol"),Vat=VV.keyFor,Fat=jat(VV.prototype.valueOf),KW=VV.isRegisteredSymbol||function(t){try{return Vat(Fat(t))!==void 0}catch{return!1}};uT({target:"Symbol",stat:!0},{isRegisteredSymbol:KW});for(var Bat=OO,zW=zS,Gat=B,Hat=VN,Wat=UT,n1=zW("Symbol"),YW=n1.isWellKnownSymbol,JW=zW("Object","getOwnPropertyNames"),qat=Gat(n1.prototype.valueOf),XW=Bat("wks"),FV=0,QW=JW(n1),Kat=QW.length;FV<Kat;FV++)try{var ZW=QW[FV];Hat(n1[ZW])&&Wat(ZW)}catch{}var $W=function(t){if(YW&&YW(t))return!0;try{for(var e=qat(t),n=0,o=JW(XW),a=o.length;n<a;n++)if(XW[o[n]]==e)return!0}catch{}return!1};uT({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:$W}),dS("matcher"),dS("observable"),uT({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:KW}),uT({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:$W}),dS("metadataKey"),dS("patternMatch"),dS("replaceAll");var WO=l(xat),_q=l(BO.f("iterator"));function aP(t){return aP=typeof WO=="function"&&typeof _q=="symbol"?function(e){return typeof e}:function(e){return e&&typeof WO=="function"&&e.constructor===WO&&e!==WO.prototype?"symbol":typeof e},aP(t)}var zat=l(BO.f("toPrimitive"));function Yat(t){var e=function(n,o){if(aP(n)!=="object"||n===null)return n;var a=n[zat];if(a!==void 0){var d=a.call(n,o||"default");if(aP(d)!=="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(n)}(t,"string");return aP(e)==="symbol"?e:String(e)}function F(t,e,n){return(e=Yat(e))in t?YH(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Jat=f,Xat=UT("iterator"),BV=!Jat(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2"),o="";return t.pathname="c%20d",e.forEach(function(a,d){e.delete("b"),o+=d+a}),n.delete("a",2),!t.toJSON||!n.has("a",1)||n.has("a",2)||!e.size&&!0||!e.sort||t.href!=="http://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[Xat]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://ÑÐµÑÑ").host!=="xn--e1aybc"||new URL("http://a#Ð±").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Qat=iI,GV=uT,qO=_e,r1=U_,vR=B,KO=r_,t4=BV,e4=iI,Zat=AL,$at=function(t,e,n){for(var o in e)n&&n.unsafe&&t[o]?t[o]=e[o]:Qat(t,o,e[o],n);return t},tct=oI,ect=IU,HV=WI,n4=AU,WV=_c,nct=mS,rct=nI,ict=mR,oct=VS,r4=t0,YS=f0,sct=HN,i4=tI,qV=EU,act=yL,zO=PL,cct=fH,uct=UT("iterator"),cP="URLSearchParams",o4=cP+"Iterator",s4=HV.set,N0=HV.getterFor(cP),dct=HV.getterFor(o4),lct=Object.getOwnPropertyDescriptor,KV=function(t){if(!KO)return qO[t];var e=lct(qO,t);return e&&e.value},a4=KV("fetch"),i1=KV("Request"),uP=KV("Headers"),zV=i1&&i1.prototype,c4=uP&&uP.prototype,hct=qO.RegExp,pct=qO.TypeError,u4=qO.decodeURIComponent,fct=qO.encodeURIComponent,mct=vR("".charAt),d4=vR([].join),JI=vR([].push),YV=vR("".replace),Ect=vR([].shift),l4=vR([].splice),h4=vR("".split),_ct=vR("".slice),gct=/\+/g,p4=Array(4),vct=function(t){return p4[t-1]||(p4[t-1]=hct("((?:%[\\da-f]{2}){"+t+"})","gi"))},bct=function(t){try{return u4(t)}catch{return t}},f4=function(t){var e=YV(t,gct," "),n=4;try{return u4(e)}catch{for(;n;)e=YV(e,vct(n--),bct);return e}},yct=/[!'()~]|%20/g,Tct={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Sct=function(t){return Tct[t]},m4=function(t){return YV(fct(t),yct,Sct)},JV=ect(function(t,e){s4(this,{type:o4,iterator:qV(N0(t).entries),kind:e})},"Iterator",function(){var t=dct(this),e=t.kind,n=t.iterator.next(),o=n.value;return n.done||(n.value=e==="keys"?o.key:e==="values"?o.value:[o.key,o.value]),n},!0),E4=function(t){this.entries=[],this.url=null,t!==void 0&&(r4(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?mct(t,0)==="?"?_ct(t,1):t:YS(t)))};E4.prototype={type:cP,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,o,a,d,h,p,m=act(t);if(m)for(n=(e=qV(t,m)).next;!(o=r1(n,e)).done;){if(d=(a=qV(oct(o.value))).next,(h=r1(d,a)).done||(p=r1(d,a)).done||!r1(d,a).done)throw pct("Expected sequence with length 2");JI(this.entries,{key:YS(h.value),value:YS(p.value)})}else for(var _ in t)nct(t,_)&&JI(this.entries,{key:_,value:YS(t[_])})},parseQuery:function(t){if(t)for(var e,n,o=h4(t,"&"),a=0;a<o.length;)(e=o[a++]).length&&(n=h4(e,"="),JI(this.entries,{key:f4(Ect(n)),value:f4(d4(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],o=0;o<e.length;)t=e[o++],JI(n,m4(t.key)+"="+m4(t.value));return d4(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var o1=function(){n4(this,YO);var t=s4(this,new E4(arguments.length>0?arguments[0]:void 0));KO||(this.size=t.entries.length)},YO=o1.prototype;if($at(YO,{append:function(t,e){var n=N0(this);zO(arguments.length,2),JI(n.entries,{key:YS(t),value:YS(e)}),KO||this.length++,n.updateURL()},delete:function(t){for(var e=N0(this),n=zO(arguments.length,1),o=e.entries,a=YS(t),d=n<2?void 0:arguments[1],h=d===void 0?d:YS(d),p=0;p<o.length;){var m=o[p];if(m.key!==a||h!==void 0&&m.value!==h)p++;else if(l4(o,p,1),h!==void 0)break}KO||(this.size=o.length),e.updateURL()},get:function(t){var e=N0(this).entries;zO(arguments.length,1);for(var n=YS(t),o=0;o<e.length;o++)if(e[o].key===n)return e[o].value;return null},getAll:function(t){var e=N0(this).entries;zO(arguments.length,1);for(var n=YS(t),o=[],a=0;a<e.length;a++)e[a].key===n&&JI(o,e[a].value);return o},has:function(t){for(var e=N0(this).entries,n=zO(arguments.length,1),o=YS(t),a=n<2?void 0:arguments[1],d=a===void 0?a:YS(a),h=0;h<e.length;){var p=e[h++];if(p.key===o&&(d===void 0||p.value===d))return!0}return!1},set:function(t,e){var n=N0(this);zO(arguments.length,1);for(var o,a=n.entries,d=!1,h=YS(t),p=YS(e),m=0;m<a.length;m++)(o=a[m]).key===h&&(d?l4(a,m--,1):(d=!0,o.value=p));d||JI(a,{key:h,value:p}),KO||(this.size=a.length),n.updateURL()},sort:function(){var t=N0(this);cct(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=N0(this).entries,o=rct(t,arguments.length>1?arguments[1]:void 0),a=0;a<n.length;)o((e=n[a++]).value,e.key,this)},keys:function(){return new JV(this,"keys")},values:function(){return new JV(this,"values")},entries:function(){return new JV(this,"entries")}},{enumerable:!0}),e4(YO,uct,YO.entries,{name:"entries"}),e4(YO,"toString",function(){return N0(this).serialize()},{enumerable:!0}),KO&&Zat(YO,"size",{get:function(){return N0(this).entries.length},configurable:!0,enumerable:!0}),tct(o1,cP),GV({global:!0,constructor:!0,forced:!t4},{URLSearchParams:o1}),!t4&&WV(uP)){var Rct=vR(c4.has),Cct=vR(c4.set),_4=function(t){if(r4(t)){var e,n=t.body;if(ict(n)===cP)return e=t.headers?new uP(t.headers):new uP,Rct(e,"content-type")||Cct(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),sct(t,{body:i4(0,YS(n)),headers:i4(0,e)})}return t};if(WV(a4)&&GV({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return a4(t,arguments.length>1?_4(arguments[1]):{})}}),WV(i1)){var XV=function(t){return n4(this,zV),new i1(t,arguments.length>1?_4(arguments[1]):{})};zV.constructor=XV,XV.prototype=zV,GV({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:XV})}}var Ict={URLSearchParams:o1,getState:N0},g4=l(Q0.URLSearchParams),wct={isBrowser:!0,classes:{URLSearchParams:g4!==void 0?g4:IV,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const v4=typeof window<"u"&&typeof document<"u",Oct=(b4=typeof navigator<"u"&&navigator.product,v4&&["ReactNative","NativeScript","NS"].indexOf(b4)<0);var b4;const Act=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";function y4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function T4(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?y4(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y4(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}var bR=T4(T4({},Object.freeze({__proto__:null,hasBrowserEnv:v4,hasStandardBrowserEnv:Oct,hasStandardBrowserWebWorkerEnv:Act})),wct),Nct=VS,Pct=U_,Dct=mS,kct=Q,Lct=function(){var t=Nct(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},S4=RegExp.prototype,R4=function(t){var e=t.flags;return e!==void 0||"flags"in S4||Dct(t,"flags")||!kct(S4,t)?e:Pct(Lct,t)},Mct=rV.charAt,C4=U_,Uct=VS,xct=_c,jct=g_,Vct=/./.exec,Fct=TypeError,Bct=uT,I4=U_,w4=_m,Gct=IU,s1=OU,O4=CO,A4=T6,dP=f0,Hct=VS,Wct=RO,qct=g_,Kct=R6,N4=R4,zct=cL,Yct=f,Jct=kU,Xct=function(t,e,n){return e+(n?Mct(t,e).length:1)},Qct=function(t,e){var n=t.exec;if(xct(n)){var o=C4(n,t,e);return o!==null&&Uct(o),o}if(jct(t)==="RegExp")return C4(Vct,t,e);throw Fct("RegExp#exec called on incompatible receiver")},P4=WI,Zct=UT("matchAll"),D4="RegExp String",k4=D4+" Iterator",$ct=P4.set,tut=P4.getterFor(k4),eut=TypeError,QV=w4("".indexOf),a1=w4("".matchAll),ZV=!!a1&&!Yct(function(){a1("a",/./)}),nut=Gct(function(t,e,n,o){$ct(this,{type:k4,regexp:t,string:e,global:n,unicode:o,done:!1})},D4,function(){var t=tut(this);if(t.done)return s1(void 0,!0);var e=t.regexp,n=t.string,o=Qct(e,n);return o===null?(t.done=!0,s1(void 0,!0)):t.global?(dP(o[0])===""&&(e.lastIndex=Xct(n,A4(e.lastIndex),t.unicode)),s1(o,!1)):(t.done=!0,s1(o,!1))}),L4=function(t){var e,n,o,a=Hct(this),d=dP(t),h=Jct(a,RegExp),p=dP(N4(a));return e=new h(h===RegExp?a.source:a,p),n=!!~QV(p,"g"),o=!!~QV(p,"u"),e.lastIndex=A4(a.lastIndex),new nut(e,d,n,o)};Bct({target:"String",proto:!0,forced:ZV},{matchAll:function(t){var e,n,o,a,d=O4(this);if(Wct(t)){if(ZV)return a1(d,t)}else{if(Kct(t)&&(e=dP(O4(N4(t))),!~QV(e,"g")))throw eut("`.matchAll` does not allow non-global regexes");if(ZV)return a1(d,t);if((o=zct(t,Zct))===void 0&&qct(t)=="RegExp"&&(o=L4),o)return I4(o,t,d)}return n=dP(d),a=new RegExp(t,"g"),I4(L4,a,n)}});var rut=O0("String").matchAll,iut=Q,out=rut,$V=String.prototype,sut=function(t){var e=t.matchAll;return typeof t=="string"||t===$V||iut($V,t)&&e===$V.matchAll?out:e},aut=l(sut);function M4(t){function e(n,o,a,d){let h=n[d++];if(h==="__proto__")return!0;const p=Number.isFinite(+h),m=d>=n.length;return h=!h&&p_.isArray(a)?a.length:h,m?(p_.hasOwnProp(a,h)?a[h]=[a[h],o]:a[h]=o,!p):(a[h]&&p_.isObject(a[h])||(a[h]=[]),e(n,o,a[h],d)&&p_.isArray(a[h])&&(a[h]=function(_){const g={},y=Object.keys(_);let C;const O=y.length;let q;for(C=0;C<O;C++)q=y[C],g[q]=_[q];return g}(a[h])),!p)}if(p_.isFormData(t)&&p_.isFunction(t.entries)){const n={};return p_.forEachEntry(t,(o,a)=>{e(function(d){return aut(p_).call(p_,/\w+|\[(\w*)]/g,d).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),a,n,0)}),n}return null}const EF={transitional:WH,adapter:["xhr","http"],transformRequest:[function(t,e){const n=e.getContentType()||"",o=n.indexOf("application/json")>-1,a=p_.isObject(t);if(a&&p_.isHTMLForm(t)&&(t=new FormData(t)),p_.isFormData(t))return o?JSON.stringify(M4(t)):t;if(p_.isArrayBuffer(t)||p_.isBuffer(t)||p_.isStream(t)||p_.isFile(t)||p_.isBlob(t))return t;if(p_.isArrayBufferView(t))return t.buffer;if(p_.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let d;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(h,p){return YL(h,new bR.classes.URLSearchParams,Object.assign({visitor:function(m,_,g,y){return bR.isNode&&p_.isBuffer(m)?(this.append(_,m.toString("base64")),!1):y.defaultVisitor.apply(this,arguments)}},p))}(t,this.formSerializer).toString();if((d=p_.isFileList(t))||n.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return YL(d?{"files[]":t}:t,h&&new h,this.formSerializer)}}return a||o?(e.setContentType("application/json",!1),function(h,p,m){if(p_.isString(h))try{return(p||JSON.parse)(h),TS(p_).call(p_,h)}catch(_){if(_.name!=="SyntaxError")throw _}return(0,JSON.stringify)(h)}(t)):t}],transformResponse:[function(t){const e=this.transitional||EF.transitional,n=e&&e.forcedJSONParsing,o=this.responseType==="json";if(t&&p_.isString(t)&&(n&&!this.responseType||o)){const a=!(e&&e.silentJSONParsing)&&o;try{return JSON.parse(t)}catch(d){if(a)throw d.name==="SyntaxError"?bT.from(d,bT.ERR_BAD_RESPONSE,this,null,this.response):d}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:bR.classes.FormData,Blob:bR.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};p_.forEach(["delete","get","head","post","put","patch"],t=>{EF.headers[t]={}});var _F=EF;const cut=p_.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),U4=Symbol("internals");function lP(t){var e;return t&&TS(e=String(t)).call(e).toLowerCase()}function c1(t){return t===!1||t==null?t:p_.isArray(t)?t.map(c1):String(t)}function yF(t,e,n,o,a){return p_.isFunction(o)?o.call(this,e,n):(a&&(e=n),p_.isString(e)?p_.isString(o)?e.indexOf(o)!==-1:p_.isRegExp(o)?o.test(e):void 0:void 0)}class u1{constructor(e){e&&this.set(e)}set(e,n,o){const a=this;function d(m,_,g){const y=lP(_);if(!y)throw new Error("header name must be a non-empty string");const C=p_.findKey(a,y);(!C||a[C]===void 0||g===!0||g===void 0&&a[C]!==!1)&&(a[C||_]=c1(m))}const h=(m,_)=>p_.forEach(m,(g,y)=>d(g,y,_));var p;return p_.isPlainObject(e)||e instanceof this.constructor?h(e,n):p_.isString(e)&&(e=TS(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(TS(p=e).call(p))?h((m=>{const _={};let g,y,C;return m&&m.split(`
`).forEach(function(O){var q,L;C=O.indexOf(":"),g=TS(q=O.substring(0,C)).call(q).toLowerCase(),y=TS(L=O.substring(C+1)).call(L),!g||_[g]&&cut[g]||(g==="set-cookie"?_[g]?_[g].push(y):_[g]=[y]:_[g]=_[g]?_[g]+", "+y:y)}),_})(e),n):e!=null&&d(n,e,o),this}get(e,n){if(e=lP(e)){const o=p_.findKey(this,e);if(o){const a=this[o];if(!n)return a;if(n===!0)return function(d){const h=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=p.exec(d);)h[m[1]]=m[2];return h}(a);if(p_.isFunction(n))return n.call(this,a,o);if(p_.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=lP(e)){const o=p_.findKey(this,e);return!(!o||this[o]===void 0||n&&!yF(0,this[o],o,n))}return!1}delete(e,n){const o=this;let a=!1;function d(h){if(h=lP(h)){const p=p_.findKey(o,h);!p||n&&!yF(0,o[p],p,n)||(delete o[p],a=!0)}}return p_.isArray(e)?e.forEach(d):d(e),a}clear(e){const n=Object.keys(this);let o=n.length,a=!1;for(;o--;){const d=n[o];e&&!yF(0,this[d],d,e,!0)||(delete this[d],a=!0)}return a}normalize(e){const n=this,o={};return p_.forEach(this,(a,d)=>{var h;const p=p_.findKey(o,d);if(p)return n[p]=c1(a),void delete n[d];const m=e?function(_){return TS(_).call(_).toLowerCase().replace(/([a-z\d])(\w*)/g,(g,y,C)=>y.toUpperCase()+C)}(d):TS(h=String(d)).call(h);m!==d&&delete n[d],n[m]=c1(a),o[m]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return p_.forEach(this,(o,a)=>{o!=null&&o!==!1&&(n[a]=e&&p_.isArray(o)?o.join(", "):o)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,o]=e;return n+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var o=arguments.length,a=new Array(o>1?o-1:0),d=1;d<o;d++)a[d-1]=arguments[d];return a.forEach(h=>n.set(h)),n}static accessor(e){const n=(this[U4]=this[U4]={accessors:{}}).accessors,o=this.prototype;function a(d){const h=lP(d);n[h]||(function(p,m){const _=p_.toCamelCase(" "+m);["get","set","has"].forEach(g=>{Object.defineProperty(p,g+_,{value:function(y,C,O){return this[g].call(this,m,y,C,O)},configurable:!0})})}(o,d),n[h]=!0)}return p_.isArray(e)?e.forEach(a):a(e),this}}u1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),p_.reduceDescriptors(u1.prototype,(t,e)=>{let{value:n}=t,o=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(a){this[o]=a}}}),p_.freezeMethods(u1);var FR=u1;function TF(t,e){const n=this||_F,o=e||n,a=FR.from(o.headers);let d=o.data;return p_.forEach(t,function(h){d=h.call(n,d,a.normalize(),e?e.status:void 0)}),a.normalize(),d}function x4(t){return!(!t||!t.__CANCEL__)}function hP(t,e,n){bT.call(this,t??"canceled",bT.ERR_CANCELED,e,n),this.name="CanceledError"}p_.inherits(hP,bT,{__CANCEL__:!0});var uut=bR.hasStandardBrowserEnv?{write(t,e,n,o,a,d){const h=[t+"="+encodeURIComponent(e)];p_.isNumber(n)&&h.push("expires="+new Date(n).toGMTString()),p_.isString(o)&&h.push("path="+o),p_.isString(a)&&h.push("domain="+a),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function j4(t,e){return t&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(e)?function(n,o){return o?n.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):n}(t,e):e}var dut=bR.hasStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let n;function o(a){let d=a;return t&&(e.setAttribute("href",d),d=e.href),e.setAttribute("href",d),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return n=o(window.location.href),function(a){const d=p_.isString(a)?o(a):a;return d.protocol===n.protocol&&d.host===n.host}}():function(){return!0};function V4(t,e){let n=0;const o=function(a,d){a=a||10;const h=new Array(a),p=new Array(a);let m,_=0,g=0;return d=d!==void 0?d:1e3,function(y){const C=Date.now(),O=p[g];m||(m=C),h[_]=y,p[_]=C;let q=g,L=0;for(;q!==_;)L+=h[q++],q%=a;if(_=(_+1)%a,_===g&&(g=(g+1)%a),C-m<d)return;const U=O&&C-O;return U?Math.round(1e3*L/U):void 0}}(50,250);return a=>{const d=a.loaded,h=a.lengthComputable?a.total:void 0,p=d-n,m=o(p);n=d;const _={loaded:d,total:h,progress:h?d/h:void 0,bytes:p,rate:m||void 0,estimated:m&&h&&d<=h?(h-d)/m:void 0,event:a};_[e?"download":"upload"]=!0,t(_)}}var lut=typeof XMLHttpRequest<"u"&&function(t){return new n_(function(e,n){let o=t.data;const a=FR.from(t.headers).normalize();let d,h,{responseType:p,withXSRFToken:m}=t;function _(){t.cancelToken&&t.cancelToken.unsubscribe(d),t.signal&&t.signal.removeEventListener("abort",d)}if(p_.isFormData(o)){if(bR.hasStandardBrowserEnv||bR.hasStandardBrowserWebWorkerEnv)a.setContentType(!1);else if((h=a.getContentType())!==!1){const[q,...L]=h?h.split(";").map(U=>TS(U).call(U)).filter(Boolean):[];a.setContentType([q||"multipart/form-data",...L].join("; "))}}let g=new XMLHttpRequest;if(t.auth){const q=t.auth.username||"",L=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";a.set("Authorization","Basic "+btoa(q+":"+L))}const y=j4(t.baseURL,t.url);function C(){if(!g)return;const q=FR.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders());(function(L,U,K){const J=K.config.validateStatus;K.status&&J&&!J(K.status)?U(new bT("Request failed with status code "+K.status,[bT.ERR_BAD_REQUEST,bT.ERR_BAD_RESPONSE][Math.floor(K.status/100)-4],K.config,K.request,K)):L(K)})(function(L){e(L),_()},function(L){n(L),_()},{data:p&&p!=="text"&&p!=="json"?g.response:g.responseText,status:g.status,statusText:g.statusText,headers:q,config:t,request:g}),g=null}if(g.open(t.method.toUpperCase(),GH(y,t.params,t.paramsSerializer),!0),g.timeout=t.timeout,"onloadend"in g?g.onloadend=C:g.onreadystatechange=function(){g&&g.readyState===4&&(g.status!==0||g.responseURL&&g.responseURL.indexOf("file:")===0)&&setTimeout(C)},g.onabort=function(){g&&(n(new bT("Request aborted",bT.ECONNABORTED,t,g)),g=null)},g.onerror=function(){n(new bT("Network Error",bT.ERR_NETWORK,t,g)),g=null},g.ontimeout=function(){let q=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const L=t.transitional||WH;t.timeoutErrorMessage&&(q=t.timeoutErrorMessage),n(new bT(q,L.clarifyTimeoutError?bT.ETIMEDOUT:bT.ECONNABORTED,t,g)),g=null},bR.hasStandardBrowserEnv&&(m&&p_.isFunction(m)&&(m=m(t)),m||m!==!1&&dut(y))){const q=t.xsrfHeaderName&&t.xsrfCookieName&&uut.read(t.xsrfCookieName);q&&a.set(t.xsrfHeaderName,q)}o===void 0&&a.setContentType(null),"setRequestHeader"in g&&p_.forEach(a.toJSON(),function(q,L){g.setRequestHeader(L,q)}),p_.isUndefined(t.withCredentials)||(g.withCredentials=!!t.withCredentials),p&&p!=="json"&&(g.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&g.addEventListener("progress",V4(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&g.upload&&g.upload.addEventListener("progress",V4(t.onUploadProgress)),(t.cancelToken||t.signal)&&(d=q=>{g&&(n(!q||q.type?new hP(null,t,g):q),g.abort(),g=null)},t.cancelToken&&t.cancelToken.subscribe(d),t.signal&&(t.signal.aborted?d():t.signal.addEventListener("abort",d)));const O=function(q){const L=/^([-+\w]{1,25})(:?\/\/|:)/.exec(q);return L&&L[1]||""}(y);O&&bR.protocols.indexOf(O)===-1?n(new bT("Unsupported protocol "+O+":",bT.ERR_BAD_REQUEST,t)):g.send(o||null)})};const SF={http:null,xhr:lut};p_.forEach(SF,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const F4=t=>"- ".concat(t),hut=t=>p_.isFunction(t)||t===null||t===!1;var B4={getAdapter:t=>{t=p_.isArray(t)?t:[t];const{length:e}=t;let n,o;const a={};for(let d=0;d<e;d++){let h;if(n=t[d],o=n,!hut(n)&&(o=SF[(h=String(n)).toLowerCase()],o===void 0))throw new bT("Unknown adapter '".concat(h,"'"));if(o)break;a[h||"#"+d]=o}if(!o){const d=Object.entries(a).map(h=>{let[p,m]=h;return"adapter ".concat(p," ")+(m===!1?"is not supported by the environment":"is not available in the build")});throw new bT("There is no suitable adapter to dispatch the request "+(e?d.length>1?`since :
`+d.map(F4).join(`
`):" "+F4(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:SF};function RF(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new hP(null,t)}function G4(t){return RF(t),t.headers=FR.from(t.headers),t.data=TF.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),B4.getAdapter(t.adapter||_F.adapter)(t).then(function(e){return RF(t),e.data=TF.call(t,t.transformResponse,e),e.headers=FR.from(e.headers),e},function(e){return x4(e)||(RF(t),e&&e.response&&(e.response.data=TF.call(t,t.transformResponse,e.response),e.response.headers=FR.from(e.response.headers))),n_.reject(e)})}function H4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}const W4=t=>t instanceof FR?function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?H4(Object(o),!0).forEach(function(a){F(e,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):H4(Object(o)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))})}return e}({},t):t;function JO(t,e){e=e||{};const n={};function o(_,g,y){return p_.isPlainObject(_)&&p_.isPlainObject(g)?p_.merge.call({caseless:y},_,g):p_.isPlainObject(g)?p_.merge({},g):p_.isArray(g)?g.slice():g}function a(_,g,y){return p_.isUndefined(g)?p_.isUndefined(_)?void 0:o(void 0,_,y):o(_,g,y)}function d(_,g){if(!p_.isUndefined(g))return o(void 0,g)}function h(_,g){return p_.isUndefined(g)?p_.isUndefined(_)?void 0:o(void 0,_):o(void 0,g)}function p(_,g,y){return y in e?o(_,g):y in t?o(void 0,_):void 0}const m={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:p,headers:(_,g)=>a(W4(_),W4(g),!0)};return p_.forEach(Object.keys(Object.assign({},t,e)),function(_){const g=m[_]||a,y=g(t[_],e[_],_);p_.isUndefined(y)&&g!==p||(n[_]=y)}),n}const q4="1.6.8",CF={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{CF[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const K4={};CF.transitional=function(t,e,n){function o(a,d){return"[Axios v"+q4+"] Transitional option '"+a+"'"+d+(n?". "+n:"")}return(a,d,h)=>{if(t===!1)throw new bT(o(d," has been removed"+(e?" in "+e:"")),bT.ERR_DEPRECATED);return e&&!K4[d]&&(K4[d]=!0,console.warn(o(d," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(a,d,h)}};var IF={assertOptions:function(t,e,n){if(typeof t!="object")throw new bT("options must be an object",bT.ERR_BAD_OPTION_VALUE);const o=Object.keys(t);let a=o.length;for(;a-- >0;){const d=o[a],h=e[d];if(h){const p=t[d],m=p===void 0||h(p,d,t);if(m!==!0)throw new bT("option "+d+" must be "+m,bT.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new bT("Unknown option "+d,bT.ERR_BAD_OPTION)}},validators:CF};const dI=IF.validators;let d1=class{constructor(t){this.defaults=t,this.interceptors={request:new HH,response:new HH}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let o;Error.captureStackTrace?Error.captureStackTrace(o={}):o=new Error;const a=o.stack?o.stack.replace(/^.+\n/,""):"";n.stack?a&&!String(n.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+a):n.stack=a}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=JO(this.defaults,e);const{transitional:n,paramsSerializer:o,headers:a}=e;n!==void 0&&IF.assertOptions(n,{silentJSONParsing:dI.transitional(dI.boolean),forcedJSONParsing:dI.transitional(dI.boolean),clarifyTimeoutError:dI.transitional(dI.boolean)},!1),o!=null&&(p_.isFunction(o)?e.paramsSerializer={serialize:o}:IF.assertOptions(o,{encode:dI.function,serialize:dI.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let d=a&&p_.merge(a.common,a[e.method]);a&&p_.forEach(["delete","get","head","post","put","patch","common"],O=>{delete a[O]}),e.headers=FR.concat(d,a);const h=[];let p=!0;this.interceptors.request.forEach(function(O){typeof O.runWhen=="function"&&O.runWhen(e)===!1||(p=p&&O.synchronous,h.unshift(O.fulfilled,O.rejected))});const m=[];let _;this.interceptors.response.forEach(function(O){m.push(O.fulfilled,O.rejected)});let g,y=0;if(!p){const O=[G4.bind(this),void 0];for(O.unshift.apply(O,h),O.push.apply(O,m),g=O.length,_=n_.resolve(e);y<g;)_=_.then(O[y++],O[y++]);return _}g=h.length;let C=e;for(y=0;y<g;){const O=h[y++],q=h[y++];try{C=O(C)}catch(L){q.call(this,L);break}}try{_=G4.call(this,C)}catch(O){return n_.reject(O)}for(y=0,g=m.length;y<g;)_=_.then(m[y++],m[y++]);return _}getUri(t){return GH(j4((t=JO(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};p_.forEach(["delete","get","head","options"],function(t){d1.prototype[t]=function(e,n){return this.request(JO(n||{},{method:t,url:e,data:(n||{}).data}))}}),p_.forEach(["post","put","patch"],function(t){function e(n){return function(o,a,d){return this.request(JO(d||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:a}))}}d1.prototype[t]=e(),d1.prototype[t+"Form"]=e(!0)});var l1=d1;class OF{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new n_(function(a){n=a});const o=this;this.promise.then(a=>{if(!o._listeners)return;let d=o._listeners.length;for(;d-- >0;)o._listeners[d](a);o._listeners=null}),this.promise.then=a=>{let d;const h=new n_(p=>{o.subscribe(p),d=p}).then(a);return h.cancel=function(){o.unsubscribe(d)},h},e(function(a,d,h){o.reason||(o.reason=new hP(a,d,h),n(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}static source(){let e;return{token:new OF(function(n){e=n}),cancel:e}}}var put=OF;const AF={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(AF).forEach(t=>{let[e,n]=t;AF[n]=e});var fut=AF;const vS=function t(e){const n=new l1(e),o=IH(l1.prototype.request,n);return p_.extend(o,l1.prototype,n,{allOwnKeys:!0}),p_.extend(o,n,null,{allOwnKeys:!0}),o.create=function(a){return t(JO(e,a))},o}(_F);vS.Axios=l1,vS.CanceledError=hP,vS.CancelToken=put,vS.isCancel=x4,vS.VERSION=q4,vS.toFormData=YL,vS.AxiosError=bT,vS.Cancel=vS.CanceledError,vS.all=function(t){return n_.all(t)},vS.spread=function(t){return function(e){return t.apply(null,e)}},vS.isAxiosError=function(t){return p_.isObject(t)&&t.isAxiosError===!0},vS.mergeConfig=JO,vS.AxiosHeaders=FR,vS.formToJSON=t=>M4(p_.isHTMLForm(t)?new FormData(t):t),vS.getAdapter=B4.getAdapter,vS.HttpStatusCode=fut,vS.default=vS;var MS=vS;const mut=()=>{};function pP(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:mut};return t.promise=new n_((e,n)=>{t.resolve=o=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(o),t.value=o)},t.reject=o=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(o))}}),t}const h1=new Map,p1=new Map,yR=new Map;let QT=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),kv=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const z4=new Uot;let tR=z4.getResult(),NF=null;function Y_(t){if(!NF){tR=z4.getResult();const e=function(p){if(p.engine.name==="Blink"&&p.browser.name!=="WeChat")return kv.CHROME;switch(p.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return kv.CHROME;case"Safari":case"Mobile Safari":return kv.SAFARI;case"Edge":return kv.EDGE;case"Firefox":return kv.FIREFOX;case"QQ":case"QQBrowser":return kv.QQ;case"Opera":return kv.OPERA;case"WeChat":return kv.WECHAT;default:return p.browser.name||""}}(tR),n=Y4(tR),o=function(p){return p.os.name==="Windows"?p.os.version?p.os.name+" "+p.os.version:p.os.name:p.os.name||""}(tR),a=tR.os.version,d=Y4(tR,!1),h=tR.device.type;if(!(e&&n&&o&&a))return{name:e,version:n,os:o,osVersion:a,browserVersion:d,deviceType:h};NF={name:e,version:n,os:o,osVersion:a,browserVersion:d,deviceType:h}}return NF}function Y4(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function f1(){return Y_().os}function J4(){const t=Y_();return"".concat(t.os," ").concat(t.osVersion)}function m1(){const t=Y_();return!!(tR.engine.name==="WebKit"&&t.os===QT.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==kv.SAFARI||ES()&&t.name!==kv.SAFARI)}function lI(){return Y_().name===kv.CHROME}function ZT(){return Y_().name===kv.SAFARI}function X4(){return Y_().name===kv.EDGE}function iT(){return Y_().name===kv.FIREFOX}function ES(){return Y_().os===QT.IOS}function PF(t){const e=Y_();return!(e.name!==kv.CHROME||!e.osVersion)&&Number(e.version)>=t}function Q4(t){const e=Y_();return!(e.name!==kv.EDGE||!e.osVersion)&&Number(e.version)>=t}function Z4(t){const e=Y_();return!(e.name!==kv.SAFARI||!e.osVersion)&&Number(e.version)>=t}function $4(t,e,n){const o=Y_();if(o.os!==QT.IOS||!o.osVersion)return!1;const a=o.osVersion.split(".");return e&&Number(a[0])===t&&Number(a[1])<e||Number(a[0])<t}function t8(t,e,n){const o=Y_();if(o.name!==kv.SAFARI||!o.osVersion||!o.browserVersion)return!1;const a=o.browserVersion.split(".");return e&&Number(a[0])===t&&Number(a[1])<e||Number(a[0])<t}function e8(t){const e=Y_();return!(e.name!==kv.OPERA||!e.osVersion)&&Number(e.version)>=t}function n8(){const t=Y_();return!(t.name!==kv.CHROME||!t.osVersion)&&Number(t.version)<=90}function r8(){const t=Y_();if(t.os!==QT.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function XO(){const t=Y_();if(t.os!==QT.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function DF(){const t=Y_();if(t.os!==QT.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function i8(){const t=Y_();if(t.os!==QT.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function P0(){return ZT()&&navigator.maxTouchPoints>0}function o8(){return Y_().name===kv.WECHAT}function s8(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function LF(){const t=f1();return function(){const{deviceType:e}=Y_();return e==="mobile"||e==="tablet"}()||t===QT.ANDROID||t===QT.IOS||t===QT.HARMONY_OS}function hI(){const t=Y_();return t.name!==kv.EDGE&&t.name!==kv.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function E1(){return f1()===QT.ANDROID}function fP(){const t=Y_();return E1()&&(t.name===kv.CHROME||t.name===kv.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function a8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function __(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?a8(Object(n),!0).forEach(function(o){fT(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a8(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}function fT(t,e,n){return(e=function(o){var a=function(d,h){if(typeof d!="object"||d===null)return d;var p=d[Symbol.toPrimitive];if(p!==void 0){var m=p.call(d,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(o);return typeof a=="symbol"?a:String(a)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}let Y=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({});class ya extends Error{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0;super(n),fT(this,"code",void 0),fT(this,"message",void 0),fT(this,"data",void 0),fT(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=o}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return e==="error"&&(n||console).error(this.toString()),e==="warning"&&(n||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}}function BR(t,e){if(typeof t!="boolean")throw new ya(Y.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function JT(t,e,n){if(!o_(n).call(n,t))throw new ya(Y.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function nT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(a){return typeof a=="number"&&a%1==0}(t))throw new ya(Y.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(o,"]. integer only"))}function MF(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new ya(Y.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&nT(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&nT(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&nT(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&nT(t.ideal,"".concat(e,".ideal"),1,1/0)}else nT(t,e,1,1/0)}function cS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,a=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new ya(Y.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!c8(t,n,o,a))throw new ya(Y.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(o,"].").concat(a?" ASCII characters only.":""))}function GR(t,e){if(!Array.isArray(t))throw new ya(Y.INVALID_PARAMS,"".concat(e," should be an array"))}function CT(t){return t==null}function c8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!o||function(a){if(typeof a!="string")return!1;for(let d=0;d<a.length;d+=1){const h=a.charCodeAt(d);if(h<0||h>255)return!1}return!0}(t))}function u8(t,e,n){if("getBigUint64"in DataView.prototype)return t.getBigUint64(e,n);const o=t.getUint32(e,n),a=t.getUint32(e+4,n),d=+!!n,h=+!n;return BigInt(o*h+a*d)<<BigInt(32)|BigInt(o*d+a*h)}function d8(t,e,n,o){if("setBigUint64"in DataView.prototype)return t.setBigUint64(e,n,o);const a=Number(n>>BigInt(32)),d=Number(n&BigInt(4294967295));t.setUint32(e,a,o),t.setUint32(e+4,d,o)}var mP=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(mP||{}),UF=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(UF||{});const l8=new class{constructor(){fT(this,"_clientSize",null),fT(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),fT(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),fT(this,"getStyle",t=>window.getComputedStyle(t,null)),fT(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const o=this.getStyle(t),{display:a,visibility:d,opacity:h,filter:p}=o;return(a==="none"||o_(e=["hidden","collapse"]).call(e,d)||Number(h)<.1)&&(n=!1),!!n&&(p&&p.split(" ").filter(m=>{var _;const g=m.split("(")[0];return o_(_=["brightness","blur","opacity"]).call(_,g)}).map(m=>{const[_,g]=m.split(/\(|\)/);return[_,Number(g.match(/^[0-9\.]+/))]}).forEach(m=>{const[_,g]=m;switch(_){case"brightness":(g<.1||g>3)&&(n=!1);break;case"blur":g>3&&(n=!1);break;case"opacity":g<.1&&(n=!1)}}),n)}),fT(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,o=!0;const a=h=>e(h);let d=t;for(;d&&o;)a(d)||(n=!1,o=!1),d=d.parentElement,d||(o=!1);return n}),fT(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),fT(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:o,right:a,top:d,bottom:h}=t.getBoundingClientRect(),p=this.getClientWidth(),m=this.getClientHeight();return{width:e,height:n,left:o,right:a,top:d,bottom:h,clientWidth:p,clientHeight:m,clientMin:Math.min(p,m)}}),fT(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),fT(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),fT(this,"checkCoverForAPoint",(t,e,n)=>{const o=this.elementFromPoint(t,e);return o!==null&&o!==n}),fT(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:o}=this._clientSize,a=t/6,d=e/6,h=[],p=10**6;for(let m=0;m<5;m++)for(let _=0;_<5;_++){const g=(n*p+(m===0?.1:m===4?(a*m*p-1e5)/p:a*m)*p)/p,y=(o*p+(_===0?.1:_===4?(d*_*p-1e5)/p:d*_)*p)/p;h.push({x:g,y})}return[...h]}),fT(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),fT(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),fT(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:o,clientHeight:a,clientWidth:d,clientMin:h}=this._clientSize;let p,m,_,g;if(t<0)p=0;else{if(!(t<d))return!1;p=t}if(e<0)return!1;if(m=e<d?e:d,n<0)_=0;else{if(!(n<a))return!1;_=n}if(o<0)return!1;g=o<a?o:a;const y=m-p,C=g-_;return this.checkSizeIsVisible(y,C,h)}),fT(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),fT(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(mP.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(mP.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(mP.SIZE)}}return this.returnHiddenResult(mP.STYLE)}return this.returnHiddenResult(UF.UNMOUNTED)}return this.returnHiddenResult(UF.INVALID_HTML_ELEMENT)}),fT(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function xF(t){return new TextEncoder().encode(t)}const h8=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},VF=async t=>function(e,n){let o="";return new Uint8Array(e).forEach(a=>{o+=a.toString(n).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",xF(t)),16);let ET=class{constructor(){fT(this,"_events",{}),fT(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const n=this._events[t],o=this._indexOfListener(n,e);o!==-1&&n.splice(o,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(d=>d);for(var n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];for(let d=0;d<e.length;d+=1){const h=e[d];h.once&&this.off(t,h.listener),h.listener.apply(this,o||[])}}safeEmit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];[...this._events[t]||[]].forEach(a=>{a.once&&this.off(t,a.listener);try{a.listener.apply(this,n)}catch(d){console.error("safeEmit event:".concat(t," error ").concat(d==null?void 0:d.toString()))}})}_indexOfListener(t,e){let n=t.length;for(;n--;)if(t[n].listener===e)return n;return-1}},EP=null;function p8(){if(EP)return EP;if(window.electron)return EP=window.electron;if(!window.require)return null;try{return EP=window.require("electron"),EP}catch{return null}}let BT=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.DATACHANNEL_FAILBACK="Client._datachannelFailback",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t}({}),IT=function(t){return t.TRACER="tracer",t}({});function f8(t){return nT(t.timeout,"config.timeout",0,1e5),nT(t.timeoutFactor,"config.timeoutFactor",0,100,!1),nT(t.maxRetryCount,"config.maxRetryConfig",0,1/0),nT(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Eut=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),B_=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.FALLBACK="FALLBACK",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function QO(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function m8(t){return cS(t.turnServerURL,"turnServerURL"),cS(t.username,"username"),cS(t.password,"password"),t.udpport&&nT(t.udpport,"udpport",1,99999,!0),t.forceturn&&BR(t.forceturn,"forceturn"),t.security&&BR(t.security,"security"),t.tcpport&&nT(t.tcpport,"tcpport",1,99999,!0),!0}function E8(t){return t.level!==void 0&&JT(t.level,"level",[1,2,3]),t.delay!==void 0&&nT(t.delay,"delay",0,3e3,!0),!0}let G_=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.INJECT_STREAM_STATUS="stream-inject-status",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),lS=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t}({}),AS=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),XI=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function GT(t,e){for(var n=arguments.length,o=new Array(n>2?n-2:0),a=2;a<n;a++)o[a-2]=arguments[a];return t.getListeners(e).length===0?n_.reject(new ya(Y.UNEXPECTED_ERROR,"can not emit promise")):new n_((d,h)=>{t.emit(e,...o,d,h)})}function oT(t,e){if(t.getListeners(e).length===0)return n_.resolve();for(var n=arguments.length,o=new Array(n>2?n-2:0),a=2;a<n;a++)o[a-2]=arguments[a];return GT(t,e,...o)}function JS(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,o=new Array(n>2?n-2:0),a=2;a<n;a++)o[a-2]=arguments[a];return QI(t,e,...o)}function QI(t,e){let n=null,o=null;for(var a=arguments.length,d=new Array(a>2?a-2:0),h=2;h<a;h++)d[h-2]=arguments[h];if(t.emit(e,...d,p=>{n=p},p=>{o=p}),o!==null)throw o;if(n===null)throw new ya(Y.UNEXPECTED_ERROR,"handler is not sync");return n}const wT=new class extends ET{set networkState(t){this.emit(XI.NETWORK_STATE_CHANGE,t,this._networkState),t===AS.ONLINE?this.emit(XI.ONLINE):t===AS.OFFLINE&&(this.onlineWaiter=new n_(e=>{this.once(XI.ONLINE,()=>{this.onlineWaiter=void 0,e(AS.ONLINE)})}),this.emit(XI.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===AS.ONLINE}constructor(){super(),fT(this,"_moduleName","network-indicator"),fT(this,"_networkState",AS.ONLINE),fT(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=AS.ONLINE}),window.addEventListener("offline",()=>{this.networkState=AS.OFFLINE})}};function _1(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function ZO(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function g1(t){n_!==void 0?n_.resolve().then(t):setTimeout(t,0)}function dT(t){return JSON.parse(JSON.stringify(t))}function ZI(t){try{return dT(t)}catch{return t}}const _8={};function pI(t,e){_8[e]||(_8[e]=!0,t())}function $I(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let o=0;o<e.length;o+=1)n[o]=e.charCodeAt(o);return n}function fI(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function g8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const o=new Uint8Array(e);o.set(n),n=o}return n}function v8(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const o=Z0(e).call(e,(h,p)=>h+p.length,0),a=new Uint8Array(new ArrayBuffer(o));let d=0;return e.forEach(h=>{a.set(h,d),d+=h.length}),a}function TR(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function b8(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?TR(n):n.size}),e+138}function _ut(t){const e=new ya(Y.TIMEOUT,"timeout");return new n_((n,o)=>{window.setTimeout(()=>o(e),t)})}function $T(t){return new n_(e=>{window.setTimeout(e,t)})}function sT(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+sT(t-n.length,"")}function _P(){return sT(32,"").toUpperCase()}const v1=()=>{},y8=new class{constructor(){fT(this,"fnMap",new Map)}throttleByKey(t,e,n,o){for(var a=arguments.length,d=new Array(a>4?a-4:0),h=4;h<a;h++)d[h-4]=arguments[h];if(this.fnMap.has(e)){const p=this.fnMap.get(e);if(p.threshold!==n){p.fn(...p.args),clearTimeout(p.timer);const m=window.setTimeout(()=>{const _=this.fnMap.get(e);_&&_.fn(..._.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:m,args:d,skipFn:o})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(e,__(__({},p),{},{fn:t,args:d,skipFn:o}))}else{const p=window.setTimeout(()=>{const m=this.fnMap.get(e);m&&m.fn(...m.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:p,args:d,skipFn:o})}}},T8=y8.throttleByKey.bind(y8);function S8(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function FF(t,e){if(!S8(t)||!S8(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let o=0;o<e.length;o++)n[o]=FF(t[o],e[o]);return n}{const n=__({},t);for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&(Object.prototype.hasOwnProperty.call(t,o)?n[o]=FF(t[o],e[o]):n[o]=e[o]);return n}}function R8(t,e){let n=[0];if(n=new Array(e).fill(0),t===0)return n;let o=0;for(;t>0&&(n[o]=255&t,t>>=8,o++,o!==e););return n}function BF(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function C8(t){const e="0123456789abcdef";function n(_r){let _o,na="";for(_o=0;_o<=3;_o++)na+=e.charAt(_r>>8*_o+4&15)+e.charAt(_r>>8*_o&15);return na}function o(_r,_o){const na=(65535&_r)+(65535&_o);return(_r>>16)+(_o>>16)+(na>>16)<<16|65535&na}function a(_r,_o,na,ba,_u,_l){return o(function(_p,u_){return _p<<u_|_p>>>32-u_}(o(o(_o,_r),o(ba,_l)),_u),na)}function d(_r,_o,na,ba,_u,_l,_p){return a(_o&na|~_o&ba,_r,_o,_u,_l,_p)}function h(_r,_o,na,ba,_u,_l,_p){return a(_o&ba|na&~ba,_r,_o,_u,_l,_p)}function p(_r,_o,na,ba,_u,_l,_p){return a(_o^na^ba,_r,_o,_u,_l,_p)}function m(_r,_o,na,ba,_u,_l,_p){return a(na^(_o|~ba),_r,_o,_u,_l,_p)}const _=function(_r){let _o;const na=1+(_r.length+8>>6),ba=new Array(16*na);for(_o=0;_o<16*na;_o++)ba[_o]=0;for(_o=0;_o<_r.length;_o++)ba[_o>>2]|=_r.charCodeAt(_o)<<_o%4*8;return ba[_o>>2]|=128<<_o%4*8,ba[16*na-2]=8*_r.length,ba}(t);let g,y,C,O,q,L=1732584193,U=-271733879,K=-1732584194,J=271733878;for(g=0;g<_.length;g+=16)y=L,C=U,O=K,q=J,L=d(L,U,K,J,_[g+0],7,-680876936),J=d(J,L,U,K,_[g+1],12,-389564586),K=d(K,J,L,U,_[g+2],17,606105819),U=d(U,K,J,L,_[g+3],22,-1044525330),L=d(L,U,K,J,_[g+4],7,-176418897),J=d(J,L,U,K,_[g+5],12,1200080426),K=d(K,J,L,U,_[g+6],17,-1473231341),U=d(U,K,J,L,_[g+7],22,-45705983),L=d(L,U,K,J,_[g+8],7,1770035416),J=d(J,L,U,K,_[g+9],12,-1958414417),K=d(K,J,L,U,_[g+10],17,-42063),U=d(U,K,J,L,_[g+11],22,-1990404162),L=d(L,U,K,J,_[g+12],7,1804603682),J=d(J,L,U,K,_[g+13],12,-40341101),K=d(K,J,L,U,_[g+14],17,-1502002290),U=d(U,K,J,L,_[g+15],22,1236535329),L=h(L,U,K,J,_[g+1],5,-165796510),J=h(J,L,U,K,_[g+6],9,-1069501632),K=h(K,J,L,U,_[g+11],14,643717713),U=h(U,K,J,L,_[g+0],20,-373897302),L=h(L,U,K,J,_[g+5],5,-701558691),J=h(J,L,U,K,_[g+10],9,38016083),K=h(K,J,L,U,_[g+15],14,-660478335),U=h(U,K,J,L,_[g+4],20,-405537848),L=h(L,U,K,J,_[g+9],5,568446438),J=h(J,L,U,K,_[g+14],9,-1019803690),K=h(K,J,L,U,_[g+3],14,-187363961),U=h(U,K,J,L,_[g+8],20,1163531501),L=h(L,U,K,J,_[g+13],5,-1444681467),J=h(J,L,U,K,_[g+2],9,-51403784),K=h(K,J,L,U,_[g+7],14,1735328473),U=h(U,K,J,L,_[g+12],20,-1926607734),L=p(L,U,K,J,_[g+5],4,-378558),J=p(J,L,U,K,_[g+8],11,-2022574463),K=p(K,J,L,U,_[g+11],16,1839030562),U=p(U,K,J,L,_[g+14],23,-35309556),L=p(L,U,K,J,_[g+1],4,-1530992060),J=p(J,L,U,K,_[g+4],11,1272893353),K=p(K,J,L,U,_[g+7],16,-155497632),U=p(U,K,J,L,_[g+10],23,-1094730640),L=p(L,U,K,J,_[g+13],4,681279174),J=p(J,L,U,K,_[g+0],11,-358537222),K=p(K,J,L,U,_[g+3],16,-722521979),U=p(U,K,J,L,_[g+6],23,76029189),L=p(L,U,K,J,_[g+9],4,-640364487),J=p(J,L,U,K,_[g+12],11,-421815835),K=p(K,J,L,U,_[g+15],16,530742520),U=p(U,K,J,L,_[g+2],23,-995338651),L=m(L,U,K,J,_[g+0],6,-198630844),J=m(J,L,U,K,_[g+7],10,1126891415),K=m(K,J,L,U,_[g+14],15,-1416354905),U=m(U,K,J,L,_[g+5],21,-57434055),L=m(L,U,K,J,_[g+12],6,1700485571),J=m(J,L,U,K,_[g+3],10,-1894986606),K=m(K,J,L,U,_[g+10],15,-1051523),U=m(U,K,J,L,_[g+1],21,-2054922799),L=m(L,U,K,J,_[g+8],6,1873313359),J=m(J,L,U,K,_[g+15],10,-30611744),K=m(K,J,L,U,_[g+6],15,-1560198380),U=m(U,K,J,L,_[g+13],21,1309151649),L=m(L,U,K,J,_[g+4],6,-145523070),J=m(J,L,U,K,_[g+11],10,-1120210379),K=m(K,J,L,U,_[g+2],15,718787259),U=m(U,K,J,L,_[g+9],21,-343485551),L=o(L,y),U=o(U,C),K=o(K,O),J=o(J,q);return n(L)+n(U)+n(K)+n(J)}let gut=1,b1=console,nS=class{static setLogger(t){b1=t}constructor(t){fT(this,"lockingPromise",n_.resolve()),fT(this,"locks",0),fT(this,"name",""),fT(this,"lockId",void 0),this.lockId=gut++,t&&(this.name=t),b1.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,b1.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:""));const n=new n_(a=>{e=()=>{this.locks-=1,b1.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:"")),a()}}),o=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),o}};function $O(t,e){return function(n,o,a){const d=a.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){const h=this[e];if(!h)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const p=await h.lock("From ".concat(t,".").concat(o));try{for(var m=arguments.length,_=new Array(m),g=0;g<m;g++)_[g]=arguments[g];return await d.apply(this,_)}finally{p()}},a}}const xT={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function y1(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function eR(t,e,n,o){const a=Object.assign({},xT,o);let d=a.timeout;const h=async()=>{await function(_){return new n_(g=>{window.setTimeout(g,_)})}(d),d*=a.timeoutFactor,d=Math.min(a.maxRetryTimeout,d)};let p=!1;const m=new n_(async(_,g)=>{e=e||(()=>!1),n=n||(()=>!0);for(let y=0;y<a.maxRetryCount;y+=1){if(p)return g(new ya(Y.OPERATION_ABORTED));try{const C=await t();if(!e(C,y)||y+1===a.maxRetryCount)return _(C);await h()}catch(C){if(!n(C,y)||y+1===a.maxRetryCount)return g(C);await h()}}});return m.cancel=()=>p=!0,m}class GF{constructor(e){fT(this,"input",[]),fT(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Z0(e=this.input).call(e,(n,o)=>n+o)/this.input.length}}let T1,S1=0,HF=0;function WF(t,e,n,o){return new n_((a,d)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),S1+=TR(e.data)):n&&(e.data.size?S1+=e.data.size:e.data instanceof FormData?S1+=b8(e.data):S1+=TR(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,MS.request(e).then(h=>{typeof h.data=="string"?HF+=TR(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?HF+=h.data.byteLength:HF+=TR(JSON.stringify(h.data)),a(h.data)}).catch(h=>{MS.isCancel(h)?d(new ya(Y.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new ya(Y.NETWORK_TIMEOUT,h.message)):h.response?d(new ya(Y.NETWORK_RESPONSE_ERROR,h.response.status)):d(new ya(Y.NETWORK_ERROR,h.message))})})}async function vut(t,e){const n=new Blob([e.data],{type:"buffer"});return await WF(t,__(__({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const I8=()=>window.isSecureContext!==void 0,E0=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(e&&e[1]&&e[2]){const o=e[1],a=e[2];return"".concat(o,".").concat(a)}const n=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const o=n[1],a=n[2];return"".concat(o,".").concat(100*(Number(a)+1))}return"4.0.0.999"}("4.21.0"),KF=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let _w=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const zF={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},YF="v4.21.0-0-g16fdae2c-dirty(6/3/2024, 2:55:18 PM)",KT={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:void 0,ENABLE_CC_FALLBACK:void 0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:zF,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0};function rT(t,e,n){var o,a,d;o_(o=Object.keys(KT)).call(o,t)&&(!n&&o_(a=Object.keys(mI)).call(a,t)||(KT[t]=e,t==="ENABLE_VIDEO_SEI"&&e===!0&&(KT.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&e&&(d=!!e,KT.USE_NEW_NETWORK_CONFIG=d,d&&(KT.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],KT.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],KT.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],KT.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],KT.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",KT.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",KT.GATEWAY_DOMAINS=["edge.sd-rtn.com"]))))}function $(t){return KT[t]}const mI={};var V_=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(V_||{});class but{constructor(e,n,o,a){fT(this,"state",void 0),this.state={codec:e,audioCodec:n,mode:o,clientId:a,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1,p2pTransport:_w.Default}}dispatch(e){this.state=function(n,o){switch(o.type){case V_.SET_SESSION_ID:return __(__({},n),{},{sessionId:o.sessionId});case V_.SET_P2P_ID:return __(__({},n),{},{p2pId:o.p2pId});case V_.SET_UID:return __(__({},n),{},{uid:o.uid});case V_.SET_INT_UID:return __(__({},n),{},{intUid:o.intUid});case V_.SET_PUB_ID:return __(__({},n),{},{pubId:o.pubId});case V_.KEY_METRIC_CLIENT_CREATED:return __(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{clientCreated:o.metric})});case V_.KEY_METRIC_JOIN_START:return __(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{joinStart:o.metric})});case V_.AVOID_JOIN_START:return __(__({},n),{},{avoidJoinStart:o.avoidJoinStart});case V_.KEY_METRIC_JOIN_END:return __(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{joinEnd:o.metric})});case V_.KEY_METRIC_REQUEST_AP_START:return __(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{requestAPStart:o.metric})});case V_.KEY_METRIC_REQUEST_AP_END:return __(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{requestAPEnd:o.metric})});case V_.KEY_METRIC_JOIN_GATEWAY_START:return __(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{joinGatewayStart:o.metric})});case V_.KEY_METRIC_JOIN_GATEWAY_END:return __(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{joinGatewayEnd:o.metric})});case V_.KEY_METRIC_PEER_CONNECTION_START:return __(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{peerConnectionStart:o.metric})});case V_.KEY_METRIC_PEER_CONNECTION_END:return __(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{peerConnectionEnd:o.metric})});case V_.KEY_METRIC_DESCRIPTION_START:return __(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{descriptionStart:o.metric})});case V_.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return __(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{signalChannelOpen:o.metric})});case V_.KEY_METRIC_ICE_CONNECTION_END:return __(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{iceConnectionEnd:o.metric})});case V_.KEY_METRIC_PUBLISH:{const a=n.keyMetrics.publish,d=a.findIndex(h=>h.trackId===o.metric.trackId);return d!==-1?(a[d]=__(__({},a[d]),o.metric),__(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{publish:[...a]})})):__(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{publish:[...n.keyMetrics.publish,o.metric]})})}case V_.KEY_METRIC_SUBSCRIBE:{const a=n.keyMetrics.subscribe,d=a.findIndex(h=>h.userId===o.metric.userId&&h.type===o.metric.type);return d!==-1?(a[d]=__(__({},a[d]),o.metric),__(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{subscribe:[...a]})})):__(__({},n),{},{keyMetrics:__(__({},n.keyMetrics),{},{subscribe:[...n.keyMetrics.subscribe,o.metric]})})}case V_.SET_CLOUD_PROXY_SERVER_MODE:return n.cloudProxyServerMode=o.mode,n;case V_.RECORD_JOIN_CHANNEL_SERVICE:return typeof o.index!="number"?n.joinChannelServiceRecords=[...n.joinChannelServiceRecords,o.record]:(n.joinChannelServiceRecords[o.index]=__(__({},n.joinChannelServiceRecords[o.index]),o.record),n.joinChannelServiceRecords=[...n.joinChannelServiceRecords]),n;case V_.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return n.joinChannelServiceRecords=[],n;case V_.RESET_KEY_METRICS:return n.keyMetrics={publish:[],subscribe:[]},n;case V_.SET_USE_DATACHANNEL:return __(__({},n),{},{useDataChannel:o.val});case V_.SET_USE_P2P:return __(__({},n),{},{useP2P:o.val});case V_.SET_TRANSPORT_TYPE:return __(__({},n),{},{p2pTransport:o.val});default:return n}}(this.state,e)}set sessionId(e){this.dispatch({type:V_.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:V_.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:V_.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:V_.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:V_.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:V_.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:V_.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(e){this.dispatch({type:V_.SET_USE_DATACHANNEL,val:e})}get useDataChannel(){return this.state.useDataChannel}set useP2P(e){this.dispatch({type:V_.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:V_.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:V_.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:V_.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:V_.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:V_.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:V_.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:V_.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:V_.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:V_.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:V_.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:V_.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:V_.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:V_.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,n,o,a){this.dispatch({type:V_.KEY_METRIC_PUBLISH,metric:__(__({trackId:e,type:n},o&&{publishStart:o}),a&&{publishEnd:a})})}subscribe(e,n,o,a,d,h,p){this.dispatch({type:V_.KEY_METRIC_SUBSCRIBE,metric:__(__(__(__(__({userId:e,type:n},o&&{subscribeStart:o}),a&&{subscribeEnd:a}),d&&{firstFrame:d}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(e,n,o,a){e.forEach(d=>{this.dispatch({type:V_.KEY_METRIC_SUBSCRIBE,metric:__(__(__({userId:d.userId,type:d.type},n&&{subscribeStart:n}),o&&{subscribeEnd:o}),a&&{firstFrame:a})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,n){e.service==="gateway"&&Array.isArray(e.urls)&&(e.urls=e.urls.map(o=>o.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof n!="number"?(this.dispatch({type:V_.RECORD_JOIN_CHANNEL_SERVICE,record:__(__({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(n<0||n>=this.state.joinChannelServiceRecords.length||this.dispatch({type:V_.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:n}),n)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:V_.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:V_.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:V_.AVOID_JOIN_START,avoidJoinStart:e})}}let _A=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const w8=128,yut=96,O8=1e3,tN=10;let Tut=0;function A8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function k_(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?A8(Object(n),!0).forEach(function(o){NT(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A8(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}function NT(t,e,n){return(e=function(o){var a=function(d,h){if(typeof d!="object"||d===null)return d;var p=d[Symbol.toPrimitive];if(p!==void 0){var m=p.call(d,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(o);return typeof a=="symbol"?a:String(a)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const N8=new class extends ET{constructor(){super(...arguments),NT(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class Sut{constructor(e){NT(this,"logger",void 0),NT(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function JF(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function P8(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const _0={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},R1=Date.now(),gP=t=>{for(const e in _0)if(Object.prototype.hasOwnProperty.call(_0,e)&&_0[e]===t)return e;return"DEFAULT"},A=new class{constructor(){NT(this,"proxyServerURL",void 0),NT(this,"logLevel",_0.DEBUG),NT(this,"uploadState","collecting"),NT(this,"uploadLogWaitingList",[]),NT(this,"uploadLogUploadingList",[]),NT(this,"uploadErrorCount",0),NT(this,"currentLogID",0),NT(this,"url",void 0),NT(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const o=[_0.DEBUG].concat(e);this.log.apply(this,o)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const o=[_0.INFO].concat(e);this.log.apply(this,o)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const o=[_0.WARNING].concat(e);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const o=[_0.ERROR].concat(e);this.log.apply(this,o)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const o=[_0.DEBUG].concat(e);this.uploadLog.apply(this,o)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){rT("UPLOAD_LOG",!0)}disableLogUpload(){rT("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new Sut(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-R1<100)return void setTimeout(()=>{this.log(...e)},Date.now()-R1);const o=Math.max(0,Math.min(4,e[0]));if(e[0]=JF()+" Agora-SDK [".concat(gP(o),"]:"),this.appendLogToWaitingList(o,...e),o<this.logLevel)return;const a=JF()+" %cAgora-SDK [".concat(gP(o),"]:");let d=[];if(!$("USE_NEW_LOG"))switch(o){case _0.DEBUG:d=[a,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,d);break;case _0.INFO:d=[a,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,d);break;case _0.WARNING:d=[a,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,d);break;case _0.ERROR:d=[a,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-R1<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-R1);const o=Math.max(0,Math.min(4,e[0]));e[0]=JF()+" Agora-SDK [".concat(gP(o),"]:"),this.appendLogToWaitingList(o,...e)}appendLogToWaitingList(t){if(!$("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];Array.isArray(n[0])?n[0][0]=P8()+" Agora-SDK [".concat(gP(t),"]:"):n[0]=P8()+" Agora-SDK [".concat(gP(t),"]:");let a="";n.forEach(d=>{typeof d=="object"&&(d=JSON.stringify(d)),a+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:a,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:E0,process_id:$("PROCESS_ID"),payload:JSON.stringify(t)};return eR(async()=>{const n=await MS.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat($("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat($("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=n,o}},()=>(this.uploadLogUploadingList=[],!1),n=>{const o={status:-1,message:n.message,errorRange:t.map(a=>a.log_item_id)};return n.response?(o.status=n.response.status,o.data=n.response.data,o.headers=n.response.headers):n.request&&(o.status=n.request.status),N8.reportLogUploadError(o),!0},{timeout:$("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:$("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,$("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var D8;function Rut(t){return cS(t.reportId,"params.reportId",0,100,!1),cS(t.category,"params.category",0,100,!1),cS(t.event,"params.event",0,100,!1),cS(t.label,"params.label",0,100,!1),nT(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(D8={}).FREE="free",D8.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const Cut={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let rS=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t}({}),yT=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({}),function(t){t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}({});class vP{constructor(){NT(this,"baseInfoMap",new Map),NT(this,"proxyServer",void 0),NT(this,"eventUploadTimer",void 0),NT(this,"setSessionIdTimer",void 0),NT(this,"url",void 0),NT(this,"backupUrl",void 0),NT(this,"_appId",void 0),NT(this,"keyEventUploadPendingItems",[]),NT(this,"normalEventUploadPendingItems",[]),NT(this,"apiInvokeUploadPendingItems",[]),NT(this,"apiInvokeCount",0),NT(this,"ltsList",[]),NT(this,"lastSendNormalEventTime",Date.now()),NT(this,"customReportCounterTimer",void 0),NT(this,"customReportCount",0),NT(this,"extApiInvoke",async e=>{for(const n of e){const o=k_(k_({},n),{},{sid:null,invokeId:++this.apiInvokeCount,tag:IT.TRACER});this.sendApiInvoke(o)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),$("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),$("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void A.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const n=this.baseInfoMap.get(e),o=Date.now(),a=n.startTime;n.startTime=o,A.debug("rewrite session ".concat(e," startTime: ").concat(o," , ").concat(o-a,"ms")),this.baseInfoMap.set(e,n)}setAppId(e){this._appId=e}reportApiInvoke(e,n,o){n.timeout=n.timeout||6e4,n.reportResult=n.reportResult===void 0||n.reportResult;const a=Date.now();this.apiInvokeCount+=1;const d=this.apiInvokeCount,h=()=>({tag:n.tag,invokeId:d,sid:e,name:n.name,apiInvokeTime:a,options:n.options,states:n.states||null}),p=!!$("SHOW_REPORT_INVOKER_LOG");p&&A.info("".concat(n.name," start"),n.options);let m=!1;$T(n.timeout).then(()=>{m||(this.sendApiInvoke(k_(k_({},h()),{},{error:Y.API_INVOKE_TIMEOUT,success:!1})),A.debug("".concat(n.name," timeout")))});const _=new ya(Y.UNEXPECTED_ERROR,"".concat(n.name,": this api invoke is end"));return{onSuccess:g=>{const y=()=>{if(m)throw _;return m=!0,this.sendApiInvoke(k_(k_({},h()),{},{success:!0},n.reportResult&&{result:g})),p&&A.info("".concat(n.name," onSuccess")),g};return o?T8(y,n.name+"Success",o,()=>m=!0):y()},onError:g=>{const y=()=>{if(m)throw g;m=!0,this.sendApiInvoke(k_(k_({},h()),{},{success:!1,error:g})),p&&A.info("".concat(n.name," onFailure"),g.toString())};return o?T8(y,n.name+"Error",o,()=>m=!0):y()}}}sessionInit(e,n){if(this.baseInfoMap.has(e))return;const o=Date.now(),a=this.createBaseInfo(e,o);a.cname=n.cname;const d=Object.assign({},{willUploadConsoleLog:$("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:KF?"global":"oversea",areas:$("AREAS")&&$("AREAS").join(",")},n.extend),{stringUid:h,channelProfile:p,channelMode:m,isABTestSuccess:_,lsid:g,clientRole:y}=n,C=Date.now(),O=k_(k_({},a),{},{eventType:rS.SESSION_INIT,appid:n.appid,browser:navigator.userAgent,buildFormat:n.buildFormat,build:YF,lts:C,elapse:C-o,extend:JSON.stringify(d),mode:n.mode,process:$("PROCESS_ID"),appType:$("APP_TYPE"),success:!0,version:E0,stringUid:h,channelProfile:p,channelMode:m,isABTestSuccess:_,lsid:g,clientType:20,clientRole:y,serviceId:$("PROCESS_ID"),extensionID:$("PLUGIN_INFO").join(",")||"",preload:n.preload?1:0});this.send({type:yT.SESSION,data:O},!0)}joinChooseServer(e,n){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),h=k_(k_({},a),{},{eventType:rS.JOIN_CHOOSE_SERVER,lts:d,eventElapse:n.elapse||d-n.lts,chooseServerAddr:n.csAddr,errorCode:n.ec,elapse:d-o.startTime,success:n.succ,chooseServerAddrList:JSON.stringify(n.serverList),uid:n.uid?parseInt(n.uid):null,cid:n.cid?parseInt(n.cid):null,chooseServerIp:n.csIp||"",opid:n.opid,unilbsServerIds:n.unilbsServerIds,extend:n.extend||void 0,isHttp3:n.isHttp3});this.send({type:yT.JOIN_CHOOSE_SERVER,data:h},!0)}reqUserAccount(e,n){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),h=k_(k_({},a),{},{eventType:rS.REQ_USER_ACCOUNT,lts:d,success:n.success,serverAddress:n.serverAddr,stringUid:n.stringUid,uid:n.uid,errorCode:n.errorCode,elapse:n.elapse||d-o.startTime,eventElapse:d-n.lts,extend:JSON.stringify(n.extend)});this.send({type:yT.REQ_USER_ACCOUNT,data:h},!0)}joinGateway(e,n){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info;n.vid&&(a.vid=n.vid),a.uid=n.uid,a.cid=n.cid;const d=Date.now(),{firstSuccess:h,avoidJoinStartTime:p,isProxy:m,addr:_}=n,g=d-(h&&p?p:o.startTime),y=k_(k_({},a),{},{eventType:rS.JOIN_GATEWAY,lts:d,gatewayAddr:n.addr,success:n.succ,errorCode:n.ec,elapse:g,eventElapse:d-n.lts,firstSuccess:h,signalChannel:n.signalChannel}),C=y.success?1:0;if(n.succ&&(o.lastJoinSuccessTime=d),h)this.send({type:yT.JOIN_GATEWAY,data:y},!0);else{let O;if(_)if(m){const L=_.match(/h=(\d{1,3}-){3}\d{1,3}/g),U=_.match(/p=[0-9]{1,6}/g);O={isSuccess:C,gatewayIp:L&&L.length?L[0].split("=")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split("=")[1]:"",isProxy:m?1:0}}else{const L=_.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),U=_.match(/(:|p=)[0-9]{1,6}/g);O={isSuccess:C,gatewayIp:L&&L.length?L[0].split("//")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else O={isSuccess:C,gatewayIp:"",port:"",isProxy:m?1:0};delete y.success,delete y.eventType,delete y.firstSuccess,y.vid=Number(y.vid);const q=Object.assign({},y,O,{eventType:rS.REJOIN_GATEWAY});this.send({type:yT.RE_JOIN_GATEWAY,data:q},!0)}}joinChannelTimeout(e,n){const o=this.baseInfoMap.get(e);if(!o)return;const a=Date.now(),d=k_(k_({},o.info),{},{lts:a,timeout:n,elapse:a-o.startTime});this.send({type:yT.JOIN_CHANNEL_TIMEOUT,data:d},!0)}publish(e,n){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),h=k_(k_({},a),{},{eventType:rS.PUBLISH,lts:d,eventElapse:n.eventElapse,elapse:d-o.startTime,success:n.succ,errorCode:n.ec,videoName:n.videoName,audioName:n.audioName,screenName:n.screenName,screenshare:n.screenshare,audio:n.audio,video:n.video,p2pid:n.p2pid,publishRequestid:n.publishRequestid});this.send({type:yT.PUBLISH,data:h},!0)}subscribe(e,n,o){const a=this.baseInfoMap.get(e);if(!a)return;const d=a.info,h=Date.now(),p=k_(k_({},d),{},{eventType:rS.SUBSCRIBE,lts:h,eventElapse:n.eventElapse,elapse:h-a.startTime,success:n.succ,errorCode:n.ec,video:n.video,audio:n.audio,subscribeRequestid:n.subscribeRequestid,p2pid:n.p2pid},o&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof n.peerid=="string"?p.peerSuid=n.peerid:p.peer=n.peerid,this.send({type:yT.SUBSCRIBE,data:p},!0)}wsCompressorInit(e){var n;const o=[...e0(n=this.baseInfoMap).call(n)],a=o.length?o[0]:"UnableToGetSid",d=this.baseInfoMap.get(a);if(!d)return;const h=d.info,p=Date.now(),m=k_(k_({},h),{},{eventType:rS.WS_COMPRESSOR_INIT,lts:p,eventElapse:e.eventElapse,elapse:p-d.startTime,status:e.status?1:2});this.send({type:yT.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(e,n,o,a){const d=this.baseInfoMap.get(e);if(!d)return;const h=d.info,p=Date.now(),m=k_(k_(k_({},h),a),{},{elapse:p-d.startTime,eventType:n,lts:p,firstDecodeFrame:Math.max(p-d.startTime,0),apEnd:Math.max(a.apEnd-d.startTime,0),apStart:Math.max(a.apStart-d.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-d.startTime,0),joinGwStart:Math.max(a.joinGwStart-d.startTime,0),pcEnd:Math.max(a.pcEnd-d.startTime,0),pcStart:Math.max(a.pcStart-d.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-d.startTime,0),subscriberStart:Math.max(a.subscriberStart-d.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-d.startTime,0)});this.send({type:o,data:m},!0)}firstRemoteFrame(e,n,o,a){const d=this.baseInfoMap.get(e);if(!d)return;const h=d.info,p=Date.now(),m=k_(k_(k_({},h),a),{},{elapse:p-d.startTime,eventType:n,lts:p});this.send({type:o,data:m},!0)}pcStats(e,n){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),h=k_(k_(k_({},a),n),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:d-o.startTime,eventType:rS.PC_STATS,lts:d});this.send({type:yT.PC_STATS,data:h},!0)}updateRemoteRTPCapabilities(e,n){if(e){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),h=k_(k_(k_({},a),n),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:rS.UPDATE_REMOTE_RTPCAPABILITIES,lts:d});this.send({type:yT.UPDATE_REMOTE_RTPCAPABILITIES,data:h},!0)}}onGatewayStream(e,n,o,a){const d=this.baseInfoMap.get(e);if(!d)return;const h=d.info,p=Date.now(),m=k_(k_(k_({},h),a),{},{eventType:n,lts:p});this.send({type:o,data:m},!0)}streamSwitch(e,n){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),h=k_(k_({},a),{},{eventType:rS.STREAM_SWITCH,lts:d,isDual:n.isdual,elapse:d-o.startTime,success:n.succ});this.send({type:yT.STREAM_SWITCH,data:h},!0)}requestProxyAppCenter(e,n){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),h=k_(k_({},a),{},{eventType:rS.REQUEST_PROXY_APPCENTER,lts:d,eventElapse:d-n.lts,elapse:d-o.startTime,APAddr:n.APAddr,workerManagerList:n.workerManagerList,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:yT.REQUEST_PROXY_APPCENTER,data:h},!0)}requestProxyWorkerManager(e,n){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),h=k_(k_({},a),{},{eventType:rS.REQUEST_PROXY_WORKER_MANAGER,lts:d,eventElapse:d-n.lts,elapse:d-o.startTime,workerManagerAddr:n.workerManagerAddr,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:yT.REQUEST_PROXY_WORKER_MANAGER,data:h},!0)}setProxyServer(e){this.proxyServer=e,e?A.debug("reportProxyServerurl: ".concat(e)):A.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,n){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),h=k_(k_({},a),{},{subscribeElapse:n.subscribeElapse,peer:n.peer,peerPublishDuration:Math.max(n.audioPublishDuration,n.videoPublishDuration),audiotag:n.audioPublishDuration>0?1:-1,videotag:n.videoPublishDuration>0?1:-1,lts:d,elapse:d-o.startTime,joinChannelSuccessElapse:d-(o.lastJoinSuccessTime||d),peerPublishDurationVideo:n.videoPublishDuration,peerPublishDurationAudio:n.audioPublishDuration});this.send({type:yT.PEER_PUBLISH_STATUS,data:h},!0)}workerEvent(e,n){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now();(function(h,p,m){const _=h[p];if(!_||typeof _!="string")return[h];h[p]="";const g=TR(JSON.stringify(h));let y=0;const C=[];let O=0;for(let q=0;q<_.length;q++)O+=_.charCodeAt(q)<=127?1:3,O<=m-g||(C[C.length]=__(__({},h),{},{[p]:_.substring(y,q)}),y=q,O=_.charCodeAt(q)<=127?1:3);return y!==_.length-1&&(C[C.length]=__(__({},h),{},{[p]:_.substring(y)})),C})(k_(k_(k_({},a),n),{},{elapse:d-o.startTime,lts:d,productType:"WebRTC"}),"payload",1300).forEach(h=>this.send({type:yT.WORKER_EVENT,data:h},!0))}apworkerEvent(e,n){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),h=k_(k_(k_({},a),n),{},{elapse:d-o.startTime,lts:d});this.send({type:yT.AP_WORKER_EVENT,data:h},!0)}joinWebProxyAP(e,n){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),h=k_(k_(k_({},a),n),{},{elapse:d-o.startTime,lts:d,extend:n.extend||void 0});this.send({type:yT.JOIN_WEB_PROXY_AP,data:h},!0)}WebSocketQuit(e,n){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),h=k_(k_(k_({},a),n),{},{elapse:d-o.startTime,lts:d});this.send({type:yT.WEBSOCKET_QUIT,data:h},!0)}async sendCustomReportMessage(e,n){if(this.customReportCount+=n.length,this.customReportCount>$("CUSTOM_REPORT_LIMIT"))throw new ya(Y.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const o=Date.now(),a=n.map(d=>({type:yT.USER_ANALYTICS,data:k_(k_({sid:e},d),{},{lts:o})}));try{$("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(d){throw A.error("send custom report message failed",d.toString()),new ya(Y.CUSTOM_REPORT_SEND_FAILED,d.message)}}sendApiInvoke(e){const n=$("NOT_REPORT_EVENT");if(e.tag&&o_(n)&&o_(n).call(n,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const o=this.baseInfoMap.get(e.sid);if(!o)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:a,uid:d,cid:h}=o.info;let p;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof ya){const{code:_,message:g}=e.error;p=_||g||e.error.toString()}else p=e.error.toString();const m={invokeId:e.invokeId,sid:e.sid,cname:a,cid:h,uid:d,lts:e.lts,success:e.success,elapse:e.lts-o.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?p:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:yT.API_INVOKE,data:m},!1),!0}appendSessionId(){vP.__CLIENT_LIST__.forEach(e=>{if(e._sessionId){const n=this.apiInvokeUploadPendingItems.length;for(let o=0;o<n;o++){const a=this.apiInvokeUploadPendingItems.shift();a&&(a.sid=e._sessionId,this.sendApiInvoke(Object.assign({},a)))}}})}send(e,n){if(n)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>$("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,n){const o=[],a=[];for(;e.length;){const h=e.shift();o.length<20?o.push(h):a.push(h)}e.push(...a);for(const h of[...o]){var d;this.ltsList.indexOf(h.data.lts)!==-1?(h.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(h.data.lts)):(this.ltsList.push(h.data.lts),$N(d=this.ltsList).call(d,(p,m)=>p-m))}return n||(this.lastSendNormalEventTime=Date.now()),$("ENABLE_EVENT_REPORT")&&o.length&&($("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(o):this.postDataToStatsCollector(o)).catch((h=>p=>{$("EVENT_REPORT_RETRY")&&(n?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(h):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(h),this.normalEventUploadPendingItems.length>$("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-$("NORMAL_EVENT_QUEUE_CAPACITY")),A.warning("report: drop normal events"))))})(o)),e}async postDataToStatsCollector2(e){wT.networkState===AS.OFFLINE&&await n_.race([wT.onlineWaiter,$T(2*xT.maxRetryTimeout)]);const n=d=>{let h=new Uint8Array;return d.forEach(p=>{const m=xF(JSON.stringify(p.data)),_=new ArrayBuffer(5),g=(C=>{let O=0;return Object.entries(yT).forEach(q=>{let[L,U]=q;U===C.type&&(O=EventNameToID[L])}),O})(p),y=new DataView(_);y.setUint16(0,m.byteLength,!0),y.setUint8(2,255&g),y.setUint8(3,g>>>8&255),y.setUint8(4,g>>>16&255),h=h8(h,new Uint8Array(_)),h=h8(h,m)}),h},o="event";let a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(o):"https://".concat($("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(o);for(let d=0;d<2;d+=1){d===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(o):"https://".concat($("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(o));try{await WF(a,{timeout:1e4,data:n(e),headers:k_(k_({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(h){if(d===1)throw h;continue}return}}async postDataToStatsCollector(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const o={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(h=>JSON.stringify(h)),vid:(h=>{const p=h&&h.data.sid&&this.baseInfoMap.get(h.data.sid);return p&&p.info.vid&&+p.info.vid||0})(e[0])};wT.networkState===AS.OFFLINE&&await n_.race([wT.onlineWaiter,$T(2*xT.maxRetryTimeout)]);const a=n?"/events/proto-raws":"/events/messages";let d=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("EVENT_REPORT_DOMAIN"),"&p=").concat($("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat($("EVENT_REPORT_DOMAIN"),":").concat($("STATS_COLLECTOR_PORT")).concat(a));for(let h=0;h<2;h+=1){h===1&&(d=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat($("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat($("EVENT_REPORT_BACKUP_DOMAIN"),":").concat($("STATS_COLLECTOR_PORT")).concat(a)));try{n?await vut(d,{timeout:1e4,data:o}):await WF(d,{timeout:1e4,data:o})}catch(p){if(h===1)throw p;continue}return}}createBaseInfo(e,n){const o=Object.assign({},Cut);return o.sid=e,this.baseInfoMap.set(e,{info:o,startTime:n}),o}reportResourceTiming(e,n){const o=performance.getEntriesByName(e),a=o[o.length-1];a&&this.reportApiInvoke(n,{name:"Client.resourceTiming",options:a,tag:IT.TRACER}).onSuccess()}}function C_(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,o){const a=o.value;if(typeof a=="function"){const d=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);o.value=function(){for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];let _=p;if(t.argsMap)try{_=t.argsMap(this,...p)}catch(y){A.warning(y),_=[]}try{JSON.stringify(_)}catch{A.warning("arguments for method ".concat(d,".").concat(String(n)," not serializable for apiInvoke.")),_=[]}const g=(t.report||E_).reportApiInvoke(this._sessionId||null,{name:"".concat(d,".").concat(String(n)),options:_,tag:IT.TRACER,reportResult:t.reportResult},t.throttleTime);try{const y=a.apply(this,p);return y instanceof n_?y.then(C=>(g.onSuccess(t.reportResult&&C),C)).catch(C=>{throw g.onError(C),C}):(g.onSuccess(t.reportResult&&y),y)}catch(y){throw g.onError(y),y}}}return o}}NT(vP,"__CLIENT_LIST__",[]);const E_=new vP;N8.on("REPORT_LOG_UPLOAD",t=>{t.networkState=wT.networkState,E_.reportApiInvoke(null,{name:"logUploadError",options:t,tag:IT.TRACER}).onSuccess("logUploadError")});const Iut=["CHINA","GLOBAL"],hS=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const o=n.join(""),a=[];for(let p=0;p<6;p++)a.push("1");const d=a.join(""),h={};return h[t]=o,h[e]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=hS,KF||(KT.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],KT.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],KT.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],KT.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],KT.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],KT.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],KT.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",KT.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",KT.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",KT.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",KT.AREAS=["NORTH_AMERICA","OVERSEA"]);const k8=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],EI=[];function tO(t,e){return!!e&&EI.some(n=>n.uid===t&&n.channelName===e)}vP.__CLIENT_LIST__=EI;var wut=cW.forEach,L8=pL("forEach")?[].forEach:function(t){return wut(this,t,arguments.length>1?arguments[1]:void 0)};uT({target:"Array",proto:!0,forced:[].forEach!=L8},{forEach:L8});var Out=O0("Array").forEach,Aut=mR,Nut=mS,Put=Q,Dut=Out,XF=Array.prototype,kut={DOMTokenList:!0,NodeList:!0},Lut=function(t){var e=t.forEach;return t===XF||Put(XF,t)&&e===XF.forEach||Nut(kut,Aut(t))?Dut:e},Mut=l(Lut),Uut=fR,M8=gL;uT({target:"Object",stat:!0,forced:f(function(){M8(1)})},{keys:function(t){return M8(Uut(t))}});var U8=l(Q0.Object.keys),xut=l(A6),jut=uT,Vut=nP,Fut=B([].reverse),x8=[1,2];jut({target:"Array",proto:!0,forced:String(x8)===String(x8.reverse())},{reverse:function(){return Vut(this)&&(this.length=this.length),Fut(this)}});var But=O0("Array").reverse,Gut=Q,Hut=But,QF=Array.prototype,Wut=function(t){var e=t.reverse;return t===QF||Gut(QF,t)&&e===QF.reverse?Hut:e},j8=Wut,qut=l(j8),Kut=uT,V8=nP,zut=NL,Yut=t0,F8=tU,Jut=jR,Xut=eI,Qut=HL,Zut=UT,$ut=LU,tdt=ZH("slice"),edt=Zut("species"),ZF=Array,ndt=Math.max;Kut({target:"Array",proto:!0,forced:!tdt},{slice:function(t,e){var n,o,a,d=Xut(this),h=Jut(d),p=F8(t,h),m=F8(e===void 0?h:e,h);if(V8(d)&&(n=d.constructor,(zut(n)&&(n===ZF||V8(n.prototype))||Yut(n)&&(n=n[edt])===null)&&(n=void 0),n===ZF||n===void 0))return $ut(d,p,m);for(o=new(n===void 0?ZF:n)(ndt(m-p,0)),a=0;p<m;p++,a++)p in d&&Qut(o,a,d[p]);return o.length=a,o}});var rdt=O0("Array").slice,idt=Q,odt=rdt,$F=Array.prototype,sdt=function(t){var e=t.slice;return t===$F||idt($F,t)&&e===$F.slice?odt:e},adt=l(sdt);function e_(t,e,n,o,a){var d,h,p,m={};return Mut(d=U8(o)).call(d,function(_){m[_]=o[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=xut(h=qut(p=adt(n).call(n)).call(p)).call(h,function(_,g){return g(t,e,_)||_},m),a&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(a):void 0,m.initializer=void 0),m.initializer===void 0&&(YH(t,e,m),m=null),m}var cdt=O0("Array").values,udt=mR,ddt=mS,ldt=Q,hdt=cdt,_B=Array.prototype,pdt={DOMTokenList:!0,NodeList:!0},fdt=function(t){var e=t.values;return t===_B||ldt(_B,t)&&e===_B.values||ddt(pdt,udt(t))?hdt:e},nR=l(fdt);let mdt=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),r0=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({}),C1=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),tG=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),D0=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),NS=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),R_=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),F_=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),h_=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.DATACHANNEL_PRECONNECT="datachannel_preconnect",t.DATACHANNEL_CONNECTING="datachannel_connecting",t.DATACHANNEL_FAILBACK="datachannel_failback",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t}({}),b_=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),eO=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),D_=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),PS=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),O_=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});class _s extends ya{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),F(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,A)}throw(){super.throw(A)}}function I1(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw A.error("Invalid Channel Name ".concat(t)),new _s(Y.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function w1(t){if(!function(e){return typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295}(t)&&!c8(t,1,255))throw new _s(Y.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof t=="string"&&A.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let iS=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t.INJECT="inject_streaming",t}({}),eN=function(t){return t[t.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",t[t.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",t[t.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",t[t.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",t[t.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",t[t.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",t[t.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",t[t.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",t[t.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",t[t.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",t[t.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN",t}({});const Edt={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},eG={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function nG(t,e){cS(t.url,"".concat(e,".url"),1,1e3,!1),CT(t.x)||nT(t.x,"".concat(e,".x"),0,1e4),CT(t.y)||nT(t.y,"".concat(e,".y"),0,1e4),CT(t.width)||nT(t.width,"".concat(e,".width"),0,1e4),CT(t.height)||nT(t.height,"".concat(e,".height"),0,1e4),CT(t.zOrder)||nT(t.zOrder,"".concat(e,".zOrder"),0,255),CT(t.alpha)||nT(t.alpha,"".concat(e,".alpha"),0,1,!1)}const _dt={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},gdt={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let SR=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.INJECT_STREAM_STATUS="@live_uap-inject-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),O1=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),zT=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function B8(t){if(!t.channelName)throw new _s(Y.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new _s(Y.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&cS(t.token,"info.token",1,2047),w1(t.uid),I1(t.channelName),!0}let DS=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),HR=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),FS=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),nN=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),lb=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),PT=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.DATACHANNEL_PRECONNECT="datachannel_preconnect",t.DATACHANNEL_FAILBACK="datachannel_failback",t.RESET_SIGNAL="reset-signal",t}({}),bP=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),tS=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),G8=function(t){return t[t.websocket=0]="websocket",t[t.datachannel=1]="datachannel",t}({}),Z_=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const H8=[Z_.AFRICA,Z_.ASIA,Z_.CHINA,Z_.EUROPE,Z_.GLOBAL,Z_.INDIA,Z_.JAPAN,Z_.NORTH_AMERICA,Z_.OCEANIA,Z_.OVERSEA,Z_.SOUTH_AMERICA];let _S=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const A1={CHINA:{},ASIA:{CODE:_S.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:_S.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:_S.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:_S.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:_S.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:_S.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:_S.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:_S.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:_S.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:_S.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:_S.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:_S.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:_S.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};KF&&(A1.CHINA={CODE:_S.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let rG=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t}({});class W8 extends ET{constructor(e,n){super(),F(this,"onICEConnectionStateChange",void 0),F(this,"onConnectionStateChange",void 0),F(this,"onDTLSTransportStateChange",void 0),F(this,"onDTLSTransportError",void 0),F(this,"onICETransportStateChange",void 0),F(this,"onFirstAudioReceived",void 0),F(this,"onFirstVideoReceived",void 0),F(this,"onFirstAudioDecoded",void 0),F(this,"onFirstVideoDecoded",void 0),F(this,"onFirstVideoDecodedTimeout",void 0),F(this,"onSelectedLocalCandidateChanged",void 0),F(this,"onSelectedRemoteCandidateChanged",void 0),F(this,"getLocalVideoStats",void 0)}}class N1 extends W8{constructor(e,n){super(e,n),F(this,"establishPromise",void 0)}}let m_=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),SS=function(t){return t[t.UDP=0]="UDP",t[t.TCP=1]="TCP",t[t.RELAY=2]="RELAY",t}({}),WR=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.TCP_RESTART=1]="TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({}),_E=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),_b=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),I_=function(t){return t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),k0=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),L0=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),oS=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),_I=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t}({}),HT=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t}({}),RR=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),g0=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),rR=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),rN=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),DT=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),iN=function(t){return t.ABORT="abort",t}({}),gI=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),vdt=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const bdt={[C1.ACCESS_POINT]:{[NS.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[NS.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[NS.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[NS.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[NS.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[NS.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[NS.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[NS.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[NS.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[NS.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[NS.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[NS.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[NS.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[NS.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[NS.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[NS.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[NS.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[NS.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[C1.UNILBS]:{[D0.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[D0.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[D0.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[D0.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[D0.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[D0.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[D0.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[D0.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[D0.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[D0.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[D0.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[D0.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[C1.STRING_UID_ALLOCATOR]:{[tG.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[tG.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[tG.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function oN(t){const e=bdt[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===C1.ACCESS_POINT){const o=t%1e4;if(o.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const ydt={[R_.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[R_.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[R_.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[R_.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[R_.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[R_.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[R_.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[R_.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[R_.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[R_.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[R_.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[R_.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[R_.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[R_.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[R_.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[R_.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[R_.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[R_.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[R_.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[R_.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[R_.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[R_.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[R_.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[R_.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[R_.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[R_.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[R_.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[R_.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[R_.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[R_.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[R_.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[R_.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[R_.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[R_.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[R_.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[R_.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[R_.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[R_.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[R_.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[R_.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[R_.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[R_.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[R_.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[R_.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[R_.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[R_.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[R_.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[R_.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[R_.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[R_.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[R_.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[R_.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[R_.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[R_.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[R_.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[R_.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[R_.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[R_.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[R_.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[R_.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[R_.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[R_.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[R_.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function nO(t){return ydt[t]||{desc:"UNKNOW_ERROR_".concat(t),action:"failed"}}function q8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function iG(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?q8(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q8(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}function K8(t){return t.every(e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)}function z8(t,e){if(typeof t=="string")return t;const{proxy:n,host:o,port:a}=t;if(e){const d=$("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(o,"/ws/?p=").concat(Number(a)+150):"wss://".concat(o,":").concat(d,"/ws/?p=").concat(Number(a)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(o,"&p=").concat(a):"wss://".concat(o,":").concat(a)}const Tdt=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Sdt=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Rdt=/wss:\/\/(.+):([0-9]+)\/?/,Cdt=/wss:\/\/(.[^\/]+)\/?/;let Idt=0;class wdt{constructor(e,n){F(this,"id",0),F(this,"store",void 0),F(this,"recordIndex",void 0),F(this,"websockets",[]),F(this,"try443PortDuration",2e3),F(this,"forceCloseWSDuration",5e3),F(this,"try443PortTimeout",null),F(this,"forceCloseTimeout",null),F(this,"isTry443PortFailed",!1),F(this,"isNormalPortFailed",!1),F(this,"useDoubleDomain",!1),F(this,"useProxy",!1),F(this,"startTime",Date.now()),this.id=++Idt,this.try443PortDuration=$("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;const n=Date.now()-this.startTime;for(var o=arguments.length,a=new Array(o),d=0;d<o;d++)a[d]=arguments[d];A.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...a)}createWebSocket(e,n,o){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:o});const a=$("GATEWAY_DOMAINS"),d=Date.now(),h=[],p=a.find(g=>{var y;return o_(y=e.host).call(y,g)});p||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)a.forEach(g=>{m.push(z8(iG(iG({},e),{},{host:e.host.replace(p,g)}),n))});else{const g=iG({},e);if(n&&p){const y=a.find(C=>C!==p);y&&(g.host=g.host.replace(p,y))}m.push(z8(g,n))}try{m.forEach(g=>{const y=new WebSocket(g);y.binaryType="arraybuffer",h.push(y),this.logger("ws is connecting:",y.url)})}catch(g){if(this.logger("ws create failed"),h.forEach(y=>y.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,o);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,o);throw new _s(Y.WS_ERR,"init websocket failed! Error: ".concat(g.toString()))}const _=pP();return this.store&&this.store.recordJoinChannelService({urls:h.map(g=>g.url),service:"gateway"},this.recordIndex),h.forEach(g=>{g.onopen=()=>{this.logger("onopen: ws ".concat(g.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(y=>{y!==g&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,_.resolve(g)},g.onclose=y=>{this.logger("onclose: ws ".concat(g.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(g.readyState)),n?this.isTry443PortFailed=K8(h):this.isNormalPortFailed=K8(h),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(n&&this.isTry443PortFailed||!n&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(y.reason)),_.reject({code:y.code,reason:bP.A_ROUND_WS_FAILED}))},g.onmessage=y=>this.logger("".concat(g.url," onmessage: ").concat(y.data))}),this.websockets.push(...h),o||(()=>{const g=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",_.isResolved),this.websockets.forEach(y=>y.readyState!==WebSocket.OPEN&&y.close())};if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(g,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",_.isResolved),_.isResolved)return g();Y_().os===QT.MAC_OS&&iT()&&g(),this.createWebSocket(e,!0,!0).then(y=>_.resolve(y)).catch(y=>{this.isNormalPortFailed&&_.reject(y),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(g,this.forceCloseWSDuration)},this.try443PortDuration)})(),_.promise}chooseBestWebsocket(e,n,o,a){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(d){let h,p,m;return[,h,p,m]=d.match(Tdt)||[],h||([,p,m]=d.match(Sdt)||[]),p&&m||([,p,m]=d.match(Rdt)||[]),p&&m||([,p]=d.match(Cdt)||[]),p||A.warning("un-destructible url: ",d),{proxy:h,host:p,port:m||"443"}}(e)),this.recordIndex=a,this.useProxy=!!e.proxy,o&&this.useProxy&&(A.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(e,!!o,!1).finally(()=>this.clearTimeout())}}function Y8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}class J8 extends ET{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;o_(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(O_.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(O_.CONNECTED):this._state==="closed"?this.emit(O_.CLOSED):this._state==="failed"&&this.emit(O_.FAILED))}resetReconnectCount(e){A.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),F(this,"connectionID",0),F(this,"currentURLIndex",0),F(this,"urls",[]),F(this,"_reconnectMode","tryNext"),F(this,"reconnectReason",void 0),F(this,"_initMutex",new nS("websocket")),F(this,"name",void 0),F(this,"_state","closed"),F(this,"reconnectInterrupter",void 0),F(this,"websocket",void 0),F(this,"retryConfig",void 0),F(this,"reconnectCount",0),F(this,"forceCloseTimeout",5e3),F(this,"onlineReconnectListener",void 0),F(this,"useCompress",void 0),F(this,"tryDoubleDomain",!1),F(this,"use443PortOnly",!1),F(this,"wsInflateLength",0),F(this,"wsDeflateLength",0),F(this,"closeEstablishingWs",()=>{}),F(this,"store",void 0),F(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=e,this.retryConfig=function(y){for(var C=1;C<arguments.length;C++){var O=arguments[C]!=null?arguments[C]:{};C%2?Y8(Object(O),!0).forEach(function(q){F(y,q,O[q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(O)):Y8(Object(O)).forEach(function(q){Object.defineProperty(y,q,Object.getOwnPropertyDescriptor(O,q))})}return y}({},n),this.useCompress=o,this.tryDoubleDomain=a,this.use443PortOnly=d;const{timeout:p,timeoutFactor:m}=n,_=Math.max(300,Math.floor(3*p/5)),g=Math.max(1.2,Math.floor(8*m)/10);AS.ONLINE&&(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=g),wT.on(XI.NETWORK_STATE_CHANGE,(y,C)=>{y!==C&&(this.resetReconnectCount("network state change: ".concat(C," -> ").concat(y)),y===AS.ONLINE?(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=g):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{const a=pP(),d=this.urls[this.currentURLIndex];this.createWebSocketConnection(d).then(a.resolve).catch(a.reject),this.once(O_.CLOSED,()=>{a.reject(new ya(Y.WS_DISCONNECT))}),this.once(O_.CONNECTED,a.resolve),await a.promise}catch{}finally{o()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;n?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void A.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),A.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ya(Y.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(o){throw new ya(Y.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const o=pP();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const a=g=>{var y;(y=this.store)===null||y===void 0||y.signalChannelOpen(),A.debug("[".concat(this.name,"] websocket opened:"),g),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},d=async g=>{var y;if(A.debug("[".concat(this.name,"] websocket close ").concat((y=this.websocket)===null||y===void 0?void 0:y.url,", code: ").concat(g.code,", reason: ").concat(g.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new ya(Y.WS_DISCONNECT,"websocket close: ".concat(g.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=g.reason,this.state="reconnecting");const C=JS(this,O_.WILL_RECONNECT,this.reconnectMode,g.reason)||this.reconnectMode,O=await this.reconnectWithAction(C);if(this.state==="closed")return void A.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!O)return o.reject(new ya(Y.WS_DISCONNECT,"websocket reconnect failed: ".concat(g.code))),this.close(!0);o.resolve()}},h=g=>{this.emit(O_.ON_MESSAGE,g)},p=g=>{A.warn("[".concat(this.connectionID,"] ws open error ").concat(g))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),$("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=$("GATEWAY_WSS_ADDRESS")),A.debug("[".concat(this.name,"] start connect, url:"),e);const m=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var _;const g=await this.chooseBestWebsocketConnection(e);this.websocket=g,a&&a(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=h,this.websocket.onerror=p,(_=this.store)===null||_===void 0||_.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this.joinGatewayRecordIndex=m}catch(g){const y=this.state==="closed",C=g instanceof ya,O=C&&g.code===Y.WS_ABORT,q=C&&g.code===Y.WS_ERR,L=C?g.message:g&&(g.reason||g.toString());A.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(L)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:O?"aborted":"error",errors:[g]},m),y||q?(o.reject(y?new ya(Y.WS_DISCONNECT,"websocket is closed: ".concat(L)):new ya(Y.WS_ERR,"init websocket failed: ".concat(L))),q&&A.error("[".concat(this.name,"] init websocket failed: ").concat(L))):d&&d(g)}return o.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;A.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||wT.isOnline||!wT.onlineWaiter||(this.onlineReconnectListener=wT.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,n){const h=y1(this.reconnectCount,this.retryConfig);A.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(e)),await n_.race([$T(h),this.onlineReconnectListener||new n_(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const a=async(h,p)=>{this.emit(O_.RECONNECT_CREATE_CONNECTION,p),await this.createWebSocketConnection(h)};try{if(e==="retry")this.emit(O_.RECONNECT_WAITTING_FINISH,e),await a(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);A.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(O_.RECONNECT_WAITTING_FINISH,e),await a(this.urls[this.currentURLIndex],e)}else e==="recover"&&(A.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(O_.RECONNECT_WAITTING_FINISH,e),this.urls=await GT(this,O_.REQUEST_NEW_URLS),this.currentURLIndex=0,await a(this.urls[this.currentURLIndex],e))}catch(h){var d;A.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const p=h==null||(d=h.data)===null||d===void 0?void 0:d.desc;return Array.isArray(p)&&o_(p).call(p,"dynamic key expired")?(this.emit(O_.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class yP extends J8{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const o=pP(),a=function(h,p){return new wdt(h,p)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{A.debug("[choose-best-ws] close establishing websockets"),a.closeAllWebsockets(),o.reject(new ya(Y.WS_ABORT,"choose best websocket aborted"))};const d=$("GATEWAY_DOMAINS");return A.debug("[choose-best-ws] currentDomain: ",e,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),a.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class TP extends J8{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new n_((o,a)=>{let d=!1;const h=[];this.closeEstablishingWs=()=>{A.debug("[choose-best-ws] close establishing websockets"),h.forEach(q=>{q.onclose=null,q.onopen=null,q.onmessage=null,q.close()}),a(new ya(Y.WS_ABORT,"choose best websocket aborted"))};const p=$("GATEWAY_DOMAINS");let m;const _=e.indexOf("?h="),g=p.find(q=>_!==-1?o_(e).call(e,q,_):o_(e).call(e,q));A.debug("[choose-best-ws] currentDomain: ",g,", domains: ",p);let y=!this.tryDoubleDomain||!g;if(!y&&g){var C;const q=Date.now();try{p.forEach(L=>{const U=_===-1?e.replace(g,L):e.substr(0,_)+e.substr(_).replace(g,L),K=new WebSocket(U);K.binaryType="arraybuffer",h.push(K),A.debug("[choose-best-ws] ws is connecting:",K.url)})}catch{for(A.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(U=>U.close());h.length;)h.pop();y=!0}(C=this.store)===null||C===void 0||C.recordJoinChannelService({urls:h.map(L=>L.url),service:"gateway"},n),h.forEach(L=>{L.onopen=()=>{if(d)return;const U=Date.now()-q;A.debug("[choose-best-ws] ws open cost ".concat(U,"ms")),h.filter(K=>K!==L).forEach(K=>{A.debug("[choose-best-ws]close backup websocket: ".concat(K.url)),K.close()}),d=!0,o(L)},L.onclose=U=>{m=U,!d&&(h.find(K=>!(K.readyState===WebSocket.CLOSED||K.readyState===WebSocket.CLOSING))||(A.debug("[choose-best-ws] all websocket is closed"),d=!0,a(m)))},L.onmessage=U=>{A.debug("[choose-best-ws]".concat(L.url," onmessage: ").concat(U.data))}}),$T(this.forceCloseTimeout).then(()=>{h.forEach(L=>{L.readyState!==WebSocket.OPEN&&L.close()})})}if(y){var O;let q;A.debug("[choose-best-ws] use single url: ",e),(O=this.store)===null||O===void 0||O.recordJoinChannelService({urls:[e],service:"gateway"},n);try{q=new WebSocket(e),h.push(q),q.binaryType="arraybuffer"}catch(L){const U=new ya(Y.WS_ERR,"init websocket failed! Error: ".concat(L.toString()));return A.error("[".concat(this.name,"]").concat(U)),void a(U)}q.onopen=()=>{o(q)},q.onclose=L=>{a(L)},q.onmessage=L=>{A.debug("[choose-best-ws]".concat(q.url," onmessage: ").concat(L.data))},$T(this.forceCloseTimeout).then(()=>{q&&q.readyState!==WebSocket.OPEN&&q.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class X8 extends ET{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===F_.CONNECTED?this.emit(h_.WS_CONNECTED):e===F_.RECONNECTING?this.emit(h_.WS_RECONNECTING,this._websocketReconnectReason):e===F_.CLOSED&&this.emit(h_.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),F(this,"_disconnectedReason",void 0),F(this,"_websocketReconnectReason",void 0),F(this,"_connectionState",F_.CLOSED),F(this,"reconnectToken",void 0),F(this,"websocket",void 0),F(this,"openConnectionTime",void 0),F(this,"clientId",void 0),F(this,"lastMsgTime",Date.now()),F(this,"uploadCache",[]),F(this,"uploadCacheInterval",void 0),F(this,"rttRolling",new GF(5)),F(this,"pingpongTimer",void 0),F(this,"wsInflateDataTimer",void 0),F(this,"pingpongTimeoutCount",0),F(this,"joinResponse",void 0),F(this,"multiIpOption",void 0),F(this,"initError",void 0),F(this,"spec",void 0),F(this,"store",void 0),F(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(h_.ON_BINARY_DATA,o.data);const a=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){const d="res-@".concat(a._id);this.emit(d,a._result,a._message)}else if(Object.prototype.hasOwnProperty.call(a,"_type")){if(this.emit(a._type,a._message),a._type===D_.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===D_.ON_USER_BANNED)switch(a._message.error_code){case 14:this.close(B_.UID_BANNED);break;case 15:this.close(B_.IP_BANNED);break;case 16:this.close(B_.CHANNEL_BANNED)}if(a._type===D_.ON_USER_LICENSE_BANNED)switch(a._message.error_code){case R_.ERR_LICENSE_MISSING:this.close(B_.LICENSE_MISSING);break;case R_.ERR_LICENSE_EXPIRED:this.close(B_.LICENSE_EXPIRED);break;case R_.ERR_LICENSE_MINUTES_EXCEEDED:this.close(B_.LICENSE_MINUTES_EXCEEDED);break;case R_.ERR_LICENSE_PERIOD_INVALID:this.close(B_.LICENSE_PERIOD_INVALID);break;case R_.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(B_.LICENSE_MULTIPLE_SDK_SERVICE);break;case R_.ERR_LICENSE_ILLEGAL:this.close(B_.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new yP("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===F_.CONNECTED&&this.reconnect("retry",lS.OFFLINE)})}async request(e,n,o,a){const d=sT(6,""),h={_id:d,_type:e,_message:n},p=this.websocket.connectionID,m=()=>new n_((q,L)=>{if(this.connectionState===F_.CONNECTED)return q();const U=()=>{this.off(h_.WS_CLOSED,K),q()},K=()=>{this.off(h_.WS_CONNECTED,U),L(new _s(Y.WS_ABORT))};this.once(h_.WS_CONNECTED,U),this.once(h_.WS_CLOSED,K),e!==b_.PUBLISH&&e!==b_.PUBLISH_DATASTREAM&&e!==b_.SUBSCRIBE&&e!==b_.SUBSCRIBE_DATASTREAM&&e!==b_.UNSUBSCRIBE&&e!==b_.UNSUBSCRIBE_DATASTREAM&&e!==b_.UNPUBLISH&&e!==b_.UNPUBLISH_DATASTREAM&&e!==b_.CONTROL&&e!==b_.RESTART_ICE||this.once(h_.DISCONNECT_P2P,()=>{L(new _s(Y.DISCONNECT_P2P))}),e!==b_.PUBLISH&&e!==b_.RESTART_ICE||this.once(h_.ABORT_P2P_EXECUTION,()=>{L(new _s(Y.DISCONNECT_P2P))})});if(this.connectionState!==F_.CONNECTING&&this.connectionState!==F_.RECONNECTING||e===b_.JOIN||e===b_.REJOIN||await m(),this.websocket.sendMessage(h,!0),a)return;const _=new n_((q,L)=>{let U=!1;const K=(_r,_o)=>{U=!0,q({isSuccess:_r==="success",message:_o||{}}),this.off(h_.WS_CLOSED,J),this.off(h_.WS_RECONNECTING,J),this.emit(h_.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(d),K);const J=()=>{L(new _s(Y.WS_ABORT,"type: ".concat(e))),this.off(h_.WS_CLOSED,J),this.off(h_.WS_RECONNECTING,J),this.off("res-@".concat(d),K)};this.once(h_.WS_CLOSED,J),this.once(h_.WS_RECONNECTING,J),$T($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||U||(A.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(h_.REQUEST_TIMEOUT,e,n))})});let g=null;try{g=await _}catch(q){if(this.connectionState===F_.CLOSED||e===b_.LEAVE)throw new _s(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?q.throw():e===b_.JOIN||e===b_.REJOIN?null:(await m(),await this.request(e,n))}if(g.isSuccess)return g.message;const y=Number(g.message.error_code||g.message.code),C=nO(y),O=new _s(Y.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(g.message.error_str),{code:y,data:g.message});return C.action==="success"?g.message:(A.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(y,", message: ").concat(C.desc,", action: ").concat(C.action)),y===R_.ERR_TOO_MANY_BROADCASTERS?((e===b_.JOIN||e===b_.REJOIN)&&(this.initError=O,this.close()),O.throw()):C.action==="failed"?O.throw():C.action==="quit"?(this.initError=O,this.close(),O.throw()):(y===R_.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=g.message.option,A.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",lS.MULTI_IP)):this.reconnect(C.action,lS.SERVER_ERROR),e===b_.JOIN||e===b_.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new n_(o=>{const a=d=>{(!n||n(d))&&(this.off(e,a),o(d))};this.on(e,a)})}uploadWRTCStats(e){if(!this.store.sessionId)return void A.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(eO.WRTC_STATS,n)}upload(e,n){const o={_type:e,_message:n};try{this.websocket.sendMessage(o)}catch{const d=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==F_.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const o={_type:e,_message:n};this.websocket.sendMessage(o)}init(e,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new n_((o,a)=>{this.once(h_.WS_CONNECTED,()=>o(this.joinResponse)),this.once(h_.WS_CLOSED,()=>a(this.initError||new _s(Y.WS_ABORT))),this.connectionState=F_.CONNECTING,this.websocket.init(e).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||B_.LEAVE,this.connectionState=F_.CLOSED,A.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===B_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new yP("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(h_.ABORT_P2P_EXECUTION);const e=await GT(this,h_.REQUEST_JOIN_INFO),n=await this.request(b_.JOIN,e);if(!n)return this.emit(h_.REPORT_JOIN_GATEWAY,bP.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(h_.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=F_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new _s(Y.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=QI(this,h_.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(b_.REJOIN,e);return!!n&&(this.connectionState=F_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(o=>{this.emit(D_.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(D_.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(D_.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(D_.MUTE_AUDIO,{uid:o.uid}):this.emit(D_.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(D_.MUTE_VIDEO,{uid:o.uid}):this.emit(D_.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(D_.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(D_.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(D_.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(D_.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(D_.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleNotification(e){A.debug("[".concat(this.clientId,"] receive notification: "),e);const n=nO(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(B_.UID_BANNED),void this.close()):void this.reconnect(n.action,lS.SERVER_ERROR);A.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=$("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(A.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",lS.TIMEOUT):this.request(b_.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-n;this.rttRolling.add(o),$("REPORT_STATS")&&this.send(b_.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(eO.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(O_.RECONNECT_WAITTING_FINISH,e=>{this.emit(h_.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(O_.RECONNECT_CREATE_CONNECTION,e=>{this.emit(h_.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(O_.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(O_.CLOSED,()=>{this.connectionState=F_.CLOSED}),this.websocket.on(O_.FAILED,()=>{this._disconnectedReason=B_.NETWORK_ERROR,this.connectionState=F_.CLOSED}),this.websocket.on(O_.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===F_.CONNECTED?this.connectionState=F_.RECONNECTING:this.connectionState=F_.CONNECTING}),this.websocket.on(O_.WILL_RECONNECT,(e,n,o)=>{const a=QI(this,h_.IS_P2P_DISCONNECTED),d=a||e!=="retry";a&&e==="retry"&&(A.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=bP.P2P_DISCONNECTED),d&&(A.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(h_.REPORT_JOIN_GATEWAY,n||bP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(h_.NEED_RENEW_SESSION,this.websocket.currentURLIndex>=this.websocket.urls.length-1?"recover":e),this.emit(h_.DISCONNECT_P2P)),o(e)}),this.websocket.on(O_.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{A.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",lS.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(h_.REPORT_JOIN_GATEWAY,e.message||e.code||bP.UNKNOWN_REASON,this.url||""),e instanceof _s){if(e.code===Y.UNEXPECTED_RESPONSE&&e.data.code===R_.ERR_NO_AUTHORIZED)return this.initError=new _s(Y.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),A.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",lS.SERVER_ERROR);A.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",lS.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(O_.REQUEST_NEW_URLS,(e,n)=>{GT(this,h_.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(O_.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(D_.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let jT=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function Q8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function P1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Q8(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Q8(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}function vI(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat($("TURN_DOMAIN")):(A.info("Unidentified as ip: ".concat(t,", use as host")),t)}function oG(t,e){t.addresses||(t.addresses=[]);const n=function(d,h){if($("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return d.map(_=>{let{ip:g,port:y}=_;return{address:"".concat(g,":").concat(y)}});const p=$("GATEWAY_DOMAINS");let m=p[1]&&o_(h).call(h,p[1])?1:0;return d.map(_=>{let{domain_prefix:g,port:y,ip:C}=_;if(g)return{address:"".concat(g,".").concat(p[m++%p.length],":").concat(y)};const O=/^[\.\:\d]+$/.test(C),q=O?"".concat(C.replace(/[^\d]/g,"-"),".").concat(p[m++%p.length],":").concat(y):"".concat(C,":").concat(y);return O||A.info("Unidentified as ip: ".concat(C,", use as host")),{ip:C,port:y,address:q}})}(t.addresses,e),o=Array.isArray(t.detail)&&t.detail[18];if(o&&typeof o=="string"){const d=o.split(";");for(let h=0;h<d.length;h++){var a;const p=TS(a=d[h]).call(a);n[h]&&p&&(n[h].ip6=p)}}return{gatewayAddrs:n,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function BS(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function Z8(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat(BS(e.width),"x").concat(BS(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function $8(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function SP(t,e){let n,o,a;switch(e){case jT.CHOOSE_SERVER:o=4096,a="choose server";break;case jT.CLOUD_PROXY:o=1048576,a="proxy";break;case jT.CLOUD_PROXY_5:o=4194304,a="proxy5";break;case jT.CLOUD_PROXY_FALLBACK:o=4194310,a="proxy fallback";break;default:throw new _s(Y.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(d=>{d.buffer&&d.buffer.flag===o&&(n={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>P1(P1({},h),{},{ticket:d.buffer.cert})),server_ts:t.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:P1(P1({},d.buffer.detail),t.detail),flag:d.buffer.flag,opid:t.opid,cert:d.buffer.cert})}),!n)throw new _s(Y.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(a," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function tK(t,e){return await n_.all(t.addresses.map(async n=>({address:vI(n.ip),tcpport:n.port,udpport:n.port,username:e&&$("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():hS.username,password:e&&$("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await VF(e.toString()):hS.password})))}function sG(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),o=e.videoHeight||n.height,a=e.videoWidth||n.width;return o&&a?Math.max(Math.min(o,a)/Math.min(BS(t.height),BS(t.width)),1):(A.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function bI(t){let{candidateType:e,relayProtocol:n,type:o,address:a,port:d,protocol:h}=t;return o==="local-candidate"?{candidateType:e,relayProtocol:n,protocol:h}:{candidateType:e,relayProtocol:n,address:a,port:d,protocol:h}}function eK(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}class Odt extends ET{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;o_(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(HT.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(HT.CONNECTED):this._state==="closed"?this.emit(HT.CLOSED):this._state==="failed"&&this.emit(HT.FAILED))}constructor(e,n,o,a){super(),F(this,"connectionID",0),F(this,"currentURLIndex",0),F(this,"reconnectReason",void 0),F(this,"_reconnectMode","tryNext"),F(this,"_initMutex",void 0),F(this,"_name",void 0),F(this,"_state","closed"),F(this,"_reconnectInterrupter",void 0),F(this,"_url",void 0),F(this,"_retryConfig",void 0),F(this,"_reconnectCount",0),F(this,"_forceCloseTimeout",5e3),F(this,"_onlineReconnectListener",void 0),F(this,"_closeEstablishingTransmitter",()=>{}),F(this,"_store",void 0),F(this,"_joinChannelServiceRecordIndex",void 0),F(this,"_transmitter",void 0),F(this,"_useCompress",void 0),F(this,"_inflateLength",0),F(this,"_deflateLength",0),this._store=a,this._name=e,this._retryConfig=function(d){for(var h=1;h<arguments.length;h++){var p=arguments[h]!=null?arguments[h]:{};h%2?eK(Object(p),!0).forEach(function(m){F(d,m,p[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(p)):eK(Object(p)).forEach(function(m){Object.defineProperty(d,m,Object.getOwnPropertyDescriptor(p,m))})}return d}({},n),this._useCompress=o}resetReconnectCount(e){A.debug("".concat(this._name," reset reconnect count, reason: ").concat(e)),this._reconnectCount=0}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const o=this._transmitter;n?setTimeout(()=>o.close(),500):o.close(),this._transmitter=void 0}this.state=e?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(e,n){if(!this._transmitter)return void A.warning("[".concat(this._name,"] can not reconnect, no websocket"));var o;e!==void 0&&(this.reconnectMode=e),A.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((o=this._store)===null||o===void 0||o.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));const a=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),a&&a.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){const e=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:e,deflateLength:n}}setInflateData(e){this._deflateLength=this._deflateLength+e.originLength,this._inflateLength=this._inflateLength+e.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let iR=function(t){return t[t.Default=0]="Default",t[t.Ack=1]="Ack",t}({});class Adt{constructor(e,n,o){F(this,"version",1),F(this,"initialRTO",void 0),F(this,"maxBatchAckCount",void 0),F(this,"maxRTO",void 0),F(this,"initialRTT",void 0),F(this,"ID",void 0),F(this,"rtt",void 0),F(this,"packetNumber",1),F(this,"rtoRatioMap",new Map),F(this,"timeoutMap",new Map),F(this,"unorderedPacketQueue",[]),F(this,"batchAckPacketQueue",[]),F(this,"lastOrderedPacketNumber",0),F(this,"batchAckTimer",void 0),F(this,"sendImpl",void 0),F(this,"receiveImpl",void 0),this.sendImpl=e,this.receiveImpl=n,this.ID=sT(7,"transmitter-"),this.initialRTO=(o==null?void 0:o.initialRTO)!==void 0?o.initialRTO:$("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(o==null?void 0:o.initialRTT)!==void 0?o.initialRTT:$("TRANSMITTER_INITIAL_RTT"),this.rtt=(o==null?void 0:o.initialRTT)!==void 0?o.initialRTT:$("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(o==null?void 0:o.maxBatchAckCount)!==void 0?o.maxBatchAckCount:$("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(o==null?void 0:o.maxRTO)!==void 0?o.maxRTO:$("TRANSMITTER_MAX_RTO")}packetize(e,n){return{type:iR.Default,version:this.version,packetNumber:n,payload:e}}serialize(e){switch(e.type){case iR.Default:{let n;typeof e.payload=="string"?n=new TextEncoder().encode(e.payload):n=e.payload;const o=new ArrayBuffer(n.length+15),a=new DataView(o);return a.setUint16(0,e.version),a.setUint8(2,e.type),a.setUint32(3,e.packetNumber),d8(a,7,BigInt(e.sendTs)),new Uint8Array(a.buffer).set(n,15),o}case iR.Ack:{const n=new ArrayBuffer(16),o=new DataView(n);return o.setUint16(0,e.version),o.setUint8(2,e.type),o.setUint32(3,e.maxAckPacketNumber),o.setUint8(7,e.shift),d8(o,8,BigInt(e.ackSendTs)),n}}}deserialize(e){const n=new DataView(e),o=n.getUint16(0),a=n.getUint8(2);switch(a){case iR.Default:{const d=n.getUint32(3),h=u8(n,7),p=e.slice(15),m=new TextDecoder().decode(p);return{version:o,type:a,packetNumber:d,sendTs:Number(h),payload:m}}case iR.Ack:{const d=n.getUint32(3),h=n.getUint8(7),p=u8(n,8);return{version:o,type:a,maxAckPacketNumber:d,shift:h,ackSendTs:Number(p)}}default:throw A.error("[".concat(this.ID,"] Unrecognized packet type ").concat(a)),new Error("Unrecognized packet type ".concat(a))}}sendMessage(e){const n=this.packetize(e,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const o=this.calculateRTO(n),a=window.setTimeout(()=>{this.resendMessage(n)},o);this.timeoutMap.set(n.packetNumber,a),this.sendPacket(n)}onData(e){const n=this.deserialize(e);n.type===iR.Default?this.ack(n):n.type===iR.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(e=>{let[n,o]=e;window.clearTimeout(o)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(e){const n=this.calculateRTO(e),o=window.setTimeout(()=>{this.resendMessage(e)},n);this.timeoutMap.set(e.packetNumber,o),this.sendPacket(e)}calculateRTO(e){const n=this.rtoRatioMap.get(e.packetNumber);if(n===void 0)return this.rtoRatioMap.set(e.packetNumber,1),this.initialRTO;{const o=9*this.rtt/8*n;return this.rtoRatioMap.set(e.packetNumber,n+1),o>this.maxRTO?this.maxRTO:o}}updateRTT(e,n){const o=e.ackSendTs;this.rtt=this.rtt*(7/8)+(n-o-this.rtt)/8}ack(e){if(e.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(e):(this.batchAckPacketQueue.push(e),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(e.payload);;){const n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(e.packetNumber<=this.lastOrderedPacketNumber){const n={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:iR.Ack,version:this.version};this.sendPacket(n)}else if(e.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[e.packetNumber-this.lastOrderedPacketNumber-2]=e;const n={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:iR.Ack,version:this.version};this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const e={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:iR.Ack,version:this.version};this.sendPacket(e),this.batchAckPacketQueue=[]}sendPacket(e){e.type===iR.Default&&(e.sendTs=Math.round(performance.now()));const n=this.serialize(e);this.sendImpl(n)}clearRTO(e){for(let n=e.maxAckPacketNumber-e.shift;n<=e.maxAckPacketNumber;n++){const o=this.timeoutMap.get(n);o!==void 0&&window.clearTimeout(o),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class nK extends Odt{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),F(this,"_initMutex",void 0),F(this,"_reconnectInterrupter",void 0),F(this,"_url",void 0),F(this,"_transmitter",void 0),F(this,"_addresses",void 0),F(this,"_reliableTransmission",void 0),this._initMutex=new nS("datachannel");const{timeout:o,timeoutFactor:a}=n,d=Math.max(300,Math.floor(3*o/5)),h=Math.max(1.2,Math.floor(8*a)/10);AS.ONLINE&&(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h),wT.on(XI.NETWORK_STATE_CHANGE,(p,m)=>{p!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(p)),p===AS.ONLINE?(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=o,this._retryConfig.timeoutFactor=a))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=n;const o=(a,d)=>{this._addresses=e,this.currentURLIndex=this._addresses.findIndex(p=>p.fingerprint||$("FINGERPRINT"));const h=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(h).then(a).catch(d),this.once(HT.CLOSED,()=>d(new _s(Y.WS_DISCONNECT))),this.once(HT.CONNECTED,()=>a())};return this._initMutex.lock().then(a=>new n_((d,h)=>{o(d,h)}).then(()=>{a()}).catch(()=>{a()}))}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new _s(Y.WS_ABORT,"datachannel is not ready");try{n||(e=JSON.stringify(e)),this._reliableTransmission.sendMessage(e)}catch(o){throw new _s(Y.WS_ERR,"send datachannel signal message error"+o.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(e){const n=JSON.stringify(e);return{compressed:n,compressedLength:n.length,origin:e}}sendMessageWithUint8Array(e){return{compressed:e,compressedLength:e.byteLength,origin:e}}createTransmitterConnection(e){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(e.ip,":").concat(e.port),new n_((n,o)=>{var a;const d=()=>{A.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n()},h=async g=>{var y;if((y=this._closeEstablishingTransmitter)===null||y===void 0||y.call(this),A.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(g.code,", reason: ").concat(g.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=g.reason,this.state="reconnecting");const C=JS(this,HT.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,O=await this.reconnectWithAction(C);if(this.state==="closed")return void A.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!O)return o(new _s(Y.WS_DISCONNECT,"datachannel reconnect failed: ".concat(g.code))),void this.close(!0);n()}else o(new _s(Y.WS_DISCONNECT,"datachannel close: ".concat(g.code))),this.close()},p=g=>{var y;(y=this._reliableTransmission)===null||y===void 0||y.onData(g.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),A.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(e)));const m=(a=this._store)===null||a===void 0?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),_=Date.now();GT(this,HT.TO_CONNECT_DATACHANNEL,e).then(g=>{var y,C;if(!g)throw new Error("transmissonInfo not exist yet");const{transmitter:O,close:q}=g;this._transmitter=O,(y=this._store)===null||y===void 0||y.signalChannelOpen();const L=Date.now()-_;A.debug("[choose dc] dc open cost ".concat(L,"ms")),this._reliableTransmission=new Adt(U=>{var K;this._transmitter&&this._transmitter.readyState==="open"&&((K=this._transmitter)===null||K===void 0||K.send(U))},U=>{typeof U=="string"&&this.emit(HT.ON_MESSAGE,U)}),this._closeEstablishingTransmitter=()=>{var U;(U=this._reliableTransmission)===null||U===void 0||U.close(),this._reliableTransmission=void 0,q()},d&&d(),O.onclose=h,O.onmessage=p,(C=this._store)===null||C===void 0||C.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this._joinChannelServiceRecordIndex=m}).catch(g=>{var y;if((y=this._store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:g instanceof _s&&g.code===Y.WS_ABORT?"aborted":"error",errors:[g]},m),this.state!=="closed"){if(g instanceof _s&&g.code===Y.WS_ERR){const C=new _s(Y.WS_ERR,"init datachannel failed! Error: ".concat(g.toString()));return A.error("[".concat(this._name,"]").concat(C)),void o(C)}h&&h(g)}else o(new _s(Y.WS_DISCONNECT,"datachannel is closed: ".concat(g.toString())))})})}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||wT.networkState!==AS.OFFLINE||(this._onlineReconnectListener=wT.onlineWaiter&&wT.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let o=!0;if(this._reconnectInterrupter=()=>{o=!1},n){const p=y1(this._reconnectCount,this._retryConfig);A.debug("[".concat(this._name,"] wait ").concat(p,"ms to reconnect datachannel, mode: ").concat(e)),await n_.race([$T(p),this._onlineReconnectListener||new n_(()=>{})])}if(this.state==="closed"||!o)return!1;this._reconnectCount+=1;const a=async(p,m)=>{this.emit(HT.RECONNECT_CREATE_CONNECTION,m),await this.createTransmitterConnection(p)};try{if(e==="retry"){const p=this._addresses[this.currentURLIndex];this.emit(HT.RECONNECT_WAITTING_FINISH,e),await a(p,e)}else if(e==="tryNext"){this.currentURLIndex+=1;for(let m=this.currentURLIndex;m<this._addresses.length;m++){if(this._addresses[m].fingerprint||$("FINGERPRINT")){this.currentURLIndex=m;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return A.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);A.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const p=this._addresses[this.currentURLIndex];this.emit(HT.RECONNECT_WAITTING_FINISH,e),await a(p,e)}else e==="recover"&&(A.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(HT.RECONNECT_WAITTING_FINISH,e),this.emit(HT.FAILBACK));return!0}catch(p){var d,h;return A.error("[".concat(this._name,"] reconnect failed"),p.toString()),p!=null&&(d=p.data)!==null&&d!==void 0&&d.desc&&Array.isArray(p.data.desc)&&p.data.desc.length&&o_(h=p.data.desc).call(h,"dynamic key expired")?(this.emit(HT.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(e,n)}}}class qR extends ET{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===F_.CONNECTED?this.emit(h_.WS_CONNECTED):e===F_.RECONNECTING?this.emit(h_.WS_RECONNECTING,this._websocketReconnectReason):e===F_.CLOSED&&this.emit(h_.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),F(this,"_disconnectedReason",void 0),F(this,"_websocketReconnectReason",void 0),F(this,"_connectionState",F_.CLOSED),F(this,"reconnectToken",void 0),F(this,"websocket",void 0),F(this,"openConnectionTime",void 0),F(this,"clientId",void 0),F(this,"lastMsgTime",Date.now()),F(this,"uploadCache",[]),F(this,"uploadCacheInterval",void 0),F(this,"rttRolling",new GF(5)),F(this,"pingpongTimer",void 0),F(this,"inflateDataTimer",void 0),F(this,"pingpongTimeoutCount",0),F(this,"joinResponse",void 0),F(this,"multiIpOption",void 0),F(this,"initError",void 0),F(this,"spec",void 0),F(this,"store",void 0),F(this,"onWebsocketMessage",o=>{if(o instanceof ArrayBuffer)return void this.emit(h_.ON_BINARY_DATA,o);const a=JSON.parse(o);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){const d="res-@".concat(a._id);this.emit(d,a._result,a._message)}else if(Object.prototype.hasOwnProperty.call(a,"_type")&&(this.emit(a._type,a._message),a._type===D_.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===D_.ON_USER_BANNED))switch(a._message.error_code){case 14:this.close(B_.UID_BANNED);break;case 15:this.close(B_.IP_BANNED);break;case 16:this.close(B_.CHANNEL_BANNED)}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new nK("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===F_.CONNECTED&&this.reconnect("retry",_I.OFFLINE)})}async request(e,n,o,a){const d=sT(6,""),h={_id:d,_type:e,_message:n},p=this.websocket.connectionID,m=()=>new n_((q,L)=>{if(this.connectionState===F_.CONNECTED)return q();const U=()=>{this.off(h_.WS_CLOSED,K),q()},K=()=>{this.off(h_.WS_CONNECTED,U),L(new _s(Y.WS_ABORT))};this.once(h_.WS_CONNECTED,U),this.once(h_.WS_CLOSED,K),e!==b_.PUBLISH&&e!==b_.SUBSCRIBE&&e!==b_.UNSUBSCRIBE&&e!==b_.UNPUBLISH&&e!==b_.CONTROL&&e!==b_.RESTART_ICE||this.once(h_.DISCONNECT_P2P,()=>{L(new _s(Y.DISCONNECT_P2P))}),e!==b_.PUBLISH&&e!==b_.RESTART_ICE||this.once(h_.ABORT_P2P_EXECUTION,()=>{L(new _s(Y.DISCONNECT_P2P))})});if(this.connectionState!==F_.CONNECTING&&this.connectionState!==F_.RECONNECTING||e===b_.JOIN||e===b_.REJOIN||await m(),e===b_.LEAVE&&(this.websocket.unbindDcCloseEventListener(),a=!0),this.websocket.sendMessage(h,!0,!1),a)return;const _=new n_((q,L)=>{let U=!1;const K=(_r,_o)=>{U=!0,q({isSuccess:_r==="success",message:_o||{}}),this.off(h_.WS_CLOSED,J),this.off(h_.WS_RECONNECTING,J),this.emit(h_.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(d),K);const J=()=>{L(new _s(Y.WS_ABORT,"type: ".concat(e))),this.off(h_.WS_CLOSED,J),this.off(h_.WS_RECONNECTING,J),this.off("res-@".concat(d),K)};this.once(h_.WS_CLOSED,J),this.once(h_.WS_RECONNECTING,J),$T($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||U||(A.warning("dc request timeout, type: ".concat(e)),this.emit(h_.REQUEST_TIMEOUT,e,n))})});let g=null;try{g=await _}catch(q){if(this.connectionState===F_.CLOSED||e===b_.LEAVE)throw new _s(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?q.throw():e===b_.JOIN||e===b_.REJOIN?null:(await m(),await this.request(e,n))}if(g.isSuccess)return g.message;const y=Number(g.message.error_code||g.message.code),C=nO(y),O=new _s(Y.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(g.message.error_str),{code:y,data:g.message});return C.action==="success"?g.message:(A.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(y,", message: ").concat(C.desc,", action: ").concat(C.action)),y===R_.ERR_TOO_MANY_BROADCASTERS?((e===b_.JOIN||e===b_.REJOIN)&&(this.initError=O,this.close()),O.throw()):C.action==="failed"?O.throw():C.action==="quit"?(this.initError=O,this.close(),O.throw()):(y===R_.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=g.message.option,A.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",_I.MULTI_IP)):this.reconnect(C.action,_I.SERVER_ERROR),e===b_.JOIN||e===b_.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new n_(o=>{const a=d=>{(!n||n(d))&&(this.off(e,a),o(d))};this.on(e,a)})}uploadWRTCStats(e){if(!this.store.sessionId)return void A.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(eO.WRTC_STATS,n)}upload(e,n){const o={_type:e,_message:n};try{this.websocket.sendMessage(o)}catch{const d=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==F_.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const o={_type:e,_message:n};this.websocket.sendMessage(o)}init(e,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new n_((o,a)=>{this.once(h_.WS_CONNECTED,()=>o(this.joinResponse)),this.once(h_.WS_CLOSED,()=>a(this.initError||new _s(Y.WS_ABORT))),this.connectionState=F_.CONNECTING,this.websocket.init(e).catch(a),this.websocket.once(HT.FAILBACK,()=>{this.openConnectionTime===void 0&&a(new _s(Y.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{n&&this.openConnectionTime===void 0&&(A.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),a(new _s(Y.INIT_DATACHANNEL_TIMEOUT)))},$("DC_JOIN_WITH_FAILBACK"))})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||B_.LEAVE,this.connectionState=F_.CLOSED,A.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),e===B_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new nK("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(h_.ABORT_P2P_EXECUTION);const e=await GT(this,h_.DATACHANNEL_CONNECTING),n=await this.request(b_.JOIN,e);if(!n)return this.emit(h_.REPORT_JOIN_GATEWAY,Y.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(h_.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=F_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new _s(Y.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=QI(this,h_.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(b_.REJOIN,e);return!!n&&(this.connectionState=F_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(o=>{this.emit(D_.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(D_.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(D_.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(D_.MUTE_AUDIO,{uid:o.uid}):this.emit(D_.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(D_.MUTE_VIDEO,{uid:o.uid}):this.emit(D_.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(D_.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(D_.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(D_.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(D_.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(D_.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleNotification(e){A.debug("[".concat(this.clientId,"] receive notification: "),e);const n=nO(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(B_.UID_BANNED),void this.close()):void this.reconnect(n.action,_I.SERVER_ERROR);A.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=$("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(A.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",_I.TIMEOUT):this.request(b_.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-n;this.rttRolling.add(o),$("REPORT_STATS")&&this.send(b_.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleInflateData(){const{inflateLength:e,deflateLength:n}=this.websocket.getInflateData();e!==0&&n!==0&&this.upload(eO.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(HT.RECONNECT_WAITTING_FINISH,e=>{this.emit(h_.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(HT.RECONNECT_CREATE_CONNECTION,e=>{this.emit(h_.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(HT.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(HT.CLOSED,()=>{this.connectionState=F_.CLOSED}),this.websocket.on(HT.FAILED,()=>{this._disconnectedReason=B_.NETWORK_ERROR,this.connectionState=F_.CLOSED}),this.websocket.on(HT.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===F_.CONNECTED?this.connectionState=F_.RECONNECTING:this.connectionState=F_.CONNECTING}),this.websocket.on(HT.WILL_RECONNECT,(e,n)=>{if(QI(this,h_.IS_P2P_DISCONNECTED)&&e==="retry")return A.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(h_.NEED_RENEW_SESSION),this.emit(h_.DISCONNECT_P2P),n("tryNext");e!=="retry"&&(A.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(h_.NEED_RENEW_SESSION),this.emit(h_.DISCONNECT_P2P)),n(e)}),this.websocket.on(HT.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{A.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",_I.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(h_.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof _s&&e.code===Y.UNEXPECTED_RESPONSE&&e.data.code===R_.ERR_NO_AUTHORIZED)return A.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",_I.SERVER_ERROR);A.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",_I.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(HT.REQUEST_NEW_URLS,(e,n)=>{GT(this,h_.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(HT.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(D_.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(HT.TO_CONNECT_DATACHANNEL,async(e,n,o)=>GT(this,h_.DATACHANNEL_PRECONNECT,e).then(n).catch(o)),this.websocket.on(HT.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(h_.DATACHANNEL_FAILBACK)})}}class rO extends ET{constructor(e,n){super(),F(this,"signal",void 0),F(this,"token",void 0),F(this,"tokenTimeout",void 0),F(this,"tokenInterval",void 0),F(this,"_sequence",0),F(this,"userMap",new Map),F(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const o=()=>{this.signal.connectionState===F_.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*$("P2P_TOKEN_INTERVAL"))};o()}async send(e,n,o,a,d){var h,p,m;if(this.userMap.size===0)return;const _=Array.from(nR(h=this.userMap).call(h))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),a=(p=a)!==null&&p!==void 0?p:sT(6,""),d=(m=d)!==null&&m!==void 0?m:this._sequence++;const g={_id:a,_type:e,_seq:d,_message:n,token:"".concat(this.token,"_").concat(_)};$("SHOW_P2P_LOG")&&A.debug("send message",g,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(g)).forEach(C=>{this.signal.request(b_.DATA_STREAM,{payload:fI(this.encoder.encode(C))})});const y=new n_((C,O)=>{const q=window.setTimeout(()=>{this.off("res-@".concat(a,"_ack"),L),this.off("res-@".concat(a),K),this.off(iN.ABORT,U),A.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(a)),this.userMap.size===0?O(new ya(Y.INVALID_REMOTE_USER)):O(new ya(Y.TIMEOUT))},$("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),L=()=>{q&&window.clearTimeout(q),this.off(iN.ABORT,U),o&&C()},U=()=>{q&&window.clearTimeout(q),this.off("res-@".concat(a,"_ack"),L),this.off("res-@".concat(a),K),O(new ya(Y.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(a)))};this.once(iN.ABORT,U),this.once("res-@".concat(a,"_ack"),L);const K=(_r,_o)=>{J=!0,q&&window.clearTimeout(q),this.off("res-@".concat(a,"_ack"),L),this.off(iN.ABORT,U),_r==="success"?C(_o):O(new ya(Y.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(a)))};let J=!1;o||(this.once("res-@".concat(a),K),$T($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{J||A.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(a,", ").concat(g))}))});try{return await y}catch(C){if(C.code===Y.TIMEOUT)return await this.send(e,n,o,a,d);throw C}}onMessage(e){var n;const{_uid:o}=e;let a,d=this.userMap.get(o);if(d)a=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==DT.CHECK)return;const{token:_}=e;a=new Map,d={uid:o,isStart:!0,token:_,splitMessageMap:a,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,d),this.signal.emit(D_.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in e&&"total"in e){var h;const{id:_,total:g}=e,y=(h=a.get(_))!==null&&h!==void 0?h:[];if(y.push(e),a.has(_)||a.set(_,y),y.length!==g)return;{const C=$N(y).call(y,(O,q)=>O.index-q.index).map(O=>O.payload).join("");a.delete(_),(e=JSON.parse(C))._uid=o}}const{_type:p,token:m}=e;if(o_(n=[DT.ACK,DT.CHECK]).call(n,p))return p===DT.CHECK&&this.handleCheckToken(d,m),void this.receiveMessage(e);m==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(e):A.debug('Receive unexpected message", '.concat(m,", cur_token: ").concat(d.token,"_").concat(this.token),e)}check(){const e={_id:sT(6,""),token:this.token,_type:DT.CHECK};$("SHOW_P2P_LOG")&&A.debug("send message",e),this.signal.request(b_.DATA_STREAM,{payload:fI(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:DT.ACK,token:this.token};$("SHOW_P2P_LOG")&&A.debug("send message",n),this.signal.request(b_.DATA_STREAM,{payload:fI(this.encoder.encode(JSON.stringify(n)))})}response(e,n,o){this.send(DT.RESPONSE,JSON.stringify({success:!o,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(_=>{const{receivedMessagesMap:g,nextExpectedSequenceNumber:y}=_;for(;g.has(y);){const C=g.get(y);g.delete(y),this.receiveMessage(C),_.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:o,_seq:a}=e,d=this.userMap.get(o),{receivedMessagesMap:h,isStart:p,nextExpectedSequenceNumber:m}=d;if(a<m)return this.ack(e._id),void A.debug("[external-signal] receive old message, seq: ".concat(a,", ").concat(e._message));h.set(a,e),p&&a===m&&(this.receiveMessage(e),h.delete(m),d.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:o,_message:a,_uid:d}=e;if($("SHOW_P2P_LOG")&&A.debug("receive message",e),n){let h;switch(e._type!==DT.ACK&&(a&&(h=JSON.parse(a)),this.ack(e._id)),e._type){case DT.CANDIDATE:case DT.CONTROL:this.signal.emit(o,h,d);break;case DT.PUBLISH:case DT.UNPUBLISH:case DT.RESTART_ICE:case DT.CALL:h.uid=d,GT(this.signal,o,h).then(p=>{this.response(e._id,p)}).catch(()=>{this.response(e._id,void 0,!0)});break;case DT.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case DT.RESPONSE:{const{success:p,message:m}=h;this.emit("res-@".concat(n),p?"success":"failed",m);break}}}}splitMessage(e){if(e.length<rO.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:o}=JSON.parse(e),a=sT(6,"");let d=0,h=800;const p=Math.ceil(e.length/h);for(;e.length>0;){d++;const m={id:a,index:d,total:p,payload:e.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(m).length>rO.MAX_MESSAGE_SIZE?h-=50:(n.push(m),e=e.slice(h))}return n.map(m=>JSON.stringify(m))}handleCheckToken(e,n){return e.token!==n?(A.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{A.debug("token timeout, ".concat(n)),this.reset(e.uid)},$("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await GT(this.signal,DT.CALL,void 0),n=await this.send(DT.CALL,e);this.signal.emit(h_.P2P_CONNECTION,n,!0)}async reset(e,n){const o=this.userMap.get(e);o&&(this.emit(iN.ABORT),this.signal.emit(D_.ON_USER_OFFLINE,{uid:o.uid,reason:vdt.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(A.debug("change local token from ".concat(n," to ").concat(n)),this.token=sT(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(iN.ABORT)}}F(rO,"MAX_SIZE",1),F(rO,"MAX_MESSAGE_SIZE",1024);class rK extends ET{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===F_.CONNECTED?this.emit(h_.WS_CONNECTED):e===F_.RECONNECTING?this.emit(h_.WS_RECONNECTING,this._websocketReconnectReason):e===F_.CLOSED&&this.emit(h_.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),F(this,"_disconnectedReason",void 0),F(this,"_websocketReconnectReason",void 0),F(this,"_connectionState",F_.CLOSED),F(this,"reconnectToken",void 0),F(this,"p2pToken",void 0),F(this,"websocket",void 0),F(this,"openConnectionTime",void 0),F(this,"clientId",void 0),F(this,"lastMsgTime",Date.now()),F(this,"uploadCache",[]),F(this,"uploadCacheInterval",void 0),F(this,"rttRolling",new GF(5)),F(this,"pingpongTimer",void 0),F(this,"pingpongTimeoutCount",0),F(this,"joinResponse",void 0),F(this,"multiIpOption",void 0),F(this,"initError",void 0),F(this,"spec",void 0),F(this,"store",void 0),F(this,"_external_signal",void 0),F(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(h_.ON_BINARY_DATA,o.data);const a=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){const d="res-@".concat(a._id);this.emit(d,a._result,a._message)}else if(Object.prototype.hasOwnProperty.call(a,"_type")){switch(a._type){case D_.ON_DATA_STREAM:return void this.handleDataStream(a._message);case D_.MUTE_AUDIO:case D_.MUTE_VIDEO:case D_.ON_P2P_LOST:case D_.ON_USER_ONLINE:return;case D_.ON_USER_OFFLINE:const{uid:d}=a._message;return A.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(a._type,a._message),a._type===D_.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===D_.ON_USER_BANNED)switch(a._message.error_code){case 14:this.close(B_.UID_BANNED);break;case 15:this.close(B_.IP_BANNED);break;case 16:this.close(B_.CHANNEL_BANNED)}if(a._type===D_.ON_USER_LICENSE_BANNED)switch(a._message.error_code){case R_.ERR_LICENSE_MISSING:this.close(B_.LICENSE_MISSING);break;case R_.ERR_LICENSE_EXPIRED:this.close(B_.LICENSE_EXPIRED);break;case R_.ERR_LICENSE_MINUTES_EXCEEDED:this.close(B_.LICENSE_MINUTES_EXCEEDED);break;case R_.ERR_LICENSE_PERIOD_INVALID:this.close(B_.LICENSE_PERIOD_INVALID);break;case R_.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(B_.LICENSE_MULTIPLE_SDK_SERVICE);break;case R_.ERR_LICENSE_ILLEGAL:this.close(B_.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new yP("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===F_.CONNECTED&&this.reconnect("retry",lS.OFFLINE)}),this.p2pToken=sT(6,""),this._external_signal=new rO(this,this.p2pToken)}async request(e,n,o,a){const d=sT(6,""),h={_id:d,_type:e,_message:n},p=this.websocket.connectionID,m=()=>new n_((q,L)=>{if(this.connectionState===F_.CONNECTED)return q();const U=()=>{this.off(h_.WS_CLOSED,K),q()},K=()=>{this.off(h_.WS_CONNECTED,U),L(new ya(Y.WS_ABORT))};this.once(h_.WS_CONNECTED,U),this.once(h_.WS_CLOSED,K)});if(this.connectionState!==F_.CONNECTING&&this.connectionState!==F_.RECONNECTING||e===b_.JOIN||e===b_.REJOIN||await m(),this.websocket.sendMessage(h,!0),a)return;const _=new n_((q,L)=>{let U=!1;const K=(_r,_o)=>{U=!0,q({isSuccess:_r==="success",message:_o||{}}),this.off(h_.WS_CLOSED,J),this.off(h_.WS_RECONNECTING,J),this.emit(h_.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(d),K);const J=()=>{L(new ya(Y.WS_ABORT,"type: ".concat(e))),this.off(h_.WS_CLOSED,J),this.off(h_.WS_RECONNECTING,J),this.off("res-@".concat(d),K)};this.once(h_.WS_CLOSED,J),this.once(h_.WS_RECONNECTING,J),$T($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||U||(A.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(h_.REQUEST_TIMEOUT,e,n))})});let g=null;try{g=await _}catch(q){if(this.connectionState===F_.CLOSED||e===b_.LEAVE)throw new ya(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?q.throw():e===b_.JOIN||e===b_.REJOIN?null:(await m(),await this.request(e,n))}if(g.isSuccess)return g.message;const y=Number(g.message.error_code||g.message.code),C=nO(y),O=new ya(Y.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(g.message.error_str),{code:y,data:g.message});return C.action==="success"?g.message:(A.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(y,", message: ").concat(C.desc,", action: ").concat(C.action)),y===R_.ERR_TOO_MANY_BROADCASTERS?((e===b_.JOIN||e===b_.REJOIN)&&(this.initError=O,this.close()),O.throw()):C.action==="failed"?O.throw():C.action==="quit"?(this.initError=O,this.close(),O.throw()):(y===R_.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=g.message.option,A.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",lS.MULTI_IP)):this.reconnect(C.action,lS.SERVER_ERROR),e===b_.JOIN||e===b_.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new n_(o=>{const a=d=>{(!n||n(d))&&(this.off(e,a),o(d))};this.on(e,a)})}uploadWRTCStats(e){if(!this.store.sessionId)return void A.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(eO.WRTC_STATS,n)}upload(e,n){const o={_type:e,_message:n};try{this.websocket.sendMessage(o)}catch{const d=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==F_.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const o={_type:e,_message:n};this.websocket.sendMessage(o)}async sendExtensionMessage(e,n,o){return await this._external_signal.send(e,n,o)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new n_((n,o)=>{this.once(h_.WS_CONNECTED,()=>n(this.joinResponse)),this.once(h_.WS_CLOSED,()=>o(this.initError||new ya(Y.WS_ABORT))),this.connectionState=F_.CONNECTING,this.websocket.init(e).catch(o)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||B_.LEAVE,this.connectionState=F_.CLOSED,A.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===B_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new yP("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents()),this.p2pToken=sT(6,""),this._external_signal.clear(),this._external_signal=new rO(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(h_.ABORT_P2P_EXECUTION);const e=await GT(this,h_.REQUEST_JOIN_INFO),n=await this.request(b_.JOIN,e);if(!n)return this.emit(h_.REPORT_JOIN_GATEWAY,Y.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(h_.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=F_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleDataStream(e){try{var n;const o=$I(e.payload),a=new TextDecoder().decode(o),d=JSON.parse(a);"total"in d&&"id"in d||o_(n=Object.values(DT)).call(n,d._type)?(d._uid=e.uid,this._external_signal.onMessage(d)):this.emit(D_.ON_DATA_STREAM,e)}catch{this.emit(D_.ON_DATA_STREAM,e)}}handleNotification(e){A.debug("[".concat(this.clientId,"] receive notification: "),e);const n=nO(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(B_.UID_BANNED),void this.close()):void this.reconnect(n.action,lS.SERVER_ERROR);A.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=$("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(A.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",lS.TIMEOUT):this.request(b_.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-n;this.rttRolling.add(o),$("REPORT_STATS")&&this.send(b_.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(O_.RECONNECT_WAITTING_FINISH,e=>{this.emit(h_.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(O_.RECONNECT_CREATE_CONNECTION,e=>{this.emit(h_.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(O_.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(O_.CLOSED,()=>{this.connectionState=F_.CLOSED}),this.websocket.on(O_.FAILED,()=>{this._disconnectedReason=B_.NETWORK_ERROR,this.connectionState=F_.CLOSED}),this.websocket.on(O_.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===F_.CONNECTED?this.connectionState=F_.RECONNECTING:this.connectionState=F_.CONNECTING}),this.websocket.on(O_.WILL_RECONNECT,(e,n,o)=>{e!=="retry"?(A.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(h_.NEED_RENEW_SESSION)):A.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(e)}),this.websocket.on(O_.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(h_.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof ya&&e.code===Y.UNEXPECTED_RESPONSE&&e.data.code===R_.ERR_NO_AUTHORIZED)return A.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",lS.SERVER_ERROR);A.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",lS.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(O_.REQUEST_NEW_URLS,(e,n)=>{GT(this,h_.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(O_.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(D_.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function iK(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function M0(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?iK(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):iK(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}const aG=new Map;class Ndt extends ET{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(PT.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(PT.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){A.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){super(),F(this,"store",void 0),F(this,"joinInfo",void 0),F(this,"key",void 0),F(this,"ntpOffset",0),F(this,"signal",void 0),F(this,"role",void 0),F(this,"inChannelInfo",{joinAt:null,duration:0}),F(this,"spec",void 0),F(this,"_state","DISCONNECTED"),F(this,"_statsCollector",void 0),F(this,"_disconnectedReason",void 0),F(this,"isSignalRecover",!1),F(this,"hasChangeBGPAddress",!1),F(this,"trafficStatsInterval",void 0),F(this,"networkQualityInterval",void 0),F(this,"_joinGatewayStartTime",0),F(this,"_signalTimeout",!1),F(this,"_clientRoleOptions",void 0),F(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?new rK(M0(M0({},n),{},{retryConfig:n.websocketRetryConfig}),e):this.store.useDataChannel?new qR(M0(M0({},n),{},{retryConfig:n.websocketRetryConfig}),e):new X8(M0(M0({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,o){if(this.signal instanceof qR){let m=!1;e.cloudProxyServer!=="disabled"?(A.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(e.cloudProxyServer,")")),m=!0):"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length>255||"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length<22?(A.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),m=!0):e.apResponse.addresses.some(_=>_.fingerprint)||$("FINGERPRINT")||(A.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),m=!0),m&&this.resetSignal()}this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const a=Date.now();let d=aG.get(e.cname);if(d||(d=new Map,aG.set(e.cname,d)),this._isProactiveJoin=!0,d.has(e.uid)){const m=new _s(Y.UID_CONFLICT);throw E_.joinGateway(e.sid,{lts:a,succ:!1,ec:m.message,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:this.signal instanceof qR?"1":"0"}),this._isProactiveJoin=!1,m}d.set(e.uid,!0),this.joinInfo=e,this.key=n;let h=0;this.joinGatewayStartTime=a;const p=e.proxyServer;try{let m;if(A.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof qR?"datachannel":"websocket"," join uid ").concat(h)),this.signal instanceof qR)m=await this.signal.init(e.apResponse.addresses,o);else{const _=e.gatewayAddrs.map(g=>{let{address:y}=g;const[C,O]=y.split(":"),q={host:C,port:O};return e.proxyServer&&(q.proxy=e.proxyServer),q});m=await this.signal.init(_,o)}h=m.uid,A.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof qR?"datachannel":"websocket"," join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(m){throw m&&m.code===Y.INIT_WEBSOCKET_TIMEOUT?(A.warning("[".concat(this.store.clientId,"] User join failed"),m.toString()),m):m&&m.code===Y.INIT_DATACHANNEL_TIMEOUT?(A.warning("[".concat(this.store.clientId,"] User join datachannel failed"),m.toString()),this.resetSignal(),m):(A.error("[".concat(this.store.clientId,"] User join failed"),m.toString()),E_.joinGateway(e.sid,{lts:a,succ:!1,ec:m.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!p,signalChannel:this.signal instanceof qR?"1":"0"}),this._isProactiveJoin=!1,d.delete(e.uid),this.signal.close(),m)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),A.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(m=>{A.warning("[".concat(this.store.clientId,"] get traffic stats error"),m.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(PT.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(PT.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(PT.NETWORK_QUALITY,{uplinkNetworkQuality:$8(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:$8(this._statsCollector.trafficStats.B_dnq)}):this.emit(PT.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==B_.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==F_.CONNECTED||await function(o,a){return a===1/0?o:n_.race([o,_ut(a)])}(this.signal.request(b_.LEAVE,void 0,!0),3e3)}catch(o){A.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(n),n!==B_.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const a={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:$("PUB_EXTEND"),twcc:!!$("PUBLISH_TWCC"),rtx:!!$("USE_PUB_RTX")};try{return(await this.signal.request(b_.PUBLISH,a,!0))._message}catch(d){if(o&&d.data&&d.data.code===R_.ERR_PUBLISH_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw d}}async publishDataChannel(e,n,o){var a;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const d={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(a=n.maxRetransmits)!==null&&a!==void 0?a:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(b_.PUBLISH_DATASTREAM,d,!0)}catch(h){if(o&&h.data&&h.data.code===R_.ERR_PUBLISH_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw h}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(b_.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(o){A.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await n_.all(e.map(n=>this.signal.request(b_.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){A.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const a={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$("SUBSCRIBE_TWCC"),rtx:!!$("USE_SUB_RTX")||void 0,extend:$("SUB_EXTEND"),svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return await this.signal.request(b_.PRE_SUBSCRIBE,a,!0)}catch(d){if(o&&d.data&&d.data.code===R_.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(e,n,!1);throw d}}async subscribe(e,n,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const a={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$("SUBSCRIBE_TWCC"),rtx:!!$("USE_SUB_RTX"),extend:$("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return(await this.signal.request(b_.SUBSCRIBE,a,!0))._message}catch(d){if(o&&d.data&&d.data.code===R_.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw d}}async subscribeDataChannel(e,n,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const a={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(b_.SUBSCRIBE_DATASTREAM,a,!0)}catch(d){if(o&&d.data&&d.data.code===R_.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw d}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!$("USE_SUB_RTX"),twcc:!!$("SUBSCRIBE_TWCC"),svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return await this.signal.request(b_.SUBSCRIBE_STREAMS,o,!0)}catch(a){if(n&&a.data&&a.data.code===R_.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),a.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw a}}async setVideoProfile(e){const n=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let a=o.frameRate,d=o.width,h=o.height,p=!0;return typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(p=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(p=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,a||(p=!1)),p?{stream_type:0,width:d,height:h,fps:a,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(e);if(n)return this.signal.request(b_.SET_VIDEO_PROFILE,n);A.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(b_.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(o){A.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await n_.all(e.map(o=>this.signal.request(b_.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:n},!0)))}catch(o){A.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(e){try{await this.signal.request(b_.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){A.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:o,rtpCapabilities:a}=e;return{gatewayEstablishParams:await this.signal.request(b_.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:o,rtpCapabilities:a}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(b_.GATEWAY_INFO)}async renewToken(e){await this.signal.request(b_.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),this.state!=="CONNECTED")return void(this.role=e);let o,a=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,a=1):a=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:a=0,await this.signal.request(b_.SET_CLIENT_ROLE,{role:e,level:a,delay:o,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(b_.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(b_.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(b_.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(b_.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(b_.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,o){if(this.signal instanceof rK)return this.signal.sendExtensionMessage(e,n,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),M0({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(b_.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=aG.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let o;return o=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:hS.username,password:hS.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(M0(M0({},hS),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(b_.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(a=>a.peer_uid===n.peer_uid);o&&o.B_st!==n.B_st&&g1(()=>{this.emit(PT.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new _s(Y.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let o=$("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}o&&o.length>128&&(o=void 0);const a=M0({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:E0,browser:navigator.userAgent,process_id:$("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:$("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:{enablePublishedUserList:$("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:$("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof $("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?$("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof $("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?$("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof $("ENABLE_USER_LICENSE_CHECK")=="boolean"?$("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:$("USE_PUB_RTX")===!0||$("USE_SUB_RTX")===!0||void 0,disableFEC:$("DISABLE_FEC"),enableNTPReport:!!$("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!$("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:typeof $("ENABLE_DATASTREAM_2")=="boolean"?$("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!$("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:typeof $("USE_XR")=="boolean"?$("USE_XR"):void 0,enableLossbasedBwe:typeof $("ENABLE_LOSSBASED_BWE")=="boolean"?$("ENABLE_LOSSBASED_BWE"):void 0,enableAutCC:typeof $("ENABLE_AUT_CC")=="boolean"?$("ENABLE_AUT_CC"):void 0,enableCCFallback:typeof $("ENABLE_CC_FALLBACK")=="boolean"?$("ENABLE_CC_FALLBACK"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(a.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(a.aes_mode=this.joinInfo.aesmode,$("ENCRYPT_AES")?(a.aes_secret=this.joinInfo.aespassword,a.aes_encrypt=!0):a.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(a.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(a.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(a.default_video_stream=this.joinInfo.defaultVideoStream),a}getRejoinMessage(){if(!this.joinInfo)throw new _s(Y.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(h_.WS_RECONNECT_WAITTING_FINISH,e=>{var n;o_(n=["tryNext","recover"]).call(n,e)&&this.joinInfo&&E_.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(h_.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(h_.WS_RECONNECTING,e=>{this.joinInfo&&E_.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||lS.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",E_.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(h_.WS_CLOSED,e=>{let n;switch(e){case B_.LEAVE:n=lS.LEAVE;break;case B_.UID_BANNED:case B_.IP_BANNED:case B_.CHANNEL_BANNED:case B_.SERVER_ERROR:n=lS.SERVER_ERROR;break;case B_.FALLBACK:n=lS.FALLBACK;break;case B_.LICENSE_MISSING:case B_.LICENSE_EXPIRED:case B_.LICENSE_MINUTES_EXCEEDED:case B_.LICENSE_PERIOD_INVALID:case B_.LICENSE_MULTIPLE_SDK_SERVICE:case B_.LICENSE_ILLEGAL:case B_.TOKEN_EXPIRE:n=e;break;default:n=lS.NETWORK_ERROR}A.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+lS.NETWORK_ERROR)),this.joinInfo&&E_.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===B_.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==B_.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(h_.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(A.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),E_.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof qR?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void A.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));rT("EVENT_REPORT_DOMAIN",e[1]),rT("EVENT_REPORT_BACKUP_DOMAIN",e[1]),rT("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}),this.signal.on(D_.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(h_.REQUEST_RECOVER,(e,n,o)=>{if(!this.joinInfo)return o(new _s(Y.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,GT(this,PT.REQUEST_NEW_GATEWAY_LIST).then(n).catch(o)}),this.signal.on(h_.REQUEST_JOIN_INFO,async e=>{var n;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const{iceParameters:o,dtlsParameters:a,rtpCapabilities:d}=await GT(this,PT.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(n=this.joinInfo)===null||n===void 0?void 0:n.turnServer});e(this.getJoinMessage({ortc:{iceParameters:o,dtlsParameters:a,rtpCapabilities:d,version:"2"}}))}),this.signal.on(h_.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(h_.REPORT_JOIN_GATEWAY,(e,n)=>{this.joinInfo&&(E_.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:e,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof qR?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(h_.IS_P2P_DISCONNECTED,e=>{e(QI(this,PT.IS_P2P_DISCONNECTED))}),this.signal.on(h_.DISCONNECT_P2P,()=>{this.emit(PT.DISCONNECT_P2P)}),this.signal.on(h_.NEED_RENEW_SESSION,e=>{this.emit(PT.NEED_RENEW_SESSION,e)}),this.signal.on(h_.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(h_.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(h_.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(PT.JOIN_RESPONSE,e,n)}),this.signal.on(h_.DATACHANNEL_PRECONNECT,async(e,n,o)=>{this.updateTurnConfigFromSignal();const a=this.getCurrentGatewayAddress();return GT(this,PT.DATACHANNEL_PRECONNECT,e,a).then(n).catch(o)}),this.signal.on(h_.DATACHANNEL_CONNECTING,async e=>{const{iceParameters:n,dtlsParameters:o,rtpCapabilities:a}=await GT(this,PT.REQUEST_DC_CONNECTION_PARAMS);e(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:o,rtpCapabilities:a,version:"2"}}))}),this.signal.on(h_.DATACHANNEL_FAILBACK,()=>{A.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(PT.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(b_.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(o){throw A.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(b_.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(o){throw A.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(b_.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(o){throw A.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(b_.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(o){throw A.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(e){const n={users:e.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(b_.UNSUBSCRIBE_STREAMS,n,!0)}catch(o){throw A.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(e,n){const o={action:e.find(a=>a.stream_type===lb.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(b_.CONTROL,o,!0,!0)}catch(a){throw A.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),a),a}}async unmuteLocal(e,n){const o={action:e.find(a=>a.stream_type===lb.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(b_.CONTROL,o,!0,!0)}catch(a){throw A.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),a),a}}async muteRemote(e,n){const o={action:e===m_.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(b_.CONTROL,o,!0,!0)}catch(a){throw A.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),a),a}}async unmuteRemote(e,n){const o={action:e===m_.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(b_.CONTROL,o,!0,!0)}catch(a){throw A.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),a),a}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(b_.RESTART_ICE,n,!0)}catch(o){throw A.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,lS.P2P_FAILED)}getCurrentGatewayAddress(){var e;if(!$("GATEWAY_WSS_ADDRESS"))return(e=this.joinInfo)!==null&&e!==void 0&&e.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(b_.SET_PARAMETER,{enablePublishAudioFilter:e})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(B_.FALLBACK)),this.store.useDataChannel=!1,this.signal=new X8(M0(M0({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(PT.RESET_SIGNAL,G8.websocket)}}let D1=0,cG=0;function oR(t,e,n,o){return new n_((a,d)=>{e.timeout=e.timeout||$("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),D1+=TR(e.data)):n&&(e.data.size?D1+=e.data.size:e.data instanceof FormData?D1+=b8(e.data):D1+=TR(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,MS.request(e).then(h=>{typeof h.data=="string"?cG+=TR(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?cG+=h.data.byteLength:cG+=TR(JSON.stringify(h.data)),o&&a({data:h.data,headers:h.headers}),a(h.data)}).catch(h=>{MS.isCancel(h)?d(new _s(Y.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new _s(Y.NETWORK_TIMEOUT,h.message)):h.response?d(new _s(Y.NETWORK_RESPONSE_ERROR,h.response.status)):d(new _s(Y.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(_h){var t_=0;return function(){return t_<_h.length?{done:!1,value:_h[t_++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(_h,t_,f_){return _h==Array.prototype||_h==Object.prototype||(_h[t_]=f_.value),_h},o,a=function(_h){_h=[typeof globalThis=="object"&&globalThis,_h,typeof window=="object"&&window,typeof self=="object"&&self,typeof u=="object"&&u];for(var t_=0;t_<_h.length;++t_){var f_=_h[t_];if(f_&&f_.Math==Math)return f_}throw Error("Cannot find global object")}(this);function d(_h,t_){if(t_)t:{var f_=a;_h=_h.split(".");for(var A_=0;A_<_h.length-1;A_++){var $_=_h[A_];if(!($_ in f_))break t;f_=f_[$_]}(t_=t_(A_=f_[_h=_h[_h.length-1]]))!=A_&&t_!=null&&n(f_,_h,{configurable:!0,writable:!0,value:t_})}}function h(_h){return(_h={next:_h})[Symbol.iterator]=function(){return this},_h}function p(_h){var t_=typeof Symbol<"u"&&Symbol.iterator&&_h[Symbol.iterator];return t_?t_.call(_h):{next:e(_h)}}if(d("Symbol",function(_h){function t_($_,i_){this.A=$_,n(this,"description",{configurable:!0,writable:!0,value:i_})}if(_h)return _h;t_.prototype.toString=function(){return this.A};var f_="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",A_=0;return function $_(i_){if(this instanceof $_)throw new TypeError("Symbol is not a constructor");return new t_(f_+(i_||"")+"_"+A_++,i_)}}),d("Symbol.iterator",function(_h){if(_h)return _h;_h=Symbol("Symbol.iterator");for(var t_="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),f_=0;f_<t_.length;f_++){var A_=a[t_[f_]];typeof A_=="function"&&typeof A_.prototype[_h]!="function"&&n(A_.prototype,_h,{configurable:!0,writable:!0,value:function(){return h(e(this))}})}return _h}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var m;t:{var _={};try{_.__proto__={a:!0},m=_.a;break t}catch{}m=!1}o=m?function(_h,t_){if(_h.__proto__=t_,_h.__proto__!==t_)throw new TypeError(_h+" is not extensible");return _h}:null}var g=o;function y(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function C(_h){if(_h.m)throw new TypeError("Generator is already running");_h.m=!0}function O(_h,t_){return _h.h=3,{value:t_}}function q(_h){this.g=new y,this.G=_h}function L(_h,t_,f_,A_){try{var $_=t_.call(_h.g.j,f_);if(!($_ instanceof Object))throw new TypeError("Iterator result "+$_+" is not an object");if(!$_.done)return _h.g.m=!1,$_;var i_=$_.value}catch(j){return _h.g.j=null,_h.g.s(j),U(_h)}return _h.g.j=null,A_.call(_h.g,i_),U(_h)}function U(_h){for(;_h.g.h;)try{var t_=_h.G(_h.g);if(t_)return _h.g.m=!1,{value:t_.value,done:!1}}catch(f_){_h.g.v=void 0,_h.g.s(f_)}if(_h.g.m=!1,_h.g.l){if(t_=_h.g.l,_h.g.l=null,t_.F)throw t_.D;return{value:t_.return,done:!0}}return{value:void 0,done:!0}}function K(_h){this.next=function(t_){return _h.o(t_)},this.throw=function(t_){return _h.s(t_)},this.return=function(t_){return function(f_,A_){C(f_.g);var $_=f_.g.j;return $_?L(f_,"return"in $_?$_.return:function(i_){return{value:i_,done:!0}},A_,f_.g.return):(f_.g.return(A_),U(f_))}(_h,t_)},this[Symbol.iterator]=function(){return this}}function J(_h,t_){return t_=new K(new q(t_)),g&&_h.prototype&&g(t_,_h.prototype),t_}if(y.prototype.o=function(_h){this.v=_h},y.prototype.s=function(_h){this.l={D:_h,F:!0},this.h=this.C||this.u},y.prototype.return=function(_h){this.l={return:_h},this.h=this.u},q.prototype.o=function(_h){return C(this.g),this.g.j?L(this,this.g.j.next,_h,this.g.o):(this.g.o(_h),U(this))},q.prototype.s=function(_h){return C(this.g),this.g.j?L(this,this.g.j.throw,_h,this.g.o):(this.g.s(_h),U(this))},d("Array.prototype.entries",function(_h){return _h||function(){return function(t_,f_){t_ instanceof String&&(t_+="");var A_=0,$_=!1,i_={next:function(){if(!$_&&A_<t_.length){var j=A_++;return{value:f_(j,t_[j]),done:!1}}return $_=!0,{done:!0,value:void 0}}};return i_[Symbol.iterator]=function(){return i_},i_}(this,function(t_,f_){return[t_,f_]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var _r=function(_h,t_){for(var f_=0;f_<_h.length;f_++)t_(_h[f_])},_o=function(_h){return _h.replace(/\r?\n|\r/g,`\r
`)},na=function(_h,t_,f_){return t_ instanceof Blob?(f_=f_!==void 0?f_+"":typeof t_.name=="string"?t_.name:"blob",t_.name===f_&&Object.prototype.toString.call(t_)!=="[object Blob]"||(t_=new File([t_],f_)),[String(_h),t_]):[String(_h),String(t_)]},ba=function(_h,t_){if(_h.length<t_)throw new TypeError(t_+" argument required, but only "+_h.length+" present.")},_u=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,_l=_u.FormData,_p=_u.XMLHttpRequest&&_u.XMLHttpRequest.prototype.send,u_=_u.Request&&_u.fetch,W_=_u.navigator&&_u.navigator.sendBeacon,_v=_u.Element&&_u.Element.prototype,hT=_u.Symbol&&Symbol.toStringTag;hT&&(Blob.prototype[hT]||(Blob.prototype[hT]="Blob"),"File"in _u&&!File.prototype[hT]&&(File.prototype[hT]="File"));try{new File([],"")}catch{_u.File=function(t_,f_,A_){return t_=new Blob(t_,A_||{}),Object.defineProperties(t_,{name:{value:f_},lastModified:{value:+(A_&&A_.lastModified!==void 0?new Date(A_.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),hT&&Object.defineProperty(t_,hT,{value:"File"}),t_}}var FT=function(_h){return _h.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},ST=function(_h){this.i=[];var t_=this;_h&&_r(_h.elements,function(f_){if(f_.name&&!f_.disabled&&f_.type!=="submit"&&f_.type!=="button"&&!f_.matches("form fieldset[disabled] *"))if(f_.type==="file"){var A_=f_.files&&f_.files.length?f_.files:[new File([],"",{type:"application/octet-stream"})];_r(A_,function($_){t_.append(f_.name,$_)})}else f_.type==="select-multiple"||f_.type==="select-one"?_r(f_.options,function($_){!$_.disabled&&$_.selected&&t_.append(f_.name,$_.value)}):f_.type==="checkbox"||f_.type==="radio"?f_.checked&&t_.append(f_.name,f_.value):(A_=f_.type==="textarea"?_o(f_.value):f_.value,t_.append(f_.name,A_))})};if((t=ST.prototype).append=function(_h,t_,f_){ba(arguments,2),this.i.push(na(_h,t_,f_))},t.delete=function(_h){ba(arguments,1);var t_=[];_h=String(_h),_r(this.i,function(f_){f_[0]!==_h&&t_.push(f_)}),this.i=t_},t.entries=function _h(){var t_,f_=this;return J(_h,function(A_){if(A_.h==1&&(t_=0),A_.h!=3)return t_<f_.i.length?A_=O(A_,f_.i[t_]):(A_.h=0,A_=void 0),A_;t_++,A_.h=2})},t.forEach=function(_h,t_){ba(arguments,1);for(var f_=p(this),A_=f_.next();!A_.done;A_=f_.next()){var $_=p(A_.value);A_=$_.next().value,$_=$_.next().value,_h.call(t_,$_,A_,this)}},t.get=function(_h){ba(arguments,1);var t_=this.i;_h=String(_h);for(var f_=0;f_<t_.length;f_++)if(t_[f_][0]===_h)return t_[f_][1];return null},t.getAll=function(_h){ba(arguments,1);var t_=[];return _h=String(_h),_r(this.i,function(f_){f_[0]===_h&&t_.push(f_[1])}),t_},t.has=function(_h){ba(arguments,1),_h=String(_h);for(var t_=0;t_<this.i.length;t_++)if(this.i[t_][0]===_h)return!0;return!1},t.keys=function _h(){var t_,f_,A_,$_,i_=this;return J(_h,function(j){if(j.h==1&&(t_=p(i_),f_=t_.next()),j.h!=3)return f_.done?void(j.h=0):(A_=f_.value,$_=p(A_),O(j,$_.next().value));f_=t_.next(),j.h=2})},t.set=function(_h,t_,f_){ba(arguments,2),_h=String(_h);var A_=[],$_=na(_h,t_,f_),i_=!0;_r(this.i,function(j){j[0]===_h?i_&&(i_=!A_.push($_)):A_.push(j)}),i_&&A_.push($_),this.i=A_},t.values=function _h(){var t_,f_,A_,$_,i_=this;return J(_h,function(j){if(j.h==1&&(t_=p(i_),f_=t_.next()),j.h!=3)return f_.done?void(j.h=0):(A_=f_.value,($_=p(A_)).next(),O(j,$_.next().value));f_=t_.next(),j.h=2})},ST.prototype._asNative=function(){for(var _h=new _l,t_=p(this),f_=t_.next();!f_.done;f_=t_.next()){var A_=p(f_.value);f_=A_.next().value,A_=A_.next().value,_h.append(f_,A_)}return _h},ST.prototype._blob=function(){var _h="----formdata-polyfill-"+Math.random(),t_=[],f_="--"+_h+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(A_,$_){return typeof A_=="string"?t_.push(f_+FT(_o($_))+`"\r
\r
`+_o(A_)+`\r
`):t_.push(f_+FT(_o($_))+'"; filename="'+FT(A_.name)+`"\r
Content-Type: `+(A_.type||"application/octet-stream")+`\r
\r
`,A_,`\r
`)}),t_.push("--"+_h+"--"),new Blob(t_,{type:"multipart/form-data; boundary="+_h})},ST.prototype[Symbol.iterator]=function(){return this.entries()},ST.prototype.toString=function(){return"[object FormData]"},_v&&!_v.matches&&(_v.matches=_v.matchesSelector||_v.mozMatchesSelector||_v.msMatchesSelector||_v.oMatchesSelector||_v.webkitMatchesSelector||function(_h){for(var t_=(_h=(this.document||this.ownerDocument).querySelectorAll(_h)).length;0<=--t_&&_h.item(t_)!==this;);return-1<t_}),hT&&(ST.prototype[hT]="FormData"),_p){var J0=_u.XMLHttpRequest.prototype.setRequestHeader;_u.XMLHttpRequest.prototype.setRequestHeader=function(_h,t_){J0.call(this,_h,t_),_h.toLowerCase()==="content-type"&&(this.B=!0)},_u.XMLHttpRequest.prototype.send=function(_h){_h instanceof ST?(_h=_h._blob(),this.B||this.setRequestHeader("Content-Type",_h.type),_p.call(this,_h)):_p.call(this,_h)}}u_&&(_u.fetch=function(_h,t_){return t_&&t_.body&&t_.body instanceof ST&&(t_.body=t_.body._blob()),u_.call(this,_h,t_)}),W_&&(_u.navigator.sendBeacon=function(_h,t_){return t_ instanceof ST&&(t_=t_._asNative()),W_.call(this,_h,t_)}),_u.FormData=ST}})();const RP=()=>{const t=$("AREAS");return t.length===0&&t.push(Z_.GLOBAL),Z0(t).call(t,(e,n,o)=>{const a=oK(n);return a?o===0?a:"".concat(e,",").concat(a):e},"")},oK=t=>t===Z_.OVERSEA?"".concat(_S.ASIA,",").concat(_S.EUROPE,",").concat(_S.AFRICA,",").concat(_S.NORTH_AMERICA,",").concat(_S.SOUTH_AMERICA,",").concat(_S.OCEANIA):_S[t],Pdt=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(n=>{const o=A1[n],a=Object.keys(o);a&&a.map(d=>{d!=="CODE"&&(e[d]=e[d].concat(o[d]))})}),e},k1={GLOBAL:{ASIA:[Z_.CHINA,Z_.JAPAN,Z_.INDIA,Z_.KOREA,Z_.HKMC],EUROPE:[],NORTH_AMERICA:[Z_.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},L1=Object.keys(k1[Z_.GLOBAL]),uG=[Z_.CHINA,Z_.NORTH_AMERICA,Z_.EUROPE,Z_.ASIA,Z_.JAPAN,Z_.INDIA,Z_.OCEANIA,Z_.SOUTH_AMERICA,Z_.AFRICA,Z_.KOREA,Z_.HKMC,Z_.US],Ddt=function(t,e){let n=[];if(o_(t).call(t,Z_.GLOBAL)){const d=[Z_.GLOBAL,Z_.OVERSEA],h=Object.keys(A1);if(e===Z_.GLOBAL)throw new _s(Y.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===Z_.CHINA)n=[Z_.OVERSEA];else if(a=e,o_(L1).call(L1,a)){const p=(o=e,k1[Z_.GLOBAL][o]||[]),m=[...d,e,...p];n=h.filter(_=>!o_(m).call(m,_))}else if(function(p){let m=!1;return L1.forEach(_=>{var g;o_(g=k1[Z_.GLOBAL][_]).call(g,p)&&(m=!0)}),m}(e)){const p=function(_){let g;return L1.forEach(y=>{var C;o_(C=k1[Z_.GLOBAL][y]).call(C,_)&&(g=y)}),g}(e),m=[...d,p,e];n=h.filter(_=>!o_(m).call(m,_))}else n=t;n=function(p){const m=[];return uG.forEach(_=>{o_(p).call(p,_)&&m.push(_)}),m.concat(p.filter(_=>!o_(uG).call(uG,_)))}(n)}else n=t;var o,a;return n};function sK(t){var e,n;if(!t&&o_(e=$("AREAS")).call(e,Z_.EXTENSIONS))return A.debug("update area from ap : reset"),void dG(Iut,!0);if(!o_(n=$("AREAS")).call(n,Z_.GLOBAL)||!t)return;let o=A1.EXTENSIONS;o&&(o={CODE:oK(Z_.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},A.debug("update area from ap success: ".concat(t,",config is "),o),rT("AREAS",[Z_.EXTENSIONS],!0),Object.keys(o).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?rT(a,o[a][0]):rT(a,o[a])}))}function dG(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=E_.reportApiInvoke(null,{name:BT.SET_AREA,options:t,tag:IT.TRACER});try{let o=[];if(typeof t=="string"&&(o=[t]),Array.isArray(t)&&(t.forEach(d=>{if(!o_(H8).call(H8,d))throw new _s(Y.INVALID_PARAMS,"invalid area code")}),o=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:d,excludedArea:h}=t;if(!d)throw new _s(Y.INVALID_PARAMS,"area code is needed");let p=d;typeof d=="string"&&(p=[d]),o=h?Ddt(p,h):p}if(!e){if(mI.AREAS){const d=new _s(Y.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(d),void A.warning("setArea is prohibited because of config-distribute")}if(o_(o).call(o,Z_.GLOBAL)&&$("AREAS")===Z_.EXTENSIONS){const d=new _s(Y.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(d),void A.warning("setArea is prohibited because of ap extensions")}}rT("AREAS",o,e);const a=Pdt(o);Object.keys(a).map(d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?rT(d,a[d][0]):rT(d,a[d])}),A.debug("set area success:",o.join(","))}catch(o){throw n.onError(o),o}n.onSuccess()}function aK(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function lG(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?aK(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):aK(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}let hG=1;function kdt(t,e,n,o,a){hG+=1;const d={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:hG,requestId:hG,version:E0,cname:n.cname},h={service_name:e,json_body:JSON.stringify(d)};let p,m,_=t[0];return eR(async()=>{p=Date.now();const g=await oR(_,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-p,g.code!==0){const O=new _s(Y.UNEXPECTED_RESPONSE,"live streaming ap error, code"+g.code,{retry:!0,responseTime:m});throw A.error(O.toString()),O}const y=JSON.parse(g.json_body);if(y.code!==200){const O=new _s(Y.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(y.code,", reason: ").concat(y.reason),{code:y.code,responseTime:m});throw A.error(O.toString()),O}if(!y.servers||y.servers.length===0){const O=new _s(Y.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:y.code,responseTime:m});throw A.error(O.toString()),O}const C=function(O,q){return{addressList:O.servers.map(L=>"wss://".concat(L.address.replace(/\./g,"-"),".").concat($("WORKER_DOMAIN"),":").concat(L.wss,"?serviceName=").concat(encodeURIComponent(q))),workerToken:O.workerToken,vid:O.vid}}(y,e);return $("LIVE_STREAMING_ADDRESS")&&(C.addressList=$("LIVE_STREAMING_ADDRESS")instanceof Array?$("LIVE_STREAMING_ADDRESS"):[$("LIVE_STREAMING_ADDRESS")]),lG(lG({},C),{},{responseTime:m})},(g,y)=>(E_.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(g.addressList),firstSuccess:y===0,responseTime:m,serverIp:t[y%t.length]}),!1),(g,y)=>(E_.apworkerEvent(n.sid,{success:!1,sc:g.data&&g.data.code||200,serviceName:e,responseTime:m,serverIp:t[y%t.length]}),!!(g.code!==Y.OPERATION_ABORTED&&g.code!==Y.UNEXPECTED_RESPONSE||g.data&&g.data.retry)&&(_=t[(y+1)%t.length],!0)),a)}let pG=1;function cK(t,e,n,o){let{url:a,areaCode:d}=t;const{clientId:h,sid:p}=e,m=Date.now();let _;const[g,y]=mG(e,d,[jT.CHOOSE_SERVER]);let C=wT.networkState;return eR(async()=>{C&&wT.networkState===AS.OFFLINE&&wT.onlineWaiter&&await n_.race([wT.onlineWaiter,$T(o&&o.maxRetryTimeout||xT.maxRetryTimeout)]),C=wT.networkState;const{data:O,headers:q}=await oR(a,{data:g,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=q.http3==="1"?1:-1,E_.reportResourceTiming(a,p),dK(O,a,e,m,[jT.CHOOSE_SERVER],_);const L=SP(O,jT.CHOOSE_SERVER);return fG(L),oG(L,a)},O=>(O&&E_.joinChooseServer(p,{lts:m,succ:!0,csAddr:a,opid:y,serverList:O.gatewayAddrs.map(q=>q.address),ec:null,cid:O.cid.toString(),uid:O.uid.toString(),csIp:O.csIp,unilbsServerIds:[jT.CHOOSE_SERVER].toString(),isHttp3:_}),!1),O=>O.code!==Y.OPERATION_ABORTED&&(O.code===Y.CAN_NOT_GET_GATEWAY_SERVER?O.data.retry:(E_.joinChooseServer(p,{lts:m,succ:!1,csAddr:a,serverList:null,opid:y,ec:O.code,csIp:O.data&&O.data.csIp,unilbsServerIds:[jT.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:C}),isHttp3:_}),A.warning("[".concat(h||"sid-".concat(p.slice(0,6)),"] Choose server network error, retry"),O),!0)),o)}function uK(t,e,n,o){let a,{url:d,areaCode:h,serviceIds:p}=t;const m=Date.now(),[_,g]=mG(e,h,p);let y;return eR(async()=>{y&&wT.networkState===AS.OFFLINE&&wT.onlineWaiter&&await n_.race([wT.onlineWaiter,$T(o&&o.maxRetryTimeout||xT.maxRetryTimeout)]),y=wT.networkState;const{data:C,headers:O}=await oR(d,{data:_,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);a=O.http3==="1"?1:-1,E_.reportResourceTiming(d,e.sid),dK(C,d,e,m,p,a);const q=SP(C,jT.CHOOSE_SERVER),L=SP(C,e.cloudProxyServer==="proxy5"?jT.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?jT.CLOUD_PROXY:jT.CLOUD_PROXY_FALLBACK);return fG(q),{gatewayInfo:oG(q,d),proxyInfo:L,url:d}},C=>(C.gatewayInfo&&E_.joinChooseServer(e.sid,{lts:m,succ:!0,csAddr:d,serverList:C.gatewayInfo.gatewayAddrs.map(O=>O.address),ec:null,opid:g,cid:C.gatewayInfo.cid.toString(),uid:C.gatewayInfo.uid.toString(),csIp:C.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:a}),C.proxyInfo&&E_.joinWebProxyAP(e.sid,{lts:m,sucess:1,apServerAddr:d,turnServerAddrList:C.proxyInfo.addresses.map(O=>O.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:p.toString()}),!1),C=>C.code!==Y.OPERATION_ABORTED&&(C.code===Y.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:(E_.joinWebProxyAP(e.sid,{lts:m,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:C.code,eventType:e.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:y})}),A.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),C),!0)),o)}const dK=(t,e,n,o,a,d)=>{const{sid:h,clientId:p,cloudProxyServer:m}=n,_=[],g=y=>{y.flag===4096?E_.joinChooseServer(h,{lts:o,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:y.error.message,csIp:y.error.data&&y.error.data.csIp,unilbsServerIds:a.toString(),isHttp3:d}):y.flag!==1048576&&y.flag!==4194304&&y.flag!==4194310||E_.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:y.error.code,eventType:m,unilbsServerIds:a.toString()})};if(t.response_body.forEach(y=>{const C=y.buffer.code;if(y.uri===23&&C===0&&!y.buffer.edges_services)if(y.buffer.flag===4194310)A.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),y.buffer.edges_services=[];else{const O={error:new _s(Y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:y.buffer.flag};_.push(O),g(O)}if(C!==0){const O=oN(C),q={error:new _s(Y.CAN_NOT_GET_GATEWAY_SERVER,O.desc,{desc:O.desc,retry:O.retry,csIp:t.detail[502]}),flag:y.buffer.flag};y.buffer.flag===4194310?A.warning(q.error.toString()):_.push(q),g(q)}}),_.length)throw A.warning("[".concat(p||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(_.map(y=>"flag: ".concat(y.flag,", message: ").concat(y.error.message,", retry: ").concat(y.error.data.retry)).join(" | "))),new _s(Y.CAN_NOT_GET_GATEWAY_SERVER,_.map(y=>"flag: ".concat(y.flag,", message: ").concat(y.error.message)).join(" | "),{retry:!!_.find(y=>y.error.data.retry),csIp:t.detail[502],desc:[...new Set(_.map(y=>{var C;return y==null||(C=y.error)===null||C===void 0||(C=C.data)===null||C===void 0?void 0:C.desc}).filter(y=>!!y))]})},fG=t=>{var e,n,o,a;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new _s(Y.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if($("AP_AREA")&&((o=t.detail)!==null&&o!==void 0&&o[23]&&typeof((a=t.detail)===null||a===void 0?void 0:a[23])=="string"?sK(t.detail[23].toLowerCase()):sK()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const h=t.detail[19],p=h==null?void 0:h.split(";");for(let m=0;m<p.length;m++){var d;const _=TS(d=p[m]).call(d);t.addresses[m]&&p&&(t.addresses[m].fingerprint=_)}}if($("GATEWAY_ADDRESS")&&$("GATEWAY_ADDRESS").length>0){A.debug("assign gateway address to",$("GATEWAY_ADDRESS"));const h=$("GATEWAY_ADDRESS").map(p=>{var m,_;const g=(m=(_=t.addresses.find(y=>y.ip===p.ip&&y.port===p.port))===null||_===void 0?void 0:_.fingerprint)!==null&&m!==void 0?m:"";return{ip:p.ip,port:p.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:g}});t.addresses=h}},Ldt=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const o=oN(n.buffer.code);throw new _s(Y.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return n.buffer.ticket}throw A.debug("update ticket request received ap response without response body:",e),new _s(Y.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},mG=(t,e,n)=>{const o=Math.floor(Math.random()*1e12),a={appid:t.appId,client_ts:Date.now(),opid:o,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:lG({6:t.stringUid,11:e,12:$("USE_NEW_TOKEN")?"1":void 0,22:e},t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};a.request_bodies.forEach(h=>{t.multiIP&&t.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(a)),[d,o]},Mdt=(t,e)=>{const n=Math.floor(Math.random()*1e12),o={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},a=new FormData;return a.append("request",JSON.stringify(o)),[a,n]};let sN=0;function aN(t){return n_.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const CP=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:o,allFailedhandler:a,promisesCollector:d}=t,h=0;const p=e;let m,_=0;const g=async()=>{const y=(()=>{const C=h*p,O=C+p;return n.slice(C,O).map(o)})();d&&d.push(...y);try{m=await aN(y)}catch(C){if(_+=p,h++,!(_>=n.length))return void await g();a(C)}y.forEach(C=>C.cancel())};return await g(),m},lK=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:o}=t;const a=e.length;let d=0;const h=async()=>{const p=n(e.shift());try{return await p}catch(m){if(d++,d>=a||o!=null&&o(m))throw m;return h()}};return h()};async function EG(t,e,n,o){return{gatewayInfo:await async function(d,h,p,m){let _=null;const g=[],y=async()=>{const O=$("WEBCS_DOMAIN").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(U=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(U+"/api/v2/transpond/webrtc?v=2"):"https://".concat(U,"/api/v2/transpond/webrtc?v=2"),areaCode:RP()})),q=m.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(U=>U.url)}),L=await CP({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:U=>(A.debug("[".concat(d.clientId,"] Connect to choose_server:"),U.url),cK(U,d,h,p)),allFailedhandler:U=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},q),U[0]},promisesCollector:g});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},q),L},C=async()=>{if(await $T(1e3),_!==null)return _;const O=$("WEBCS_DOMAIN_BACKUP_LIST").map(U=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(U+"/api/v2/transpond/webrtc?v=2"):"https://".concat(U,"/api/v2/transpond/webrtc?v=2"),areaCode:RP()})),q=m.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(U=>U.url)}),L=await CP({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:U=>(A.debug("[".concat(d.clientId,"] Connect to backup choose_server:"),U.url),cK(U,d,h,p)),allFailedhandler:U=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},q),U[0]},promisesCollector:g});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},q),L};try{return _=await aN([y(),C()]),g.length&&g.forEach(O=>O.cancel&&typeof O.cancel=="function"&&O.cancel()),_}catch(O){throw O[0]}}(t,e,n,o)}}async function hK(t,e,n,o,a){const d=t.cloudProxyServer;if(d==="disabled"){if(t.useLocalAccessPoint)return await EG(t,e,n,a);if($("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:C,proxyInfo:O}=await mK(t,e,n,a);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:C};const q=O.map(L=>({turnServerURL:L.address,tcpport:L.tcpport||hS.tcpport,udpport:L.udpport||hS.udpport,username:L.username||hS.username,password:L.password||hS.password,forceturn:!1,security:!0}));if(a.useP2P){var h;const L=(h=t.uid)!==null&&h!==void 0?h:C.uid,U="glb:".concat(L.toString()),K=await VF(U),J=O.map(_r=>({turnServerURL:_r.address,tcpport:_r.tcpport||hS.tcpport,udpport:_r.udpport||hS.udpport,username:U,password:K,forceturn:!1,security:!0}));q.push(...J)}return t.turnServer={mode:"manual",servers:q},{gatewayInfo:C}}return await EG(t,e,n,a)}const{proxyInfo:p,gatewayInfo:m}=await mK(t,e,n,a),_={gatewayInfo:m},g=p.map(C=>({turnServerURL:C.address,tcpport:d==="proxy3"?void 0:C.tcpport?C.tcpport:hS.tcpport,udpport:d==="proxy4"?void 0:C.udpport?C.udpport:hS.udpport,username:C.username||hS.username,password:C.password||hS.password,forceturn:d!=="proxy4",security:d==="proxy5"}));if(a.useP2P){var y;const C=(y=t.uid)!==null&&y!==void 0?y:m.uid,O="glb:".concat(C.toString()),q=await VF(O),L=p.map(U=>({turnServerURL:U.address,tcpport:d==="proxy3"?void 0:U.tcpport||hS.tcpport,udpport:d==="proxy4"?void 0:U.udpport||hS.udpport,username:O,password:q,forceturn:d!=="proxy4",security:d==="proxy5"}));g.push(...L)}return t.turnServer={mode:"manual",servers:g},A.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(d)),_}async function pK(t,e,n,o,a){const d=$("ACCOUNT_REGISTER").slice(0,$("AJAX_REQUEST_CONCURRENT"));let h=[];h=e.proxyServer?d.map(m=>"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v1")):d.map(m=>"https://".concat(m,"/api/v1"));const p=a==null?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const m=await async function(_,g,y,C,O){const q=Date.now(),L={sid:y.sid,opid:10,appid:y.appId,string_uid:g};let U=_[0];const K=await eR(()=>oR(U+"".concat(U.indexOf("?")===-1?"?":"&","action=stringuid"),{data:L,cancelToken:C,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(J,_r)=>{if(J.code===0){if(J.uid<=0||J.uid>=Math.pow(2,32))throw A.error("Invalid Uint Uid ".concat(g," => ").concat(J.uid),J),E_.reqUserAccount(L.sid,{lts:q,success:!1,serverAddr:U,stringUid:L.string_uid,uid:J.uid,errorCode:Y.INVALID_UINT_UID_FROM_STRING_UID,extend:L}),new _s(Y.INVALID_UINT_UID_FROM_STRING_UID);return E_.reqUserAccount(L.sid,{lts:q,success:!0,serverAddr:U,stringUid:L.string_uid,uid:J.uid,errorCode:null,extend:L}),!1}const _o=oN(J.code);return _o.retry&&(U=_[(_r+1)%_.length]),E_.reqUserAccount(L.sid,{lts:q,success:!1,serverAddr:U,stringUid:L.string_uid,uid:J.uid,errorCode:_o.desc,extend:L}),_o.retry},(J,_r)=>J.code!==Y.OPERATION_ABORTED&&(E_.reqUserAccount(L.sid,{lts:q,success:!1,serverAddr:U,stringUid:L.string_uid,uid:null,errorCode:J.code,extend:L}),U=_[(_r+1)%_.length],!0),O);if(K.code!==0){const J=oN(K.code);throw new _s(Y.UNEXPECTED_RESPONSE,J.desc)}return K}(h,t,e,n,o);return a==null||a.recordJoinChannelService({status:"success",endTs:Date.now()},p),m.uid}catch(m){throw a==null||a.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},p),m}}async function Udt(t,e,n){const o=$("ACCOUNT_REGISTER");let a=[];a=e.proxyServer?o.map(d=>"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1")):o.map(d=>"https://".concat(d,"/api/v1"));try{return await lK({referenceList:a,asyncMapHandler:h=>async function(p,m,_,g){const y=Date.now(),C={sid:_.sid,opid:10,appid:_.appId,string_uid:m};try{const O=await oR(p+"".concat(p.indexOf("?")===-1?"?":"&","action=stringuid"),{data:C,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(O.code!==0){const q=oN(O.code);throw new _s(Y.UNEXPECTED_RESPONSE,"preload sua error:".concat(q.desc),q)}if(O.uid<=0||O.uid>=Math.pow(2,32))throw new _s(Y.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:y,url:p,req:C,uid:O.uid,elapse:Date.now()-y}}catch(O){throw O}}(h,t,e,n),closeFn:h=>h.code===Y.OPERATION_ABORTED||h.code===Y.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(d){throw d}}async function xdt(t,e,n){const o=$("CDS_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(m=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1?action=config")),a=o.map(m=>function(_,g,y,C){const O=Y_(),q={flag:64,cipher_method:0,features:{device:O.name,system:O.os,system_general:navigator.userAgent,vendor:g.appId,version:E0,cname:g.cname,sid:g.sid,session_id:g.sid,detail:"",proxyServer:g.proxyServer}};return eR(()=>oR(_,{data:q,timeout:1e3,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,L=>L.code!==Y.OPERATION_ABORTED,C)}(m,t,e,n));let d=null,h=null,p={};try{d=await aN(a)}catch(m){if(m.code===Y.OPERATION_ABORTED)throw m;h=m}if(a.forEach(m=>m.cancel()),E_.reportApiInvoke(t.sid,{name:BT.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{p=function(m){if(!m.test_tags)return{};const _=m.test_tags,g=Object.keys(_),y={};return g.forEach(C=>{var O;const q=TS(O=C.slice(4)).call(O),L=JSON.parse(_[C])[1];y[q]=L}),y}(d)}catch{}return p}async function fK(t,e){const n=$("WEBCS_DOMAIN").concat($("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:RP(),serviceIds:[jT.CHOOSE_SERVER,jT.CLOUD_PROXY_FALLBACK]}));try{return await lK({referenceList:n,asyncMapHandler:a=>async function(d,h,p){let m,{url:_,areaCode:g,serviceIds:y}=d;const C=Date.now(),[O,q]=mG(h,g,y);let L=wT.networkState;try{L&&wT.networkState===AS.OFFLINE&&wT.onlineWaiter&&await n_.race([wT.onlineWaiter,$T(xT.maxRetryTimeout)]),L=wT.networkState;const{data:U,headers:K}=await oR(_,{data:O,cancelToken:p,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);m=K.http3==="1"?1:-1,(na=>{const ba=[];if(na.response_body.forEach(_u=>{const _l=_u.buffer.code;if(_u.uri===23&&_l===0&&!_u.buffer.edges_services)if(_u.buffer.flag===4194310)_u.buffer.edges_services=[];else{const _p={error:new _s(Y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:na.detail[502]}),flag:_u.buffer.flag};ba.push(_p)}if(_l!==0){const _p=oN(_l),u_={error:new _s(Y.CAN_NOT_GET_GATEWAY_SERVER,_p.desc,{desc:_p.desc,retry:_p.retry,csIp:na.detail[502]}),flag:_u.buffer.flag};_u.buffer.flag===4194310?A.warning(u_.error.toString()):ba.push(u_)}}),ba.length)throw new _s(Y.CAN_NOT_GET_GATEWAY_SERVER,ba.map(_u=>"flag: ".concat(_u.flag,", message: ").concat(_u.error.message)).join(" | "),{retry:!!ba.find(_u=>_u.error.data.retry),csIp:na.detail[502],desc:[...new Set(ba.map(_u=>{var _l;return _u==null||(_l=_u.error)===null||_l===void 0||(_l=_l.data)===null||_l===void 0?void 0:_l.desc}).filter(_u=>!!_u))]})})(U);const _r=SP(U,jT.CHOOSE_SERVER),_o=SP(U,jT.CLOUD_PROXY_FALLBACK);return fG(_r),{gatewayInfo:oG(_r,_),proxyInfo:_o,opid:q,requestTime:C,url:_,isHttp3:m,elapse:Date.now()-C}}catch(U){throw U}}(a,t,e),closeFn:a=>a.code===Y.OPERATION_ABORTED||a.code===Y.CAN_NOT_GET_GATEWAY_SERVER&&!a.data.retry})}catch(o){throw o}}async function mK(t,e,n,o){const a=$("PROXY_SERVER_TYPE3"),d=(O,q,L)=>{let U=L||a;return Array.isArray(U)&&(U=q%2==0?a[1]:a[0]),"https://".concat(U,"/ap/?url=").concat(O)};let h=null;const p=[],m=async()=>{const O=$("WEBCS_DOMAIN").slice(0,$("AJAX_REQUEST_CONCURRENT")).map((U,K)=>{let J;return J=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(U,"/api/v2/transpond/webrtc?v=2"),K,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(U,"/api/v2/transpond/webrtc?v=2"):d("".concat(U,"/api/v2/transpond/webrtc?v=2"),K),{url:J,areaCode:RP(),serviceIds:[jT.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?jT.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?jT.CLOUD_PROXY:jT.CLOUD_PROXY_FALLBACK]}}),q=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(U=>U.url)}),L=await CP({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:U=>(A.debug("[".concat(t.clientId,"] Connect to choose_server:"),U.url),uK(U,t,e,n)),allFailedhandler:U=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},q),U[0]},promisesCollector:p});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},q),L},_=async()=>{if(await $T(1e3),h!==null)return h;const O=$("WEBCS_DOMAIN_BACKUP_LIST").map((U,K)=>{let J;return J=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(U,"/api/v2/transpond/webrtc?v=2"),K,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(U,"/api/v2/transpond/webrtc?v=2"):d("".concat(U,"/api/v2/transpond/webrtc?v=2"),K),{url:J,areaCode:RP(),serviceIds:[jT.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?jT.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?jT.CLOUD_PROXY:jT.CLOUD_PROXY_FALLBACK]}}),q=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(U=>U.url)}),L=await CP({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:U=>(A.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),U.url),uK(U,t,e,n)),allFailedhandler:U=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},q),U[0]},promisesCollector:p});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},q),L};let g,y,C;try{({gatewayInfo:g,proxyInfo:y,url:C}=await aN([m(),_()]))}catch(O){throw O[0]}if(p.length&&p.forEach(O=>O.cancel&&typeof O.cancel=="function"&&O.cancel()),!g||!y)throw new _s(Y.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=C,t.cloudProxyServer!=="disabled"&&Array.isArray(a)&&C){const O=/^https?:\/\/(.+?)(\/.*)?$/.exec(C)[1];o_(a).call(a,O)&&(t.proxyServer=O,A.setProxyServer(O),E_.setProxyServer(O))}return h={gatewayInfo:g,proxyInfo:await tK(y,g.uid)},h}async function EK(t,e,n,o){const a=$("UAP_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap"));return await kdt(a,t,e,n,o)}async function jdt(t,e,n){const o=$("UAP_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")),a=o.map(d=>function(h,p,m,_){const g={command:"convergeAllocateEdge",sid:p.sid,appId:p.appId,token:p.token,ts:Date.now(),version:E0,cname:p.cname,uid:p.uid.toString(),requestId:pG,seq:pG};pG+=1;const y={service_name:"tele_channel",json_body:JSON.stringify(g)};return eR(async()=>{const C=await oR(h,{data:y,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(C.code!==0){const q=new _s(Y.UNEXPECTED_RESPONSE,"cross channel ap error, code"+C.code,{retry:!0});throw A.error(q.toString()),q}const O=JSON.parse(C.json_body);if(O.code!==200){const q=new _s(Y.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(O.code,", reason: ").concat(O.reason));throw A.error(q.toString()),q}if(!O.servers||O.servers.length===0){const q=new _s(Y.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw A.error(q.toString()),q}return{vid:O.vid,workerToken:O.workerToken,addressList:($("CHANNEL_MEDIA_RELAY_SERVERS")||O.servers).map(q=>"wss://".concat(q.address.replace(/\./g,"-"),".").concat($("WORKER_DOMAIN"),":").concat(q.wss))}},void 0,C=>!!(C.code!==Y.OPERATION_ABORTED&&C.code!==Y.UNEXPECTED_RESPONSE||C.data&&C.data.retry),_)}(d,t,e,n));try{const d=await aN(a);return a.forEach(h=>h.cancel()),d}catch(d){throw d[0]}}async function Vdt(t,e,n){let o=null;const a=[],d=async h=>{const p=$(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(m=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(m+"/api/v2/transpond/webrtc?v=2"):"https://".concat(m,"/api/v2/transpond/webrtc?v=2"));return h&&(await $T(1e3),o!==null)?o:await CP({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:m=>(A.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),m),function(_,g,y,C){const[O]=Mdt(g,[jT.CHOOSE_SERVER]);let q=wT.networkState;return eR(async()=>{q&&wT.networkState===AS.OFFLINE&&wT.onlineWaiter&&await n_.race([wT.onlineWaiter,$T(C&&C.maxRetryTimeout||xT.maxRetryTimeout)]),q=wT.networkState;const L=await oR(_,{data:O,cancelToken:y,headers:{"Content-Type":"multipart/form-data;"}},!0);return Ldt(L,_)},()=>!1,L=>L.code!==Y.OPERATION_ABORTED&&(L.code===Y.UPDATE_TICKET_FAILED?L.data.retry:(A.warning("[".concat(g.clientId,"] update ticket network error, retry"),L),!0)),C)}(m,t,e,n)),allFailedhandler:m=>{throw m[0]},promisesCollector:a})};try{return o=await aN([d(!1),d(!0)]),a.length&&a.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function _K(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function gK(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_K(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_K(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}class Fdt extends ET{get isSuccess(){return!!this.configs}constructor(){super(),F(this,"configs",void 0),F(this,"joinInfo",void 0),F(this,"cancelToken",void 0),F(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),F(this,"interval",void 0),F(this,"mutex",new nS("config-distribute")),F(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),$("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},$("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,E_.reportApiInvoke(null,{options:void 0,name:BT.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:IT.TRACER}).onSuccess(JSON.stringify(mI))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void A.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await xdt(this.joinInfo,this.cancelToken,this.retryConfig),A.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(o){const a=new _s(Y.NETWORK_RESPONSE_ERROR,o);A.warning("[config-distribute] ".concat(a.toString()))}finally{n()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var n;(n=e)&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(rG.UPDATE_BITRATE_LIMIT,e):this.emit(rG.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&gK({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var n;const o=$N(n=Object.keys(e).filter(d=>/^webrtc_ng_global_parameter/.test(d))).call(n);for(let d=0;d<o.length;d++)for(let h=o.length-1;h>d;h--){const p=o[h];if(typeof e[p].__priority=="number"){const m=e[p].__priority,_=o[h-1];if(typeof e[_].__priority=="number"){if(!(m>e[_].__priority))continue;{const g=p;o[h]=o[h-1],o[h-1]=g}}else{const g=p;o[h]=o[h-1],o[h-1]=g}}}const a={};o.forEach(d=>{const h=e[d],p=h.__expires;Object.keys(h).forEach(m=>{m==="__priority"||m==="__expires"||Object.prototype.hasOwnProperty.call(a,m)||(a[m]=gK({value:h[m]},p&&{expires:p}))})});try{(function(p){try{const m=Date.now();Object.keys(p).forEach(_=>{switch(_){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(KT,_)){const{value:g,expires:y}=p[_];if(y&&y<=m)return;mI[_]=g,KT[_]=g,A.debug("Update global parameters from config distribute",_,g)}}})}catch(m){A.error("Error update config immediately: ".concat(p),m.message)}})(a);const d=JSON.stringify(a),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),A.debug("Caching global parameters ".concat(d))}catch(d){A.error("Error caching global parameters:",d.message)}}}var U0,Bdt=l(j8),vK=r_,Gdt=B,Hdt=U_,Wdt=f,_G=gL,qdt=GN,Kdt=w_,zdt=fR,Ydt=aL,cN=Object.assign,bK=Object.defineProperty,Jdt=Gdt([].concat),Xdt=!cN||Wdt(function(){if(vK&&cN({b:1},cN(bK({},"a",{enumerable:!0,get:function(){bK(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol(),o="abcdefghijklmnopqrst";return t[n]=7,o.split("").forEach(function(a){e[a]=a}),cN({},t)[n]!=7||_G(cN({},e)).join("")!=o})?function(t,e){for(var n=zdt(t),o=arguments.length,a=1,d=qdt.f,h=Kdt.f;o>a;)for(var p,m=Ydt(arguments[a++]),_=d?Jdt(_G(m),d(m)):_G(m),g=_.length,y=0;g>y;)p=_[y++],vK&&!Hdt(h,m,p)||(n[p]=m[p]);return n}:cN,Qdt=VS,Zdt=Z6,$dt=nI,tlt=U_,elt=fR,nlt=function(t,e,n,o){try{return o?e(Qdt(n)[0],n[1]):e(n)}catch(a){Zdt(t,"throw",a)}},rlt=J6,ilt=NL,olt=jR,yK=HL,slt=EU,alt=yL,TK=Array,iO=B,gG=2147483647,clt=/[^\0-\u007E]/,SK=/[.\u3002\uFF0E\uFF61]/g,RK="Overflow: input needs wider integers to process",CK=RangeError,ult=iO(SK.exec),uN=Math.floor,vG=String.fromCharCode,IK=iO("".charCodeAt),wK=iO([].join),yI=iO([].push),dlt=iO("".replace),llt=iO("".split),hlt=iO("".toLowerCase),OK=function(t){return t+22+75*(t<26)},plt=function(t,e,n){var o=0;for(t=n?uN(t/700):t>>1,t+=uN(t/e);t>455;)t=uN(t/35),o+=36;return uN(o+36*t/(t+38))},flt=function(t){var e=[];t=function(K){for(var J=[],_r=0,_o=K.length;_r<_o;){var na=IK(K,_r++);if(na>=55296&&na<=56319&&_r<_o){var ba=IK(K,_r++);(64512&ba)==56320?yI(J,((1023&na)<<10)+(1023&ba)+65536):(yI(J,na),_r--)}else yI(J,na)}return J}(t);var n,o,a=t.length,d=128,h=0,p=72;for(n=0;n<t.length;n++)(o=t[n])<128&&yI(e,vG(o));var m=e.length,_=m;for(m&&yI(e,"-");_<a;){var g=gG;for(n=0;n<t.length;n++)(o=t[n])>=d&&o<g&&(g=o);var y=_+1;if(g-d>uN((gG-h)/y))throw CK(RK);for(h+=(g-d)*y,d=g,n=0;n<t.length;n++){if((o=t[n])<d&&++h>gG)throw CK(RK);if(o==d){for(var C=h,O=36;;){var q=O<=p?1:O>=p+26?26:O-p;if(C<q)break;var L=C-q,U=36-q;yI(e,vG(OK(q+L%U))),C=uN(L/U),O+=36}yI(e,vG(OK(C))),p=plt(h,y,_==m),h=0,_++}}h++,d++}return wK(e,"")},mlt=uT,bG=r_,Elt=BV,yG=_e,AK=nI,x0=B,M1=iI,j0=AL,_lt=AU,TG=mS,SG=Xdt,dN=function(t){var e=elt(t),n=ilt(this),o=arguments.length,a=o>1?arguments[1]:void 0,d=a!==void 0;d&&(a=$dt(a,o>2?arguments[2]:void 0));var h,p,m,_,g,y,C=alt(e),O=0;if(!C||this===TK&&rlt(C))for(h=olt(e),p=n?new this(h):TK(h);h>O;O++)y=d?a(e[O],O):e[O],yK(p,O,y);else for(g=(_=slt(e,C)).next,p=n?new this:[];!(m=tlt(g,_)).done;O++)y=d?nlt(_,a,[m.value,O],!0):m.value,yK(p,O,y);return p.length=O,p},sR=mV,glt=rV.codeAt,vlt=function(t){var e,n,o=[],a=llt(dlt(hlt(t),SK,"."),".");for(e=0;e<a.length;e++)n=a[e],yI(o,ult(clt,n)?"xn--"+flt(n):n);return wK(o,".")},KR=f0,blt=oI,ylt=PL,NK=Ict,PK=WI,Tlt=PK.set,U1=PK.getterFor("URL"),Slt=NK.URLSearchParams,Rlt=NK.getState,IP=yG.URL,RG=yG.TypeError,x1=yG.parseInt,Clt=Math.floor,DK=Math.pow,V0=x0("".charAt),aR=x0(/./.exec),wP=x0([].join),Ilt=x0(1 .toString),wlt=x0([].pop),lN=x0([].push),CG=x0("".replace),Olt=x0([].shift),Alt=x0("".split),OP=x0("".slice),j1=x0("".toLowerCase),Nlt=x0([].unshift),IG="Invalid scheme",oO="Invalid host",kK="Invalid port",LK=/[a-z]/i,Plt=/[\d+-.a-z]/i,wG=/\d/,Dlt=/^0x/i,klt=/^[0-7]+$/,Llt=/^\d+$/,MK=/^[\da-f]+$/i,Mlt=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Ult=/[\0\t\n\r #/:<>?@[\\\]^|]/,xlt=/^[\u0000-\u0020]+/,jlt=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Vlt=/[\t\n\r]/g,AP=function(t){var e,n,o,a;if(typeof t=="number"){for(e=[],n=0;n<4;n++)Nlt(e,t%256),t=Clt(t/256);return wP(e,".")}if(typeof t=="object"){for(e="",o=function(d){for(var h=null,p=1,m=null,_=0,g=0;g<8;g++)d[g]!==0?(_>p&&(h=m,p=_),m=null,_=0):(m===null&&(m=g),++_);return _>p&&(h=m,p=_),h}(t),n=0;n<8;n++)a&&t[n]===0||(a&&(a=!1),o===n?(e+=n?":":"::",a=!0):(e+=Ilt(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},V1={},UK=SG({},V1,{" ":1,'"':1,"<":1,">":1,"`":1}),xK=SG({},UK,{"#":1,"?":1,"{":1,"}":1}),OG=SG({},xK,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),TI=function(t,e){var n=glt(t,0);return n>32&&n<127&&!TG(e,t)?t:encodeURIComponent(t)},F1={ftp:21,file:null,http:80,https:443,ws:80,wss:443},NP=function(t,e){var n;return t.length==2&&aR(LK,V0(t,0))&&((n=V0(t,1))==":"||!e&&n=="|")},jK=function(t){var e;return t.length>1&&NP(OP(t,0,2))&&(t.length==2||(e=V0(t,2))==="/"||e==="\\"||e==="?"||e==="#")},Flt=function(t){return t==="."||j1(t)==="%2e"},AG={},VK={},NG={},FK={},BK={},PG={},GK={},HK={},B1={},G1={},DG={},kG={},LG={},MG={},WK={},UG={},hN={},CR={},qK={},sO={},zR={},xG=function(t,e,n){var o,a,d,h=KR(t);if(e){if(a=this.parse(h))throw RG(a);this.searchParams=null}else{if(n!==void 0&&(o=new xG(n,!0)),a=this.parse(h,null,o))throw RG(a);(d=Rlt(new Slt)).bindURL(this),this.searchParams=d}};xG.prototype={type:"URL",parse:function(t,e,n){var o,a,d,h,p,m=this,_=e||AG,g=0,y="",C=!1,O=!1,q=!1;for(t=KR(t),e||(m.scheme="",m.username="",m.password="",m.host=null,m.port=null,m.path=[],m.query=null,m.fragment=null,m.cannotBeABaseURL=!1,t=CG(t,xlt,""),t=CG(t,jlt,"$1")),t=CG(t,Vlt,""),o=dN(t);g<=o.length;){switch(a=o[g],_){case AG:if(!a||!aR(LK,a)){if(e)return IG;_=NG;continue}y+=j1(a),_=VK;break;case VK:if(a&&(aR(Plt,a)||a=="+"||a=="-"||a=="."))y+=j1(a);else{if(a!=":"){if(e)return IG;y="",_=NG,g=0;continue}if(e&&(m.isSpecial()!=TG(F1,y)||y=="file"&&(m.includesCredentials()||m.port!==null)||m.scheme=="file"&&!m.host))return;if(m.scheme=y,e)return void(m.isSpecial()&&F1[m.scheme]==m.port&&(m.port=null));y="",m.scheme=="file"?_=MG:m.isSpecial()&&n&&n.scheme==m.scheme?_=FK:m.isSpecial()?_=HK:o[g+1]=="/"?(_=BK,g++):(m.cannotBeABaseURL=!0,lN(m.path,""),_=qK)}break;case NG:if(!n||n.cannotBeABaseURL&&a!="#")return IG;if(n.cannotBeABaseURL&&a=="#"){m.scheme=n.scheme,m.path=sR(n.path),m.query=n.query,m.fragment="",m.cannotBeABaseURL=!0,_=zR;break}_=n.scheme=="file"?MG:PG;continue;case FK:if(a!="/"||o[g+1]!="/"){_=PG;continue}_=B1,g++;break;case BK:if(a=="/"){_=G1;break}_=CR;continue;case PG:if(m.scheme=n.scheme,a==U0)m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=sR(n.path),m.query=n.query;else if(a=="/"||a=="\\"&&m.isSpecial())_=GK;else if(a=="?")m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=sR(n.path),m.query="",_=sO;else{if(a!="#"){m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=sR(n.path),m.path.length--,_=CR;continue}m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=sR(n.path),m.query=n.query,m.fragment="",_=zR}break;case GK:if(!m.isSpecial()||a!="/"&&a!="\\"){if(a!="/"){m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,_=CR;continue}_=G1}else _=B1;break;case HK:if(_=B1,a!="/"||V0(y,g+1)!="/")continue;g++;break;case B1:if(a!="/"&&a!="\\"){_=G1;continue}break;case G1:if(a=="@"){C&&(y="%40"+y),C=!0,d=dN(y);for(var L=0;L<d.length;L++){var U=d[L];if(U!=":"||q){var K=TI(U,OG);q?m.password+=K:m.username+=K}else q=!0}y=""}else if(a==U0||a=="/"||a=="?"||a=="#"||a=="\\"&&m.isSpecial()){if(C&&y=="")return"Invalid authority";g-=dN(y).length+1,y="",_=DG}else y+=a;break;case DG:case kG:if(e&&m.scheme=="file"){_=UG;continue}if(a!=":"||O){if(a==U0||a=="/"||a=="?"||a=="#"||a=="\\"&&m.isSpecial()){if(m.isSpecial()&&y=="")return oO;if(e&&y==""&&(m.includesCredentials()||m.port!==null))return;if(h=m.parseHost(y))return h;if(y="",_=hN,e)return;continue}a=="["?O=!0:a=="]"&&(O=!1),y+=a}else{if(y=="")return oO;if(h=m.parseHost(y))return h;if(y="",_=LG,e==kG)return}break;case LG:if(!aR(wG,a)){if(a==U0||a=="/"||a=="?"||a=="#"||a=="\\"&&m.isSpecial()||e){if(y!=""){var J=x1(y,10);if(J>65535)return kK;m.port=m.isSpecial()&&J===F1[m.scheme]?null:J,y=""}if(e)return;_=hN;continue}return kK}y+=a;break;case MG:if(m.scheme="file",a=="/"||a=="\\")_=WK;else{if(!n||n.scheme!="file"){_=CR;continue}if(a==U0)m.host=n.host,m.path=sR(n.path),m.query=n.query;else if(a=="?")m.host=n.host,m.path=sR(n.path),m.query="",_=sO;else{if(a!="#"){jK(wP(sR(o,g),""))||(m.host=n.host,m.path=sR(n.path),m.shortenPath()),_=CR;continue}m.host=n.host,m.path=sR(n.path),m.query=n.query,m.fragment="",_=zR}}break;case WK:if(a=="/"||a=="\\"){_=UG;break}n&&n.scheme=="file"&&!jK(wP(sR(o,g),""))&&(NP(n.path[0],!0)?lN(m.path,n.path[0]):m.host=n.host),_=CR;continue;case UG:if(a==U0||a=="/"||a=="\\"||a=="?"||a=="#"){if(!e&&NP(y))_=CR;else if(y==""){if(m.host="",e)return;_=hN}else{if(h=m.parseHost(y))return h;if(m.host=="localhost"&&(m.host=""),e)return;y="",_=hN}continue}y+=a;break;case hN:if(m.isSpecial()){if(_=CR,a!="/"&&a!="\\")continue}else if(e||a!="?")if(e||a!="#"){if(a!=U0&&(_=CR,a!="/"))continue}else m.fragment="",_=zR;else m.query="",_=sO;break;case CR:if(a==U0||a=="/"||a=="\\"&&m.isSpecial()||!e&&(a=="?"||a=="#")){if((p=j1(p=y))===".."||p==="%2e."||p===".%2e"||p==="%2e%2e"?(m.shortenPath(),a=="/"||a=="\\"&&m.isSpecial()||lN(m.path,"")):Flt(y)?a=="/"||a=="\\"&&m.isSpecial()||lN(m.path,""):(m.scheme=="file"&&!m.path.length&&NP(y)&&(m.host&&(m.host=""),y=V0(y,0)+":"),lN(m.path,y)),y="",m.scheme=="file"&&(a==U0||a=="?"||a=="#"))for(;m.path.length>1&&m.path[0]==="";)Olt(m.path);a=="?"?(m.query="",_=sO):a=="#"&&(m.fragment="",_=zR)}else y+=TI(a,xK);break;case qK:a=="?"?(m.query="",_=sO):a=="#"?(m.fragment="",_=zR):a!=U0&&(m.path[0]+=TI(a,V1));break;case sO:e||a!="#"?a!=U0&&(a=="'"&&m.isSpecial()?m.query+="%27":m.query+=a=="#"?"%23":TI(a,V1)):(m.fragment="",_=zR);break;case zR:a!=U0&&(m.fragment+=TI(a,UK))}g++}},parseHost:function(t){var e,n,o;if(V0(t,0)=="["){if(V0(t,t.length-1)!="]"||(e=function(a){var d,h,p,m,_,g,y,C=[0,0,0,0,0,0,0,0],O=0,q=null,L=0,U=function(){return V0(a,L)};if(U()==":"){if(V0(a,1)!=":")return;L+=2,q=++O}for(;U();){if(O==8)return;if(U()!=":"){for(d=h=0;h<4&&aR(MK,U());)d=16*d+x1(U(),16),L++,h++;if(U()=="."){if(h==0||(L-=h,O>6))return;for(p=0;U();){if(m=null,p>0){if(!(U()=="."&&p<4))return;L++}if(!aR(wG,U()))return;for(;aR(wG,U());){if(_=x1(U(),10),m===null)m=_;else{if(m==0)return;m=10*m+_}if(m>255)return;L++}C[O]=256*C[O]+m,++p!=2&&p!=4||O++}if(p!=4)return;break}if(U()==":"){if(L++,!U())return}else if(U())return;C[O++]=d}else{if(q!==null)return;L++,q=++O}}if(q!==null)for(g=O-q,O=7;O!=0&&g>0;)y=C[O],C[O--]=C[q+g-1],C[q+--g]=y;else if(O!=8)return;return C}(OP(t,1,-1)),!e))return oO;this.host=e}else if(this.isSpecial()){if(t=vlt(t),aR(Mlt,t)||(e=function(a){var d,h,p,m,_,g,y,C=Alt(a,".");if(C.length&&C[C.length-1]==""&&C.length--,(d=C.length)>4)return a;for(h=[],p=0;p<d;p++){if((m=C[p])=="")return a;if(_=10,m.length>1&&V0(m,0)=="0"&&(_=aR(Dlt,m)?16:8,m=OP(m,_==8?1:2)),m==="")g=0;else{if(!aR(_==10?Llt:_==8?klt:MK,m))return a;g=x1(m,_)}lN(h,g)}for(p=0;p<d;p++)if(g=h[p],p==d-1){if(g>=DK(256,5-d))return null}else if(g>255)return null;for(y=wlt(h),p=0;p<h.length;p++)y+=h[p]*DK(256,3-p);return y}(t),e===null))return oO;this.host=e}else{if(aR(Ult,t))return oO;for(e="",n=dN(t),o=0;o<n.length;o++)e+=TI(n[o],V1);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return TG(F1,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme=="file"&&e==1&&NP(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,o=t.password,a=t.host,d=t.port,h=t.path,p=t.query,m=t.fragment,_=e+":";return a!==null?(_+="//",t.includesCredentials()&&(_+=n+(o?":"+o:"")+"@"),_+=AP(a),d!==null&&(_+=":"+d)):e=="file"&&(_+="//"),_+=t.cannotBeABaseURL?h[0]:h.length?"/"+wP(h,"/"):"",p!==null&&(_+="?"+p),m!==null&&(_+="#"+m),_},setHref:function(t){var e=this.parse(t);if(e)throw RG(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t=="blob")try{return new pN(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+AP(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(KR(t)+":",AG)},getUsername:function(){return this.username},setUsername:function(t){var e=dN(KR(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=TI(e[n],OG)}},getPassword:function(){return this.password},setPassword:function(t){var e=dN(KR(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=TI(e[n],OG)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?AP(t):AP(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,DG)},getHostname:function(){var t=this.host;return t===null?"":AP(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,kG)},getPort:function(){var t=this.port;return t===null?"":KR(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=KR(t))==""?this.port=null:this.parse(t,LG))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+wP(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,hN))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=KR(t))==""?this.query=null:(V0(t,0)=="?"&&(t=OP(t,1)),this.query="",this.parse(t,sO)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=KR(t))!=""?(V0(t,0)=="#"&&(t=OP(t,1)),this.fragment="",this.parse(t,zR)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var pN=function(t){var e=_lt(this,XS),n=ylt(arguments.length,1)>1?arguments[1]:void 0,o=Tlt(e,new xG(t,!1,n));bG||(e.href=o.serialize(),e.origin=o.getOrigin(),e.protocol=o.getProtocol(),e.username=o.getUsername(),e.password=o.getPassword(),e.host=o.getHost(),e.hostname=o.getHostname(),e.port=o.getPort(),e.pathname=o.getPathname(),e.search=o.getSearch(),e.searchParams=o.getSearchParams(),e.hash=o.getHash())},XS=pN.prototype,F0=function(t,e){return{get:function(){return U1(this)[t]()},set:e&&function(n){return U1(this)[e](n)},configurable:!0,enumerable:!0}};if(bG&&(j0(XS,"href",F0("serialize","setHref")),j0(XS,"origin",F0("getOrigin")),j0(XS,"protocol",F0("getProtocol","setProtocol")),j0(XS,"username",F0("getUsername","setUsername")),j0(XS,"password",F0("getPassword","setPassword")),j0(XS,"host",F0("getHost","setHost")),j0(XS,"hostname",F0("getHostname","setHostname")),j0(XS,"port",F0("getPort","setPort")),j0(XS,"pathname",F0("getPathname","setPathname")),j0(XS,"search",F0("getSearch","setSearch")),j0(XS,"searchParams",F0("getSearchParams")),j0(XS,"hash",F0("getHash","setHash"))),M1(XS,"toJSON",function(){return U1(this).serialize()},{enumerable:!0}),M1(XS,"toString",function(){return U1(this).serialize()},{enumerable:!0}),IP){var KK=IP.createObjectURL,zK=IP.revokeObjectURL;KK&&M1(pN,"createObjectURL",AK(KK,IP)),zK&&M1(pN,"revokeObjectURL",AK(zK,IP))}blt(pN,"URL"),mlt({global:!0,constructor:!0,forced:!Elt,sham:!bG},{URL:pN});var Blt=uT,Glt=f,Hlt=PL,YK=f0,Wlt=BV,JK=zS("URL");Blt({target:"URL",stat:!0,forced:!(Wlt&&Glt(function(){JK.canParse()}))},{canParse:function(t){var e=Hlt(arguments.length,1),n=YK(t),o=e<2||arguments[1]===void 0?void 0:YK(arguments[1]);try{return!!new JK(n,o)}catch{return!1}}});var XK=l(Q0.URL),qlt=Q,Klt=R4,QK=RegExp.prototype,zlt=function(t){return t===QK||qlt(QK,t)?Klt(t):t.flags},RS=l(zlt);function fN(t){let e=t.length;for(;--e>=0;)t[e]=0}const jG=256,ZK=286,PP=30,DP=15,VG=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),H1=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Ylt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),$K=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),YR=new Array(576);fN(YR);const kP=new Array(60);fN(kP);const LP=new Array(512);fN(LP);const MP=new Array(256);fN(MP);const FG=new Array(29);fN(FG);const W1=new Array(PP);function BG(t,e,n,o,a){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=o,this.max_length=a,this.has_stree=t&&t.length}let _z,tY,eY;function GG(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}fN(W1);const nY=t=>t<256?LP[t]:LP[256+(t>>>7)],UP=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},i0=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,UP(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},IR=(t,e,n)=>{i0(t,n[2*e],n[2*e+1])},rY=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},iY=(t,e,n)=>{const o=new Array(16);let a,d,h=0;for(a=1;a<=DP;a++)h=h+n[a-1]<<1,o[a]=h;for(d=0;d<=e;d++){let p=t[2*d+1];p!==0&&(t[2*d]=rY(o[p]++,p))}},oY=t=>{let e;for(e=0;e<ZK;e++)t.dyn_ltree[2*e]=0;for(e=0;e<PP;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},sY=t=>{t.bi_valid>8?UP(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},aY=(t,e,n,o)=>{const a=2*e,d=2*n;return t[a]<t[d]||t[a]===t[d]&&o[e]<=o[n]},HG=(t,e,n)=>{const o=t.heap[n];let a=n<<1;for(;a<=t.heap_len&&(a<t.heap_len&&aY(e,t.heap[a+1],t.heap[a],t.depth)&&a++,!aY(e,o,t.heap[a],t.depth));)t.heap[n]=t.heap[a],n=a,a<<=1;t.heap[n]=o},cY=(t,e,n)=>{let o,a,d,h,p=0;if(t.sym_next!==0)do o=255&t.pending_buf[t.sym_buf+p++],o+=(255&t.pending_buf[t.sym_buf+p++])<<8,a=t.pending_buf[t.sym_buf+p++],o===0?IR(t,a,e):(d=MP[a],IR(t,d+jG+1,e),h=VG[d],h!==0&&(a-=FG[d],i0(t,a,h)),o--,d=nY(o),IR(t,d,n),h=H1[d],h!==0&&(o-=W1[d],i0(t,o,h)));while(p<t.sym_next);IR(t,256,e)},WG=(t,e)=>{const n=e.dyn_tree,o=e.stat_desc.static_tree,a=e.stat_desc.has_stree,d=e.stat_desc.elems;let h,p,m,_=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<d;h++)n[2*h]!==0?(t.heap[++t.heap_len]=_=h,t.depth[h]=0):n[2*h+1]=0;for(;t.heap_len<2;)m=t.heap[++t.heap_len]=_<2?++_:0,n[2*m]=1,t.depth[m]=0,t.opt_len--,a&&(t.static_len-=o[2*m+1]);for(e.max_code=_,h=t.heap_len>>1;h>=1;h--)HG(t,n,h);m=d;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],HG(t,n,1),p=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=p,n[2*m]=n[2*h]+n[2*p],t.depth[m]=(t.depth[h]>=t.depth[p]?t.depth[h]:t.depth[p])+1,n[2*h+1]=n[2*p+1]=m,t.heap[1]=m++,HG(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((g,y)=>{const C=y.dyn_tree,O=y.max_code,q=y.stat_desc.static_tree,L=y.stat_desc.has_stree,U=y.stat_desc.extra_bits,K=y.stat_desc.extra_base,J=y.stat_desc.max_length;let _r,_o,na,ba,_u,_l,_p=0;for(ba=0;ba<=DP;ba++)g.bl_count[ba]=0;for(C[2*g.heap[g.heap_max]+1]=0,_r=g.heap_max+1;_r<573;_r++)_o=g.heap[_r],ba=C[2*C[2*_o+1]+1]+1,ba>J&&(ba=J,_p++),C[2*_o+1]=ba,_o>O||(g.bl_count[ba]++,_u=0,_o>=K&&(_u=U[_o-K]),_l=C[2*_o],g.opt_len+=_l*(ba+_u),L&&(g.static_len+=_l*(q[2*_o+1]+_u)));if(_p!==0){do{for(ba=J-1;g.bl_count[ba]===0;)ba--;g.bl_count[ba]--,g.bl_count[ba+1]+=2,g.bl_count[J]--,_p-=2}while(_p>0);for(ba=J;ba!==0;ba--)for(_o=g.bl_count[ba];_o!==0;)na=g.heap[--_r],na>O||(C[2*na+1]!==ba&&(g.opt_len+=(ba-C[2*na+1])*C[2*na],C[2*na+1]=ba),_o--)}})(t,e),iY(n,_,t.bl_count)},uY=(t,e,n)=>{let o,a,d=-1,h=e[1],p=0,m=7,_=4;for(h===0&&(m=138,_=3),e[2*(n+1)+1]=65535,o=0;o<=n;o++)a=h,h=e[2*(o+1)+1],++p<m&&a===h||(p<_?t.bl_tree[2*a]+=p:a!==0?(a!==d&&t.bl_tree[2*a]++,t.bl_tree[32]++):p<=10?t.bl_tree[34]++:t.bl_tree[36]++,p=0,d=a,h===0?(m=138,_=3):a===h?(m=6,_=3):(m=7,_=4))},dY=(t,e,n)=>{let o,a,d=-1,h=e[1],p=0,m=7,_=4;for(h===0&&(m=138,_=3),o=0;o<=n;o++)if(a=h,h=e[2*(o+1)+1],!(++p<m&&a===h)){if(p<_)do IR(t,a,t.bl_tree);while(--p!=0);else a!==0?(a!==d&&(IR(t,a,t.bl_tree),p--),IR(t,16,t.bl_tree),i0(t,p-3,2)):p<=10?(IR(t,17,t.bl_tree),i0(t,p-3,3)):(IR(t,18,t.bl_tree),i0(t,p-11,7));p=0,d=a,h===0?(m=138,_=3):a===h?(m=6,_=3):(m=7,_=4)}};let lY=!1;const hY=(t,e,n,o)=>{i0(t,0+(o?1:0),3),sY(t),UP(t,n),UP(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var Jlt=t=>{lY||((()=>{let e,n,o,a,d;const h=new Array(16);for(o=0,a=0;a<28;a++)for(FG[a]=o,e=0;e<1<<VG[a];e++)MP[o++]=a;for(MP[o-1]=a,d=0,a=0;a<16;a++)for(W1[a]=d,e=0;e<1<<H1[a];e++)LP[d++]=a;for(d>>=7;a<PP;a++)for(W1[a]=d<<7,e=0;e<1<<H1[a]-7;e++)LP[256+d++]=a;for(n=0;n<=DP;n++)h[n]=0;for(e=0;e<=143;)YR[2*e+1]=8,e++,h[8]++;for(;e<=255;)YR[2*e+1]=9,e++,h[9]++;for(;e<=279;)YR[2*e+1]=7,e++,h[7]++;for(;e<=287;)YR[2*e+1]=8,e++,h[8]++;for(iY(YR,287,h),e=0;e<PP;e++)kP[2*e+1]=5,kP[2*e]=rY(e,5);_z=new BG(YR,VG,257,ZK,DP),tY=new BG(kP,H1,0,PP,DP),eY=new BG(new Array(0),Ylt,0,19,7)})(),lY=!0),t.l_desc=new GG(t.dyn_ltree,_z),t.d_desc=new GG(t.dyn_dtree,tY),t.bl_desc=new GG(t.bl_tree,eY),t.bi_buf=0,t.bi_valid=0,oY(t)},Xlt=(t,e,n,o)=>{let a,d,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(p=>{let m,_=4093624447;for(m=0;m<=31;m++,_>>>=1)if(1&_&&p.dyn_ltree[2*m]!==0)return 0;if(p.dyn_ltree[18]!==0||p.dyn_ltree[20]!==0||p.dyn_ltree[26]!==0)return 1;for(m=32;m<jG;m++)if(p.dyn_ltree[2*m]!==0)return 1;return 0})(t)),WG(t,t.l_desc),WG(t,t.d_desc),h=(p=>{let m;for(uY(p,p.dyn_ltree,p.l_desc.max_code),uY(p,p.dyn_dtree,p.d_desc.max_code),WG(p,p.bl_desc),m=18;m>=3&&p.bl_tree[2*$K[m]+1]===0;m--);return p.opt_len+=3*(m+1)+5+5+4,m})(t),a=t.opt_len+3+7>>>3,d=t.static_len+3+7>>>3,d<=a&&(a=d)):a=d=n+5,n+4<=a&&e!==-1?hY(t,e,n,o):t.strategy===4||d===a?(i0(t,2+(o?1:0),3),cY(t,YR,kP)):(i0(t,4+(o?1:0),3),((p,m,_,g)=>{let y;for(i0(p,m-257,5),i0(p,_-1,5),i0(p,g-4,4),y=0;y<g;y++)i0(p,p.bl_tree[2*$K[y]+1],3);dY(p,p.dyn_ltree,m-1),dY(p,p.dyn_dtree,_-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),cY(t,t.dyn_ltree,t.dyn_dtree)),oY(t),o&&sY(t)},Qlt=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(MP[n]+jG+1)]++,t.dyn_dtree[2*nY(e)]++),t.sym_next===t.sym_end),Zlt=t=>{i0(t,2,3),IR(t,256,YR),(e=>{e.bi_valid===16?(UP(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},$lt={_tr_init:Jlt,_tr_stored_block:hY,_tr_flush_block:Xlt,_tr_tally:Qlt,_tr_align:Zlt},xP=(t,e,n,o)=>{let a=65535&t|0,d=t>>>16&65535|0,h=0;for(;n!==0;){h=n>2e3?2e3:n,n-=h;do a=a+e[o++]|0,d=d+a|0;while(--h);a%=65521,d%=65521}return a|d<<16|0};const tht=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var o=0;o<8;o++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var kS=(t,e,n,o)=>{const a=tht,d=o+n;t^=-1;for(let h=o;h<d;h++)t=t>>>8^a[255&(t^e[h])];return-1^t},aO={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},mN={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:eht,_tr_stored_block:qG,_tr_flush_block:nht,_tr_tally:SI,_tr_align:rht}=$lt,{Z_NO_FLUSH:RI,Z_PARTIAL_FLUSH:iht,Z_FULL_FLUSH:oht,Z_FINISH:B0,Z_BLOCK:pY,Z_OK:US,Z_STREAM_END:fY,Z_STREAM_ERROR:wR,Z_DATA_ERROR:sht,Z_BUF_ERROR:KG,Z_DEFAULT_COMPRESSION:aht,Z_FILTERED:cht,Z_HUFFMAN_ONLY:q1,Z_RLE:uht,Z_FIXED:dht,Z_DEFAULT_STRATEGY:lht,Z_UNKNOWN:hht,Z_DEFLATED:K1}=mN,zG=286,pht=30,fht=19,mht=2*zG+1,Eht=15,cO=258,OR=262,EN=42,uO=113,jP=666,dO=(t,e)=>(t.msg=aO[e],e),mY=t=>2*t-(t>4?9:0),CI=t=>{let e=t.length;for(;--e>=0;)t[e]=0},_ht=t=>{let e,n,o,a=t.w_size;e=t.hash_size,o=e;do n=t.head[--o],t.head[o]=n>=a?n-a:0;while(--e);e=a,o=e;do n=t.prev[--o],t.prev[o]=n>=a?n-a:0;while(--e)};let II=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const v0=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},b0=(t,e)=>{nht(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,v0(t.strm)},AT=(t,e)=>{t.pending_buf[t.pending++]=e},VP=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},YG=(t,e,n,o)=>{let a=t.avail_in;return a>o&&(a=o),a===0?0:(t.avail_in-=a,e.set(t.input.subarray(t.next_in,t.next_in+a),n),t.state.wrap===1?t.adler=xP(t.adler,e,a,n):t.state.wrap===2&&(t.adler=kS(t.adler,e,a,n)),t.next_in+=a,t.total_in+=a,a)},EY=(t,e)=>{let n,o,a=t.max_chain_length,d=t.strstart,h=t.prev_length,p=t.nice_match;const m=t.strstart>t.w_size-OR?t.strstart-(t.w_size-OR):0,_=t.window,g=t.w_mask,y=t.prev,C=t.strstart+cO;let O=_[d+h-1],q=_[d+h];t.prev_length>=t.good_match&&(a>>=2),p>t.lookahead&&(p=t.lookahead);do if(n=e,_[n+h]===q&&_[n+h-1]===O&&_[n]===_[d]&&_[++n]===_[d+1]){d+=2,n++;do;while(_[++d]===_[++n]&&_[++d]===_[++n]&&_[++d]===_[++n]&&_[++d]===_[++n]&&_[++d]===_[++n]&&_[++d]===_[++n]&&_[++d]===_[++n]&&_[++d]===_[++n]&&d<C);if(o=cO-(C-d),d=C-cO,o>h){if(t.match_start=e,h=o,o>=p)break;O=_[d+h-1],q=_[d+h]}}while((e=y[e&g])>m&&--a!=0);return h<=t.lookahead?h:t.lookahead},_N=t=>{const e=t.w_size;let n,o,a;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-OR)&&(t.window.set(t.window.subarray(e,e+e-o),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),_ht(t),o+=e),t.strm.avail_in===0)break;if(n=YG(t.strm,t.window,t.strstart+t.lookahead,o),t.lookahead+=n,t.lookahead+t.insert>=3)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=II(t,t.ins_h,t.window[a+1]);t.insert&&(t.ins_h=II(t,t.ins_h,t.window[a+3-1]),t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<OR&&t.strm.avail_in!==0)},_Y=(t,e)=>{let n,o,a,d=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,p=t.strm.avail_in;do{if(n=65535,a=t.bi_valid+42>>3,t.strm.avail_out<a||(a=t.strm.avail_out-a,o=t.strstart-t.block_start,n>o+t.strm.avail_in&&(n=o+t.strm.avail_in),n>a&&(n=a),n<d&&(n===0&&e!==B0||e===RI||n!==o+t.strm.avail_in)))break;h=e===B0&&n===o+t.strm.avail_in?1:0,qG(t,0,0,h),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,v0(t.strm),o&&(o>n&&(o=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+o),t.strm.next_out),t.strm.next_out+=o,t.strm.avail_out-=o,t.strm.total_out+=o,t.block_start+=o,n-=o),n&&(YG(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(h===0);return p-=t.strm.avail_in,p&&(p>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=p&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-p,t.strm.next_in),t.strstart),t.strstart+=p,t.insert+=p>t.w_size-t.insert?t.w_size-t.insert:p),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:e!==RI&&e!==B0&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(a=t.window_size-t.strstart,t.strm.avail_in>a&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,a+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),a>t.strm.avail_in&&(a=t.strm.avail_in),a&&(YG(t.strm,t.window,t.strstart,a),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.high_water<t.strstart&&(t.high_water=t.strstart),a=t.bi_valid+42>>3,a=t.pending_buf_size-a>65535?65535:t.pending_buf_size-a,d=a>t.w_size?t.w_size:a,o=t.strstart-t.block_start,(o>=d||(o||e===B0)&&e!==RI&&t.strm.avail_in===0&&o<=a)&&(n=o>a?a:o,h=e===B0&&t.strm.avail_in===0&&n===o?1:0,qG(t,t.block_start,n,h),t.block_start+=n,v0(t.strm)),h?3:1)},JG=(t,e)=>{let n,o;for(;;){if(t.lookahead<OR){if(_N(t),t.lookahead<OR&&e===RI)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=II(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-OR&&(t.match_length=EY(t,n)),t.match_length>=3)if(o=SI(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=II(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=II(t,t.ins_h,t.window[t.strstart+1]);else o=SI(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(o&&(b0(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===B0?(b0(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(b0(t,!1),t.strm.avail_out===0)?1:2},gN=(t,e)=>{let n,o,a;for(;;){if(t.lookahead<OR){if(_N(t),t.lookahead<OR&&e===RI)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=II(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-OR&&(t.match_length=EY(t,n),t.match_length<=5&&(t.strategy===cht||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){a=t.strstart+t.lookahead-3,o=SI(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=a&&(t.ins_h=II(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,o&&(b0(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(o=SI(t,0,t.window[t.strstart-1]),o&&b0(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(o=SI(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===B0?(b0(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(b0(t,!1),t.strm.avail_out===0)?1:2};function AR(t,e,n,o,a){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=o,this.func=a}const FP=[new AR(0,0,0,0,_Y),new AR(4,4,8,4,JG),new AR(4,5,16,8,JG),new AR(4,6,32,32,JG),new AR(4,4,16,16,gN),new AR(8,16,32,32,gN),new AR(8,16,128,128,gN),new AR(8,32,128,256,gN),new AR(32,128,258,1024,gN),new AR(32,258,258,4096,gN)];function ght(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=K1,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*mht),this.dyn_dtree=new Uint16Array(2*(2*pht+1)),this.bl_tree=new Uint16Array(2*(2*fht+1)),CI(this.dyn_ltree),CI(this.dyn_dtree),CI(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Eht+1),this.heap=new Uint16Array(2*zG+1),CI(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*zG+1),CI(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const BP=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==EN&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==uO&&e.status!==jP?1:0},gY=t=>{if(BP(t))return dO(t,wR);t.total_in=t.total_out=0,t.data_type=hht;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?EN:uO,t.adler=e.wrap===2?0:1,e.last_flush=-2,eht(e),US},vY=t=>{const e=gY(t);return e===US&&(n=>{n.window_size=2*n.w_size,CI(n.head),n.max_lazy_match=FP[n.level].max_lazy,n.good_match=FP[n.level].good_length,n.nice_match=FP[n.level].nice_length,n.max_chain_length=FP[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},bY=(t,e,n,o,a,d)=>{if(!t)return wR;let h=1;if(e===aht&&(e=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),a<1||a>9||n!==K1||o<8||o>15||e<0||e>9||d<0||d>dht||o===8&&h!==1)return dO(t,wR);o===8&&(o=9);const p=new ght;return t.state=p,p.strm=t,p.status=EN,p.wrap=h,p.gzhead=null,p.w_bits=o,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=a+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<a+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=e,p.strategy=d,p.method=n,vY(t)};var vht=(t,e)=>{if(BP(t)||e>pY||e<0)return t?dO(t,wR):wR;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===jP&&e!==B0)return dO(t,t.avail_out===0?KG:wR);const o=n.last_flush;if(n.last_flush=e,n.pending!==0){if(v0(t),t.avail_out===0)return n.last_flush=-1,US}else if(t.avail_in===0&&mY(e)<=mY(o)&&e!==B0)return dO(t,KG);if(n.status===jP&&t.avail_in!==0)return dO(t,KG);if(n.status===EN&&n.wrap===0&&(n.status=uO),n.status===EN){let a=K1+(n.w_bits-8<<4)<<8,d=-1;if(d=n.strategy>=q1||n.level<2?0:n.level<6?1:n.level===6?2:3,a|=d<<6,n.strstart!==0&&(a|=32),a+=31-a%31,VP(n,a),n.strstart!==0&&(VP(n,t.adler>>>16),VP(n,65535&t.adler)),t.adler=1,n.status=uO,v0(t),n.pending!==0)return n.last_flush=-1,US}if(n.status===57){if(t.adler=0,AT(n,31),AT(n,139),AT(n,8),n.gzhead)AT(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),AT(n,255&n.gzhead.time),AT(n,n.gzhead.time>>8&255),AT(n,n.gzhead.time>>16&255),AT(n,n.gzhead.time>>24&255),AT(n,n.level===9?2:n.strategy>=q1||n.level<2?4:0),AT(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(AT(n,255&n.gzhead.extra.length),AT(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=kS(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(AT(n,0),AT(n,0),AT(n,0),AT(n,0),AT(n,0),AT(n,n.level===9?2:n.strategy>=q1||n.level<2?4:0),AT(n,3),n.status=uO,v0(t),n.pending!==0)return n.last_flush=-1,US}if(n.status===69){if(n.gzhead.extra){let a=n.pending,d=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+d>n.pending_buf_size;){let p=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+p),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>a&&(t.adler=kS(t.adler,n.pending_buf,n.pending-a,a)),n.gzindex+=p,v0(t),n.pending!==0)return n.last_flush=-1,US;a=0,d-=p}let h=new Uint8Array(n.gzhead.extra);n.pending_buf.set(h.subarray(n.gzindex,n.gzindex+d),n.pending),n.pending+=d,n.gzhead.hcrc&&n.pending>a&&(t.adler=kS(t.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let a,d=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>d&&(t.adler=kS(t.adler,n.pending_buf,n.pending-d,d)),v0(t),n.pending!==0)return n.last_flush=-1,US;d=0}a=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,AT(n,a)}while(a!==0);n.gzhead.hcrc&&n.pending>d&&(t.adler=kS(t.adler,n.pending_buf,n.pending-d,d)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let a,d=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>d&&(t.adler=kS(t.adler,n.pending_buf,n.pending-d,d)),v0(t),n.pending!==0)return n.last_flush=-1,US;d=0}a=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,AT(n,a)}while(a!==0);n.gzhead.hcrc&&n.pending>d&&(t.adler=kS(t.adler,n.pending_buf,n.pending-d,d))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(v0(t),n.pending!==0))return n.last_flush=-1,US;AT(n,255&t.adler),AT(n,t.adler>>8&255),t.adler=0}if(n.status=uO,v0(t),n.pending!==0)return n.last_flush=-1,US}if(t.avail_in!==0||n.lookahead!==0||e!==RI&&n.status!==jP){let a=n.level===0?_Y(n,e):n.strategy===q1?((d,h)=>{let p;for(;;){if(d.lookahead===0&&(_N(d),d.lookahead===0)){if(h===RI)return 1;break}if(d.match_length=0,p=SI(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,p&&(b0(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===B0?(b0(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(b0(d,!1),d.strm.avail_out===0)?1:2})(n,e):n.strategy===uht?((d,h)=>{let p,m,_,g;const y=d.window;for(;;){if(d.lookahead<=cO){if(_N(d),d.lookahead<=cO&&h===RI)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(_=d.strstart-1,m=y[_],m===y[++_]&&m===y[++_]&&m===y[++_])){g=d.strstart+cO;do;while(m===y[++_]&&m===y[++_]&&m===y[++_]&&m===y[++_]&&m===y[++_]&&m===y[++_]&&m===y[++_]&&m===y[++_]&&_<g);d.match_length=cO-(g-_),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(p=SI(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(p=SI(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),p&&(b0(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===B0?(b0(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(b0(d,!1),d.strm.avail_out===0)?1:2})(n,e):FP[n.level].func(n,e);if(a!==3&&a!==4||(n.status=jP),a===1||a===3)return t.avail_out===0&&(n.last_flush=-1),US;if(a===2&&(e===iht?rht(n):e!==pY&&(qG(n,0,0,!1),e===oht&&(CI(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),v0(t),t.avail_out===0))return n.last_flush=-1,US}return e!==B0?US:n.wrap<=0?fY:(n.wrap===2?(AT(n,255&t.adler),AT(n,t.adler>>8&255),AT(n,t.adler>>16&255),AT(n,t.adler>>24&255),AT(n,255&t.total_in),AT(n,t.total_in>>8&255),AT(n,t.total_in>>16&255),AT(n,t.total_in>>24&255)):(VP(n,t.adler>>>16),VP(n,65535&t.adler)),v0(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?US:fY)},bht=(t,e)=>{let n=e.length;if(BP(t))return wR;const o=t.state,a=o.wrap;if(a===2||a===1&&o.status!==EN||o.lookahead)return wR;if(a===1&&(t.adler=xP(t.adler,e,n,0)),o.wrap=0,n>=o.w_size){a===0&&(CI(o.head),o.strstart=0,o.block_start=0,o.insert=0);let m=new Uint8Array(o.w_size);m.set(e.subarray(n-o.w_size,n),0),e=m,n=o.w_size}const d=t.avail_in,h=t.next_in,p=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,_N(o);o.lookahead>=3;){let m=o.strstart,_=o.lookahead-2;do o.ins_h=II(o,o.ins_h,o.window[m+3-1]),o.prev[m&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=m,m++;while(--_);o.strstart=m,o.lookahead=2,_N(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,t.next_in=h,t.input=p,t.avail_in=d,o.wrap=a,US},GP={deflateInit:(t,e)=>bY(t,e,K1,15,8,lht),deflateInit2:bY,deflateReset:vY,deflateResetKeep:gY,deflateSetHeader:(t,e)=>BP(t)||t.state.wrap!==2?wR:(t.state.gzhead=e,US),deflate:vht,deflateEnd:t=>{if(BP(t))return wR;const e=t.state.status;return t.state=null,e===uO?dO(t,sht):US},deflateSetDictionary:bht,deflateInfo:"pako deflate (from Nodeca project)"};const yht=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var z1={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const o in n)yht(n,o)&&(t[o]=n[o])}}return t},flattenChunks:t=>{let e=0;for(let o=0,a=t.length;o<a;o++)e+=t[o].length;const n=new Uint8Array(e);for(let o=0,a=0,d=t.length;o<d;o++){let h=t[o];n.set(h,a),a+=h.length}return n}};let yY=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{yY=!1}const HP=new Uint8Array(256);for(let t=0;t<256;t++)HP[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;HP[254]=HP[254]=1;var WP={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,o,a,d,h=t.length,p=0;for(a=0;a<h;a++)n=t.charCodeAt(a),(64512&n)==55296&&a+1<h&&(o=t.charCodeAt(a+1),(64512&o)==56320&&(n=65536+(n-55296<<10)+(o-56320),a++)),p+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(p),d=0,a=0;d<p;a++)n=t.charCodeAt(a),(64512&n)==55296&&a+1<h&&(o=t.charCodeAt(a+1),(64512&o)==56320&&(n=65536+(n-55296<<10)+(o-56320),a++)),n<128?e[d++]=n:n<2048?(e[d++]=192|n>>>6,e[d++]=128|63&n):n<65536?(e[d++]=224|n>>>12,e[d++]=128|n>>>6&63,e[d++]=128|63&n):(e[d++]=240|n>>>18,e[d++]=128|n>>>12&63,e[d++]=128|n>>>6&63,e[d++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let o,a;const d=new Array(2*n);for(a=0,o=0;o<n;){let h=t[o++];if(h<128){d[a++]=h;continue}let p=HP[h];if(p>4)d[a++]=65533,o+=p-1;else{for(h&=p===2?31:p===3?15:7;p>1&&o<n;)h=h<<6|63&t[o++],p--;p>1?d[a++]=65533:h<65536?d[a++]=h:(h-=65536,d[a++]=55296|h>>10&1023,d[a++]=56320|1023&h)}}return((h,p)=>{if(p<65534&&h.subarray&&yY)return String.fromCharCode.apply(null,h.length===p?h:h.subarray(0,p));let m="";for(let _=0;_<p;_++)m+=String.fromCharCode(h[_]);return m})(d,a)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+HP[t[n]]>e?n:e}},TY=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const SY=Object.prototype.toString,{Z_NO_FLUSH:Tht,Z_SYNC_FLUSH:Sht,Z_FULL_FLUSH:Rht,Z_FINISH:Cht,Z_OK:Y1,Z_STREAM_END:Iht,Z_DEFAULT_COMPRESSION:wht,Z_DEFAULT_STRATEGY:Oht,Z_DEFLATED:Aht}=mN;function qP(t){this.options=z1.assign({level:wht,method:Aht,chunkSize:16384,windowBits:15,memLevel:8,strategy:Oht},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new TY,this.strm.avail_out=0;let n=GP.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==Y1)throw new Error(aO[n]);if(e.header&&GP.deflateSetHeader(this.strm,e.header),e.dictionary){let o;if(o=typeof e.dictionary=="string"?WP.string2buf(e.dictionary):SY.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=GP.deflateSetDictionary(this.strm,o),n!==Y1)throw new Error(aO[n]);this._dict_set=!0}}function XG(t,e){const n=new qP(e);if(n.push(t,!0),n.err)throw n.msg||aO[n.err];return n.result}qP.prototype.push=function(t,e){const n=this.strm,o=this.options.chunkSize;let a,d;if(this.ended)return!1;for(d=e===~~e?e:e===!0?Cht:Tht,typeof t=="string"?n.input=WP.string2buf(t):SY.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(o),n.next_out=0,n.avail_out=o),(d===Sht||d===Rht)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(a=GP.deflate(n,d),a===Iht)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),a=GP.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===Y1;if(n.avail_out!==0){if(d>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},qP.prototype.onData=function(t){this.chunks.push(t)},qP.prototype.onEnd=function(t){t===Y1&&(this.result=z1.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Nht={Deflate:qP,deflate:XG,deflateRaw:function(t,e){return(e=e||{}).raw=!0,XG(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,XG(t,e)},constants:mN};const J1=16209;var Pht=function(t,e){let n,o,a,d,h,p,m,_,g,y,C,O,q,L,U,K,J,_r,_o,na,ba,_u,_l,_p;const u_=t.state;n=t.next_in,_l=t.input,o=n+(t.avail_in-5),a=t.next_out,_p=t.output,d=a-(e-t.avail_out),h=a+(t.avail_out-257),p=u_.dmax,m=u_.wsize,_=u_.whave,g=u_.wnext,y=u_.window,C=u_.hold,O=u_.bits,q=u_.lencode,L=u_.distcode,U=(1<<u_.lenbits)-1,K=(1<<u_.distbits)-1;t:do{O<15&&(C+=_l[n++]<<O,O+=8,C+=_l[n++]<<O,O+=8),J=q[C&U];e:for(;;){if(_r=J>>>24,C>>>=_r,O-=_r,_r=J>>>16&255,_r===0)_p[a++]=65535&J;else{if(!(16&_r)){if(!(64&_r)){J=q[(65535&J)+(C&(1<<_r)-1)];continue e}if(32&_r){u_.mode=16191;break t}t.msg="invalid literal/length code",u_.mode=J1;break t}_o=65535&J,_r&=15,_r&&(O<_r&&(C+=_l[n++]<<O,O+=8),_o+=C&(1<<_r)-1,C>>>=_r,O-=_r),O<15&&(C+=_l[n++]<<O,O+=8,C+=_l[n++]<<O,O+=8),J=L[C&K];n:for(;;){if(_r=J>>>24,C>>>=_r,O-=_r,_r=J>>>16&255,!(16&_r)){if(!(64&_r)){J=L[(65535&J)+(C&(1<<_r)-1)];continue n}t.msg="invalid distance code",u_.mode=J1;break t}if(na=65535&J,_r&=15,O<_r&&(C+=_l[n++]<<O,O+=8,O<_r&&(C+=_l[n++]<<O,O+=8)),na+=C&(1<<_r)-1,na>p){t.msg="invalid distance too far back",u_.mode=J1;break t}if(C>>>=_r,O-=_r,_r=a-d,na>_r){if(_r=na-_r,_r>_&&u_.sane){t.msg="invalid distance too far back",u_.mode=J1;break t}if(ba=0,_u=y,g===0){if(ba+=m-_r,_r<_o){_o-=_r;do _p[a++]=y[ba++];while(--_r);ba=a-na,_u=_p}}else if(g<_r){if(ba+=m+g-_r,_r-=g,_r<_o){_o-=_r;do _p[a++]=y[ba++];while(--_r);if(ba=0,g<_o){_r=g,_o-=_r;do _p[a++]=y[ba++];while(--_r);ba=a-na,_u=_p}}}else if(ba+=g-_r,_r<_o){_o-=_r;do _p[a++]=y[ba++];while(--_r);ba=a-na,_u=_p}for(;_o>2;)_p[a++]=_u[ba++],_p[a++]=_u[ba++],_p[a++]=_u[ba++],_o-=3;_o&&(_p[a++]=_u[ba++],_o>1&&(_p[a++]=_u[ba++]))}else{ba=a-na;do _p[a++]=_p[ba++],_p[a++]=_p[ba++],_p[a++]=_p[ba++],_o-=3;while(_o>2);_o&&(_p[a++]=_p[ba++],_o>1&&(_p[a++]=_p[ba++]))}break}}break}}while(n<o&&a<h);_o=O>>3,n-=_o,O-=_o<<3,C&=(1<<O)-1,t.next_in=n,t.next_out=a,t.avail_in=n<o?o-n+5:5-(n-o),t.avail_out=a<h?h-a+257:257-(a-h),u_.hold=C,u_.bits=O};const X1=15,Dht=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),kht=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Lht=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Mht=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var KP=(t,e,n,o,a,d,h,p)=>{const m=p.bits;let _,g,y,C,O,q,L=0,U=0,K=0,J=0,_r=0,_o=0,na=0,ba=0,_u=0,_l=0,_p=null;const u_=new Uint16Array(16),W_=new Uint16Array(16);let _v,hT,FT,ST=null;for(L=0;L<=X1;L++)u_[L]=0;for(U=0;U<o;U++)u_[e[n+U]]++;for(_r=m,J=X1;J>=1&&u_[J]===0;J--);if(_r>J&&(_r=J),J===0)return a[d++]=20971520,a[d++]=20971520,p.bits=1,0;for(K=1;K<J&&u_[K]===0;K++);for(_r<K&&(_r=K),ba=1,L=1;L<=X1;L++)if(ba<<=1,ba-=u_[L],ba<0)return-1;if(ba>0&&(t===0||J!==1))return-1;for(W_[1]=0,L=1;L<X1;L++)W_[L+1]=W_[L]+u_[L];for(U=0;U<o;U++)e[n+U]!==0&&(h[W_[e[n+U]]++]=U);if(t===0?(_p=ST=h,q=20):t===1?(_p=Dht,ST=kht,q=257):(_p=Lht,ST=Mht,q=0),_l=0,U=0,L=K,O=d,_o=_r,na=0,y=-1,_u=1<<_r,C=_u-1,t===1&&_u>852||t===2&&_u>592)return 1;for(;;){_v=L-na,h[U]+1<q?(hT=0,FT=h[U]):h[U]>=q?(hT=ST[h[U]-q],FT=_p[h[U]-q]):(hT=96,FT=0),_=1<<L-na,g=1<<_o,K=g;do g-=_,a[O+(_l>>na)+g]=_v<<24|hT<<16|FT|0;while(g!==0);for(_=1<<L-1;_l&_;)_>>=1;if(_!==0?(_l&=_-1,_l+=_):_l=0,U++,--u_[L]==0){if(L===J)break;L=e[n+h[U]]}if(L>_r&&(_l&C)!==y){for(na===0&&(na=_r),O+=K,_o=L-na,ba=1<<_o;_o+na<J&&(ba-=u_[_o+na],!(ba<=0));)_o++,ba<<=1;if(_u+=1<<_o,t===1&&_u>852||t===2&&_u>592)return 1;y=_l&C,a[y]=_r<<24|_o<<16|O-d|0}}return _l!==0&&(a[O+_l]=L-na<<24|64<<16|0),p.bits=_r,0};const{Z_FINISH:RY,Z_BLOCK:Uht,Z_TREES:Q1,Z_OK:lO,Z_STREAM_END:xht,Z_NEED_DICT:jht,Z_STREAM_ERROR:G0,Z_DATA_ERROR:CY,Z_MEM_ERROR:IY,Z_BUF_ERROR:Vht,Z_DEFLATED:wY}=mN,Z1=16180,$1=16190,JR=16191,QG=16192,ZG=16194,tM=16199,eM=16200,$G=16206,sS=16209,OY=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Fht(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const hO=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Z1||e.mode>16211?1:0},AY=t=>{if(hO(t))return G0;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Z1,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,lO},NY=t=>{if(hO(t))return G0;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,AY(t)},PY=(t,e)=>{let n;if(hO(t))return G0;const o=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?G0:(o.window!==null&&o.wbits!==e&&(o.window=null),o.wrap=n,o.wbits=e,NY(t))},DY=(t,e)=>{if(!t)return G0;const n=new Fht;t.state=n,n.strm=t,n.window=null,n.mode=Z1;const o=PY(t,e);return o!==lO&&(t.state=null),o};let t3,e3,kY=!0;const Bht=t=>{if(kY){t3=new Int32Array(512),e3=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(KP(1,t.lens,0,288,t3,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;KP(2,t.lens,0,32,e3,0,t.work,{bits:5}),kY=!1}t.lencode=t3,t.lenbits=9,t.distcode=e3,t.distbits=5},LY=(t,e,n,o)=>{let a;const d=t.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),o>=d.wsize?(d.window.set(e.subarray(n-d.wsize,n),0),d.wnext=0,d.whave=d.wsize):(a=d.wsize-d.wnext,a>o&&(a=o),d.window.set(e.subarray(n-o,n-o+a),d.wnext),(o-=a)?(d.window.set(e.subarray(n-o,n),0),d.wnext=o,d.whave=d.wsize):(d.wnext+=a,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=a))),0};var Ght=(t,e)=>{let n,o,a,d,h,p,m,_,g,y,C,O,q,L,U,K,J,_r,_o,na,ba,_u,_l=0;const _p=new Uint8Array(4);let u_,W_;const _v=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(hO(t)||!t.output||!t.input&&t.avail_in!==0)return G0;n=t.state,n.mode===JR&&(n.mode=QG),h=t.next_out,a=t.output,m=t.avail_out,d=t.next_in,o=t.input,p=t.avail_in,_=n.hold,g=n.bits,y=p,C=m,_u=lO;t:for(;;)switch(n.mode){case Z1:if(n.wrap===0){n.mode=QG;break}for(;g<16;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}if(2&n.wrap&&_===35615){n.wbits===0&&(n.wbits=15),n.check=0,_p[0]=255&_,_p[1]=_>>>8&255,n.check=kS(n.check,_p,2,0),_=0,g=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&_)<<8)+(_>>8))%31){t.msg="incorrect header check",n.mode=sS;break}if((15&_)!==wY){t.msg="unknown compression method",n.mode=sS;break}if(_>>>=4,g-=4,ba=8+(15&_),n.wbits===0&&(n.wbits=ba),ba>15||ba>n.wbits){t.msg="invalid window size",n.mode=sS;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&_?16189:JR,_=0,g=0;break;case 16181:for(;g<16;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}if(n.flags=_,(255&RS(n))!==wY){t.msg="unknown compression method",n.mode=sS;break}if(57344&RS(n)){t.msg="unknown header flags set",n.mode=sS;break}n.head&&(n.head.text=_>>8&1),512&RS(n)&&4&n.wrap&&(_p[0]=255&_,_p[1]=_>>>8&255,n.check=kS(n.check,_p,2,0)),_=0,g=0,n.mode=16182;case 16182:for(;g<32;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}n.head&&(n.head.time=_),512&RS(n)&&4&n.wrap&&(_p[0]=255&_,_p[1]=_>>>8&255,_p[2]=_>>>16&255,_p[3]=_>>>24&255,n.check=kS(n.check,_p,4,0)),_=0,g=0,n.mode=16183;case 16183:for(;g<16;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}n.head&&(n.head.xflags=255&_,n.head.os=_>>8),512&RS(n)&&4&n.wrap&&(_p[0]=255&_,_p[1]=_>>>8&255,n.check=kS(n.check,_p,2,0)),_=0,g=0,n.mode=16184;case 16184:if(1024&RS(n)){for(;g<16;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}n.length=_,n.head&&(n.head.extra_len=_),512&RS(n)&&4&n.wrap&&(_p[0]=255&_,_p[1]=_>>>8&255,n.check=kS(n.check,_p,2,0)),_=0,g=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&RS(n)&&(O=n.length,O>p&&(O=p),O&&(n.head&&(ba=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(o.subarray(d,d+O),ba)),512&RS(n)&&4&n.wrap&&(n.check=kS(n.check,o,O,d)),p-=O,d+=O,n.length-=O),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&RS(n)){if(p===0)break t;O=0;do ba=o[d+O++],n.head&&ba&&n.length<65536&&(n.head.name+=String.fromCharCode(ba));while(ba&&O<p);if(512&RS(n)&&4&n.wrap&&(n.check=kS(n.check,o,O,d)),p-=O,d+=O,ba)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&RS(n)){if(p===0)break t;O=0;do ba=o[d+O++],n.head&&ba&&n.length<65536&&(n.head.comment+=String.fromCharCode(ba));while(ba&&O<p);if(512&RS(n)&&4&n.wrap&&(n.check=kS(n.check,o,O,d)),p-=O,d+=O,ba)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&RS(n)){for(;g<16;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}if(4&n.wrap&&_!==(65535&n.check)){t.msg="header crc mismatch",n.mode=sS;break}_=0,g=0}n.head&&(n.head.hcrc=RS(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=JR;break;case 16189:for(;g<32;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}t.adler=n.check=OY(_),_=0,g=0,n.mode=$1;case $1:if(n.havedict===0)return t.next_out=h,t.avail_out=m,t.next_in=d,t.avail_in=p,n.hold=_,n.bits=g,jht;t.adler=n.check=1,n.mode=JR;case JR:if(e===Uht||e===Q1)break t;case QG:if(n.last){_>>>=7&g,g-=7&g,n.mode=$G;break}for(;g<3;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}switch(n.last=1&_,_>>>=1,g-=1,3&_){case 0:n.mode=16193;break;case 1:if(Bht(n),n.mode=tM,e===Q1){_>>>=2,g-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=sS}_>>>=2,g-=2;break;case 16193:for(_>>>=7&g,g-=7&g;g<32;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}if((65535&_)!=(_>>>16^65535)){t.msg="invalid stored block lengths",n.mode=sS;break}if(n.length=65535&_,_=0,g=0,n.mode=ZG,e===Q1)break t;case ZG:n.mode=16195;case 16195:if(O=n.length,O){if(O>p&&(O=p),O>m&&(O=m),O===0)break t;a.set(o.subarray(d,d+O),h),p-=O,d+=O,m-=O,h+=O,n.length-=O;break}n.mode=JR;break;case 16196:for(;g<14;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}if(n.nlen=257+(31&_),_>>>=5,g-=5,n.ndist=1+(31&_),_>>>=5,g-=5,n.ncode=4+(15&_),_>>>=4,g-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=sS;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;g<3;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}n.lens[_v[n.have++]]=7&_,_>>>=3,g-=3}for(;n.have<19;)n.lens[_v[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,u_={bits:n.lenbits},_u=KP(0,n.lens,0,19,n.lencode,0,n.work,u_),n.lenbits=u_.bits,_u){t.msg="invalid code lengths set",n.mode=sS;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;_l=n.lencode[_&(1<<n.lenbits)-1],U=_l>>>24,K=_l>>>16&255,J=65535&_l,!(U<=g);){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}if(J<16)_>>>=U,g-=U,n.lens[n.have++]=J;else{if(J===16){for(W_=U+2;g<W_;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}if(_>>>=U,g-=U,n.have===0){t.msg="invalid bit length repeat",n.mode=sS;break}ba=n.lens[n.have-1],O=3+(3&_),_>>>=2,g-=2}else if(J===17){for(W_=U+3;g<W_;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}_>>>=U,g-=U,ba=0,O=3+(7&_),_>>>=3,g-=3}else{for(W_=U+7;g<W_;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}_>>>=U,g-=U,ba=0,O=11+(127&_),_>>>=7,g-=7}if(n.have+O>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=sS;break}for(;O--;)n.lens[n.have++]=ba}}if(n.mode===sS)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=sS;break}if(n.lenbits=9,u_={bits:n.lenbits},_u=KP(1,n.lens,0,n.nlen,n.lencode,0,n.work,u_),n.lenbits=u_.bits,_u){t.msg="invalid literal/lengths set",n.mode=sS;break}if(n.distbits=6,n.distcode=n.distdyn,u_={bits:n.distbits},_u=KP(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,u_),n.distbits=u_.bits,_u){t.msg="invalid distances set",n.mode=sS;break}if(n.mode=tM,e===Q1)break t;case tM:n.mode=eM;case eM:if(p>=6&&m>=258){t.next_out=h,t.avail_out=m,t.next_in=d,t.avail_in=p,n.hold=_,n.bits=g,Pht(t,C),h=t.next_out,a=t.output,m=t.avail_out,d=t.next_in,o=t.input,p=t.avail_in,_=n.hold,g=n.bits,n.mode===JR&&(n.back=-1);break}for(n.back=0;_l=n.lencode[_&(1<<n.lenbits)-1],U=_l>>>24,K=_l>>>16&255,J=65535&_l,!(U<=g);){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}if(K&&!(240&K)){for(_r=U,_o=K,na=J;_l=n.lencode[na+((_&(1<<_r+_o)-1)>>_r)],U=_l>>>24,K=_l>>>16&255,J=65535&_l,!(_r+U<=g);){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}_>>>=_r,g-=_r,n.back+=_r}if(_>>>=U,g-=U,n.back+=U,n.length=J,K===0){n.mode=16205;break}if(32&K){n.back=-1,n.mode=JR;break}if(64&K){t.msg="invalid literal/length code",n.mode=sS;break}n.extra=15&K,n.mode=16201;case 16201:if(n.extra){for(W_=n.extra;g<W_;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}n.length+=_&(1<<n.extra)-1,_>>>=n.extra,g-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;_l=n.distcode[_&(1<<n.distbits)-1],U=_l>>>24,K=_l>>>16&255,J=65535&_l,!(U<=g);){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}if(!(240&K)){for(_r=U,_o=K,na=J;_l=n.distcode[na+((_&(1<<_r+_o)-1)>>_r)],U=_l>>>24,K=_l>>>16&255,J=65535&_l,!(_r+U<=g);){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}_>>>=_r,g-=_r,n.back+=_r}if(_>>>=U,g-=U,n.back+=U,64&K){t.msg="invalid distance code",n.mode=sS;break}n.offset=J,n.extra=15&K,n.mode=16203;case 16203:if(n.extra){for(W_=n.extra;g<W_;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}n.offset+=_&(1<<n.extra)-1,_>>>=n.extra,g-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=sS;break}n.mode=16204;case 16204:if(m===0)break t;if(O=C-m,n.offset>O){if(O=n.offset-O,O>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=sS;break}O>n.wnext?(O-=n.wnext,q=n.wsize-O):q=n.wnext-O,O>n.length&&(O=n.length),L=n.window}else L=a,q=h-n.offset,O=n.length;O>m&&(O=m),m-=O,n.length-=O;do a[h++]=L[q++];while(--O);n.length===0&&(n.mode=eM);break;case 16205:if(m===0)break t;a[h++]=n.length,m--,n.mode=eM;break;case $G:if(n.wrap){for(;g<32;){if(p===0)break t;p--,_|=o[d++]<<g,g+=8}if(C-=m,t.total_out+=C,n.total+=C,4&n.wrap&&C&&(t.adler=n.check=RS(n)?kS(n.check,a,C,h-C):xP(n.check,a,C,h-C)),C=m,4&n.wrap&&(RS(n)?_:OY(_))!==n.check){t.msg="incorrect data check",n.mode=sS;break}_=0,g=0}n.mode=16207;case 16207:if(n.wrap&&RS(n)){for(;g<32;){if(p===0)break t;p--,_+=o[d++]<<g,g+=8}if(4&n.wrap&&_!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=sS;break}_=0,g=0}n.mode=16208;case 16208:_u=xht;break t;case sS:_u=CY;break t;case 16210:return IY;default:return G0}return t.next_out=h,t.avail_out=m,t.next_in=d,t.avail_in=p,n.hold=_,n.bits=g,(n.wsize||C!==t.avail_out&&n.mode<sS&&(n.mode<$G||e!==RY))&&LY(t,t.output,t.next_out,C-t.avail_out),y-=t.avail_in,C-=t.avail_out,t.total_in+=y,t.total_out+=C,n.total+=C,4&n.wrap&&C&&(t.adler=n.check=RS(n)?kS(n.check,a,C,t.next_out-C):xP(n.check,a,C,t.next_out-C)),t.data_type=n.bits+(n.last?64:0)+(n.mode===JR?128:0)+(n.mode===tM||n.mode===ZG?256:0),(y===0&&C===0||e===RY)&&_u===lO&&(_u=Vht),_u},XR={inflateReset:NY,inflateReset2:PY,inflateResetKeep:AY,inflateInit:t=>DY(t,15),inflateInit2:DY,inflate:Ght,inflateEnd:t=>{if(hO(t))return G0;let e=t.state;return e.window&&(e.window=null),t.state=null,lO},inflateGetHeader:(t,e)=>{if(hO(t))return G0;const n=t.state;return 2&n.wrap?(n.head=e,e.done=!1,lO):G0},inflateSetDictionary:(t,e)=>{const n=e.length;let o,a,d;return hO(t)?G0:(o=t.state,o.wrap!==0&&o.mode!==$1?G0:o.mode===$1&&(a=1,a=xP(a,e,n,0),a!==o.check)?CY:(d=LY(t,e,n,n),d?(o.mode=16210,IY):(o.havedict=1,lO)))},inflateInfo:"pako inflate (from Nodeca project)"},Hht=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const MY=Object.prototype.toString,{Z_NO_FLUSH:Wht,Z_FINISH:qht,Z_OK:zP,Z_STREAM_END:n3,Z_NEED_DICT:r3,Z_STREAM_ERROR:Kht,Z_DATA_ERROR:UY,Z_MEM_ERROR:zht}=mN;function YP(t){this.options=z1.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&!(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new TY,this.strm.avail_out=0;let n=XR.inflateInit2(this.strm,e.windowBits);if(n!==zP)throw new Error(aO[n]);if(this.header=new Hht,XR.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=WP.string2buf(e.dictionary):MY.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=XR.inflateSetDictionary(this.strm,e.dictionary),n!==zP)))throw new Error(aO[n])}function i3(t,e){const n=new YP(e);if(n.push(t),n.err)throw n.msg||aO[n.err];return n.result}YP.prototype.push=function(t,e){const n=this.strm,o=this.options.chunkSize,a=this.options.dictionary;let d,h,p;if(this.ended)return!1;for(h=e===~~e?e:e===!0?qht:Wht,MY.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(o),n.next_out=0,n.avail_out=o),d=XR.inflate(n,h),d===r3&&a&&(d=XR.inflateSetDictionary(n,a),d===zP?d=XR.inflate(n,h):d===UY&&(d=r3));n.avail_in>0&&d===n3&&n.state.wrap>0&&t[n.next_in]!==0;)XR.inflateReset(n),d=XR.inflate(n,h);switch(d){case Kht:case UY:case r3:case zht:return this.onEnd(d),this.ended=!0,!1}if(p=n.avail_out,n.next_out&&(n.avail_out===0||d===n3))if(this.options.to==="string"){let m=WP.utf8border(n.output,n.next_out),_=n.next_out-m,g=WP.buf2string(n.output,m);n.next_out=_,n.avail_out=o-_,_&&n.output.set(n.output.subarray(m,m+_),0),this.onData(g)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(d!==zP||p!==0){if(d===n3)return d=XR.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},YP.prototype.onData=function(t){this.chunks.push(t)},YP.prototype.onEnd=function(t){t===zP&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=z1.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Yht={Inflate:YP,inflate:i3,inflateRaw:function(t,e){return(e=e||{}).raw=!0,i3(t,e)},ungzip:i3,constants:mN};const{Deflate:vft,deflate:Jht,deflateRaw:bft,gzip:yft}=Nht,{Inflate:Tft,inflate:Xht,inflateRaw:Sft,ungzip:Rft}=Yht;var Qht=Jht,Zht=Xht;const pS={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function q_(){return pS}function xY(){return"setSinkId"in HTMLAudioElement.prototype&&(!$("RESTRICTION_SET_PLAYBACK_DEVICE")||(lI()||X4())&&!LF())}let uS=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function vN(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function z_(t,e,n,o,a){return{width:t,height:e,frameRate:n,bitrateMin:o,bitrateMax:a}}function H0(t,e,n,o,a){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:o,bitrateMax:a}}function o3(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const $ht={"90p":z_(160,90),"90p_1":z_(160,90),"120p":z_(160,120,15,30,65),"120p_1":z_(160,120,15,30,65),"120p_3":z_(120,120,15,30,50),"120p_4":z_(212,120),"180p":z_(320,180,15,30,140),"180p_1":z_(320,180,15,30,140),"180p_3":z_(180,180,15,30,100),"180p_4":z_(240,180,15,30,120),"240p":z_(320,240,15,40,200),"240p_1":z_(320,240,15,40,200),"240p_3":z_(240,240,15,40,140),"240p_4":z_(424,240,15,40,220),"360p":z_(640,360,15,80,400),"360p_1":z_(640,360,15,80,400),"360p_3":z_(360,360,15,80,260),"360p_4":z_(640,360,30,80,600),"360p_6":z_(360,360,30,80,400),"360p_7":z_(480,360,15,80,320),"360p_8":z_(480,360,30,80,490),"360p_9":z_(640,360,15,80,800),"360p_10":z_(640,360,24,80,800),"360p_11":z_(640,360,24,80,1e3),"480p":z_(640,480,15,100,500),"480p_1":z_(640,480,15,100,500),"480p_2":z_(640,480,30,100,1e3),"480p_3":z_(480,480,15,100,400),"480p_4":z_(640,480,30,100,750),"480p_6":z_(480,480,30,100,600),"480p_8":z_(848,480,15,100,610),"480p_9":z_(848,480,30,100,930),"480p_10":z_(640,480,10,100,400),"720p":z_(1280,720,15,120,1130),"720p_auto":z_(1280,720,30,900,3e3),"720p_1":z_(1280,720,15,120,1130),"720p_2":z_(1280,720,30,120,2e3),"720p_3":z_(1280,720,30,120,1710),"720p_5":z_(960,720,15,120,910),"720p_6":z_(960,720,30,120,1380),"1080p":z_(1920,1080,15,120,2080),"1080p_1":z_(1920,1080,15,120,2080),"1080p_2":z_(1920,1080,30,120,3e3),"1080p_3":z_(1920,1080,30,120,3150),"1080p_5":z_(1920,1080,60,120,4780),"1440p":z_(2560,1440,30,120,4850),"1440p_1":z_(2560,1440,30,120,4850),"1440p_2":z_(2560,1440,60,120,7350),"4k":z_(3840,2160,30,120,8910),"4k_1":z_(3840,2160,30,120,8910),"4k_3":z_(3840,2160,60,120,13500)},nM=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],tpt={"480p":H0(640,480,5),"480p_1":H0(640,480,5),"480p_2":H0(640,480,30),"480p_3":H0(640,480,15),"720p":H0(1280,720,5),"720p_auto":z_(1280,720,30,900,3e3),"720p_1":H0(1280,720,5),"720p_2":H0(1280,720,30),"720p_3":H0(1280,720,15),"1080p":H0(1920,1080,5),"1080p_1":H0(1920,1080,5),"1080p_2":H0(1920,1080,30),"1080p_3":H0(1920,1080,15)},ept={"1SL1TL":o3(1,1),"3SL3TL":o3(3,3),"2SL3TL":o3(2,3)};function NR(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},$ht[t]):t}function s3(t){return typeof t=="string"?Object.assign({},tpt[t]):t}function rM(t){return typeof t=="string"?Object.assign({},ept[t]):t}const npt={speech_low_quality:vN(16e3,!1),speech_standard:vN(32e3,!1,18),music_standard:vN(48e3,!1),standard_stereo:vN(48e3,!0,56),high_quality:vN(48e3,!1,128),high_quality_stereo:vN(48e3,!0,192)};function iM(t){return typeof t=="string"?Object.assign({},npt[t]):t}const bN=[];function jY(t){return JT(t,"mediaSource",["screen","window","application"]),!0}let c_=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),lT=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t}({}),yN=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),rpt=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),ipt=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t}({}),pO=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),TN=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),SN=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),o0=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const a3={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},c3={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},VY={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},opt={uplinkNetworkQuality:0,downlinkNetworkQuality:0},FY={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let LS=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),s0=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),JP=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),fO=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),CS=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),PR=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const u3={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let oM=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function BY(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function _T(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?BY(Object(n),!0).forEach(function(o){ja(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):BY(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}function ja(t,e,n){return(e=function(o){var a=function(d,h){if(typeof d!="object"||d===null)return d;var p=d[Symbol.toPrimitive];if(p!==void 0){var m=p.call(d,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(o);return typeof a=="symbol"?a:String(a)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function K_(t,e,n,o,a){var d,h,p={};return Object.keys(o).forEach(function(m){p[m]=o[m]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=Z0(d=Bdt(h=n.slice()).call(h)).call(d,function(m,_){return _(t,e,m)||m},p),a&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(a):void 0,p.initializer=void 0),p.initializer===void 0&&(Object.defineProperty(t,e,p),p=null),p}class GY extends ET{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(pO.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),ja(this,"trackMediaType",void 0),ja(this,"_ID",void 0),ja(this,"_rtpTransceiver",void 0),ja(this,"_lowRtpTransceiver",void 0),ja(this,"_hints",[]),ja(this,"_isClosed",!1),ja(this,"_originMediaStreamTrack",void 0),ja(this,"mediaStreamTrack",void 0),ja(this,"_external",{}),this._ID=n||sT(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(o){o_(bN).call(bN,o)||bN.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||pI(()=>{var n;E_.reportApiInvoke(null,{name:BT.GET_MEDIA_STREAM_TRACK,options:[],tag:IT.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===yN.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=bN.indexOf(e);n!==-1&&bN.splice(n,1)}(this),this.emit(TN.CLOSED),this.removeAllListeners(pO.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===yN.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(pO.TRANSCEIVER_UPDATED,e,n)}}class RN extends GY{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),ja(this,"_enabled",!0),ja(this,"_muted",!1),ja(this,"_isExternalTrack",!1),ja(this,"_isClosed",!1),ja(this,"_enabledMutex",void 0),ja(this,"processor",void 0),ja(this,"_processorContext",void 0),ja(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new nS("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,A.debug("[".concat(this.getTrackId(),"] close")),this.emit(c_.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oT(this,c_.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){A.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(TN.TRACK_ENDED)}stateCheck(e,n){if(A.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),BR(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new ya(Y.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",A);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new ya(Y.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",A)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():n_.resolve([])}}const HY=window.AudioContext||window.webkitAudioContext;let a0=null;const tT=new class extends ET{constructor(){super(...arguments),ja(this,"prevState",void 0),ja(this,"curState",void 0),ja(this,"currentTime",void 0),ja(this,"currentTimeStuckAt",void 0),ja(this,"interruptDetectorTrack",void 0),ja(this,"onLocalAudioTrackMute",()=>{A.info("ios15-interruption-start"),this.emit(uS.IOS_15_16_INTERRUPTION_START)}),ja(this,"onLocalAudioTrackUnmute",async()=>{A.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?A.info("ios15-interruption-end-canceled"):(a0&&await a0.suspend(),this.emit(uS.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){A.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){A.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function CN(){if(!a0){if(function(){if(!HY)return void A.error("your browser is not support web audio");A.info("create audio context");const t=_T({},$("WEBAUDIO_INIT_OPTIONS"));A.debug("audio context init option:",JSON.stringify(t)),a0=new HY(t),tT.curState=a0.state,a0.onstatechange=()=>{tT.prevState=tT.curState,tT.curState=a0?a0.state:void 0;const{prevState:e,curState:n}=tT,o=n==="running",a=n==="interrupted",d=e==="running",h=e==="suspended",p=e==="interrupted",m=Y_().osVersion;(ES()||P0())&&d&&a&&(A.info("ios".concat(m,"-interruption-start")),tT.emit(uS.IOS_INTERRUPTION_START)),(ES()||P0())&&(h||p)&&o&&(A.info("ios".concat(m,"-interruption-end")),tT.emit(uS.IOS_INTERRUPTION_END)),e!==n&&tT.emit(uS.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=a0)===null||e===void 0?void 0:e.currentTime;tT.currentTime!==n?(tT.currentTimeStuckAt&&(A.debug("AudioContext current time resume at ".concat(n)),tT.currentTimeStuckAt=void 0),tT.currentTime=n):(n!==tT.currentTimeStuckAt&&(E_.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:IT.TRACER}).onSuccess(),A.warning("AudioContext current time stuck at ".concat(n))),tT.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,a=!1,d=!1,h=!1;function p(L){e.state==="running"?m(!1):ES()||P0()?e.state==="suspended"&&(m(!0),L&&e.resume().then(_,_)):e.state!=="closed"&&(m(!0),L&&e.resume().then(_,_))}function m(L){if(a!==L){a=L;for(let U=0,K=n;U<K.length;U+=1){const J=K[U];L?window.addEventListener(J,g,{capture:!0,passive:!0}):window.removeEventListener(J,g,{capture:!0,passive:!0})}}}function _(){p(!1)}function g(){p(!0)}function y(L){if(!h)if(o.paused)if(L){let U;C(!1),h=!0;try{U=o.play(),U?U.then(O,O):(o.addEventListener("playing",O),o.addEventListener("abort",O),o.addEventListener("error",O))}catch{O()}}else C(!0);else C(!1)}function C(L){if(d!==L){d=L;for(let U=0,K=n;U<K.length;U++){const J=K[U];L?window.addEventListener(J,q,{capture:!0,passive:!0}):window.removeEventListener(J,q,{capture:!0,passive:!0})}}}function O(){o.removeEventListener("playing",O),o.removeEventListener("abort",O),o.removeEventListener("error",O),h=!1,y(!1)}function q(){y(!0)}if(ES()){const L=e.createMediaStreamDestination(),U=document.createElement("div");U.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=U.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=L.stream,y(!0)}tT.on(uS.STATE_CHANGE,function(){p(!0)}),p(!1)}(a0)}(),!a0)throw new ya(Y.NOT_SUPPORTED,"can not create audio context");return a0}return a0}function mO(t){if(function(){if(d3!==null)return d3;const o=CN(),a=o.createBufferSource(),d=o.createGain(),h=o.createGain();a.connect(d),a.connect(h),a.disconnect(d);let p=!1;try{a.disconnect(d)}catch{p=!0}return a.disconnect(),d3=p,p}())return;const e=t.connect,n=t.disconnect;t.connect=(o,a,d)=>{var h;return t._inputNodes||(t._inputNodes=[]),o_(h=t._inputNodes).call(h,o)||(o instanceof AudioNode?(t._inputNodes.push(o),e.call(t,o,a,d)):e.call(t,o,a)),t},t.disconnect=(o,a,d)=>{n.call(t),o?_1(t._inputNodes,o):t._inputNodes=[];for(const h of t._inputNodes)e.call(t,h)}}let d3=null;function l3(t,e){let n=!1;const o=1/e;if($("DISABLE_WEBAUDIO")){const a=window.setInterval(()=>{n?window.clearInterval(a):t(performance.now()/1e3)},1e3*o)}else{const a=CN();let d=a.createGain();d.gain.value=0,d.connect(a.destination);const h=()=>{if(n)return void(d=null);const p=a.createOscillator();p.onended=h,p.connect(d),p.start(0),p.stop(a.currentTime+o),t(a.currentTime)};h()}return()=>{n=!0}}class WY{constructor(){ja(this,"context",void 0),ja(this,"analyserNode",void 0),ja(this,"sourceNode",void 0),this.context=CN(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ES()||P0()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let a=0;a<e.length;++a)e[a]=o[a]/128-1}const n=Z0(e).call(e,(o,a)=>o+a*a,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{A.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class qY extends ET{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),ja(this,"outputNode",void 0),ja(this,"outputTrack",void 0),ja(this,"isPlayed",!1),ja(this,"sourceNode",void 0),ja(this,"context",void 0),ja(this,"audioBufferNode",void 0),ja(this,"destNode",void 0),ja(this,"audioOutputLevel",0),ja(this,"volumeLevelAnalyser",void 0),ja(this,"_processedNode",void 0),ja(this,"playNode",void 0),ja(this,"isDestroyed",!1),ja(this,"onNoAudioInput",void 0),ja(this,"isNoAudioInput",!1),ja(this,"_noAudioInputCount",0),this.context=CN(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),mO(this.outputNode),this.volumeLevelAnalyser=new WY}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(o0.ON_AUDIO_BUFFER,function(o){for(let a=0;a<o.outputBuffer.numberOfChannels;a+=1){const d=o.outputBuffer.getChannelData(a);for(let h=0;h<d.length;h+=1)d[h]=0}return o.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!q_().webAudioMediaStreamDest)throw new ya(Y.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&g1(()=>{tT.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ES()||P0()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let o;n.getFloatTimeDomainData?(o=new Float32Array(n.fftSize),n.getFloatTimeDomainData(o)):(o=new Uint8Array(n.fftSize),n.getByteTimeDomainData(o));let a=!1;for(let d=0;d<o.length;d++)o[d]!==0&&(a=!0);return a?(this.isNoAudioInput=!1,!0):(await $T(200),await this.checkHasAudioInput(e?e+1:1)&&a)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class KY extends qY{get isFreeze(){return!1}constructor(e,n,o){var a;if(super(),ja(this,"sourceNode",void 0),ja(this,"track",void 0),ja(this,"clonedTrack",void 0),ja(this,"audioElement",void 0),ja(this,"isCurrentTrackCloned",!1),ja(this,"isRemoteTrack",!1),ja(this,"originVolumeLevelAnalyser",void 0),ja(this,"rebuildWebAudio",async()=>{if(A.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void A.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>A.info("resume success")),A.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const p=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?p.stop():this.isCurrentTrackCloned=!0;const m=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(m),mO(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const _=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(_,this.context.currentTime),mO(this.outputNode),this.emit(o0.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=m,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new ya(Y.UNEXPECTED_ERROR);this.track=e;const d=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(d),mO(this.sourceNode),o){const p=o.clone();p.enabled=!0,this.clonedTrack=p,A.debug("create an unmuted track ".concat(p.id," from the original track ").concat(o.id," to get the volume"));const m=this.context.createMediaStreamSource(new MediaStream([p]));mO(m),this.originVolumeLevelAnalyser=new WY,this.originVolumeLevelAnalyser.updateSource(m)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;const h=Y_();n&&h.os===QT.IOS&&Number((a=h.osVersion)===null||a===void 0?void 0:a.split(".")[0])<15&&(tT.on(uS.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(p=>{p||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),mO(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(o0.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),tT.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),A.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([n]));mO(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function zY(t,e,n){const o=(d,h)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||h:d:h,a={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:o(e.height,1080),maxWidth:o(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(a.video.mandatory.maxFrameRate=e.frameRate.max,a.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(a.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(a)}async function spt(t,e){const n=await YY(t.mediaSource),{sourceId:o,audio:a}=await function(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new n_((p,m)=>{const _=document.createElement("div");_.innerText="share screen",_.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const g=document.createElement("div");g.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const y=document.createElement("div");y.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",y.setAttribute("style","height: 12%;");const C=document.createElement("div");C.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const O=document.createElement("div");O.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const q=document.createElement("button");q.innerHTML="cancel",q.setAttribute("style","width: 85px;"),q.onclick=()=>{document.body.removeChild(K);const J=new Error("NotAllowedError");J.name="NotAllowedError",m(J)};let L=h;const U=document.createElement("div");if(h){const J=document.createElement("input");J.setAttribute("type","checkbox");const _r=document.createElement("span");J.setAttribute("style","margin-right: 6px;"),_r.innerText="Share audio",J.checked=L,J.onchange=()=>{L=J.checked},U.appendChild(J),U.appendChild(_r)}O.appendChild(U),O.appendChild(q),g.appendChild(y),g.appendChild(C),g.appendChild(O);const K=document.createElement("div");K.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),K.appendChild(_),K.appendChild(g),document.body.appendChild(K),d.map(J=>{if(J.id){const _r=document.createElement("div");_r.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let _o=J.thumbnail;try{const{width:na}=_o.getSize();na>1920&&(_o=_o.resize({width:1920}))}catch(na){throw na&&na.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),na}_r.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+_o.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+J.name.replace(/[\u00A0-\u9999<>\&]/g,function(na){return"&#"+na.charCodeAt(0)+";"})+"</span>",_r.onclick=()=>{document.body.removeChild(K),p({sourceId:J.id,audio:L})},C.appendChild(_r)}})})}(n,e);return await zY(o,t,a)}async function YY(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=p8();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new ya(Y.ELECTRON_IS_NULL);let o=null;try{var a;o=((a=n.desktopCapturer)===null||a===void 0?void 0:a.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{o=null}o&&o.then||(o=new n_((d,h)=>{n.desktopCapturer.getSources({types:e},(p,m)=>{p?h(p):d(m)})}));try{return await o}catch(d){throw new ya(Y.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}const h3=new nS("safari");let JY=!1,XY=!1;async function c0(t,e){let n=0,o=null;for(;n<2;)try{o=await apt(t,e,n>0);break}catch(a){if(a instanceof ya)throw A.error("[".concat(e,"] ").concat(a.toString())),a;const d=sM(a.name||a.code||a,a.message);if(d.code===Y.MEDIA_OPTION_INVALID){A.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await $T(500);continue}throw A.error("[".concat(e,"] ").concat(d.toString())),d}if(!o)throw new ya(Y.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function apt(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ya(Y.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const o=q_(),a=new MediaStream;if(t.audioSource&&a.addTrack(t.audioSource),t.videoSource&&a.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return A.debug("Using Video Source/ Audio Source"),a;if(t.screen)if(p8())t.screen.sourceId?IN(a,await zY(t.screen.sourceId,t.screen,t.screenAudio)):IN(a,await spt(t.screen,t.screenAudio));else if(lI()&&t.screen.extensionId&&t.screen.mandatory){if(!o.getStreamFromExtension)throw new ya(Y.NOT_SUPPORTED,"This browser does not support screen sharing");A.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const C=await(h=t.screen.extensionId,p=e,new n_((O,q)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},L=>{if(!L||!L.streamId)return A.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),L),void q(new ya(Y.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));O(L.streamId)})}catch(L){A.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),L.toString()),q(new ya(Y.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=C,IN(a,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(o.getDisplayMedia){var d;t.screen.mediaSource&&jY(t.screen.mediaSource);const C={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(d=t.screen.displaySurface)!==null&&d!==void 0?d:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:O,surfaceSwitching:q,systemAudio:L}=t.screen,U={selfBrowserSurface:O,surfaceSwitching:q,systemAudio:L};!O&&delete U.selfBrowserSurface,!q&&delete U.surfaceSwitching,!L&&delete U.systemAudio,A.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:C,audio:!!t.screenAudio,controls:U})),IN(a,await navigator.mediaDevices.getDisplayMedia(_T({video:C,audio:!!t.screenAudio},U)))}else{if(!iT())throw A.error("[".concat(e,"] This browser does not support screenSharing")),new ya(Y.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&jY(t.screen.mediaSource);const C={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};A.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(C))),IN(a,await navigator.mediaDevices.getUserMedia(C))}}var h,p;if(!t.video&&!t.audio)return a;let m={video:t.video,audio:t.audio},_=$("MEDIA_DEVICE_CONSTRAINTS");if(_)try{typeof _=="string"&&(_=JSON.parse(_)),m=FF(m,_)}catch{}A.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(m)),Y_();let g,y=null;(ZT()||ES()||m1())&&(y=await h3.lock());try{g=await navigator.mediaDevices.getUserMedia(m)}catch(C){throw y&&y(),C}return m.audio&&(JY=!0),m.video&&(XY=!0),IN(a,g),y&&y(),a}function sM(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ya(Y.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new ya(Y.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new ya(Y.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new ya(Y.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ya(Y.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new ya(Y.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return A.error("getUserMedia unexpected error",t),new ya(Y.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function IN(t,e){const n=t.getVideoTracks()[0],o=t.getAudioTracks()[0],a=e.getVideoTracks()[0],d=e.getAudioTracks()[0];d&&(o&&t.removeTrack(o),t.addTrack(d)),a&&(n&&t.removeTrack(n),t.addTrack(a))}const u0=new class extends ET{get state(){return this._state}set state(t){t!==this._state&&(this.emit(fO.STATE_CHANGE,t),this._state=t)}constructor(){super(),ja(this,"_state",JP.IDLE),ja(this,"isAccessMicrophonePermission",!1),ja(this,"isAccessCameraPermission",!1),ja(this,"lastAccessMicrophonePermission",!1),ja(this,"lastAccessCameraPermission",!1),ja(this,"checkdeviceMatched",!1),ja(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{($("ENUMERATE_DEVICES_INTERVAL")||(E1()||f1()===QT.HARMONY_OS)&&hI())&&this.updateDevicesInfo()},$("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>A.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ya(Y.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),a=this.checkMediaDeviceInfoIsOk(o);let d=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&e;a.audio&&(d=!1),a.video&&(h=!1);let p=null,m=null,_=null;if(!n&&(d||h)){if(h3.isLocked&&(A.debug("[device manager] wait GUM lock"),(await h3.lock())(),A.debug("[device manager] GUM unlock")),JY&&(d=!1,this.isAccessMicrophonePermission=!0),XY&&(h=!1,this.isAccessCameraPermission=!0),A.debug("[device manager] check media device permissions",t,e,d,h),d&&h){try{_=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(g){const y=sM(g.name||g.code||g,g.message);if(y.code===Y.PERMISSION_DENIED)throw y;A.warning("getUserMedia failed in getDevices",y)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{p=await navigator.mediaDevices.getUserMedia({audio:t})}catch(g){const y=sM(g.name||g.code||g,g.message);if(y.code===Y.PERMISSION_DENIED)throw y;A.warning("getUserMedia failed in getDevices",y)}this.isAccessMicrophonePermission=!0}else if(h){try{m=await navigator.mediaDevices.getUserMedia({video:e})}catch(g){const y=sM(g.name||g.code||g,g.message);if(y.code===Y.PERMISSION_DENIED)throw y;A.warning("getUserMedia failed in getDevices",y)}this.isAccessCameraPermission=!0}A.debug("[device manager] mic permission",t,"cam permission",e)}try{const g=await navigator.mediaDevices.enumerateDevices();return p&&p.getTracks().forEach(y=>y.stop()),m&&m.getTracks().forEach(y=>y.stop()),_&&_.getTracks().forEach(y=>y.stop()),p=null,m=null,_=null,g}catch(g){return p&&p.getTracks().forEach(y=>y.stop()),m&&m.getTracks().forEach(y=>y.stop()),_&&_.getTracks().forEach(y=>y.stop()),p=null,m=null,_=null,new ya(Y.ENUMERATE_DEVICES_FAILED,g.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new ya(Y.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=JP.INITING;try{await this.updateDevicesInfo(),this.state=JP.INITEND}catch(t){throw A.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=JP.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new ya(Y.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const a=t.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),d=t.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");a&&d?d.groupId===a.groupId?A.debug("[device-check] default input ".concat(a.label," and output ").concat(d.label," is the same group")):A.warning("[device-check] default input ".concat(a.label," and output ").concat(d.label," is not the same group")):A.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(a=>{if(!a.deviceId)return;const d=this.deviceInfoMap.get("".concat(a.kind,"_").concat(a.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){const h={initAt:e,updateAt:e,device:a,state:"ACTIVE"};this.deviceInfoMap.set("".concat(a.kind,"_").concat(a.deviceId),h),n.push(h)}d&&(d.updateAt=e)}),this.deviceInfoMap.forEach((a,d)=>{a.state==="ACTIVE"&&a.updateAt!==e&&(a.state="INACTIVE",n.push(a))}),this.state!==JP.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(a=>{switch(a.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(fO.RECORDING_DEVICE_CHANGED,a);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(fO.CAMERA_DEVICE_CHANGED,a);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(fO.PLAYOUT_DEVICE_CHANGED,a)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(a=>a.kind==="audioinput"),n=t.filter(a=>a.kind==="videoinput"),o={audio:!1,video:!1};for(const a of e)if(a.label&&a.deviceId){o.audio=!0;break}for(const a of n)if(a.label&&a.deviceId){o.video=!0;break}return o}};let p3=!1;const d0=new class extends ET{constructor(){super(...arguments),ja(this,"onAutoplayFailed",void 0),ja(this,"onAudioAutoplayFailed",void 0)}};function QY(){if(Y_(),!p3){const t=e=>{e.preventDefault(),p3=!1,fP()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};p3=!0,fP()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),A.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),d0.onAutoplayFailed?d0.onAutoplayFailed():d0.onAudioAutoplayFailed?A.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):A.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),d0.emit("autoplay-failed")}}function ZY(t,e,n,o){if(!t)return;const a=E_.getBaseInfoBySessionId(t);if(!a)return;const d=a.info,h=Date.now(),p=_T(_T({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-a.startTime,cbRegistered:d0.onAutoplayFailed||d0.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:o,extend:void 0});E_.send({type:yT.AUTOPLAY_FAILED,data:p},!0)}const cpt=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],xS=new class{constructor(){ja(this,"onAutoplayFailed",void 0),ja(this,"elementMap",new Map),ja(this,"elementStateMap",new Map),ja(this,"elementsNeedToResume",[]),ja(this,"sinkIdMap",new Map),ja(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,o]=e;const a=this.elementStateMap.get(n),d=o.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(A.debug("resume after interrupted, ele: ".concat(a," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return o.pause(),void o.play();if(tT.curState==="running")return XO()?(o.pause(),void o.play()):void(a&&a==="paused"&&o.play())}})}),ja(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const o=n.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(A.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),tT.on(uS.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tT.on(uS.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),tT.on(uS.STATE_CHANGE,()=>{ES()&&tT.prevState==="suspended"&&tT.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(o){throw new ya(Y.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(t,e,n,o){if(this.elementMap.has(e))return;const a=document.createElement("audio");a.autoplay=!0,a.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,a),this.elementMap.set(e,a),this.elementStateMap.set(e,CS.INIT),this.setVolume(e,n);const d=this.sinkIdMap.get(e);if(d)try{a.setSinkId(d).catch(p=>{A.warning("[".concat(e,"] set sink id failed"),p.toString())})}catch(p){A.warning("[".concat(e,"] set sink id failed"),p.toString())}const h=a.play();h&&h.then&&h.catch(p=>{o&&ZY(o,"audio",p.message,e),A.warning("audio element play warning",p.toString()),this.elementMap.has(e)&&p.name==="NotAllowedError"&&(A.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(a),g1(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),QY()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){cpt.forEach(n=>{e.addEventListener(n,o=>{const a=this.elementStateMap.get(t),d=o.type==="pause"?"paused":o.type;if(A.debug("[".concat(t,"] audio-element-status change ").concat(a," => ").concat(d)),o.type==="error"){const h=e==null?void 0:e.error;h&&A.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,d)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{A.debug("Auto resume audio element success")}).catch(n=>{A.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new n_(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{fP()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function kT(){return function(t,e,n){const o=n.value;return typeof o=="function"&&(n.value=function(){this._isClosed&&new ya(Y.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",A);for(var a=arguments.length,d=new Array(a),h=0;h<a;h++)d[h]=arguments[h];const p=o.apply(this,d);return p instanceof n_?new n_((m,_)=>{p.then(m).catch(_)}):p}),n}}class $Y extends ET{constructor(e){super(),ja(this,"name","VideoProcessorDestination"),ja(this,"ID","0"),ja(this,"_source",void 0),ja(this,"videoContext",void 0),ja(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ya(Y.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ya(Y.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(LS.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(LS.ON_TRACK,void 0)}}class t7 extends ET{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),ja(this,"constraintsMap",new Map),ja(this,"statsRegistry",[]),ja(this,"usageRegistry",[]),ja(this,"trackId",void 0),ja(this,"direction",void 0),ja(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await GT(this,s0.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var o;return A.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),oT(this,s0.REQUEST_UPDATE_CONSTRAINTS,Array.from(nR(o=this.constraintsMap).call(o)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return A.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),oT(this,s0.REQUEST_UPDATE_CONSTRAINTS,Array.from(nR(n=this.constraintsMap).call(n)))}registerStats(e,n,o){this.statsRegistry.find(a=>a.processorID===e.ID&&a.processorName===e.name&&a.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:o})}unregisterStats(e,n){const o=this.statsRegistry.findIndex(a=>a.processorID===e.ID&&a.processorName===e.name&&a.type===n);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:o,type:a,cb:d}of this.statsRegistry)try{const h=d();e.push({processorID:n,processorName:o,type:a,stats:h})}catch(h){A.error(new ya(Y.UNEXPECTED_ERROR,h.message))}return e}registerUsage(e,n){this.usageRegistry.find(o=>o.processorID===e.ID&&o.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(o=>o.processorID===e.ID&&o.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let o=n();o instanceof n_&&(o=await o),e.push(_T(_T({},o),{},{direction:this.direction}))}catch(o){A.error("gather extension usage error",o)}return e}getDirection(){return this.direction}}class e7 extends ET{constructor(e){super(),ja(this,"name","AudioProcessorDestination"),ja(this,"ID","0"),ja(this,"inputTrack",void 0),ja(this,"inputNode",void 0),ja(this,"audioProcessorContext",void 0),ja(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ya(Y.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ya(Y.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(LS.ON_TRACK,void 0),this.emit(LS.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(LS.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(LS.ON_NODE,this.inputNode))}}class n7 extends ET{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,o){super(),ja(this,"constraintsMap",new Map),ja(this,"statsRegistry",[]),ja(this,"audioContext",void 0),ja(this,"trackId",void 0),ja(this,"direction",void 0),ja(this,"usageRegistry",[]),ja(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=o}async getConstraints(){return GT(this,s0.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var o;return A.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),oT(this,s0.REQUEST_UPDATE_CONSTRAINTS,Array.from(nR(o=this.constraintsMap).call(o)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),oT(this,s0.REQUEST_UPDATE_CONSTRAINTS,Array.from(nR(n=this.constraintsMap).call(n)))}registerStats(e,n,o){this.statsRegistry.find(a=>a.processorID===e.ID&&a.processorName===e.name&&a.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:o})}unregisterStats(e,n){const o=this.statsRegistry.findIndex(a=>a.processorID===e.ID&&a.processorName===e.name&&a.type===n);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:o,type:a,cb:d}of this.statsRegistry)try{const h=d();e.push({processorID:n,processorName:o,type:a,stats:h})}catch(h){A.error(new ya(Y.UNEXPECTED_ERROR,h.message))}return e}registerUsage(e,n){this.usageRegistry.find(o=>o.processorID===e.ID&&o.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(o=>o.processorID===e.ID&&o.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let o=n();o instanceof n_&&(o=await o),e.push(_T(_T({},o),{},{direction:this.direction}))}catch(o){A.error("gather extension usage error",o)}return e}getDirection(){return this.direction}}class f3 extends ET{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),ja(this,"context",void 0),ja(this,"processSourceNode",void 0),ja(this,"outputTrack",void 0),ja(this,"processedNode",void 0),ja(this,"clonedTrack",void 0),ja(this,"outputNode",void 0),this.outputNode=new upt}setVolume(){}createOutputTrack(){throw new ya(Y.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class upt{disconnect(){}connect(){}}function r7(t){return new n_((e,n)=>{let o=!1;const a=document.createElement("video");a.setAttribute("autoplay",""),a.setAttribute("muted",""),a.muted=!0,a.autoplay=!0,a.setAttribute("playsinline",""),a.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(a);const d=ES()?"canplay":"playing";a.addEventListener(d,()=>{const h=a.videoWidth,p=a.videoHeight;!h&&iT()||(o=!0,a.srcObject=null,a.remove(),e([h,p]))}),a.srcObject=new MediaStream([t]),a.play().catch(v1),setTimeout(()=>{o||(a.srcObject=null,a.remove(),e([a.videoWidth,a.videoHeight]))},4e3)})}function aM(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=NR(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!s8()&&n.frameRate&&(e.frameRate=n.frameRate),X4()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),iT()&&(e.frameRate={ideal:30,max:30}),e}function i7(t){const e={};if(s8()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,lI()&&t.ANS&&(e.googHighpassFilter=t.ANS))),t.encoderConfig){const n=iM(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),E1()&&(e.sampleRate=void 0),e}const dpt=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:o,height:a}=t.getMediaStreamTrackSettings();let{frameRate:d=n,width:h=o,height:p=a}=e;if(!d||!h||!p)return;h=BF(h),p=BF(p),d=BF(d);const{max:m,min:_}=function(O,q,L){const U=200*Math.pow(L/15,.6)*Math.pow(O*q/640/360,.75);return{min:Math.floor(U),max:Math.floor(4*U)}}(h,p,d),{bitrateMax:g,bitrateMin:y}=e||{};g||A.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(p,", fps: ").concat(d,"] => [brMax: ").concat(g,", brMin: ").concat(y,"]"));const{maxFramerate:C}=$("ENCODER_CONFIG_LIMIT");return C&&typeof C=="number"&&(d=Math.min(d,C)),{frameRate:d,bitrateMax:g||m,bitrateMin:y||_,scaleResolutionDownBy:1,scale:0}},o7=async(t,e,n)=>await(async(o,a,d)=>{const h=function(_){const g=[];for(let y=0;y<_.length;y+=2)g.push(parseInt(_.slice(y,y+2),16));return Uint8Array.from(g)}(C8(""+a+d)).slice(0,16),p=h.slice(0,12),m=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:p},m,o))})(t.buffer,e,n),m3=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new n_((n,o)=>{e.toBlob(async a=>{if(e.remove(),a){const d=await s7(a);n({buffer:d,width:e.width,height:e.height})}else o(new ya(Y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},s7=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var a7,c7,u7,d7,l7,h7,p7,f7,m7,E7,_7,g7,v7,b7,y7,T7,S7,R7,TT,C7,I7,w7,O7,A7,N7,DR,P7,D7,k7,L7,M7,U7,x7,j7,V7,F7,B7,G7,H7,fS;let OT=(a7=C_({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),c7=C_({argsMap:(t,e)=>[t.getTrackId(),e]}),u7=kT(),d7=$O("LocalAudioTrack","_enabledMutex"),l7=C_({argsMap:(t,e)=>[t.getTrackId(),e]}),h7=kT(),p7=$O("LocalAudioTrack","_enabledMutex"),f7=C_({argsMap:(t,e)=>[t.getTrackId(),e]}),m7=kT(),E7=kT(),_7=kT(),g7=C_({argsMap:t=>[t.getTrackId()]}),v7=kT(),b7=C_({argsMap:t=>[t.getTrackId()]}),y7=kT(),T7=C_({argsMap:t=>[t.getTrackId()]}),S7=C_({argsMap:(t,e)=>[t.getTrackId(),e.name]}),R7=C_({argsMap:t=>[t.getTrackId()]}),K_((TT=class extends RN{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?xS.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,o){super(t,n),ja(this,"trackMediaType","audio"),ja(this,"_encoderConfig",void 0),ja(this,"_trackSource",void 0),ja(this,"_enabled",!0),ja(this,"_volume",100),ja(this,"_useAudioElement",!0),ja(this,"_bypassWebAudio",!1),ja(this,"processor",void 0),ja(this,"_processorContext",void 0),ja(this,"_processorDestination",void 0),ja(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!o,this._trackSource=new f3,$("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),$("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),ZT()&&!a0?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){nT(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&xS.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void A.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,oT(this,c_.NEED_REPLACE_TRACK,this).then(()=>{A.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{A.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!xY())throw new ya(Y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await xS.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await oT(this,c_.NEED_ENABLE_TRACK,this),A.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(o){throw n||(this._enabled=!1),A.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await oT(this,c_.NEED_DISABLE_TRACK,this)}catch(o){throw n||(this._enabled=!0),A.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,A.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await oT(this,c_.NEED_MUTE_TRACK,this):await oT(this,c_.NEED_UNMUTE_TRACK,this))}getStats(){return pI(()=>{A.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),JS(this,c_.GET_STATS)||_T({},a3)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(o0.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(o0.ON_AUDIO_BUFFER),this._source.on(o0.ON_AUDIO_BUFFER,n=>t(n))}play(){A.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(A.debug("[".concat(this.getTrackId(),"] start audio playback in element")),xS.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){A.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?xS.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];A.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&xS.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oT(this,c_.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return n_.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new ya(Y.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new ya(Y.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(LS.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await oT(this,c_.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oT(this,c_.NEED_REPLACE_TRACK,this))}),t.on(LS.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(LS.ON_TRACK),t.removeAllListeners(LS.ON_NODE)}bindProcessorContextEvents(t){t.on(s0.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(s0.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof f3&&(this._trackSource=new KY(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new n7(this._source.context,this.getTrackId(),"local"),e=new e7(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(o0.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(xS.stop(this.getTrackId()),this._source.play()),oT(this,c_.NEED_REPLACE_MIXING_TRACK,this).then(()=>{A.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{A.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[a7],Object.getOwnPropertyDescriptor(TT.prototype,"setVolume"),TT.prototype),K_(TT.prototype,"setPlaybackDevice",[c7,u7],Object.getOwnPropertyDescriptor(TT.prototype,"setPlaybackDevice"),TT.prototype),K_(TT.prototype,"setEnabled",[d7,l7,h7],Object.getOwnPropertyDescriptor(TT.prototype,"setEnabled"),TT.prototype),K_(TT.prototype,"setMuted",[p7,f7,m7],Object.getOwnPropertyDescriptor(TT.prototype,"setMuted"),TT.prototype),K_(TT.prototype,"getStats",[E7],Object.getOwnPropertyDescriptor(TT.prototype,"getStats"),TT.prototype),K_(TT.prototype,"setAudioFrameCallback",[_7],Object.getOwnPropertyDescriptor(TT.prototype,"setAudioFrameCallback"),TT.prototype),K_(TT.prototype,"play",[g7,v7],Object.getOwnPropertyDescriptor(TT.prototype,"play"),TT.prototype),K_(TT.prototype,"stop",[b7,y7],Object.getOwnPropertyDescriptor(TT.prototype,"stop"),TT.prototype),K_(TT.prototype,"close",[T7],Object.getOwnPropertyDescriptor(TT.prototype,"close"),TT.prototype),K_(TT.prototype,"pipe",[S7],Object.getOwnPropertyDescriptor(TT.prototype,"pipe"),TT.prototype),K_(TT.prototype,"unpipe",[R7],Object.getOwnPropertyDescriptor(TT.prototype,"unpipe"),TT.prototype),TT),cM=(C7=C_({argsMap:(t,e)=>[t.getTrackId(),e]}),I7=kT(),w7=$O("MicrophoneAudioTrack","_enabledMutex"),O7=C_({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),A7=kT(),N7=C_({argsMap:t=>[t.getTrackId()]}),K_((DR=class extends OT{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,o){super(t,e.encoderConfig?iM(e.encoderConfig):{},o,$("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),ja(this,"_config",void 0),ja(this,"_deviceName","default"),ja(this,"_constraints",void 0),ja(this,"_originalConstraints",void 0),ja(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(XO()||DF())&&tT.bindInterruptDetectorTrack(this)}async setDevice(t){if(A.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await u0.getDeviceById(t),n={};n.audio=_T({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let o=null;try{o=await c0(n,this.getTrackId())}catch(a){throw A.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),o=await c0({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await u0.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}A.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return A.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),t),$("AUTO_RESET_AUDIO_ROUTE")&&(ES()||P0())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),n||(this._enabled=!1);try{await oT(this,c_.NEED_DISABLE_TRACK,this)}catch(h){throw A.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const a=_T({},this._constraints),d=u0.searchDeviceIdByName(this._deviceName);d&&!a.deviceId&&(a.deviceId=d);try{n||(this._enabled=!0);const h=await c0({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await oT(this,c_.NEED_ENABLE_TRACK,this)}catch(h){throw n||(this._enabled=!1),A.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}A.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(XO()||DF())&&tT.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ES()||P0())&&this._enabled&&!this._isClosed&&tT.duringInterruption){const t=async()=>{tT.off(uS.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(A.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};tT.on(uS.IOS_INTERRUPTION_END,t)}else A.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(TN.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=u0.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const o=await c0({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(s0.REQUEST_UPDATE_CONSTRAINTS,async(e,n,o)=>{try{const a=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(a),n()}catch(a){o(a)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(s0.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[C7,I7],Object.getOwnPropertyDescriptor(DR.prototype,"setDevice"),DR.prototype),K_(DR.prototype,"setEnabled",[w7,O7,A7],Object.getOwnPropertyDescriptor(DR.prototype,"setEnabled"),DR.prototype),K_(DR.prototype,"close",[N7],Object.getOwnPropertyDescriptor(DR.prototype,"close"),DR.prototype),DR),lpt=(P7=C_({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),D7=kT(),k7=C_({argsMap:t=>[t.getTrackId()]}),L7=kT(),M7=C_({argsMap:t=>[t.getTrackId()]}),U7=kT(),x7=C_({argsMap:t=>[t.getTrackId()]}),j7=kT(),V7=C_({argsMap:t=>[t.getTrackId()]}),F7=kT(),B7=C_({argsMap:t=>[t.getTrackId()]}),G7=C_({argsMap:t=>[t.getTrackId()]}),H7=kT(),K_((fS=class extends OT{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,o){super(e.createOutputTrack(),n,o),ja(this,"source",void 0),ja(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(o0.AUDIO_SOURCE_STATE_CHANGE,a=>{this.safeEmit(TN.SOURCE_STATE_CHANGE,a)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){nT(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[P7,D7],Object.getOwnPropertyDescriptor(fS.prototype,"startProcessAudioBuffer"),fS.prototype),K_(fS.prototype,"pauseProcessAudioBuffer",[k7,L7],Object.getOwnPropertyDescriptor(fS.prototype,"pauseProcessAudioBuffer"),fS.prototype),K_(fS.prototype,"seekAudioBuffer",[M7,U7],Object.getOwnPropertyDescriptor(fS.prototype,"seekAudioBuffer"),fS.prototype),K_(fS.prototype,"resumeProcessAudioBuffer",[x7,j7],Object.getOwnPropertyDescriptor(fS.prototype,"resumeProcessAudioBuffer"),fS.prototype),K_(fS.prototype,"stopProcessAudioBuffer",[V7,F7],Object.getOwnPropertyDescriptor(fS.prototype,"stopProcessAudioBuffer"),fS.prototype),K_(fS.prototype,"close",[B7],Object.getOwnPropertyDescriptor(fS.prototype,"close"),fS.prototype),K_(fS.prototype,"setAudioBufferPlaybackSpeed",[G7,H7],Object.getOwnPropertyDescriptor(fS.prototype,"setAudioBufferPlaybackSpeed"),fS.prototype),fS);class YT extends OT{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=CN().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,sT(8,"track-mix-")),ja(this,"trackList",void 0),ja(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(A.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):A.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){A.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}_1(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof YT?n.emit(pO.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class hpt extends qY{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(o0.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),ja(this,"audioBuffer",void 0),ja(this,"sourceNode",void 0),ja(this,"startPlayTime",0),ja(this,"startPlayOffset",0),ja(this,"pausePlayTime",0),ja(this,"options",void 0),ja(this,"currentLoopCount",0),ja(this,"currentPlaybackSpeed",100),ja(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):A.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const W7=new Map;class E3{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(A.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){ja(this,"trackId",void 0),ja(this,"config",void 0),ja(this,"onFirstVideoFrameDecoded",void 0),ja(this,"onVideoStateChanged",void 0),ja(this,"freezeTimeCounterList",[]),ja(this,"renderFreezeAccTime",0),ja(this,"isKeepLastFrame",!1),ja(this,"timeUpdatedCount",0),ja(this,"freezeTime",0),ja(this,"playbackTime",0),ja(this,"lastTimeUpdatedTime",0),ja(this,"autoplayFailed",!1),ja(this,"videoTrack",void 0),ja(this,"videoElement",void 0),ja(this,"cacheVideoElement",void 0),ja(this,"renderStats",void 0),ja(this,"_videoState",PR.VideoStateStopped),ja(this,"videoElementCheckInterval",void 0),ja(this,"videoElementFreezeTimeout",void 0),ja(this,"_videoElementStatus",CS.NONE),ja(this,"isGettingVideoDimensions",!1),ja(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return A.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),ja(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&tT.curState==="running"&&(A.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(J4())),i8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),ja(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=CS.PLAYING;break;case"loadeddata":if(this.videoState=PR.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=CS.CANPLAY;break;case"stalled":this.videoElementStatus=CS.STALLED;break;case"suspend":this.videoElementStatus=CS.SUSPEND;break;case"pause":this.videoElementStatus=CS.PAUSED,ES()||P0()||ZT()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(A.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=CS.WAITING;break;case"abort":this.videoElementStatus=CS.ABORT;break;case"ended":this.videoElementStatus=CS.ENDED;break;case"emptied":this.videoElementStatus=CS.EMPTIED;break;case"error":{const o=this.videoElement.error;o?(this.videoElementStatus=CS.ERROR,A.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")"))):A.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const a=o-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,QR.lastVisibleTime<QR.lastHiddenTime||d<QR.lastHiddenTime||d<QR.lastVisibleTime)return;for(a>$("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=a),this.playbackTime+=a;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),ja(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(A.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(J4())),i8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),tT.on(uS.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tT.on(uS.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(a=>{e&&ZY(e,"video",a.message,this.trackId),a.name==="NotAllowedError"?(A.warning("detected video element autoplay failed",a),this.autoplayFailed=!0,this.handleAutoPlayFailed()):A.warning("[".concat(this.trackId,"] play warning: "),a)});const o=Y_();if((o.name==="Safari"&&Number(o.version)===15||XO())&&n&&n.then){const a=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(a).catch(a)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return A.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const o=n.getImageData(0,0,e.width,e.height);return e.remove(),o}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const a=o.getContext("2d");return a?(a.drawImage(this.videoElement,0,0,o.width,o.height),new n_((d,h)=>{o.toBlob(async p=>{if(o.remove(),p){const m=await s7(p);d({buffer:m,width:o.width,height:o.height})}else h(new ya(Y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await m3(e)}destroy(){this.renderStats=void 0,tT.off(uS.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tT.off(uS.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=PR.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=CS.INIT,!this.videoElementCheckInterval&&(q7.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(d){return d!==document.body&&document.body.contains(d)})(this.videoElement)||(this.videoElementStatus=CS.DESTROYED)},1e3),$("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let d;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(p,$("VIDEO_FREEZE_DURATION")))},p=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===PR.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=PR.VideoStateFrozen:document.addEventListener("visibilitychange",h))},m=(_,g)=>{if(this.videoElementStatus===CS.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=g.mediaTime):this.renderStats={lastTs:g.mediaTime,curTs:g.mediaTime,lastRenderNum:0,renderNum:0},d){const O=g.presentationTime-d.presentationTime;this.videoState===PR.VideoStateStarting&&(this.videoState=PR.VideoStateDecoding),this.videoState===PR.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(p,$("VIDEO_FREEZE_DURATION"))),O<$("VIDEO_FREEZE_DURATION")&&this.videoState===PR.VideoStateFrozen&&(this.videoState=PR.VideoStateDecoding),O>$("VIDEO_FREEZE_DURATION")&&QR.lastVisibleTime>=QR.lastHiddenTime&&d.timestamp>QR.lastVisibleTime&&d.timestamp>QR.lastHiddenTime&&(this.renderFreezeAccTime+=O)}d=_T(_T({},g),{},{timestamp:_})}var y,C;$("ENABLE_VIDEO_FRAME_CALLBACK")&&((y=(C=this.videoElement).requestVideoFrameCallback)===null||y===void 0||y.call(C,m))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,m)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),E1()&&!$("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=Y_();o.name==="Safari"&&Number(o.version)===15||XO()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,iT()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,iT()&&this.videoElement.load());const a=this.videoElement.play();a!==void 0&&a.catch(d=>{A.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){q7.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=CS.NONE}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{A.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{A.error(o)}),this.autoplayFailed=!1,fP()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};fP()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),QY()}}const q7=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class K7 extends E3{constructor(e){super(e),ja(this,"container",void 0),ja(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,o):await m3(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",$("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var z7,Y7,J7,X7,Q7,Z7,$7,tJ,eJ,nJ,rJ,iJ,oJ,sJ,aJ,cJ,uJ,dJ,lJ,hJ,pJ,fJ,mJ,EJ,_J,H_,gJ,vJ,bJ,yJ,TJ,SJ,RJ,CJ,l0;let aT=(z7=C_({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Y7=kT(),J7=C_({argsMap:t=>[t.getTrackId()]}),X7=$O("LocalVideoTrack","_enabledMutex"),Q7=C_({argsMap:(t,e)=>[t.getTrackId(),e]}),Z7=kT(),$7=$O("LocalVideoTrack","_enabledMutex"),tJ=C_({argsMap:(t,e)=>[t.getTrackId(),e]}),eJ=kT(),nJ=C_({argsMap:(t,e)=>[t.getTrackId(),e]}),rJ=kT(),iJ=kT(),oJ=C_({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),sJ=kT(),aJ=kT(),cJ=kT(),uJ=kT(),dJ=kT(),lJ=kT(),hJ=kT(),pJ=C_({argsMap:(t,e)=>[t.getTrackId(),e.name]}),fJ=C_({argsMap:t=>[t.getTrackId()]}),mJ=C_({argsMap:t=>[t.getTrackId()]}),EJ=C_({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),_J=C_(),H_=class SQ extends RN{get videoHeight(){if(ZT()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(ZT()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==CS.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,o,a,d,h){if(super(e,d),ja(this,"trackMediaType","video"),ja(this,"_player",void 0),ja(this,"isUseScaleResolutionDownBy",!1),ja(this,"_videoVisibleTimer",null),ja(this,"_statsTimer",null),ja(this,"_previousVideoVisibleStatus",void 0),ja(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ja(this,"_encoderConfig",void 0),ja(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),ja(this,"_optimizationMode",void 0),ja(this,"_videoHeight",void 0),ja(this,"_videoWidth",void 0),ja(this,"_forceBitrateLimit",void 0),ja(this,"_enabled",!0),ja(this,"_processorDestination",void 0),ja(this,"_processorContext",void 0),ZT()){const{width:p,height:m}=e.getSettings();this._videoWidth=p,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=o,this._optimizationMode=a,this._hints=h||[],this._hints.indexOf(lT.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(p,m,_){const g=Y_();return!(g.name!==p||!g.osVersion)&&Number(g.version)===m}(kv.CHROME,115)&&f1().indexOf("Windows")!==-1){const p=function(m,_){if("VideoFrame"in window&&"TransformStream"in window&&q_().supportWebRTCInsertableStream){const g=new MediaStreamTrackProcessor(m),y=new MediaStreamTrackGenerator({kind:"video"});let C,O,q=Date.now();const L=()=>{U&&(clearInterval(U),U=void 0),C&&(C.close(),C=void 0),m.stop(),O=void 0,y.removeEventListener("ended",L)};let U=window.setInterval(()=>{if(O&&C&&Date.now()-q>1e3)try{y.readyState==="live"?O.enqueue(C.clone()):L()}catch{L()}},1e3);const K=new TransformStream({transform:(J,_r)=>{y.readyState==="live"?(O=_r,q=Date.now(),C===void 0?(C=J,_r.enqueue(J.clone())):(_r.enqueue(C),C=J)):J.close()}});return y.addEventListener("ended",L),g.readable.pipeThrough(K).pipeTo(y.writable),y}}(e);p&&(A.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}n&&this._hints.indexOf(lT.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new t7(this.getTrackId(),"local"),this._processorDestination=new $Y(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const a=document.getElementById(e);a?e=a:(A.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}A.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const o=_T(_T(_T({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(o):(e instanceof HTMLVideoElement?this._player=new E3(o):this._player=new K7(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(TN.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},$("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,A.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await oT(this,c_.NEED_DISABLE_TRACK,this)}catch(o){throw A.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return n||(this._enabled=!1),void A.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await oT(this,c_.NEED_ENABLE_TRACK,this)}catch(o){throw A.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}A.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,A.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await oT(this,c_.NEED_MUTE_TRACK,this):await oT(this,c_.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,n){if(!this._enabled)throw new ya(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),e=NR(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const o=aM({encoderConfig:e});(ZT()||ES()||P0())&&(o.deviceId=void 0),A.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(a){const d=new ya(Y.UNEXPECTED_ERROR,a.toString());throw A.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=e,this._hints.indexOf(lT.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await oT(this,c_.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(A)}}getStats(){return pI(()=>{A.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),JS(this,c_.GET_STATS)||_T({},c3)}async setBeautyEffect(e){A.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await m3(e)}async setBitrateLimit(e){if(A.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e){this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate);try{await oT(this,c_.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(A)}}}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void A.error(Y.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await oT(this,c_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=n,A.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}A.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return A.error(Y.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,A.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){r7(this._originMediaStreamTrack).then(e=>{let[n,o]=e;this._videoHeight=o,this._videoWidth=n}).catch(v1)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new ya(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");A.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=NR(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(lT.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await oT(this,c_.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(A)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:o}=this.getMediaStreamTrackSettings();if(!e||!n||!o)return;const{bitrateMax:a,bitrateMin:d}=this._encoderConfig;if(d==null||a==null){const{max:h,min:p}=function(m,_,g,y,C){const O=$("BITRATE_ADAPTER_TYPE");if(O==="DEFAULT_BITRATE")return{min:y,max:C};if(C===void 0){var q;const U=Math.floor(200*Math.pow(g/15,.6)*Math.pow(m*_/640/360,.75));C=O==="STANDARD_BITRATE"?4*U:2*U,y=(q=y)!==null&&q!==void 0?q:U}else{var L;y=(L=y)!==null&&L!==void 0?L:Math.floor(C/10)}return{min:y,max:C}}(e,n,o,d,a);this._encoderConfig.bitrateMin=p,this._encoderConfig.bitrateMax=h,A.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(p,"]"))}}getVideoElementVisibleStatus(){try{var e,n;const o=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),a={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:d,slot:h}=a;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=l8.checkOneElementVisible(d),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const _=E_.reportApiInvoke(null,{tag:IT.TRACER,name:BT.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(o){throw new ya(Y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new ya(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;e&&(o=_T(_T({},o),NR(e))),o=ZI(o);const a=sT(8,"track-video-cloned-"),d=new SQ(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,ZI(this._scalabilityMode),this._optimizationMode,a,ZI(this._hints));return e&&o&&d.setEncoderConfiguration(o),A.debug("clone video track from ".concat(this.getTrackId()," to ").concat(a,", clone ").concat(n)),d}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new ya(Y.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new ya(Y.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!ZT()&&!ES())return;this._statsTimer&&window.clearInterval(this._statsTimer);let e=2,n=nM[e],o=-1,a=Date.now();const d=h=>{h>2||h<0||(a=Date.now(),n=nM[h],this.setSenderConfiguration(n))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{const h=this.getStats(),p=JS(this,c_.GET_RTC_STATS);if(h.sendPackets>0&&p){o===-1&&(o=Date.now());const m=Date.now();if(m-o<1e3||m-a<$("PROFILE_SWITCH_INTERVAL"))return;const _=h.sendFrameRate,g=.6*n.frameRate,y=.9*n.frameRate;typeof _=="number"&&_>0&&_<g?e>0&&(e--,d(e),A.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(_,", switchProfile to ").concat(e))):p.OutgoingAvailableBandwidth<n.bitrateMin?e>0&&(e--,d(e),A.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(p.OutgoingAvailableBandwidth,", bitrateMin ").concat(n.bitrateMin,", switchProfile to ").concat(e))):typeof _=="number"&&_>y&&e<nM.length-1&&p.OutgoingAvailableBandwidth>1.2*nM[e+1].bitrateMin&&(e++,d(e),A.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(_,", OutgoingAvailableBandwidth ").concat(p.OutgoingAvailableBandwidth,", switchProfile to ").concat(e)))}},$("CHECK_LOCAL_STATS_INTERVAL"))}sendSeiData(e){if(pI(()=>{E_.reportApiInvoke(null,{name:BT.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:IT.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!$("ENABLE_VIDEO_SEI")||!$("ENABLE_ENCODED_TRANSFORM"))return void A.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new ya(Y.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void A.warning("Video track is not published, SEI can not be send");const o=n.sender.getParameters();if(o.codecs.length===0)return;const a=o.codecs[0].mimeType.toLocaleLowerCase();a==="video/h264"?this.safeEmit("sei-to-send",e):A.warning("SEI is not supported by ".concat(a))}bindProcessorDestinationEvents(){this.processorDestination.on(LS.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await oT(this,c_.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oT(this,c_.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(LS.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(s0.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(s0.REQUEST_CONSTRAINTS)}},K_(H_.prototype,"play",[z7,Y7],Object.getOwnPropertyDescriptor(H_.prototype,"play"),H_.prototype),K_(H_.prototype,"stop",[J7],Object.getOwnPropertyDescriptor(H_.prototype,"stop"),H_.prototype),K_(H_.prototype,"setEnabled",[X7,Q7,Z7],Object.getOwnPropertyDescriptor(H_.prototype,"setEnabled"),H_.prototype),K_(H_.prototype,"setMuted",[$7,tJ,eJ],Object.getOwnPropertyDescriptor(H_.prototype,"setMuted"),H_.prototype),K_(H_.prototype,"setEncoderConfiguration",[nJ,rJ],Object.getOwnPropertyDescriptor(H_.prototype,"setEncoderConfiguration"),H_.prototype),K_(H_.prototype,"getStats",[iJ],Object.getOwnPropertyDescriptor(H_.prototype,"getStats"),H_.prototype),K_(H_.prototype,"setBeautyEffect",[oJ,sJ],Object.getOwnPropertyDescriptor(H_.prototype,"setBeautyEffect"),H_.prototype),K_(H_.prototype,"getCurrentFrameData",[aJ],Object.getOwnPropertyDescriptor(H_.prototype,"getCurrentFrameData"),H_.prototype),K_(H_.prototype,"getCurrentFrameImage",[cJ],Object.getOwnPropertyDescriptor(H_.prototype,"getCurrentFrameImage"),H_.prototype),K_(H_.prototype,"setBitrateLimit",[uJ],Object.getOwnPropertyDescriptor(H_.prototype,"setBitrateLimit"),H_.prototype),K_(H_.prototype,"setOptimizationMode",[dJ],Object.getOwnPropertyDescriptor(H_.prototype,"setOptimizationMode"),H_.prototype),K_(H_.prototype,"setScalabiltyMode",[lJ],Object.getOwnPropertyDescriptor(H_.prototype,"setScalabiltyMode"),H_.prototype),K_(H_.prototype,"updateMediaStreamTrackResolution",[hJ],Object.getOwnPropertyDescriptor(H_.prototype,"updateMediaStreamTrackResolution"),H_.prototype),K_(H_.prototype,"pipe",[pJ],Object.getOwnPropertyDescriptor(H_.prototype,"pipe"),H_.prototype),K_(H_.prototype,"unpipe",[fJ],Object.getOwnPropertyDescriptor(H_.prototype,"unpipe"),H_.prototype),K_(H_.prototype,"close",[mJ],Object.getOwnPropertyDescriptor(H_.prototype,"close"),H_.prototype),K_(H_.prototype,"replaceTrack",[EJ],Object.getOwnPropertyDescriptor(H_.prototype,"replaceTrack"),H_.prototype),K_(H_.prototype,"startMonitorStats",[_J],Object.getOwnPropertyDescriptor(H_.prototype,"startMonitorStats"),H_.prototype),H_),_3=(gJ=C_({argsMap:(t,e)=>[t.getTrackId(),e]}),vJ=kT(),bJ=$O("CameraVideoTrack","_enabledMutex"),yJ=C_({argsMap:(t,e)=>[t.getTrackId(),e]}),TJ=kT(),SJ=C_({argsMap:(t,e)=>[t.getTrackId(),e]}),RJ=kT(),CJ=C_({argsMap:t=>[t.getTrackId()]}),l0=class RQ extends aT{get __className__(){return"CameraVideoTrack"}constructor(e,n,o,a,d,h){super(e,NR(n.encoderConfig),a,d,h),ja(this,"_config",void 0),ja(this,"_originalConstraints",void 0),ja(this,"_constraints",void 0),ja(this,"_enabled",!0),ja(this,"_deviceName","default"),ja(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(XO()||DF())&&!function(){const p=Y_();if(p.os!==QT.IOS||!p.osVersion)return!1;const m=p.osVersion.split(".");return Number(m[0])===15&&Number(m[1])>=2}()&&o8()&&this._enabled&&!this._isClosed&&(A.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=o,this._constraints=o,this._deviceName=e.label,this._encoderConfig=NR(this._config.encoderConfig),tT.on(uS.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),tT.on(uS.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(A.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await u0.getDeviceById(e),o={};o.video=_T({},this._constraints),o.video.deviceId={exact:e},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let a=null;try{a=await c0(o,this.getTrackId())}catch(d){throw A.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),a=await c0({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await u0.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}A.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){A.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:_T(_T({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await c0(n,this.getTrackId())}catch(a){throw A.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),a.toString()),o=await c0({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=_T({},n.video),A.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await c0({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await oT(this,c_.NEED_ENABLE_TRACK,this)}catch(o){throw A.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),A.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await oT(this,c_.NEED_DISABLE_TRACK,this)}catch(o){throw A.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}A.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new ya(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),e=NR(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const o=dT(this._config);o.encoderConfig=e;const a=aM(o);(ZT()||ES()||P0())&&(a.deviceId=void 0),A.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(d){const h=new ya(Y.UNEXPECTED_ERROR,d.toString());throw A.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=a,this._originalConstraints=a,this._encoderConfig=e,this._hints.indexOf(lT.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await oT(this,c_.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(A)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ES()||P0())&&this._enabled&&!this._isClosed&&tT.duringInterruption){const e=async()=>{tT.off(uS.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(A.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};tT.on(uS.IOS_INTERRUPTION_END,e)}else A.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(TN.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,o=u0.searchDeviceIdByName(this._deviceName);if(o&&!n.deviceId&&(n.deviceId={exact:o}),this._enabled){const a=await c0({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),tT.off(uS.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),tT.off(uS.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;e&&(o=_T(_T({},o),NR(e))),o=ZI(o);const a=sT(8,"track-cam-cloned-"),d=new RQ(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,ZI(_T(_T({},this._config),{},{encoderConfig:o})),ZI(this._constraints),ZI(this._scalabilityMode),this._optimizationMode,a);return e&&o&&d.setEncoderConfiguration(o),A.debug("clone track from ".concat(this.getTrackId()," to ").concat(a,", clone ").concat(n)),d}bindProcessorContextEvents(){this.processorContext.on(s0.REQUEST_UPDATE_CONSTRAINTS,async(e,n,o)=>{try{const a=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(a),n()}catch(a){o(a)}}),this.processorContext.on(s0.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},K_(l0.prototype,"setDevice",[gJ,vJ],Object.getOwnPropertyDescriptor(l0.prototype,"setDevice"),l0.prototype),K_(l0.prototype,"setEnabled",[bJ,yJ,TJ],Object.getOwnPropertyDescriptor(l0.prototype,"setEnabled"),l0.prototype),K_(l0.prototype,"setEncoderConfiguration",[SJ,RJ],Object.getOwnPropertyDescriptor(l0.prototype,"setEncoderConfiguration"),l0.prototype),K_(l0.prototype,"close",[CJ],Object.getOwnPropertyDescriptor(l0.prototype,"close"),l0.prototype),l0);function g3(t,e,n,o){n.optimizationMode&&(o&&o.width&&o.height?(n.encoderConfig=_T(_T({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?A.debug("[".concat(t,"] set content hint to"),n.optimizationMode):A.debug("[".concat(t,"] set content hint failed")))):A.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var IJ,wJ,OJ,AJ,y0,NJ,PJ,DJ,kJ,LJ,MJ,IS;class UJ extends GY{getUserId(){return this._userId}constructor(e,n,o,a){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(a.clientId,"_").concat(sT(5,""))),ja(this,"_userId",void 0),ja(this,"_uintId",void 0),ja(this,"_isDestroyed",!1),ja(this,"store",void 0),ja(this,"processor",void 0),ja(this,"processorContext",void 0),this._userId=n,this._uintId=o,this.store=a}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,A.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let wN=(IJ=C_({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),wJ=C_({argsMap:t=>[t.getTrackId()]}),OJ=C_({argsMap:(t,e)=>[t.getTrackId(),e.name]}),AJ=C_({argsMap:t=>[t.getTrackId()]}),K_((y0=class extends UJ{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==CS.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,o){super(t,e,n,o),ja(this,"_videoVisibleTimer",null),ja(this,"_previousVideoVisibleStatus",void 0),ja(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ja(this,"trackMediaType","video"),ja(this,"_videoWidth",void 0),ja(this,"_videoHeight",void 0),ja(this,"_player",void 0),ja(this,"processorDestination",void 0),ja(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new t7(this.getTrackId(),"remote"),this.processorDestination=new $Y(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return pI(()=>{A.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),JS(this,c_.GET_STATS)||_T({},FY)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(A.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}A.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=_T(_T({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new E3(n):this._player=new K7(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(SN.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(SN.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(SN.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},$("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,A.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){r7(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(v1)}_updatePlayerSource(){A.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:a,slot:d}=o;if(this.isPlaying&&a instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=l8.checkOneElementVisible(a),p=Object.assign({},h);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;const m=E_.reportApiInvoke(null,{tag:IT.TRACER,name:BT.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(n){throw new ya(Y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new ya(Y.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(LS.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(LS.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(pO.SEI_RECEIVED,t)}}).prototype,"play",[IJ],Object.getOwnPropertyDescriptor(y0.prototype,"play"),y0.prototype),K_(y0.prototype,"stop",[wJ],Object.getOwnPropertyDescriptor(y0.prototype,"stop"),y0.prototype),K_(y0.prototype,"pipe",[OJ],Object.getOwnPropertyDescriptor(y0.prototype,"pipe"),y0.prototype),K_(y0.prototype,"unpipe",[AJ],Object.getOwnPropertyDescriptor(y0.prototype,"unpipe"),y0.prototype),y0),ON=(NJ=C_({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),PJ=C_({argsMap:(t,e)=>[t.getTrackId(),e]}),DJ=C_({argsMap:t=>[t.getTrackId()]}),kJ=C_({argsMap:t=>[t.getTrackId()]}),LJ=C_({argsMap:(t,e)=>[t.getTrackId(),e.name]}),MJ=C_({argsMap:t=>[t.getTrackId()]}),K_((IS=class extends UJ{get isPlaying(){return this._useAudioElement?xS.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,o){super(t,e,n,o),ja(this,"trackMediaType","audio"),ja(this,"_source",void 0),ja(this,"_useAudioElement",!0),ja(this,"_volume",100),ja(this,"processorContext",void 0),ja(this,"processorDestination",void 0),ja(this,"_played",!1),ja(this,"_bypassWebAudio",!1),$("DISABLE_WEBAUDIO")?(this._source=new f3,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new KY(t,!0),$("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(o0.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(SN.FIRST_FRAME_DECODED)}),this.processorContext=new n7(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new e7(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(o0.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(o0.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(o0.ON_AUDIO_BUFFER),this._source.on(o0.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?xS.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!xY())throw new ya(Y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await xS.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return pI(()=>{A.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),JS(this,c_.GET_STATS)||_T({},VY)}play(){A.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(A.debug("[".concat(this.getTrackId(),"] use audio element to play")),xS.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){A.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?xS.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];A.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&xS.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new ya(Y.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new ya(Y.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new ya(Y.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(LS.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(LS.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(LS.ON_TRACK),this.processorDestination.removeAllListeners(LS.ON_NODE)}}).prototype,"setVolume",[NJ],Object.getOwnPropertyDescriptor(IS.prototype,"setVolume"),IS.prototype),K_(IS.prototype,"setPlaybackDevice",[PJ],Object.getOwnPropertyDescriptor(IS.prototype,"setPlaybackDevice"),IS.prototype),K_(IS.prototype,"play",[DJ],Object.getOwnPropertyDescriptor(IS.prototype,"play"),IS.prototype),K_(IS.prototype,"stop",[kJ],Object.getOwnPropertyDescriptor(IS.prototype,"stop"),IS.prototype),K_(IS.prototype,"pipe",[LJ],Object.getOwnPropertyDescriptor(IS.prototype,"pipe"),IS.prototype),K_(IS.prototype,"unpipe",[MJ],Object.getOwnPropertyDescriptor(IS.prototype,"unpipe"),IS.prototype),IS);const QR=new class extends ET{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),ja(this,"_lastHiddenTime",0),ja(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),A.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};var xJ=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(xJ||{});class ppt{constructor(){ja(this,"_sequence",0),ja(this,"_startTime",Date.now()),ja(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const p=new Uint8Array(4);p.set([1,0,0,0]);const m={id:0,length:4,data:p.buffer},_={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[m]};n.commonPacketHeader.extension=1,n.extension=_,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;$("SHOW_DATASTREAM2_LOG")&&A.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const o=new ArrayBuffer(n.commonPacketHeader.length),a=new Uint8Array(o),d=new DataView(o);let h=0;if(d.setUint16(h,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),h+=2,d.setUint32(h,n.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,n.commonStreamHeader,!0),h+=2,n.extension){const p=this.serializeExtension(n.extension);a.set(new Uint8Array(p),h),h+=p.byteLength}if(a.set(new Uint8Array(n.payload),h),h+=n.payload.byteLength,h!==n.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let o=0;const a=n.getUint16(o,!0);o+=2;const d={length:16383&a,reserved:(16384&a)>>14,extension:(32768&a)>>15,sequence:n.getUint16(o+2,!0)<<16|n.getUint16(o,!0)};let h,p;if(o+=4,$("SHOW_DATASTREAM2_LOG")&&A.debug("receive data header: ".concat(JSON.stringify(d))),n.getUint16(o,!0),o+=2,d.extension){p=this.deserializeExtension(e.slice(o)),o+=2+p.length,h=e.slice(o);let m=!1;if(p.datas.length>0){const _=p.datas.find(g=>g.id===0);_&&(m=(1&new DataView(_.data).getUint32(0,!0))==1)}h=m?this.decompress(h):h}else h=e.slice(8);return h}serializeExtension(e){const{profile:n,length:o,datas:a}=e,d=new ArrayBuffer(o+2),h=new Uint8Array(d),p=new DataView(d);let m=0;if(p.setUint8(m++,n),p.setUint8(m++,o),a.forEach(_=>{n?(p.setUint8(m++,_.id),p.setUint8(m++,_.length),h.set(new Uint8Array(_.data),m),m+=_.data.byteLength):(p.setUint8(m++,_.id|_.length<<4),h.set(new Uint8Array(_.data),m),m+=_.data.byteLength)}),m!==o+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(o+2));return d}deserializeExtension(e){const n=new DataView(e);let o=0;const a=n.getUint8(o);o++;const d=n.getUint8(o);o++;const h=a===xJ.TWO_BYTE,p=[],m=new DataView(e,2);let _=0;for(;_<d;){let g=0,y=0,C=new ArrayBuffer(0);h?(g=m.getUint8(_),_++,y=m.getUint8(_),_++):(g=15&m.getUint8(_),y=m.getUint8(_)>>4,_++),y>0&&(C=m.buffer.slice(_+2,_+2+y),_+=C.byteLength),p.push({id:g,length:y,data:C})}if(_!==d)throw Error("parse error");return{profile:a,length:d,datas:p}}decompress(e){return Zht(new Uint8Array(e))}compress(e){return Qht(new Uint8Array(e))}}class jJ extends ET{constructor(e,n){super(),ja(this,"_version",1),ja(this,"_type",3),ja(this,"_config",void 0),ja(this,"_originDataChannel",void 0),ja(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),ja(this,"_dataStreamPacketHandler",void 0),ja(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader(),this._dataStreamPacketHandler=new ppt}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return $("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new n_((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const o=setTimeout(()=>{var a;n(new ya(Y.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((a=this._originDataChannel)===null||a===void 0?void 0:a.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new ya(Y.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new ya(Y.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[oM.OPEN,oM.CLOSE,oM.ERROR].forEach(n=>{const o=()=>{this.emit(n)};this._datachannelEventMap.set(n,o),e.addEventListener(n,o)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[o,a]=n;e.removeEventListener(o,a)}),this._datachannelEventMap.clear()}}class fpt extends jJ{constructor(e){super(e),ja(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=n.data.slice(0,this._dataStreamPacketHeader.byteLength),a=new DataView(o).getUint8(3);if(a!==this.id)return void($("SHOW_DATASTREAM2_LOG")&&A.debug("invalid datachannel id: ".concat(a," !== ").concat(this.id)));let d=n.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(oM.MESSAGE,d)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class VJ extends jJ{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function uM(){const t=new Blob([atob("ZnVuY3Rpb24gZShlKXtjb25zdCB0PW5ldyBEYXRhVmlldyhlLmRhdGEpO2lmKDA9PT10LmdldFVpbnQ4KDApJiYwPT09dC5nZXRVaW50OCgxKSYmMD09PXQuZ2V0VWludDgoMikmJjE9PT10LmdldFVpbnQ4KDMpJiY2PT09dC5nZXRVaW50OCg0KSl7bGV0IG49NixyPTAsbz0wO2Zvcig7MjU1PT09KG89dC5nZXRVaW50OChuKyspKTspcis9MjU1O3IrPW87Y29uc3QgYT1mdW5jdGlvbihlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLG89W10sYT0wO2Zvcig7YTxuOylhKzM8biYmMD09PXJbYV0mJjA9PT1yW2ErMV0mJjM9PT1yW2ErMl0mJigwPT09clthKzNdfHwxPT09clthKzNdfHwyPT09clthKzNdfHwzPT09clthKzNdKT8oby5wdXNoKHJbYV0sclthKzFdLHJbYSszXSksYSs9NCk6KG8ucHVzaChyW2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShvKX0oZS5kYXRhLG4scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGEpfXJldHVybiBudWxsfWZ1bmN0aW9uIHQoZSx0KXtjb25zdCBuPWZ1bmN0aW9uKGUpe2NvbnN0IHQ9ZS5sZW5ndGg7bGV0IG49W10scj0wO2Zvcig7cjx0OylyKzI8dCYmMD09PWVbcl0mJjA9PT1lW3IrMV0mJigwPT09ZVtyKzJdfHwxPT09ZVtyKzJdfHwyPT09ZVtyKzJdfHwzPT09ZVtyKzJdKT8obi5wdXNoKGVbcl0sZVtyKzFdLDMsZVtyKzJdKSxyKz0zKToobi5wdXNoKGVbcl0pLHIrKyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KG4pfSh0KSxyPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihyLzI1NSksYT1yJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK3IrZS5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBpPTA7Zm9yKDtpPG87KXNbNitpXT0yNTUsaSsrO3JldHVybiBzWzYraV09YSxpKysscy5zZXQobiw2K2kpLHMuc2V0KG5ldyBVaW50OEFycmF5KGUpLDYraStyKSxzLmJ1ZmZlcn1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlNhZmFyaSIpPi0xJiYtMT09PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiQ2hyb21lIikmJihzZWxmLm9ucnRjdHJhbnNmb3JtPW49Pntjb25zdCByPW4udHJhbnNmb3JtZXI7bGV0IG89W107ci5vcHRpb25zLnBvcnQub25tZXNzYWdlPWU9PntlLmRhdGEuc2VpJiZvLnB1c2goZS5kYXRhLnNlaSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBhPXIucmVhZGFibGUuZ2V0UmVhZGVyKCkscz1yLndyaXRhYmxlLmdldFdyaXRlcigpOyJyeCI9PT1yLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2EucmVhZCgpLnRoZW4oKHI9PntpZighci5kb25lKXtpZihyLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7YS5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1vLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>XK.revokeObjectURL(t),0),new Worker(XK.createObjectURL(t))}const dM=new Map,lM=new Map,hM=new Map;async function mpt(t,e){if(!q_().supportWebRTCEncodedTransform)return void A.warning("browser not support video encoded transform");if(hM.has(t)||!t.track)return;const n={track:t.track};if(lI()){if(!t.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");let a=null;try{a=t.createEncodedStreams()}catch(p){return void A.error("create video-encoded-streams error",p&&p.message)}let d=[];e.on("sei-to-send",p=>{d.push(p)});const h=new TransformStream({transform(p,m){n.controller||(n.controller=m),t.track&&t.track.id!==n.track.id&&(A.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",o),n.track=t.track,n.track.addEventListener("ended",o));const _=d.shift();_&&(p.data=function(g,y){const C=function(J){const _r=J.length;let _o=[],na=0;for(;na<_r;)na+2<_r&&J[na]===0&&J[na+1]===0&&(J[na+2]===0||J[na+2]===1||J[na+2]===2||J[na+2]===3)?(_o.push(J[na],J[na+1],3,J[na+2]),na+=3):(_o.push(J[na]),na++);return new Uint8Array(_o)}(y),O=C.length,q=Math.floor(O/255),L=O%255,U=new Uint8Array(6+q+1+O+g.byteLength);U[0]=0,U[1]=0,U[2]=0,U[3]=1,U[4]=6,U[5]=101;let K=0;for(;K<q;)U[6+K]=255,K++;return U[6+K]=L,K++,U.set(C,6+K),U.set(new Uint8Array(g),6+K+O),U.buffer}(p.data,_)),m.enqueue(p)}});a.readable.pipeThrough(h).pipeTo(a.writable)}else{if(!ZT())return;{if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");const a=uM(),d=new MessageChannel;await new n_(p=>a.onmessage=m=>{m.data==="registered"&&p(void 0)});const h=new RTCRtpScriptTransform(a,{name:"tx",port:d.port2},[d.port2]);t.transform=h,await new n_(p=>a.onmessage=m=>{m.data==="started"&&p(void 0)}),e.on("sei-to-send",p=>{d.port1.postMessage({sei:p})}),d.port1.onmessage=p=>{var m;p.data.transformed&&t.track&&((m=t.track)===null||m===void 0?void 0:m.id)!==n.track.id&&(A.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",o),n.track=t.track,n.track.addEventListener("ended",o))},n.worker=a}}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}const a=hM.get(t);if(a){hM.delete(t);try{var d,h;(d=a.controller)===null||d===void 0||d.terminate(),(h=a.worker)===null||h===void 0||h.terminate()}catch(p){A.warning(p&&p.message)}}}hM.set(t,n),t.track.addEventListener("ended",o)}const XP=new Map;async function Ept(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!q_().supportWebRTCEncodedTransform)return void A.warning("browser not support video encoded transform");if(!t.track)return;if(XP.has(t)){const a=XP.get(t);return void(a&&(a.onSei=e.onSei))}const n={track:t.track,onSei:e.onSei};if(lI()){if(!t.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");let a=null;try{a=t.createEncodedStreams()}catch(h){return void A.error("create video-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,p){n.controller||(n.controller=p),t.track&&t.track.id!==n.track.id&&(A.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",o),n.track=t.track,n.track.addEventListener("ended",o));const m=function(_){const g=new DataView(_.data);if(g.getUint8(0)===0&&g.getUint8(1)===0&&g.getUint8(2)===0&&g.getUint8(3)===1&&g.getUint8(4)===6){let y=6,C=0,O=0;for(;(O=g.getUint8(y++))===255;)C+=255;C+=O;const q=function(L,U,K){let J=new Uint8Array(L,U,K),_r=[],_o=0;for(;_o<K;)_o+3<K&&J[_o]===0&&J[_o+1]===0&&J[_o+2]===3&&(J[_o+3]===0||J[_o+3]===1||J[_o+3]===2||J[_o+3]===3)?(_r.push(J[_o],J[_o+1],J[_o+3]),_o+=4):(_r.push(J[_o]),_o++);return new Uint8Array(_r)}(_.data,y,C);return new Uint8Array(q)}return null}(h);m&&n.onSei&&n.onSei(m),p.enqueue(h)}});a.readable.pipeThrough(d).pipeTo(a.writable)}else if(ZT()){if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");const a=uM(),d=new MessageChannel;await new n_(p=>a.onmessage=m=>{m.data==="registered"&&p(void 0)});const h=new RTCRtpScriptTransform(a,{name:"rx",port:d.port2},[d.port2]);t.transform=h,await new n_(p=>a.onmessage=m=>{m.data==="started"&&p(void 0)}),d.port1.onmessage=p=>{var m;p.data.transformed&&t.track&&((m=t.track)===null||m===void 0?void 0:m.id)!==n.track.id?(A.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",o),n.track=t.track,n.track.addEventListener("ended",o)):p.data.sei&&n.onSei&&n.onSei(p.data.sei)},n.worker=a}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}(function(a){const d=XP.get(a);if(d){XP.delete(a);try{var h,p;(h=d.controller)===null||h===void 0||h.terminate(),(p=d.worker)===null||p===void 0||p.terminate()}catch(m){A.warning(m&&m.message)}}})(t)}XP.set(t,n),t.track.addEventListener("ended",o)}(function(){const t=Y_();pS.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),pS.getStreamFromExtension=t.name===kv.CHROME&&Number(t.version)>34,pS.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),pS.supportMinBitrate=t.name===kv.CHROME||t.name===kv.EDGE,pS.supportSetRtpSenderParameters=function(){const e=Y_();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!hI()||!(!ZT()&&!m1())||e.name===kv.FIREFOX&&Number(e.version)>=64)}(),t.name===kv.SAFARI&&(Number(t.version)>=14?pS.supportDualStream=!0:pS.supportDualStream=!1),pS.webAudioMediaStreamDest=function(){const e=Y_();return!(e.name===kv.SAFARI&&Number(e.version)<12)}(),pS.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",pS.supportWebGL=typeof WebGLRenderingContext<"u",pS.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,hI()||(pS.webAudioWithAEC=!0),pS.supportShareAudio=function(){const e=Y_();return(e.os===QT.WIN_10||e.os===QT.WIN_81||e.os===QT.WIN_7||e.os===QT.LINUX||e.os===QT.MAC_OS||e.os===QT.CHROMIUM_OS)&&e.name===kv.CHROME&&Number(e.version)>=74}(),pS.supportDataChannel=!!(PF(76)||function(e){const n=Y_();return!(n.name!==kv.FIREFOX||!n.osVersion)&&Number(n.version)>=e}(68)||Z4(14)),pS.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!iT()&&!!e&&e.prototype.setConfiguration instanceof Function}(),pS.supportWebRTCEncodedTransform=function(){const e=Y_();return e.name==="Chrome"&&Number(e.version)>=86||e.name==="Safari"&&Number(e.version)>=15}(),pS.supportWebRTCInsertableStream=function(){const e=Y_();return(e.name===kv.CHROME||e.name===kv.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),pS.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,pS.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,g1(()=>{pS.supportDualStreamEncoding=function(){const e=Y_();return!!$("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&$("CHROME_DUAL_STREAM_USE_ENCODING"))}(),A.info("browser compatibility",JSON.stringify(pS),JSON.stringify(t))})})();class _pt extends ET{constructor(){super(...arguments),F(this,"resultStorage",new Map)}setLocalAudioStats(e,n,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(o,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(o,n))}setLocalVideoStats(e,n,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(o,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(o,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(o))}setRemoteAudioStats(e,n){const o=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const o=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(n))}record(e,n,o){if($("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const a=this.resultStorage.get(e);if(a&&(a.result.push(o),a.result.length>=5)){var d;const h=o_(d=a.result).call(d,!0);a.isPrevNormal&&!h&&this.emit("exception",FJ[e],e,n),!a.isPrevNormal&&h&&this.emit("exception",FJ[e]+2e3,e+"_RECOVER",n),a.isPrevNormal=h,a.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof YT&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let o=null;n._encoderConfig&&n._encoderConfig.frameRate&&(o=BS(n._encoderConfig.frameRate));const a=e.captureFrameRate;return!o||!a||!(o>10&&a<5||o<10&&o>=5&&a<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof YT&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const FJ={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},gS=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const o=n[n.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const o=n[n.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function v3(t,e){this.v=t,this.k=e}function L_(t){return new v3(t,0)}var gpt=w2,vpt=_R;uT({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=vpt.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var bpt=_R,ypt=UO;uT({target:"Promise",stat:!0,forced:!0},{try:function(t){var e=bpt.f(this),n=ypt(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var b3=l(gpt),BJ=BO.f("asyncIterator"),Tpt=l(BJ);function QP(t){var e,n;function o(d,h){try{var p=t[d](h),m=p.value,_=m instanceof v3;b3.resolve(_?m.v:m).then(function(g){if(_){var y=d==="return"?"return":"next";if(!m.k||g.done)return o(y,g);g=t[y](g).value}a(p.done?"return":"normal",g)},function(g){o("throw",g)})}catch(g){a("throw",g)}}function a(d,h){switch(d){case"return":e.resolve({value:h,done:!0});break;case"throw":e.reject(h);break;default:e.resolve({value:h,done:!1})}(e=e.next)?o(e.key,e.arg):n=null}this._invoke=function(d,h){return new b3(function(p,m){var _={key:d,arg:h,resolve:p,reject:m,next:null};n?n=n.next=_:(e=n=_,o(d,h))})},typeof t.return!="function"&&(this.return=void 0)}function QS(t){return function(){return new QP(t.apply(this,arguments))}}QP.prototype[typeof WO=="function"&&Tpt||"@@asyncIterator"]=function(){return this},QP.prototype.next=function(t){return this._invoke("next",t)},QP.prototype.throw=function(t){return this._invoke("throw",t)},QP.prototype.return=function(t){return this._invoke("return",t)};var GJ=l(Q0.Object.getOwnPropertySymbols),Spt=uT,Rpt=eU.indexOf,Cpt=pL,y3=_m([].indexOf),HJ=!!y3&&1/y3([1],1,-0)<0;Spt({target:"Array",proto:!0,forced:HJ||!Cpt("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return HJ?y3(this,t,e)||0:Rpt(this,t,e)}});var Ipt=O0("Array").indexOf,wpt=Q,Opt=Ipt,T3=Array.prototype,Apt=function(t){var e=t.indexOf;return t===T3||wpt(T3,t)&&e===T3.indexOf?Opt:e},WJ=l(Apt);function Npt(t,e){if(t==null)return{};var n,o,a=function(h,p){if(h==null)return{};var m,_,g={},y=U8(h);for(_=0;_<y.length;_++)m=y[_],WJ(p).call(p,m)>=0||(g[m]=h[m]);return g}(t,e);if(GJ){var d=GJ(t);for(o=0;o<d.length;o++)n=d[o],WJ(e).call(e,n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}var qJ={exports:{}};(function(t,e){t.exports=(()=>{var n={8:(d,h,p)=>{p.r(h),p.d(h,{Parser:()=>W_,Printer:()=>J0,parse:()=>A_,print:()=>$_});const m=`
`,_="".concat("\r").concat(m),g=" ";let y;function C(i_){return i_>="0"&&i_<="9"}function O(i_){return i_>="!"&&i_<="~"}function q(i_){return O(i_)||i_>="Â"&&i_<="Ã¿"}function L(i_){return i_==="!"||i_>="#"&&i_<="'"||i_>="*"&&i_<="+"||i_>="-"&&i_<="."||i_>="0"&&i_<="9"||i_>="A"&&i_<="Z"||i_>="^"&&i_<="~"}function U(i_){return i_>="1"&&i_<="9"}function K(i_){return i_>="A"&&i_<="Z"||i_>="a"&&i_<="z"}function J(i_){return i_==="d"||i_==="h"||i_==="m"||i_==="s"}function _r(i_){return i_>""&&i_<"	"||i_>"\v"&&i_<"\f"||i_>""&&i_<"Ã¿"}function _o(i_){return K(i_)||C(i_)||i_==="+"||i_==="/"}function na(i_){return C(i_)||K(i_)||i_==="+"||i_==="/"||i_==="-"||i_==="_"}function ba(i_){return K(i_)||C(i_)||i_==="+"||i_==="/"}function _u(i_,j){var _t=Object.keys(i_);if(Object.getOwnPropertySymbols){var _n=Object.getOwnPropertySymbols(i_);j&&(_n=_n.filter(function(wE){return Object.getOwnPropertyDescriptor(i_,wE).enumerable})),_t.push.apply(_t,_n)}return _t}function _l(i_){for(var j=1;j<arguments.length;j++){var _t=arguments[j]!=null?arguments[j]:{};j%2?_u(Object(_t),!0).forEach(function(_n){_p(i_,_n,_t[_n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i_,Object.getOwnPropertyDescriptors(_t)):_u(Object(_t)).forEach(function(_n){Object.defineProperty(i_,_n,Object.getOwnPropertyDescriptor(_t,_n))})}return i_}function _p(i_,j,_t){return j in i_?Object.defineProperty(i_,j,{value:_t,enumerable:!0,configurable:!0,writable:!0}):i_[j]=_t,i_}(function(i_){i_.VERSION="v",i_.ORIGIN="o",i_.SESSION_NAME="s",i_.INFORMATION="i",i_.URI="u",i_.EMAIL="e",i_.PHONE="p",i_.CONNECTION="c",i_.BANDWIDTH="b",i_.TIME="t",i_.REPEAT="r",i_.ZONE_ADJUSTMENTS="z",i_.KEY="k",i_.ATTRIBUTE="a",i_.MEDIA="m"})(y||(y={}));class u_{consumeText(j,_t){let _n=_t;for(;_n<j.length;){const wE=j[_n];if(wE==="\0"||wE==="\r"||wE===m)break;_n+=1}if(_n-_t==0)throw new Error("Invalid text, at ".concat(j));return _n}consumeUnicastAddress(j,_t,_n){return this.consumeTill(j,_t,g)}consumeOneOrMore(j,_t,_n){let wE=_t;for(;_n(j[wE]);)wE++;if(wE-_t==0)throw new Error("Invalid rule at ".concat(_t,"."));return wE}consumeSpace(j,_t){if(j[_t]===g)return _t+1;throw new Error("Invalid space at ".concat(_t,"."))}consumeIP4Address(j,_t){let _n=_t;for(let wE=0;wE<4;wE++)if(_n=this.consumeDecimalUChar(j,_n),wE!==3){if(j[_n]!==".")throw new Error("Invalid IP4 address.");_n++}return _n}consumeDecimalUChar(j,_t){let _n=_t;for(let N_=0;N_<3&&C(j[_n]);N_++,_n++);if(_n-_t==0)throw new Error("Invalid decimal uchar.");const wE=parseInt(j.slice(_t,_n));if(wE>=0&&wE<=255)return _n;throw new Error("Invalid decimal uchar")}consumeIP6Address(j,_t){let _n=this.consumeHexpart(j,_t);return j[_n]===":"&&(_n+=1,_n=this.consumeIP4Address(j,_n)),_n}consumeHexpart(j,_t){let _n=_t;if(j[_n]===":"&&j[_n+1]===":"){_n+=2;try{_n=this.consumeHexseq(j,_n)}catch{}return _n}if(_n=this.consumeHexseq(j,_n),j[_n]===":"&&j[_n+1]===":"){_n+=2;try{_n=this.consumeHexseq(j,_n)}catch{}return _n}return _n}consumeHexseq(j,_t){let _n=_t;for(;_n=this.consumeHex4(j,_n),j[_n]===":"&&j[_n+1]!==":";)_n+=1;return _n}consumeHex4(j,_t){let _n=0;for(;_n<4;_n++)if(!((wE=j[_t+_n])>="0"&&wE<="9"||wE>="a"&&wE<="f"||wE>="A"&&wE<="F")){if(_n===0)throw new Error("Invalid hex 4");break}var wE;return _t+_n}consumeFQDN(j,_t){let _n=_t;for(;C(j[_n])||K(j[_n])||j[_n]==="-"||j[_n]===".";)_n+=1;if(_n-_t<4)throw new Error("Invalid FQDN");return _n}consumeExtnAddr(j,_t){return this.consumeOneOrMore(j,_t,q)}consumeMulticastAddress(j,_t,_n){switch(_n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(j,_t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(j,_t);default:try{return this.consumeFQDN(j,_t)}catch{return this.consumeExtnAddr(j,_t)}}}consumeIP6MulticastAddress(j,_t){const _n=this.consumeHexpart(j,_t);return j[_n]==="/"?this.consumeInteger(j,_n+1):_n}consumeIP4MulticastAddress(j,_t){let _n=_t+3;const wE=j.slice(_t,_n),N_=parseInt(wE);if(N_<224||N_>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let eT=0;eT<3;eT++){if(j[_n]!==".")throw new Error("Invalid IP4 multicast address.");_n+=1,_n=this.consumeDecimalUChar(j,_n)}return j[_n]==="/"&&(_n+=1),_n=this.consumeTTL(j,_n),j[_n]==="/"&&(_n=this.consumeInteger(j,_n)),_n}consumeInteger(j,_t){if(!U(j[_t]))throw new Error("Invalid integer.");for(_t+=1;C(j[_t]);)_t+=1;return _t}consumeTTL(j,_t){if(j[_t]==="0")return _t+1;if(!U(j[_t]))throw new Error("Invalid TTL.");_t+=1;for(let _n=0;_n<2&&C(j[_t]);_n++)_t+=1;return _t}consumeToken(j,_t){return this.consumeOneOrMore(j,_t,L)}consumeTime(j,_t){let _n=_t;if(j[_n]==="0")return _n+1;for(U(j[_n])&&(_n+=1);C(j[_n]);)_n++;if(_n-_t<10)throw new Error("Invalid time");return _n}consumeAddress(j,_t){return this.consumeTill(j,_t,g)}consumeTypedTime(j,_t){let _n=_t;return _n=this.consumeOneOrMore(j,_n,C),J(j[_n])?_n+1:_n}consumeRepeatInterval(j,_t){if(!U(j[_t]))throw new Error("Invalid repeat interval");for(_t+=1;C(j[_t]);)_t+=1;return J(j[_t])&&(_t+=1),_t}consumePort(j,_t){return this.consumeOneOrMore(j,_t,C)}consume(j,_t,_n){for(let wE=0;wE<_n.length;wE++){if(_t+wE>=j.length)throw new Error("consume exceeding value length");if(j[_t+wE]!==_n[wE])throw new Error("consume ".concat(_n," failed at ").concat(wE))}return _t+_n.length}consumeTill(j,_t,_n){let wE=_t;for(;wE<j.length&&(typeof _n!="string"||j[wE]!==_n)&&(typeof _n!="function"||!_n(j[wE]));)wE++;return wE}}class W_ extends u_{constructor(){super(),_p(this,"records",[]),_p(this,"currentLine",0)}parse(j){const _t=this.probeEOL(j);this.records=j.split(_t).filter(qT=>!!TS(qT).call(qT)).map(this.parseLine),this.currentLine=0;const _n=this.parseVersion(),wE=this.parseOrigin(),N_=this.parseSessionName(),eT=this.parseInformation(),XT=this.parseUri(),qS=this.parseEmail(),_C=this.parsePhone(),UM=this.parseConnection(),xM=this.parseBandWidth(),C0=this.parseTimeFields(),xI=this.parseKey(),xN=this.parseSessionAttribute(),LT=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:_n,origin:wE,sessionName:N_,information:eT,uri:XT,emails:qS,phones:_C,connection:UM,bandwidths:xM,timeFields:C0,key:xI,attributes:xN,mediaDescriptions:LT}}getCurrentRecord(){const j=this.records[this.currentLine];if(!j)throw new Error("Record doesn't exit.");return j}probeEOL(j){for(let _t=0;_t<j.length;_t++)if(j[_t]===m)return j[_t-1]==="\r"?_:m;throw new Error("Invalid newline character.")}parseLine(j,_t){if(j.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const _n=j[0];if(j[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:_n,value:j.slice(2),line:_t,cur:0}}parseSessionAttribute(){const j=new hT;for(;this.currentLine<this.records.length;){const _t=this.getCurrentRecord();if(_t.type!==y.ATTRIBUTE)break;const _n={attField:this.extractOneOrMore(_t,wE=>L(wE)&&wE!==":"),_cur:0};_t.value[_t.cur]===":"&&(_t.cur+=1,_n.attValue=this.extractOneOrMore(_t,_r)),j.parse(_n),this.currentLine++}return j.digest()}parseMediaAttributes(j){const _t=new FT(j);for(;this.currentLine<this.records.length;){const _n=this.getCurrentRecord();if(_n.type!==y.ATTRIBUTE)break;const wE={attField:this.extractOneOrMore(_n,N_=>L(N_)&&N_!==":"),_cur:0};_n.value[_n.cur]===":"&&(_n.cur+=1,wE.attValue=this.extractOneOrMore(_n,_r)),_t.parse(wE),this.currentLine++}return _t.digest()}parseKey(){const j=this.getCurrentRecord();if(j.type===y.KEY){if(j.value==="prompt"||j.value==="clear:"||j.value==="base64:"||j.value==="uri:")return j.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const j=this.getCurrentRecord();if(j.type===y.ZONE_ADJUSTMENTS){const _t=[];for(;;)try{const _n=this.extract(j,this.consumeTime);this.consumeSpaceForRecord(j);let wE=!1;j.value[j.cur]==="-"&&(wE=!0,j.cur+=1);const N_=this.extract(j,this.consumeTypedTime);_t.push({time:_n,typedTime:N_,back:wE})}catch{break}if(_t.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,_t}return[]}parseRepeat(){const j=[];for(;;){const _t=this.getCurrentRecord();if(_t.type!==y.REPEAT)break;{const _n=this.extract(_t,this.consumeRepeatInterval),wE=this.parseTypedTime(_t);j.push({repeatInterval:_n,typedTimes:wE}),this.currentLine++}}return j}parseTypedTime(j){const _t=[];for(;;)try{this.consumeSpaceForRecord(j),_t.push(this.extract(j,this.consumeTypedTime))}catch{break}if(_t.length===0)throw new Error("Invalid typed time.");return _t}parseTime(){const j=this.getCurrentRecord(),_t=this.extract(j,this.consumeTime);this.consumeSpaceForRecord(j);const _n=this.extract(j,this.consumeTime);return this.currentLine++,{startTime:_t,stopTime:_n}}parseBandWidth(){const j=[];for(;this.currentLine<this.records.length;){const _t=this.getCurrentRecord();if(_t.type!==y.BANDWIDTH)break;{const _n=this.extractOneOrMore(_t,L);if(_t.value[_t.cur]!==":")throw new Error("Invalid bandwidth field.");_t.cur++;const wE=this.extractOneOrMore(_t,C);j.push({bwtype:_n,bandwidth:wE}),this.currentLine++}}return j}parseVersion(){const j=this.getCurrentRecord();if(j.type!==y.VERSION)throw new Error("first sdp record must be version");const _t=j.value.slice(0,this.consumeOneOrMore(j.value,0,C));if(_t.length!==j.value.length)throw new Error('invalid proto version, "v='.concat(j.value,'"'));return this.currentLine++,_t}parseOrigin(){const j=this.getCurrentRecord();if(j.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const _t=this.extractOneOrMore(j,q);this.consumeSpaceForRecord(j);const _n=this.extractOneOrMore(j,C);this.consumeSpaceForRecord(j);const wE=this.extractOneOrMore(j,C);this.consumeSpaceForRecord(j);const N_=this.extractOneOrMore(j,L);this.consumeSpaceForRecord(j);const eT=this.extractOneOrMore(j,L);this.consumeSpaceForRecord(j);const XT=this.extract(j,this.consumeUnicastAddress);return this.currentLine++,{username:_t,sessId:_n,sessVersion:wE,nettype:N_,addrtype:eT,unicastAddress:XT}}parseSessionName(){const j=this.getCurrentRecord();if(j.type===y.SESSION_NAME){const _t=this.extract(j,this.consumeText);return this.currentLine++,_t}}parseInformation(){const j=this.getCurrentRecord();if(j.type!==y.INFORMATION)return;const _t=this.extract(j,this.consumeText);return this.currentLine++,_t}parseUri(){const j=this.getCurrentRecord();if(j.type===y.URI)return this.currentLine++,j.value}parseEmail(){const j=[];for(;;){const _t=this.getCurrentRecord();if(_t.type!==y.EMAIL)break;j.push(_t.value),this.currentLine++}return j}parsePhone(){const j=[];for(;;){const _t=this.getCurrentRecord();if(_t.type!==y.PHONE)break;j.push(_t.value),this.currentLine++}return j}parseConnection(){const j=this.getCurrentRecord();if(j.type===y.CONNECTION){const _t=this.extractOneOrMore(j,L);this.consumeSpaceForRecord(j);const _n=this.extractOneOrMore(j,L);this.consumeSpaceForRecord(j);const wE=this.extract(j,this.consumeAddress);return this.currentLine++,{nettype:_t,addrtype:_n,address:wE}}}parseMedia(){const j=this.getCurrentRecord(),_t=this.extract(j,this.consumeToken);this.consumeSpaceForRecord(j);let _n=this.extract(j,this.consumePort);j.value[j.cur]==="/"&&(j.cur+=1,_n+=this.extract(j,this.consumeInteger)),this.consumeSpaceForRecord(j);const wE=[];for(wE.push(this.extract(j,this.consumeToken));j.value[j.cur]==="/";)j.cur+=1,wE.push(this.extract(j,this.consumeToken));if(wE.length===0)throw new Error("Invalid proto");const N_=this.parseFmt(j);return this.currentLine++,{mediaType:_t,port:_n,protos:wE,fmts:N_}}parseTimeFields(){const j=[];for(;this.getCurrentRecord().type===y.TIME;){const _t=this.parseTime(),_n=this.parseRepeat(),wE=this.parseZone();j.push({time:_t,repeats:_n,zones:wE})}return j}parseMediaDescription(){const j=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const _t=this.parseMedia(),_n=this.parseInformation(),wE=this.parseConnections(),N_=this.parseBandWidth(),eT=this.parseKey(),XT=this.parseMediaAttributes(_t);j.push({media:_t,information:_n,connections:wE,bandwidths:N_,key:eT,attributes:XT})}return j}parseConnections(){const j=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)j.push(this.parseConnection());return j}parseFmt(j){const _t=[];for(;;)try{this.consumeSpaceForRecord(j),_t.push(this.extract(j,this.consumeToken))}catch{break}if(_t.length===0)throw new Error("Invalid fmts");return _t}extract(j,_t){for(var _n=arguments.length,wE=new Array(_n>2?_n-2:0),N_=2;N_<_n;N_++)wE[N_-2]=arguments[N_];const eT=_t.call(this,j.value,j.cur,...wE),XT=j.value.slice(j.cur,eT);return j.cur=eT,XT}extractOneOrMore(j,_t){const _n=this.consumeOneOrMore(j.value,j.cur,_t),wE=j.value.slice(j.cur,_n);return j.cur=_n,wE}consumeSpaceForRecord(j){if(j.value[j.cur]!==g)throw new Error("Invalid space at ".concat(j.cur,"."));j.cur+=1}}class _v extends u_{constructor(){super(...arguments),_p(this,"attributes",void 0),_p(this,"digested",!1)}extractOneOrMore(j,_t,_n){const wE=this.consumeOneOrMore(j.attValue,j._cur,_t),N_=j.attValue.slice(j._cur,wE),[eT,XT]=_n||[];if(typeof eT=="number"&&N_.length<eT)throw new Error("error in length, should be more or equal than ".concat(eT," characters."));if(typeof XT=="number"&&N_.length>XT)throw new Error("error in length, should be less or equal than ".concat(XT," characters."));return j._cur=wE,N_}consumeAttributeSpace(j){if(j.attValue[j._cur]!==g)throw new Error("Invalid space at ".concat(j._cur,"."));j._cur+=1}extract(j,_t){if(!j.attValue)throw new Error("Nothing to extract from attValue.");for(var _n=arguments.length,wE=new Array(_n>2?_n-2:0),N_=2;N_<_n;N_++)wE[N_-2]=arguments[N_];const eT=_t.call(this,j.attValue,j._cur,...wE),XT=j.attValue.slice(j._cur,eT);return j._cur=eT,XT}atEnd(j){if(!j.attValue)throw new Error;return j._cur>=j.attValue.length}peekChar(j){if(!j.attValue)throw new Error;return j.attValue[j._cur]}peek(j,_t){if(!j.attValue)throw new Error;for(let _n=0;_n<_t.length;_n++)if(_t[_n]!==j.attValue[j._cur+_n])return!1;return!0}parseIceUfrag(j){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(j,_o,[4,256])}parseIcePwd(j){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(j,_o,[22,256])}parseIceOptions(j){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const _t=[];for(;!this.atEnd(j);){_t.push(this.extractOneOrMore(j,_o));try{this.consumeAttributeSpace(j)}catch(_n){if(this.atEnd(j))break;throw _n}}this.attributes.iceOptions=_t}parseFingerprint(j){const _t=this.extract(j,this.consumeToken);this.consumeAttributeSpace(j);const _n=this.extract(j,this.consumeTill);this.attributes.fingerprints.push({hashFunction:_t,fingerprint:_n})}parseExtmap(j){const _t=this.extractOneOrMore(j,C);let _n;this.peekChar(j)==="/"&&(this.extract(j,this.consume,"/"),_n=this.extract(j,this.consumeToken)),this.consumeAttributeSpace(j);const wE=this.extract(j,this.consumeTill,g),N_=_l(_l({entry:parseInt(_t,10)},_n&&{direction:_n}),{},{extensionName:wE});this.peekChar(j)===g&&(this.consumeAttributeSpace(j),N_.extensionAttributes=this.extract(j,this.consumeTill)),this.attributes.extmaps.push(N_)}parseSetup(j){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const _t=this.extract(j,this.consumeTill);if(_t!=="active"&&_t!=="passive"&&_t!=="actpass"&&_t!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=_t}}class hT extends _v{constructor(){super(...arguments),_p(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(j){if(this.digested)throw new Error("already digested");try{switch(j.attField){case"group":this.parseGroup(j);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(j);break;case"ice-pwd":this.parseIcePwd(j);break;case"ice-options":this.parseIceOptions(j);break;case"fingerprint":this.parseFingerprint(j);break;case"setup":this.parseSetup(j);break;case"tls-id":this.parseTlsId(j);break;case"identity":this.parseIdentity(j);break;case"extmap":this.parseExtmap(j);break;case"msid-semantic":this.parseMsidSemantic(j);break;default:j.ignored=!0,this.attributes.unrecognized.push(j)}}catch(_t){throw console.error("parsing session attribute ".concat(j.attField,' error, "a=').concat(j.attField,":").concat(j.attValue,'"')),_t}if(!j.ignored&&j.attValue&&!this.atEnd(j))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(j){const _t=this.extract(j,this.consumeToken),_n=[];for(;!this.atEnd(j)&&this.peekChar(j)===g;)this.consumeAttributeSpace(j),_n.push(this.extract(j,this.consumeToken));this.attributes.groups.push({semantic:_t,identificationTag:_n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(j){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(j,na)}parseIdentity(j){const _t=this.extractOneOrMore(j,ba),_n=[];for(;!this.atEnd(j)&&this.peekChar(j)===g;){this.consumeAttributeSpace(j);const wE=this.extract(j,this.consumeToken);this.extract(j,this.consume,"=");const N_=this.extractOneOrMore(j,eT=>eT!==g&&_r(eT));_n.push({name:wE,value:N_})}this.attributes.identities.push({assertionValue:_t,extensions:_n})}parseMsidSemantic(j){this.peekChar(j)===g&&this.consumeAttributeSpace(j);const _t={semantic:this.extract(j,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(j)}catch{break}if(this.peekChar(j)==="*"){this.extract(j,this.consume,"*"),_t.applyForAll=!0;break}{const _n=this.extract(j,this.consumeTill,g);_t.identifierList.push(_n)}}this.attributes.msidSemantic=_t}}class FT extends _v{constructor(j){super(),_p(this,"attributes",void 0),j.protos.indexOf("RTP")!==-1||j.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(j){if(this.digested)throw new Error("already digested");try{switch(j.attField){case"extmap":this.parseExtmap(j);break;case"setup":this.parseSetup(j);break;case"ice-ufrag":this.parseIceUfrag(j);break;case"ice-pwd":this.parseIcePwd(j);break;case"ice-options":this.parseIceOptions(j);break;case"candidate":this.parseCandidate(j);break;case"remote-candidate":this.parseRemoteCandidate(j);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(j);break;case"rtpmap":this.parseRtpmap(j);break;case"ptime":this.parsePtime(j);break;case"maxptime":this.parseMaxPtime(j);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(j);break;case"ssrc":this.parseSSRC(j);break;case"fmtp":this.parseFmtp(j);break;case"rtcp-fb":this.parseRtcpFb(j);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(j);break;case"mid":this.parseMid(j);break;case"msid":this.parseMsid(j);break;case"imageattr":this.parseImageAttr(j);break;case"rid":this.parseRid(j);break;case"simulcast":this.parseSimulcast(j);break;case"sctp-port":this.parseSctpPort(j);break;case"max-message-size":this.parseMaxMessageSize(j);break;case"ssrc-group":this.parseSSRCGroup(j);break;default:j.ignored=!0,this.attributes.unrecognized.push(j)}}catch(_t){throw console.error("parsing media attribute ".concat(j.attField,' error, "a=').concat(j.attField,":").concat(j.attValue,'"')),_t}if(!j.ignored&&j.attValue&&!this.atEnd(j))throw new Error("attribute parsing error")}parseCandidate(j){const _t=this.extractOneOrMore(j,_o,[1,32]);this.consumeAttributeSpace(j);const _n=this.extractOneOrMore(j,C,[1,5]);this.consumeAttributeSpace(j);const wE=this.extract(j,this.consumeToken);this.consumeAttributeSpace(j);const N_=this.extractOneOrMore(j,C,[1,10]);this.consumeAttributeSpace(j);const eT=this.extract(j,this.consumeAddress);this.consumeAttributeSpace(j);const XT=this.extract(j,this.consumePort);this.consumeAttributeSpace(j),this.extract(j,this.consume,"typ"),this.consumeAttributeSpace(j);const qS={foundation:_t,componentId:_n,transport:wE,priority:N_,connectionAddress:eT,port:XT,type:this.extract(j,this.consumeToken),extension:{}};for(this.peek(j," raddr")&&(this.extract(j,this.consume," raddr"),this.consumeAttributeSpace(j),qS.relAddr=this.extract(j,this.consumeAddress)),this.peek(j," rport")&&(this.extract(j,this.consume," rport"),this.consumeAttributeSpace(j),qS.relPort=this.extract(j,this.consumePort));this.peekChar(j)===g;){this.consumeAttributeSpace(j);const _C=this.extract(j,this.consumeToken);this.consumeAttributeSpace(j),qS.extension[_C]=this.extractOneOrMore(j,O)}this.attributes.candidates.push(qS)}parseRemoteCandidate(j){const _t=[];for(;;){const _n=this.extractOneOrMore(j,C,[1,5]);this.consumeAttributeSpace(j);const wE=this.extract(j,this.consumeAddress);this.consumeAttributeSpace(j);const N_=this.extract(j,this.consumePort);_t.push({componentId:_n,connectionAddress:wE,port:N_});try{this.consumeAttributeSpace(j)}catch{break}}this.attributes.remoteCandidatesList.push(_t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(j){const _t=this.extract(j,this.consumeToken);this.consumeAttributeSpace(j);const _n=this.extract(j,this.consumeTill,"/");this.extract(j,this.consume,"/");const wE={encodingName:_n,clockRate:this.extractOneOrMore(j,C)};this.atEnd(j)||this.peekChar(j)!=="/"||(this.extract(j,this.consume,"/"),wE.encodingParameters=parseInt(this.extract(j,this.consumeTill),10));const N_=this.attributes.payloads.find(eT=>eT.payloadType===parseInt(_t,10));N_?N_.rtpMap=wE:this.attributes.payloads.push({payloadType:parseInt(_t,10),rtpMap:wE,rtcpFeedbacks:[]})}parsePtime(j){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(j,this.consumeTill)}parseMaxPtime(j){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(j,this.consumeTill)}parseDirection(j){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=j.attField}parseSSRC(j){const _t=this.extractOneOrMore(j,C);this.consumeAttributeSpace(j);const _n=this.extract(j,this.consumeTill,":");let wE;this.peekChar(j)===":"&&(this.extract(j,this.consume,":"),wE=this.extract(j,this.consumeTill));const N_=this.attributes.ssrcs.find(eT=>eT.ssrcId===parseInt(_t,10));N_?N_.attributes[_n]=wE:this.attributes.ssrcs.push({ssrcId:parseInt(_t,10),attributes:{[_n]:wE}})}parseFmtp(j){const _t=this.extract(j,this.consumeTill,g);this.consumeAttributeSpace(j);const _n=this.extract(j,this.consumeTill),wE={};_n.split(";").forEach(eT=>{let[XT,qS]=eT.split("=");XT=TS(XT).call(XT);const _C=typeof qS=="string"?TS(qS).call(qS):null;typeof XT=="string"&&XT.length>0&&(wE[XT]=_C)});const N_=this.attributes.payloads.find(eT=>eT.payloadType===parseInt(_t,10));N_?N_.fmtp={parameters:wE}:this.attributes.payloads.push({payloadType:parseInt(_t,10),rtcpFeedbacks:[],fmtp:{parameters:wE}})}parseFmtParameters(j){const _t={},_n=this.extract(j,this.consumeTill,"=");j._cur++;const wE=this.extract(j,this.consumeTill,";");for(_t[_n]=wE;j.attValue[j._cur]===";";){const N_=this.extract(j,this.consumeTill,"=");j._cur++;const eT=this.extract(j,this.consumeTill,";");_t[N_]=eT}return _t}parseRtcpFb(j){let _t="";_t=this.peekChar(j)==="*"?this.extract(j,this.consume,"*"):this.extract(j,this.consumeTill,g),this.consumeAttributeSpace(j);const _n=this.extract(j,this.consumeTill,g);let wE;if(_n==="trr-int")wE={type:_n,interval:this.extract(j,this.consumeTill)};else{const N_={type:_n};this.peekChar(j)===g&&(this.consumeAttributeSpace(j),N_.parameter=this.extract(j,this.consumeToken),this.peekChar(j)===g&&(N_.additional=this.extract(j,this.consumeTill))),wE=N_}if(_t==="*")this.attributes.rtcpFeedbackWildcards.push(wE);else{const N_=this.attributes.payloads.find(eT=>eT.payloadType===parseInt(_t,10));N_?N_.rtcpFeedbacks.push(wE):this.attributes.payloads.push({payloadType:parseInt(_t,10),rtcpFeedbacks:[wE]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(j){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const _t={port:this.extract(j,this.consumePort)};this.peekChar(j)===g&&(this.consumeAttributeSpace(j),_t.netType=this.extractOneOrMore(j,L),this.consumeAttributeSpace(j),_t.addressType=this.extractOneOrMore(j,L),this.consumeAttributeSpace(j),_t.address=this.extract(j,this.consumeAddress)),this.attributes.rtcp=_t}parseMsid(j){const _t={id:this.extractOneOrMore(j,L,[1,64])};this.peekChar(j)===g&&(this.consumeAttributeSpace(j),_t.appdata=this.extractOneOrMore(j,L,[1,64])),this.attributes.msids.push(_t)}parseImageAttr(j){this.attributes.imageattr.push(j.attValue)}parseRid(j){const _t=this.extractOneOrMore(j,wE=>K(wE)||C(wE)||wE==="_"||wE==="-");this.consumeAttributeSpace(j);const _n={id:_t,direction:this.extract(j,this.consumeToken),params:[]};if(this.peekChar(j)===g){if(this.consumeAttributeSpace(j),this.peek(j,"pt=")){this.extract(j,this.consume,"pt=");const wE=[];for(;;){const N_=this.extract(j,this.consumeToken);wE.push(N_);try{this.extract(j,this.consume,",")}catch{break}}_n.payloads=wE,this.peekChar(j)===g&&this.extract(j,this.consume,g)}for(;;){const wE=this.extract(j,this.consumeToken);switch(wE){case"depend":{const N_={type:wE,rids:this.extract(j,this.consume,"=").split(",")};_n.params.push(N_);break}default:{const N_={type:wE};this.peekChar(j)==="="&&(this.extract(j,this.consume,"="),N_.val=this.extract(j,this.consumeTill,";")),_n.params.push(N_)}}try{this.extract(j,this.consume,";")}catch{break}}}this.attributes.rids.push(_n)}parseSimulcast(j){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=j.attValue,this.extract(j,this.consumeTill)}parseSctpPort(j){this.attributes.sctpPort=this.extractOneOrMore(j,C,[1,5])}parseMaxMessageSize(j){this.attributes.maxMessageSize=this.extractOneOrMore(j,C,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(j){this.attributes.mid=this.extract(j,this.consumeToken)}parseSSRCGroup(j){const _t=this.extract(j,this.consumeToken),_n=[];for(;;)try{this.consumeAttributeSpace(j);const wE=this.extract(j,this.consumeInteger);_n.push(parseInt(wE,10))}catch{break}this.attributes.ssrcGroups.push({semantic:_t,ssrcIds:_n})}}function ST(i_,j,_t){return j in i_?Object.defineProperty(i_,j,{value:_t,enumerable:!0,configurable:!0,writable:!0}):i_[j]=_t,i_}class J0{constructor(){ST(this,"eol",_)}print(j,_t){let _n="";return _t&&(this.eol=_t),_n+=this.printVersion(j.version),_n+=this.printOrigin(j.origin),_n+=this.printSessionName(j.sessionName),_n+=this.printInformation(j.information),_n+=this.printUri(j.uri),_n+=this.printEmail(j.emails),_n+=this.printPhone(j.phones),_n+=this.printConnection(j.connection),_n+=this.printBandwidth(j.bandwidths),_n+=this.printTimeFields(j.timeFields),_n+=this.printKey(j.key),_n+=this.printSessionAttributes(j.attributes),_n+=this.printMediaDescription(j.mediaDescriptions),_n}printVersion(j){return"v=".concat(j).concat(this.eol)}printOrigin(j){return"o=".concat(j.username," ").concat(j.sessId," ").concat(j.sessVersion," ").concat(j.nettype," ").concat(j.addrtype," ").concat(j.unicastAddress).concat(this.eol)}printSessionName(j){return j?"s=".concat(j).concat(this.eol):""}printInformation(j){return j?"i=".concat(j).concat(this.eol):""}printUri(j){return j?"u=".concat(j).concat(this.eol):""}printEmail(j){let _t="";for(const _n of j)_t+="e=".concat(_n).concat(this.eol);return _t}printPhone(j){let _t="";for(const _n of j)_t+="e=".concat(_n).concat(this.eol);return _t}printConnection(j){return j?"c=".concat(j.nettype," ").concat(j.addrtype," ").concat(j.address).concat(this.eol):""}printBandwidth(j){let _t="";for(const _n of j)_t+="b=".concat(_n.bwtype,":").concat(_n.bandwidth).concat(this.eol);return _t}printTimeFields(j){let _t="";for(const _n of j){_t+="t=".concat(_n.time.startTime," ").concat(_n.time.startTime).concat(this.eol);for(const wE of _n.repeats)_t+="r=".concat(wE.repeatInterval," ").concat(wE.typedTimes.join(" ")).concat(this.eol);_n.zoneAdjustments&&(_t+="z=",_t+="z=".concat(_n.zoneAdjustments.map(wE=>"".concat(wE.time," ").concat(wE.back?"-":""," ").concat(wE.typedTime)).join(" ")).concat(this.eol),_t+=this.eol)}return _t}printKey(j){return j?"k=".concat(j).concat(this.eol):""}printAttributes(j){let _t="";for(const _n of j)_t+="a=".concat(_n.attField).concat(_n.attValue?":".concat(_n.attValue):"").concat(this.eol);return _t}printMediaDescription(j){let _t="";for(const _n of j)_t+=this.printMedia(_n.media),_t+=this.printInformation(_n.information),_t+=this.printConnections(_n.connections),_t+=this.printBandwidth(_n.bandwidths),_t+=this.printKey(_n.key),_t+=this.printMediaAttributes(_n);return _t}printConnections(j){let _t="";for(const _n of j)_t+=this.printConnection(_n);return _t}printMedia(j){return"m=".concat(j.mediaType," ").concat(j.port," ").concat(j.protos.join("/")," ").concat(j.fmts.join(" ")).concat(this.eol)}printSessionAttributes(j){return new t_(this.eol).print(j)}printMediaAttributes(j){return new f_(this.eol).print(j)}}class _h{constructor(j){ST(this,"eol",void 0),this.eol=j}printIceUfrag(j){return j===void 0?"":"a=ice-ufrag:".concat(j).concat(this.eol)}printIcePwd(j){return j===void 0?"":"a=ice-pwd:".concat(j).concat(this.eol)}printIceOptions(j){return j===void 0?"":"a=ice-options:".concat(j.join(g)).concat(this.eol)}printFingerprints(j){return j.length>0?j.map(_t=>"a=fingerprint:".concat(_t.hashFunction).concat(g).concat(_t.fingerprint)).join(this.eol)+this.eol:""}printExtmap(j){return j.map(_t=>"a=extmap:".concat(_t.entry).concat(_t.direction?"/".concat(_t.direction):"").concat(g).concat(_t.extensionName).concat(_t.extensionAttributes?"".concat(g).concat(_t.extensionAttributes):"").concat(this.eol)).join("")}printSetup(j){return j===void 0?"":"a=setup:".concat(j).concat(this.eol)}printUnrecognized(j){return j.map(_t=>"a=".concat(_t.attField).concat(_t.attValue?":".concat(_t.attValue):"").concat(this.eol)).join("")}}class t_ extends _h{print(j){let _t="";return _t+=this.printGroups(j.groups),_t+=this.printMsidSemantic(j.msidSemantic),_t+=this.printIceLite(j.iceLite),_t+=this.printIceUfrag(j.iceUfrag),_t+=this.printIcePwd(j.icePwd),_t+=this.printIceOptions(j.iceOptions),_t+=this.printFingerprints(j.fingerprints),_t+=this.printSetup(j.setup),_t+=this.printTlsId(j.tlsId),_t+=this.printIdentity(j.identities),_t+=this.printExtmap(j.extmaps),_t+=this.printUnrecognized(j.unrecognized),_t}printGroups(j){let _t="";return j.length>0&&(_t+=j.map(_n=>"a=group:".concat(_n.semantic).concat(_n.identificationTag.map(wE=>"".concat(g).concat(wE)).join("")).concat(this.eol)).join("")),_t}printIceLite(j){return j===void 0?"":"a=ice-lite"+this.eol}printTlsId(j){return j?"a=tls-id:".concat(j).concat(this.eol):""}printIdentity(j){return j.length===0?"":j.map(_t=>"a=identity:".concat(_t.assertionValue).concat(_t.extensions.map(_n=>"".concat(g).concat(_n.name).concat(_n.value?"=".concat(_n.value):"")))).join(this.eol)+this.eol}printMsidSemantic(j){if(!j)return"";let _t="a=msid-semantic:".concat(j.semantic);return j.applyForAll?_t+="".concat(g,"*"):j.identifierList.length>0&&(_t+=j.identifierList.map(_n=>"".concat(g).concat(_n))),_t+this.eol}}class f_ extends _h{print(j){const _t=j.attributes;let _n="";return _n+=this.printRTCP(_t.rtcp),_n+=this.printIceUfrag(_t.iceUfrag),_n+=this.printIcePwd(_t.icePwd),_n+=this.printIceOptions(_t.iceOptions),_n+=this.printCandidates(_t.candidates),_n+=this.printRemoteCandidatesList(_t.remoteCandidatesList),_n+=this.printEndOfCandidates(_t.endOfCandidates),_n+=this.printFingerprints(_t.fingerprints),_n+=this.printSetup(_t.setup),_n+=this.printMid(_t.mid),_n+=this.printExtmap(_t.extmaps),_n+=this.printRTPRelated(_t),_n+=this.printPtime(_t.ptime),_n+=this.printMaxPtime(_t.maxPtime),_n+=this.printDirection(_t.direction),_n+=this.printSSRCGroups(_t.ssrcGroups),_n+=this.printSSRC(_t.ssrcs),_n+=this.printRTCPMux(_t.rtcpMux),_n+=this.printRTCPMuxOnly(_t.rtcpMuxOnly),_n+=this.printRTCPRsize(_t.rtcpRsize),_n+=this.printMSId(_t.msids),_n+=this.printImageattr(_t.imageattr),_n+=this.printRid(_t.rids),_n+=this.printSimulcast(_t.simulcast),_n+=this.printSCTPPort(_t.sctpPort),_n+=this.printMaxMessageSize(_t.maxMessageSize),_n+=this.printUnrecognized(_t.unrecognized),_n}printCandidates(j){return j.map(_t=>"a=candidate:".concat(_t.foundation).concat(g).concat(_t.componentId).concat(g).concat(_t.transport).concat(g).concat(_t.priority).concat(g).concat(_t.connectionAddress).concat(g).concat(_t.port).concat(g,"typ").concat(g).concat(_t.type).concat(_t.relAddr?"".concat(g,"raddr").concat(g).concat(_t.relAddr):"").concat(_t.relPort?"".concat(g,"rport").concat(g).concat(_t.relPort):"").concat(Object.keys(_t.extension).map(_n=>"".concat(g).concat(_n).concat(g).concat(_t.extension[_n])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(j){return j.map(_t=>"a=remote-candidates:".concat(_t.join(g)).concat(this.eol)).join("")}printEndOfCandidates(j){return j===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(j){if(!j.payloads)return"";const _t=j.payloads;let _n="";_n+=j.rtcpFeedbackWildcards.map(wE=>this.printRTCPFeedback("*",wE)).join("");for(const wE of _t)_n+=this.printRtpMap(wE.payloadType,wE.rtpMap),_n+=this.printFmtp(wE.payloadType,wE.fmtp),_n+=wE.rtcpFeedbacks.map(N_=>this.printRTCPFeedback(wE.payloadType,N_)).join("");return _n}printFmtp(j,_t){if(!_t)return"";const _n=Object.keys(_t.parameters);return _n.length===1&&_t.parameters[_n[0]]===null?"a=fmtp:".concat(j).concat(g).concat(_n[0]).concat(this.eol):"a=fmtp:".concat(j).concat(g).concat(Object.keys(_t.parameters).map(wE=>"".concat(wE,"=").concat(_t.parameters[wE])).join(";")).concat(this.eol)}printRtpMap(j,_t){return _t?"a=rtpmap:".concat(j).concat(g).concat(_t.encodingName,"/").concat(_t.clockRate).concat(_t.encodingParameters?"/".concat(_t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(j,_t){let _n="a=rtcp-fb:".concat(j).concat(g),wE=_t;return wE.type==="trr-int"?_n+="ttr-int".concat(g).concat(wE.interval):(_n+="".concat(wE.type),wE.parameter&&(_n+="".concat(g).concat(wE.parameter),wE.additional&&(_n+="".concat(g).concat(wE.additional)))),_n+this.eol}printPtime(j){return j===void 0?"":"a=ptime:".concat(j).concat(this.eol)}printMaxPtime(j){return j===void 0?"":"a=maxptime:".concat(j).concat(this.eol)}printDirection(j){return j===void 0?"":"a=".concat(j).concat(this.eol)}printSSRC(j){return j.map(_t=>Object.keys(_t.attributes).map(_n=>"a=ssrc:".concat(_t.ssrcId.toString(10)).concat(g).concat(_n).concat(_t.attributes[_n]?":".concat(_t.attributes[_n]):"").concat(this.eol)).join("")).join("")}printRTCPMux(j){return j===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(j){return j===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(j){return j===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(j){if(j===void 0)return"";let _t="a=rtcp:".concat(j.port);return j.netType&&(_t+="".concat(g).concat(j.netType)),j.addressType&&(_t+="".concat(g).concat(j.addressType)),j.address&&(_t+="".concat(g).concat(j.address)),_t+this.eol}printMSId(j){return j.map(_t=>"a=msid:".concat(_t.id).concat(_t.appdata?"".concat(g).concat(_t.appdata):"").concat(this.eol)).join("")}printImageattr(j){return j.map(_t=>"a=imageattr:".concat(_t).concat(this.eol)).join("")}printRid(j){return j.map(_t=>{let _n="a=rid:".concat(_t.id).concat(g).concat(_t.direction);return _t.payloads&&(_n+="".concat(g,"pt=").concat(_t.payloads.join(","))),_t.params.length>0&&(_n+="".concat(g).concat(_t.params.map(wE=>wE.type==="depend"?"depend=".concat(wE.rids.join(",")):"".concat(wE.type,"=").concat(wE.val)).join(";"))),_n+this.eol}).join("")}printSimulcast(j){return j===void 0?"":"a=simulcast:".concat(j).concat(this.eol)}printSCTPPort(j){return j===void 0?"":"a=sctp-port:".concat(j).concat(this.eol)}printMaxMessageSize(j){return j===void 0?"":"a=max-message-size:".concat(j).concat(this.eol)}printMid(j){return j===void 0?"":"a=mid:".concat(j).concat(this.eol)}printSSRCGroups(j){return j.map(_t=>"a=ssrc-group:".concat(_t.semantic).concat(_t.ssrcIds.map(_n=>"".concat(g).concat(_n.toString(10))).join("")).concat(this.eol)).join("")}}function A_(i_){return new W_().parse(i_)}function $_(i_,j){return new J0().print(i_,j)}}},o={};function a(d){if(o[d])return o[d].exports;var h=o[d]={exports:{}};return n[d](h,h.exports,a),h.exports}return a.d=(d,h)=>{for(var p in h)a.o(h,p)&&!a.o(d,p)&&Object.defineProperty(d,p,{enumerable:!0,get:h[p]})},a.o=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),a.r=d=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},a(8)})()})(qJ);var gT=qJ.exports;function W0(t){if(Array.isArray(t))return t.map(n=>n);if(!KJ(t))return t;const e={};for(const n in t){const o=t[n];KJ(o)||Array.isArray(o)?e[n]=W0(o):e[n]=o}return e}function KJ(t){return!(typeof t!="object"||Array.isArray(t)||!t)}class S3{constructor(e){F(this,"input",[]),F(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const kR={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},ZP={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:kR,remoteCandidate:kR}},zJ={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},YJ={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},JJ={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},XJ={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function QJ(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function ZJ(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?QJ(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):QJ(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}class R3{constructor(e,n){F(this,"onFirstVideoReceived",void 0),F(this,"onFirstVideoDecoded",void 0),F(this,"onFirstAudioReceived",void 0),F(this,"onFirstVideoDecodedTimeout",void 0),F(this,"onFirstAudioDecoded",void 0),F(this,"onSelectedLocalCandidateChanged",void 0),F(this,"onSelectedRemoteCandidateChanged",void 0),F(this,"videoIsReady",!1),F(this,"videoIsReady2",{}),F(this,"pc",void 0),F(this,"options",void 0),F(this,"intervalTimer",void 0),F(this,"stats",W0(ZP)),F(this,"isFirstVideoReceived",{}),F(this,"isFirstVideoDecoded",{}),F(this,"isFirstAudioReceived",{}),F(this,"isFirstAudioDecoded",{}),F(this,"isFirstVideoDecodedTimeout",{}),F(this,"lossRateWindowStats",[]),this.pc=e,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new n_(e=>{e({local:ZJ({},kR),remote:ZJ({},kR)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,n){this.videoIsReady2[e]=n}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,o=["videoSend","audioSend","videoRecv","audioRecv"];let a=0,d=0,h=0,p=0;for(const m of o)e[m].forEach((_,g)=>{if(!this.lossRateWindowStats[n-1][m][g]||!this.lossRateWindowStats[0][m][g])return;const y=this.lossRateWindowStats[n-1][m][g].packets-this.lossRateWindowStats[0][m][g].packets,C=this.lossRateWindowStats[n-1][m][g].packetsLost-this.lossRateWindowStats[0][m][g].packetsLost;m==="videoSend"||m==="audioSend"?(a+=y,h+=C):(d+=y,p+=C),Number.isNaN(y)||Number.isNaN(y)?_.packetLostRate=0:_.packetLostRate=y<=0||C<=0?0:C/(y+C)});e.sendPacketLossRate=a<=0||h<=0?0:h/(a+h),e.recvPacketLossRate=d<=0||p<=0?0:p/(d+p)}}function $J(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function Ppt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$J(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$J(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}class Dpt extends R3{constructor(){super(...arguments),F(this,"_stats",ZP),F(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),n=this.statsResponsesToObjects(e);this._stats=W0(ZP);const o=n.filter(d=>d.type==="ssrc");this.processSSRCStats(o);const a=n.find(d=>d.type==="VideoBwe");a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(n=>{var o;const a=o_(o=n.id).call(o,"send");switch("".concat(n.mediaType,"_").concat(a?"send":"recv")){case"video_send":{const d=W0(YJ);d.codec=n.googCodecName,d.adaptionChangeReason="none",n.googCpuLimitedResolution&&(d.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(d.adaptionChangeReason="bandwidth"),d.avgEncodeMs=Number(n.googAvgEncodeMs),d.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},d.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},d.firsCount=Number(n.googFirReceived),d.nacksCount=Number(n.googNacksReceived),d.plisCount=Number(n.googPlisReceived),d.frameCount=Number(n.framesEncoded),d.bytes=Number(n.bytesSent),d.packets=Number(n.packetsSent),d.packetsLost=Number(n.packetsLost),d.ssrc=Number(n.ssrc),d.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(d),this._stats.rtt=d.rttMs;break}case"video_recv":{const d=W0(zJ),h=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(d.codec=n.googCodecName,d.targetDelayMs=Number(n.googTargetDelayMs),d.renderDelayMs=Number(n.googRenderDelayMs),d.currentDelayMs=Number(n.googCurrentDelayMs),d.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),d.decodeMs=Number(n.googDecodeMs),d.maxDecodeMs=Number(n.googMaxDecodeMs),d.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},d.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},d.decodeFrameRate=Number(n.googFrameRateDecoded),d.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},d.jitterBufferMs=Number(n.googJitterBufferMs),d.firsCount=Number(n.googFirsSent),d.nacksCount=Number(n.googNacksSent),d.plisCount=Number(n.googPlisSent),d.framesDecodeCount=Number(n.framesDecoded),d.bytes=Number(n.bytesReceived),d.packets=Number(n.packetsReceived),d.packetsLost=Number(n.packetsLost),d.ssrc=Number(n.ssrc),d.packets>0&&!this.isFirstVideoReceived[d.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(d.ssrc),this.isFirstVideoReceived[d.ssrc]=!0),d.framesDecodeCount>0&&!this.isFirstVideoDecoded[d.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(d.ssrc,d.decodedFrame.width,d.decodedFrame.height),this.isFirstVideoDecoded[d.ssrc]=!0),h){const p=h.stats,m=Date.now()-h.lts;d.framesDecodeFreezeTime=p.framesDecodeFreezeTime,d.framesDecodeInterval=p.framesDecodeInterval,d.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[d.ssrc]?(h.lts=Date.now(),d.framesDecodeInterval=m,d.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?d.framesDecodeFreezeTime+=d.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):d.framesDecodeCount<h.stats.framesDecodeCount&&(d.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(d.ssrc,{stats:Ppt({},d),lts:Date.now()}),this._stats.videoRecv.push(d);break}case"audio_recv":{const d=W0(XJ);d.codec=n.googCodecName,d.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,d.decodingCNG=Number(n.googDecodingCNG),d.decodingCTN=Number(n.googDecodingCTN),d.decodingCTSG=Number(n.googDecodingCTSG),d.decodingNormal=Number(n.googDecodingNormal),d.decodingPLC=Number(n.googDecodingPLC),d.decodingPLCCNG=Number(n.googDecodingPLCCNG),d.expandRate=Number(n.googExpandRate),d.accelerateRate=Number(n.googAccelerateRate),d.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),d.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),d.speechExpandRate=Number(n.googSpeechExpandRate),d.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),d.jitterBufferMs=Number(n.googJitterBufferMs),d.jitterMs=Number(n.googJitterReceived),d.bytes=Number(n.bytesReceived),d.packets=Number(n.packetsReceived),d.packetsLost=Number(n.packetsLost),d.ssrc=Number(n.ssrc),d.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),d.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),d.receivedFrames>0&&!this.isFirstAudioReceived[d.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(d.ssrc),this.isFirstAudioReceived[d.ssrc]=!0),d.decodingNormal>0&&!this.isFirstAudioDecoded[d.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(d.ssrc),this.isFirstAudioDecoded[d.ssrc]=!0),this._stats.audioRecv.push(d);break}case"audio_send":{const d=W0(JJ);d.codec=n.googCodecName,d.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,d.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),d.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),d.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),d.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),d.bytes=Number(n.bytesSent),d.packets=Number(n.packetsSent),d.packetsLost=Number(n.packetsLost),d.ssrc=Number(n.ssrc),d.rttMs=Number(n.googRtt||0),this._stats.rtt=d.rttMs,this._stats.audioSend.push(d);break}}})}_getStats(){return new n_((e,n)=>{this.pc.getStats(e,n)})}statsResponsesToObjects(e){const n=[];return e.result().forEach(o=>{const a={id:o.id,timestamp:o.timestamp.valueOf().toString(),type:o.type};o.names().forEach(d=>{a[d]=o.stat(d)}),n.push(a)}),n}}function t9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function EO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?t9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):t9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}class e9 extends R3{constructor(){super(...arguments),F(this,"_stats",ZP),F(this,"report",void 0),F(this,"lastDecodeVideoReceiverStats",new Map),F(this,"lastVideoFramesRecv",new Map),F(this,"lastVideoFramesSent",new Map),F(this,"lastVideoFramesDecode",new Map),F(this,"lastVideoFramesOutput",new Map),F(this,"lastVideoJBDelay",new Map),F(this,"lastAudioJBDelay",new Map),F(this,"mediaBytesSent",new Map),F(this,"mediaBytesRetransmit",new Map),F(this,"mediaBytesTargetEncode",new Map),F(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=W0(ZP),this.report.forEach(e=>{switch(e.type){case r0.OUTBOUND:case r0.INBOUND:{const n=e.mediaType||e.kind,o=!n&&"frameWidth"in e,a=!n&&!("frameWidth"in e);e.type===r0.OUTBOUND?n==="audio"||a?this.processAudioOutboundStats(e):(n==="video"||o)&&this.processVideoOutboundStats(e):e.type===r0.INBOUND&&(n==="audio"||a?this.processAudioInboundStats(e):(n==="video"||o)&&this.processVideoInboundStats(e));break}case r0.TRANSPORT:{const n=this.report.get(e.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case r0.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),n={local:EO({},kR),remote:EO({},kR)};return e.forEach(o=>{let a;if(o.type===r0.TRANSPORT&&(a=e.get(o.selectedCandidatePairId)),o.type===r0.CANDIDATE_PAIR&&o.selected&&(a=o),a){const d=(h,p)=>{h.type=p.type,h.id=p.id,p.address&&(h.address=p.address),p.candidateType&&(h.candidateType=p.candidateType),p.port&&(h.port=p.port),p.priority&&(h.priority=p.priority),p.protocol&&(h.protocol=p.protocol),p.relayProtocol&&(h.relayProtocol=p.relayProtocol)};if(a.localCandidateId){const h=e.get(a.localCandidateId);h&&d(n.local,h)}if(a.remoteCandidateId){const h=e.get(a.remoteCandidateId);h&&d(n.remote,h)}}}),n}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const n=this.report.get(e.localCandidateId);n&&this.processCandidateStats(n)}if(e.remoteCandidateId){const n=this.report.get(e.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(e){let n;e.type===r0.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),e.type===r0.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=e.type,n.id=e.id,e.address&&(n.address=e.address),e.candidateType&&(n.candidateType=e.candidateType),e.port&&(n.port=e.port),e.priority&&(n.priority=e.priority),e.protocol&&(n.protocol=e.protocol),e.relayProtocol&&(n.relayProtocol=e.relayProtocol),e.type===r0.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(EO({},n),EO({},this.stats.selectedCandidatePair.localCandidate)),e.type===r0.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(EO({},n),EO({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let n=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);n||(n=W0(XJ),this._stats.audioRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.bytes=e.bytesReceived,n.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),n.receivedFrames||(n.receivedFrames=e.packetsReceived),n.droppedFrames||(n.droppedFrames=e.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof e.concealedSamples=="number"&&(n.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let n=this._stats.videoRecv.find(p=>p.ssrc===e.ssrc);n||(n=W0(zJ),this._stats.videoRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.bytes=e.bytesReceived,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.framesDecodeCount=e.framesDecoded,n.framesDroppedCount=e.framesDropped,n.totalInterFrameDelay=e.totalInterFrameDelay,n.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,n.totalFreezesDuration=e.totalFreezesDuration;const o=this.lastDecodeVideoReceiverStats.get(n.ssrc),a=this.lastVideoFramesDecode.get(n.ssrc),d=this.lastVideoFramesOutput.get(n.ssrc),h=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const p=n.decodedFrame?n.decodedFrame.width:0,m=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,p,m),this.isFirstVideoDecoded[n.ssrc]=!0}if(o){const p=o.stats,m=h-o.lts;n.framesDecodeFreezeTime=p.framesDecodeFreezeTime,n.framesDecodeInterval=p.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(o.lts=Date.now(),n.framesDecodeInterval=m,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):n.framesDecodeCount<p.framesDecodeCount&&(n.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(o.stats.framesDecodeCount>e.framesDecoded?n.qpSumPerFrame=e.qpSum/e.framesDecoded:n.qpSumPerFrame=(e.qpSum-o.qpSum)/(e.framesDecoded-o.stats.framesDecodeCount))}a&&h-a.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-a.count)/((h-a.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:h,rate:n.decodeFrameRate})):a?n.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:h,rate:0}),n.framesDroppedCount&&e.framesReceived&&(d&&h-d.lts>=800?(n.outputFrameRate=Math.round((e.framesReceived-n.framesDroppedCount-d.count)/((h-d.lts)/1e3)),this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:h,rate:Math.max(n.outputFrameRate,0)})):d?n.outputFrameRate=d.rate:this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:h,rate:0})),e.totalDecodeTime&&(n.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(n.framesRateFirefox=e.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:EO({},n),lts:o?o.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let n=this._stats.videoSend.find(a=>a.ssrc===e.ssrc);n||(n=W0(YJ),this._stats.videoSend.push(n));const o=this.mediaBytesSent.get(e.ssrc);if(o)o.add(e.bytesSent);else{const a=new S3(10);a.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,a)}if(e.retransmittedBytesSent!==void 0){const a=this.mediaBytesRetransmit.get(e.ssrc);if(a)a.add(e.retransmittedBytesSent);else{const d=new S3(10);d.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,d)}}if(e.totalEncodedBytesTarget){const a=this.mediaBytesTargetEncode.get(e.ssrc);if(a)a.add(e.totalEncodedBytesTarget);else{const d=new S3(10);d.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,d)}}if(n.ssrc=e.ssrc,n.bytes=e.bytesSent,n.packets=e.packetsSent,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.frameCount=e.framesEncoded,n.adaptionChangeReason=e.qualityLimitationReason,n.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){const a=this.lastEncoderMs.get(e.ssrc);if(!a||a.lastFrameCount>e.framesEncoded)n.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const d=e.framesEncoded-a.lastFrameCount,h=e.totalEncodeTime-a.lastEncoderTime;n.avgEncodeMs=1e3*h/d}}if(e.framesEncoded&&e.qpSum){const a=this.lastEncoderMs.get(e.ssrc);!a||a.lastFrameCount>e.framesEncoded?n.qpSumPerFrame=e.qpSum/e.framesEncoded:n.qpSumPerFrame=(e.qpSum-a.lastQpSum)/(e.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,n),this.processVideoTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const a=this.findRemoteStatsId(e.ssrc,r0.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,n)}}processAudioOutboundStats(e){let n=this._stats.audioSend.find(o=>o.ssrc===e.ssrc);if(n||(n=W0(JJ),this._stats.audioSend.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsSent,n.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const o=this.findRemoteStatsId(e.ssrc,r0.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,n)}}findRemoteStatsId(e,n){var o;const a=Array.from(nR(o=this.report).call(o)).find(d=>d.type===n&&d.ssrc===e);return a?a.id:null}processVideoMediaSource(e,n){const o=this.report.get(e);o&&o.width&&o.height&&o.framesPerSecond&&(n.inputFrame={width:o.width,height:o.height,frameRate:o.framesPerSecond})}processAudioMediaSource(e,n){const o=this.report.get(e);o&&(n.inputLevel=o.audioLevel)}processVideoTrackSenderStats(e,n,o){var a,d,h,p;const m=n?this.report.get(n):void 0,_=(a=m==null?void 0:m.framesSent)!==null&&a!==void 0?a:e.framesSent;if(typeof _!="number")return;let g=(d=m==null?void 0:m.frameWidth)!==null&&d!==void 0?d:e.frameWidth,y=(h=m==null?void 0:m.frameHeight)!==null&&h!==void 0?h:e.frameHeight,C=(p=m==null?void 0:m.framesPerSecond)!==null&&p!==void 0?p:e.framesPerSecond;if(typeof g=="number"&&typeof y=="number"||(g=0,y=0),C==null){const O=Date.now(),q=this.lastVideoFramesSent.get(o.ssrc);q&&O-q.lts>=800?(C=Math.round((_-q.count)/((O-q.lts)/1e3)),this.lastVideoFramesSent.set(o.ssrc,{count:_,lts:O,rate:C})):q?C=q.rate:this.lastVideoFramesSent.set(o.ssrc,{count:_,lts:O,rate:0})}o.sentFrame={width:g,height:y,frameRate:Math.max(0,C)}}processVideoTrackReceiverStats(e,n,o){var a,d,h,p,m;const _=n?this.report.get(n):void 0,g=(a=_==null?void 0:_.framesReceived)!==null&&a!==void 0?a:e.framesReceived,y=(d=_==null?void 0:_.frameWidth)!==null&&d!==void 0?d:e.frameWidth,C=(h=_==null?void 0:_.frameHeight)!==null&&h!==void 0?h:e.frameHeight,O=(p=_==null?void 0:_.jitterBufferDelay)!==null&&p!==void 0?p:e.jitterBufferDelay,q=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof g=="number"){const L=this.lastVideoFramesRecv.get(o.ssrc),U=Date.now();o.framesReceivedCount=g;let K=0;L&&U-L.lts>=800?(K=Math.round((g-L.count)/((U-L.lts)/1e3)),this.lastVideoFramesRecv.set(o.ssrc,{count:g,lts:U,rate:K})):L?K=L.rate:this.lastVideoFramesRecv.set(o.ssrc,{count:g,lts:U,rate:0}),o.receivedFrame={width:y||0,height:C||0,frameRate:K||0},o.decodedFrame={width:y||0,height:C||0,frameRate:o.decodeFrameRate||0},o.outputFrame={width:y||0,height:C||0,frameRate:o.outputFrameRate||o.decodeFrameRate||0}}if(O&&q){const L=this.lastVideoJBDelay.get(o.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let U=L.jitterBufferMs;const K=q-L.jitterBufferEmittedCount;K>0&&(U=1e3*(O-L.jitterBufferDelay)/K),o.jitterBufferMs=U,o.currentDelayMs=Math.round(U),this.lastVideoJBDelay.set(o.ssrc,{jitterBufferDelay:O,jitterBufferEmittedCount:q,jitterBufferMs:o.currentDelayMs})}}processAudioTrackSenderStats(e,n,o){var a,d,h,p;const m=n?this.report.get(n):void 0,_=(a=(d=m==null?void 0:m.echoReturnLoss)!==null&&d!==void 0?d:e.echoReturnLoss)!==null&&a!==void 0?a:0,g=(h=(p=m==null?void 0:m.echoReturnLossEnhancement)!==null&&p!==void 0?p:e.echoReturnLossEnhancement)!==null&&h!==void 0?h:0;o.aecReturnLoss=_,o.aecReturnLossEnhancement=g}processAudioTrackReceiverStats(e,n,o){var a,d,h,p,m,_,g;const y=n?this.report.get(n):void 0,C=(a=y==null?void 0:y.removedSamplesForAcceleration)!==null&&a!==void 0?a:e.removedSamplesForAcceleration,O=(d=y==null?void 0:y.totalSamplesReceived)!==null&&d!==void 0?d:e.totalSamplesReceived,q=(h=y==null?void 0:y.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,L=(p=y==null?void 0:y.jitterBufferEmittedCount)!==null&&p!==void 0?p:e.jitterBufferEmittedCount,U=(m=y==null?void 0:y.audioLevel)!==null&&m!==void 0?m:e==null?void 0:e.audioLevel,K=(_=y==null?void 0:y.totalSamplesDuration)!==null&&_!==void 0?_:e==null?void 0:e.totalSamplesDuration,J=(g=y==null?void 0:y.concealedSamples)!==null&&g!==void 0?g:e.concealedSamples;if(C&&O&&(o.accelerateRate=C/O),q&&L){const _o=this.lastAudioJBDelay.get(o.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let na=_o.jitterBufferMs;const ba=L-_o.jitterBufferEmittedCount;ba>0&&(na=1e3*(q-_o.jitterBufferDelay)/ba),o.jitterBufferMs=Math.round(na),this.lastAudioJBDelay.set(o.ssrc,{jitterBufferDelay:q,jitterBufferEmittedCount:L,jitterBufferMs:o.jitterBufferMs})}o.outputLevel=U;let _r=1920;K&&O&&(_r=O/K/50,o.receivedFrames=Math.round(O/_r)),J&&(o.droppedFrames=Math.round(J/_r))}processRemoteInboundStats(e,n){const o=this.report.get(e);o&&(n.packetsLost=o.packetsLost,o.roundTripTime&&(n.rttMs=1e3*o.roundTripTime),o.jitter&&(n.jitterMs=1e3*o.jitter),o.timestamp&&(n.timestamp=o.timestamp))}getCodecFromCodecStats(e){const n=this.report.get(e);if(!n)return"";const o=n.mimeType.match(/\/(.*)$/);return o&&o[1]?o[1]:""}updateSendBitrate(){let e=0,n=null,o=null;this.mediaBytesSent.forEach(d=>{e+=d.diffMean()}),this.mediaBytesRetransmit.forEach(d=>{n=n===null?d.diffMean():n+d.diffMean()}),this.mediaBytesTargetEncode.forEach(d=>{o=o===null?d.diffMean():o+d.diffMean()});const a=n!==null?e-n:e;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),o!==null&&(this._stats.bitrate.targetEncoded=8*o/(this.options.updateInterval/1e3))}}class kpt extends R3{updateStats(){return n_.resolve()}}function pM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new Dpt(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:o,firstVideoDecodedTimeout:a}):new e9(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:o,firstVideoDecodedTimeout:a}):function(h){return!!window.RTCStatsReport&&h.getStats()instanceof n_}(t)?new e9(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:o,firstVideoDecodedTimeout:a}):new kpt(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:o,firstVideoDecodedTimeout:a})}function n9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function r9(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?n9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):n9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}function $P(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:a,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:p,filterVideoCodec:m}=e,{useXR:_}=n;let g=[],y=[],C=[],O=[],q=!1,L=!1;if(gT.parse(t).mediaDescriptions.forEach(K=>{o&&o!==K.attributes.direction||(K.media.mediaType!=="video"||q||(y=K.attributes.payloads,O=K.attributes.extmaps,q=!0),K.media.mediaType!=="audio"||L||(g=K.attributes.payloads,C=K.attributes.extmaps,L=!0))}),!O||y.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!C||g.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(y.forEach(K=>{var J;(J=K.rtpMap)!==null&&J!==void 0&&J.clockRate&&(K.rtpMap.clockRate=parseInt(K.rtpMap.clockRate)),_&&K.rtcpFeedbacks.push({type:"rrtr"})}),g.forEach(K=>{var J;(J=K.rtpMap)!==null&&J!==void 0&&J.clockRate&&(K.rtpMap.clockRate=parseInt(K.rtpMap.clockRate)),_&&K.rtcpFeedbacks.push({type:"rrtr"})}),a&&(g=g.filter(K=>{var J;return((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName.toLowerCase())!=="rtx"}),y=y.filter(K=>{var J;return((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName.toLowerCase())!=="rtx"})),d&&(y=y.filter(K=>{var J;return!/(red)|(ulpfec)|(flexfec)/i.test(((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName)||"")})),h&&(g=g.filter(K=>{var J;return!/(red)|(ulpfec)|(flexfec)/i.test(((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName)||"")})),p&&(p==null?void 0:p.length)>0&&(g=g.filter(K=>{var J;return o_(p).call(p,((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName.toLowerCase())||"")})),m&&(m==null?void 0:m.length)>0){const K=y.filter(J=>{var _r;return o_(m).call(m,((_r=J.rtpMap)===null||_r===void 0?void 0:_r.encodingName.toLowerCase())||"")});y=K.concat(a?[]:A3(K,y))}const U=$("UNSUPPORTED_VIDEO_CODEC");return U&&U.length>0&&(y=y.filter(K=>!(K.rtpMap&&o_(U).call(U,K.rtpMap.encodingName.toLowerCase())))),{audioCodecs:g,videoCodecs:y,audioExtensions:C,videoExtensions:O}}function cR(t){const e=gT.parse(t);let n,o;for(const a of e.mediaDescriptions){if(!n){const d=a.attributes.iceUfrag,h=a.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:d,icePwd:h}}if(!o){const d=a.attributes.fingerprints;d.length>0&&(o={fingerprints:d})}}if(!o&&e.attributes.fingerprints.length>0&&(o={fingerprints:e.attributes.fingerprints}),!o||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:o}}function C3(t,e){const n=[],o=t.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),a=t.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),d=t.attributes.ssrcs;if(a)a.ssrcIds.forEach(h=>{var p;const m=(p=o.find(_=>_.ssrcIds[0]===h))===null||p===void 0?void 0:p.ssrcIds[1];n.push({ssrcId:h,rtx:e?m:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],p=o[0].ssrcIds[1];n.push({ssrcId:h,rtx:e?p:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:d[0].ssrcId})}return n}function i9(t,e){const{cname:n}=t;let o;e&&e.ip&&typeof e.port=="number"?(o=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],A.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(o.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),A.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))):o=t.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}}));const a={fingerprints:t.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},d={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let h;switch(t.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}return{dtlsParameters:a,iceParameters:d,candidates:o,rtpCapabilities:NN(t.rtpCapabilities),setup:h,cname:n}}function h0(t,e,n){const o=[],a=[];return t.forEach(d=>{let{ssrcId:h,rtx:p}=d;const m=sT(8,"track-"),_={ssrcId:h,attributes:r9({label:m,mslabel:n=n||sT(10,""),msid:"".concat(n," ").concat(m)},e&&{cname:e})};if(o.push(_),p!==void 0){const g={ssrcId:p,attributes:r9({label:m,mslabel:n,msid:"".concat(n," ").concat(m)},e&&{cname:e})};o.push(g),a.push({semantic:"FID",ssrcIds:[h,p]})}}),t.length>1&&a.push({semantic:"SIM",ssrcIds:t.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:o,ssrcGroups:a}}function wI(t,e){e instanceof OT&&t.attributes.payloads.forEach(n=>{var o;const a=(o=n.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!a||["opus","pcmu","pcma","g722"].indexOf(a)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const d=e._encoderConfig;d&&a!=="pcmu"&&a!=="pcma"&&a!=="g722"&&(d.bitrate&&!iT()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function fM(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function mM(t,e){var n;if(!(e instanceof aT&&e._encoderConfig&&e._hints.indexOf(lT.SCREEN_TRACK)===-1))return;const o=e._encoderConfig;q_().supportMinBitrate&&o.bitrateMin&&t.attributes.payloads.forEach(a=>{var d,h;o_(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=a.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),q_().supportMinBitrate&&!o_(n=e._hints).call(n,lT.LOW_STREAM)&&o.bitrateMax&&t.attributes.payloads.forEach(a=>{var d,h;o_(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=a.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-start-bitrate"]="".concat($("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function I3(t){if(t.media.mediaType!=="video")return;const e=Y_();if(e.name!==kv.SAFARI&&e.os!==QT.IOS)return;const n=t.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function AN(t,e,n){if(!e)return;let o,a;if(t.media.mediaType==="video"?(o=n.videoExtensions,a=n.videoCodecs):(o=n.audioExtensions,a=n.audioCodecs),e.twcc===!0){const d=o.find(h=>h.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");d&&(t.attributes.extmaps.find(p=>p.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||t.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(p,m){return m.filter(_=>!!p.find(g=>g.payloadType===_.payloadType&&!!g.rtcpFeedbacks.find(y=>y.type==="transport-cc")))}(a,t.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(m=>m.type==="transport-cc")||p.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(e.twcc===!1){const d=t.attributes.extmaps.findIndex(h=>h.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");p!==-1&&h.rtcpFeedbacks.splice(p,1)})}if(e.remb===!0){const d=o.find(h=>h.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");d&&(t.attributes.extmaps.find(p=>p.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||t.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(p,m){return m.filter(_=>!!p.find(g=>g.payloadType===_.payloadType&&!!g.rtcpFeedbacks.find(y=>y.type==="goog-remb")))}(a,t.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(m=>m.type==="goog-remb")||p.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(e.remb===!1){const d=t.attributes.extmaps.findIndex(h=>h.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>m.type==="goog-remb");p!==-1&&h.rtcpFeedbacks.splice(p,1)})}}function w3(t,e,n){if(iT()||t.media.mediaType!=="video"||!(e instanceof aT)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!$("SIMULCAST")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const o=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,a=t.attributes.ssrcs[0],d=t.attributes.ssrcGroups.find(p=>p.semantic==="FID"&&p.ssrcIds[0]===a.ssrcId),h={semantic:"SIM",ssrcIds:[a.ssrcId]};for(let p=1;p<o;p++)t.attributes.ssrcs.push({ssrcId:a.ssrcId+p,attributes:dT(a.attributes)}),h.ssrcIds.push(a.ssrcId+p),d&&(t.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+p,attributes:dT(a.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[a.ssrcId+p,d.ssrcIds[1]+p]}));t.attributes.ssrcGroups.unshift(h)}async function O3(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const o=(await n.createOffer()).sdp,{send:a,recv:d,sendrecv:h}=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;const g=$P(_,p,m,"sendonly"),y=$P(_,p,m,"recvonly"),C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},q={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(q0(g,y,"videoExtensions",C,O,q),q0(g,y,"videoCodecs",C,O,q),q0(g,y,"audioExtensions",C,O,q),q0(g,y,"audioCodecs",C,O,q),$("RAISE_H264_BASELINE_PRIORITY")){const L=q.videoCodecs.findIndex(U=>{var K,J;return((K=U.rtpMap)===null||K===void 0?void 0:K.encodingName.toLocaleLowerCase())==="h264"&&((J=U.fmtp)===null||J===void 0?void 0:J.parameters["profile-level-id"])==="42001f"});if(L!==-1){const U=q.videoCodecs.findIndex(K=>{var J;return((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"});if(U<L){A.debug("raising H264 baseline profile priority");const K=q.videoCodecs[L];q.videoCodecs.splice(L,1),q.videoCodecs.splice(U,0,K)}U!==-1&&(O.videoCodecs=O.videoCodecs.filter(K=>{var J,_r;return!(((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"&&((_r=K.fmtp)===null||_r===void 0?void 0:_r.parameters["profile-level-id"])!=="42001f")})),U!==-1&&$("FILTER_SEND_H264_BASELINE")&&(C.videoCodecs=C.videoCodecs.filter(K=>{var J,_r;return!(((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"&&((_r=K.fmtp)===null||_r===void 0?void 0:_r.parameters["profile-level-id"])!=="42001f")}))}}return{send:C,recv:O,sendrecv:q}}(t,e,o);try{n.close()}catch{}return{send:a,recv:d,sendrecv:h}}function o9(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=$P(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(q0(t,e,"videoExtensions",n,o,a),q0(t,e,"videoCodecs",n,o,a),q0(t,e,"audioExtensions",n,o,a),q0(t,e,"audioCodecs",n,o,a),$("RAISE_H264_BASELINE_PRIORITY")){const d=a.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(d!==-1){const h=a.videoCodecs.findIndex(p=>p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<d){A.debug("raising H264 baseline profile priority");const p=a.videoCodecs[d];a.videoCodecs.splice(d,1),a.videoCodecs.splice(h,0,p)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(p=>!(p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&p.fmtp&&p.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:o,sendrecv:a}}function q0(t,e,n,o,a,d){if(n==="videoExtensions"||n==="audioExtensions"){const h=[];return t[n].forEach(p=>{e[n].some((m,_)=>{if(p.entry===m.entry&&p.extensionName===m.extensionName)return h.push(_),!0})?d[n].push(p):o[n].push(p)}),void e[n].forEach((p,m)=>{h.indexOf(m)===-1&&a[n].push(p)})}if(n==="videoCodecs"||n==="audioCodecs"){const h=[];return t[n].forEach(p=>{e[n].some((m,_)=>{if(p.payloadType===m.payloadType&&JSON.stringify(p)===JSON.stringify(m))return h.push(_),!0})?d[n].push(p):o[n].push(p)}),void e[n].forEach((p,m)=>{h.indexOf(m)===-1&&a[n].push(p)})}}function NN(t){const{send:e,recv:n,sendrecv:o}=t;if(!o){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let a,d;return e?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...e.audioCodecs,...o.audioCodecs],a.videoCodecs=[...e.videoCodecs,...o.videoCodecs],a.audioExtensions=[...e.audioExtensions,...o.audioExtensions],a.videoExtensions=[...e.videoExtensions,...o.videoExtensions]):a=o,n?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...n.audioCodecs,...o.audioCodecs],d.videoCodecs=[...n.videoCodecs,...o.videoCodecs],d.audioExtensions=[...n.audioExtensions,...o.audioExtensions],d.videoExtensions=[...n.videoExtensions,...o.videoExtensions]):d=o,{send:a,recv:d}}function uR(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function EM(t){t.mediaDescriptions.forEach(e=>{e.media.mediaType!=="video"&&e.media.mediaType!=="audio"||e.attributes.payloads.forEach(n=>{n.rtcpFeedbacks.findIndex(o=>o.type==="rrtr")===-1&&n.rtcpFeedbacks.push({type:"rrtr"})})})}function _O(t,e,n,o){let a=[];if(t===m_.VIDEO){if($("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(a=e.videoCodecs.filter(d=>{var h;return o_(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===$("H264_PROFILE_LEVEL_ID")})),!Array.isArray(a)||a.length===0){let d=[];const h=[],p=[],m=[];if(n.videoCodecs.forEach(_=>{const g=_.rtpMap&&_.rtpMap.encodingName.toLowerCase()||"";o_(g).call(g,o)?d.push(_):o_(g).call(g,"vp9")?h.push(_):o_(g).call(g,"vp8")?p.push(_):o_(g).call(g,"h264")&&m.push(_)}),d.length===0){let _="";h.length!==0?(d=h,_="vp9"):p.length!==0?(d=p,_="vp8"):m.length!==0&&(d=m,_="h264"),A.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(_))}d.length!==0&&(a=e.videoCodecs.filter(_=>d.some(g=>g.payloadType===_.payloadType)))}if(a.length===0&&(A.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),a=e.videoCodecs),$("USE_PUB_RTX")||$("USE_SUB_RTX")){const d=A3(a,e.videoCodecs);a=[...a,...d]}}else a=e.audioCodecs.filter(d=>{var h;return o_(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),a.length===0&&(A.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),a=e.audioCodecs.filter(d=>{var h;return o_(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return a}function A3(t,e){const n=t.map(o=>o.payloadType.toString());return e.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&o_(n).call(n,o.fmtp&&o.fmtp.parameters.apt))}let s9=class{get localCapabilities(){return dT(this._localCapabilities)}get rtpCapabilities(){return dT(this._rtpCapabilities)}get candidates(){return dT(this._candidates)}get iceParameters(){return dT(this._iceParameters)}get dtlsParameters(){return dT(this._dtlsParameters)}constructor(t){F(this,"sessionDesc",void 0),F(this,"_localCapabilities",void 0),F(this,"_rtpCapabilities",void 0),F(this,"_candidates",void 0),F(this,"_iceParameters",void 0),F(this,"_dtlsParameters",void 0),F(this,"setup",void 0),F(this,"currentMidIndex",void 0),F(this,"cname","o/i14u9pJrxRKAsu"),F(this,"firefoxSsrcMidMap",new Map),t=dT(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:o,remoteRTPCapabilities:a,localCapabilities:d,direction:h,setup:p,videoCodec:m,audioCodec:_}=t;let g;this.setup=p,g=h===PS.RECEIVE_ONLY?gT.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):gT.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=a,this._candidates=o,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=d;const y=h===PS.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,C=h===PS.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,O=h===PS.RECEIVE_ONLY?a.send.videoCodecs:_O(m_.VIDEO,y,C,m),q=h===PS.RECEIVE_ONLY?a.send.audioCodecs:_O(m_.AUDIO,y,C,_);for(const L of g.mediaDescriptions)L.attributes.iceUfrag=e.iceUfrag,L.attributes.icePwd=e.icePwd,L.attributes.fingerprints=n.fingerprints,L.attributes.candidates=o,L.attributes.setup=this.setup,L.media.mediaType==="application"&&(L.attributes.sctpPort="5000"),L.media.mediaType==="video"&&(L.media.fmts=O.map(U=>U.payloadType.toString(10)),L.attributes.payloads=O,L.attributes.extmaps=y.videoExtensions),L.media.mediaType==="audio"&&(L.media.fmts=q.map(U=>U.payloadType.toString(10)),L.attributes.payloads=q,L.attributes.extmaps=y.audioExtensions,uR(L));this.sessionDesc=g,this.currentMidIndex=g.mediaDescriptions.length-1}toString(){return gT.print(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,o,a){n=n.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:h}=h0(e,this.cname,$("SYNC_GROUP")?n:void 0),p=this.findPreloadMediaDesc(d);if(p){if(iT()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,p.attributes.mid),a&&(a.twcc||a.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,a),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(t,d,o);let _;return m===-1?(_=this.createOrRecycleSendMedia(t,d,h,"sendonly",o,a),this.updateBundleMids()):(_=dT(this.sessionDesc.mediaDescriptions[m]),_.attributes.direction="sendonly",_.attributes.ssrcs=d,_.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(_,a)),iT()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,_.attributes.mid),{needExchangeSDP:!0,mid:_.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const o=[];return t.forEach(a=>{const d=a._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(d);let p,m=!1;h===-1?(m=!0,p=this.createOrRecycleRecvMedia(a,[],"recvonly",e,n),this.updateBundleMids()):(p=dT(this.sessionDesc.mediaDescriptions[h]),p.attributes.direction="recvonly"),o.push({mid:p.attributes.mid,needCreateTransceiver:m})}),o}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:o,port:a,type:d,relatedAddress:h,relatedPort:p,priority:m}=new RTCIceCandidate(t),_={foundation:e??"",componentId:"1",transport:n??"",priority:m?m+"":"",connectionAddress:o??"",port:a?a+"":"",type:d?d+"":"",relAddr:h??"",relPort:p?p+"":"",extension:{}};this.candidates.some(g=>g.priority===_.priority&&g.connectionAddress===_.connectionAddress&&g.port===_.port)||(this._candidates.push(_),this.sessionDesc.mediaDescriptions.forEach(g=>{g.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,o,a){const d=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,p=_O(d,h,this.localCapabilities.send,d===m_.AUDIO?a:o),m=d===m_.VIDEO?h.videoExtensions:h.audioExtensions,_="".concat(++this.currentMidIndex);let g={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};g=this.mungRecvMediaDsec(g,t);const y=this.findFirstClosedMedia(d);if(y){const C=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[C]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>o_(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>o_(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const a=o.media.mediaType===t&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(iT()){if(a){const d=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(d||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!d||d!==o.attributes.mid)}return!1}return a&&o.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=dT(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,o,a,d){const h=this.rtpCapabilities.send,p=t===m_.VIDEO?h.videoCodecs:h.audioCodecs,m=t===m_.VIDEO?h.videoExtensions:h.audioExtensions;iT()&&(a="".concat(++this.currentMidIndex));let _={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:a}};_=this.mungSendMediaDesc(_,d);const g=this.findFirstClosedMedia(t);if(g){const y=this.sessionDesc.mediaDescriptions.indexOf(g);this.sessionDesc.mediaDescriptions[y]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}mungRecvMediaDsec(t,e,n){const o=dT(t);return fM(o),wI(o,e),mM(o,e),I3(o),AN(o,n,this.localCapabilities.send),o}mungSendMediaDesc(t,e){const n=dT(t);return AN(n,e,this.localCapabilities.recv),uR(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(n!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>iT()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const Lpt=["sdp"];var pT;function a9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function OI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?a9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}let c9=(pT=class jN extends W8{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,o){super(e,n),F(this,"direction",void 0),F(this,"name",void 0),F(this,"store",void 0),F(this,"spec",void 0),F(this,"peerConnection",void 0),F(this,"initialOffer",void 0),F(this,"transport",void 0),F(this,"statsFilter",void 0),F(this,"localCandidateCount",0),F(this,"_isInRestartIce",!1),F(this,"mutex",new nS("P2PConnection-mutex")),F(this,"onLocalCandidate",void 0),F(this,"remoteSDP",void 0),F(this,"pendingCandidates",[]),F(this,"localCapabilities",void 0),F(this,"isReady",!1),F(this,"restartCnt",0),F(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.peerConnection=new RTCPeerConnection(jN.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??PS.SEND_ONLY,this.name=this.direction===PS.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=pM(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,iT()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await O3();if(this.localCapabilities=NN(n),e){const{sdp:o}=e,a=Npt(e,Lpt),d=function(){const g={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},y=$P(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},q={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(q0(y,g,"videoExtensions",C,O,q),q0(y,g,"videoCodecs",C,O,q),q0(y,g,"audioExtensions",C,O,q),q0(y,g,"audioCodecs",C,O,q),$("RAISE_H264_BASELINE_PRIORITY")){const L=q.videoCodecs.findIndex(U=>U.rtpMap&&U.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&U.fmtp&&U.fmtp.parameters["profile-level-id"]==="42001f");if(L!==-1){const U=q.videoCodecs.findIndex(K=>K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(U<L){A.debug("raising H264 baseline profile priority");const K=q.videoCodecs[L];q.videoCodecs.splice(L,1),q.videoCodecs.splice(U,0,K)}U!==-1&&$("FILTER_SEND_H264_BASELINE")&&(C.videoCodecs=C.videoCodecs.filter(K=>!(K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&K.fmtp&&K.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:C,recv:O,sendrecv:q}}({},{},o);this.remoteSDP=new s9({remoteIceParameters:a.iceParameters,remoteDtlsParameters:a.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const p=cR(h.sdp);await this.peerConnection.setLocalDescription(h);const m=await o9({},{},h.sdp);this.localCapabilities=NN(m);const _=this.peerConnection.getTransceivers()[0];return _!=null&&_.receiver&&_.receiver.transport&&this.tryBindTransportEvents(_.receiver.transport),OI(OI({},p),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=cR(o.sdp);return this.initialOffer=o,OI(OI({},a),{},{sdp:o.sdp})}}catch(n){throw new ya(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:o,dtlsParameters:a}=e,d=await o9({},{},n);this.remoteSDP=new s9({remoteIceParameters:o,remoteDtlsParameters:a,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new ya(Y.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,o){var a=this;return QS(function*(){const d=yield L_(a.mutex.lock("From P2PConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],p=a.remoteSDP.receive(e,n,o);e.forEach((U,K)=>{if(p[K].needCreateTransceiver){const J=a.peerConnection.addTransceiver(U._mediaStreamTrack,{direction:"sendonly"});h.push(J),U._updateRtpTransceiver(J)}else{const J=a.peerConnection.getTransceivers().find(_r=>_r.mid===p[K].mid);if(!J)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(p[K].mid));h.push(J),U._updateRtpTransceiver(J)}}),iT()&&$("SIMULCAST")===!0&&(yield L_(a.applySimulcastForFirefox(h,e)));const m=p.map(U=>U.mid),_=yield L_(a.peerConnection.createOffer()),g=a.mungSendOfferSDP(_.sdp,e,m),y=gT.parse(g),C=m.map(U=>{const K=y.mediaDescriptions.find(J=>J.attributes.mid===U);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return C3(K,$("USE_PUB_RTX"))}),O=h.map((U,K)=>{const J=m[K];return{localSSRC:C[K],id:J}});yield L_(a.peerConnection.setLocalDescription({type:"offer",sdp:g}));try{yield O}catch(U){const K=a.remoteSDP.toString();throw yield L_(a.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield L_(a.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield L_(a.stopSending(m,!0)),U}yield L_(a.applySimulcastEncodings(h,e)),yield L_(a.applySendEncodings(h,e));const q=a.remoteSDP.toString(),L=a.logSDPExchange(g,"offer","local","send");return L==null||L(q),yield L_(a.setRemoteDescription({type:"answer",sdp:q})),h.map((U,K)=>{const J=m[K];return{localSSRC:C[K],id:J}})}catch(h){throw h instanceof ya?h:new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(e,n){const o=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=this.peerConnection.getTransceivers().filter(m=>e.indexOf(m.mid)!==-1);if(a.length!==e.length)throw new Error("Transceivers' length (".concat(a.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));a.map(m=>{var _;m.direction="inactive",(_=m.stop)===null||_===void 0||_.call(m)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(e);const p=this.remoteSDP.toString();h==null||h(p),await this.setRemoteDescription({type:"answer",sdp:p})}catch(a){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}finally{o&&o()}}async receive(e,n,o,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(e,n,o,a);if(h){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const g=await this.peerConnection.createAnswer(),y=this.mungReceiveAnswerSDP(g.sdp,d,e);_==null||_(y||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:y}),A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const p=this.peerConnection.getTransceivers().find(m=>m.mid===d);if(!p||p.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,mid:p.mid,transceiver:p}}catch(d){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(e,n,o,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(e,n,o,a);if(h){const p=this.remoteSDP.toString(),m=this.logSDPExchange(p,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:p});const _=await this.peerConnection.createAnswer(),g=this.mungReceiveAnswerSDP(_.sdp,d,e);m==null||m(g||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:g}),A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(d){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),o=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===_w.Auto&&(this.store.p2pTransport=_w.SdRtn,q_().supportPCSetConfiguration&&this.peerConnection.setConfiguration(jN.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,q_().supportPCSetConfiguration&&this.peerConnection.setConfiguration(jN.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=cR(n.sdp);return this.store.descriptionStart(),this.direction===PS.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===PS.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=cR(n.sdp);return await this.peerConnection.setLocalDescription(n),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(o.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const d=this.remoteSDP.toString(),h=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(o){throw new ya(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(e,n){const o=this.peerConnection.getTransceivers().filter(a=>a.mid===e);o.length===1&&(this.isVP8Simulcast(n)?iT()||await this.applySimulcastEncodings(o,[n]):await this.applySendEncodings(o,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const o=this.peerConnection.getTransceivers().find(a=>a.mid===n);o&&await o.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:o,remote:a}=n.getSelectedCandidatePair();return{local:OI(OI({},kR),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:OI(OI({},kR),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;o_(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const a={iceServers:[]};var d;return e.iceServers?a.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(QO(e.turnServer.servers)?a.iceServers=e.turnServer.servers:(a.iceServers&&a.iceServers.push(...jN.turnServerConfigToIceServers(e.turnServer.servers,n,o)),$("USE_TURN_SERVER_OF_GATEWAY")&&a.iceServers&&e.turnServer.serversFromGateway&&a.iceServers.push(...jN.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,o)),o_(d=[_w.Relay,_w.SdRtn]).call(d,n)&&(a.iceTransportPolicy="relay"),$("FORCE_TURN_TCP")?a.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(a.iceTransportPolicy="relay")}))),$("ENABLE_ENCODED_TRANSFORM")&&q_().supportWebRTCEncodedTransform&&(a.encodedInsertableStreams=!0),A.debug("P2PConnection p2pTransport is ".concat(n)),a}static turnServerConfigToIceServers(e,n){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const a=[],d=e.filter(p=>p.tcpport);A.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(o));const h=d.length>o?d[o]:d[0];switch(n){case _w.SdRtn:const p=e.filter(_=>{var g;return o_(g=_.username).call(g,"glb:")&&_.turnServerURL==_.turnServerURL}),m=p.length>o?p[o]:p[0];m&&(a.push({username:m.username,credential:m.password,credentialType:"password",urls:"turn:".concat(vI(m.turnServerURL),":").concat(m.tcpport,"?transport=udp")}),a.push({username:m.username,credential:m.password,credentialType:"password",urls:"turns:".concat(vI(m.turnServerURL),":").concat(m.tcpport,"?transport=tcp")}));break;case _w.Relay:h&&(a.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),a.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(vI(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(a.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),a.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(vI(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),a.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return a}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var o;e!=null&&e.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,e.state))},e.onerror=o=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in o?o.error:o)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const o=e==null?void 0:e.iceTransport.state;var a;o&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,o))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:o,remote:a}=n.getSelectedCandidatePair();A.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var o;if(n||(n=this.peerConnection.getSenders().find(g=>g.track===e._mediaStreamTrack)),!n)return A.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return A.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!q_().supportSetRtpSenderParameters)return A.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const a={},d={};switch(e._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if(e._encoderConfig){var h;const{bitrateMax:g,frameRate:y,scaleResolutionDownBy:C}=e._encoderConfig;g&&(d.maxBitrate=1e3*g),o_(h=e._hints).call(h,lT.LOW_STREAM)&&(y&&(d.maxFramerate=BS(y)),C&&C>=1&&(d.scaleResolutionDownBy=C))}if($("DSCP_TYPE")&&hI()){var p;const g=$("DSCP_TYPE");o_(p=["very-low","low","medium","high"]).call(p,g)&&(d.networkPriority=g)}const m=n.getParameters(),_=(o=m.encodings)===null||o===void 0?void 0:o[0];iT()&&!_&&(a.encodings=[d]),_&&Object.assign(_,d),Object.assign(m,a),A.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await n.setParameters(m)}async applySendEncodings(e,n){try{if(!q_().supportSetRtpSenderParameters||e.length!==n.length)return;for(let o=0;o<e.length;o++){const a=e[o],d=n[o];d instanceof aT&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,a.sender)}}catch{A.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,o){const a=gT.parse(e);return n.forEach((d,h)=>{const p=o[h],m=a.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(wI(m,d),w3(m,d,this.store.codec))}),gT.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,o)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,e,n,o)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let m=0;m<e.length;m++){var o,a,d,h,p;const _=e[m],g=n[m];if(g instanceof aT&&!o_(o=g._hints).call(o,lT.LOW_STREAM)&&(a=g._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((d=g._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=g._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=g._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){const y={},C={high:1e3*(g._encoderConfig.bitrateMax-50),medium:5e4};y.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];const O=_.sender.getParameters();await _.sender.setParameters(Object.assign(O,y))}}}async applySimulcastEncodings(e,n){if(!iT()&&e.length===n.length)for(let o=0;o<e.length;o++){const a=n[o];if(a instanceof aT&&this.isVP8Simulcast(a)){const d=e[o],h={},p={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];const m=d.sender.getParameters();await d.sender.setParameters(Object.assign(m,h))}}}isVP8Simulcast(e){var n,o,a,d,h;return!!(e instanceof aT&&$("SIMULCAST")&&this.store.codec==="vp8"&&!o_(n=e._hints).call(n,lT.LOW_STREAM)&&(o=e._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((a=e._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(d=e._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=e._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(e,n,o,a){if($("SDP_LOGGING"))return A.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(n," SDP during P2PConnection.").concat(a,`
`),e),n==="offer"?d=>{this.logSDPExchange(d,"answer",o==="local"?"remote":"local",a)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(h=>h.mid&&e.indexOf(h.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(e);const d=this.remoteSDP.toString();a==null||a(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(h=>h.mid&&e.indexOf(h.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(e);const d=this.remoteSDP.toString();a==null||a(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var o,a;if(n=(o=n)!==null&&o!==void 0?o:(a=this.currentRemoteDescription)===null||a===void 0?void 0:a.sdp){var d;const h=(d=gT.parse(n).mediaDescriptions.find(p=>p.attributes.mid===e))===null||d===void 0?void 0:d.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),o_(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,o){const a=gT.parse(e),d=a.mediaDescriptions.find(h=>h.attributes.mid===n);return d&&o===m_.AUDIO&&d.media.mediaType==="audio"&&uR(d),gT.print(a)}},e_(pT.prototype,"establish",[K0],Object.getOwnPropertyDescriptor(pT.prototype,"establish"),pT.prototype),e_(pT.prototype,"connect",[K0],Object.getOwnPropertyDescriptor(pT.prototype,"connect"),pT.prototype),e_(pT.prototype,"receive",[K0],Object.getOwnPropertyDescriptor(pT.prototype,"receive"),pT.prototype),e_(pT.prototype,"mockReceive",[K0],Object.getOwnPropertyDescriptor(pT.prototype,"mockReceive"),pT.prototype),e_(pT.prototype,"stopReceiving",[K0],Object.getOwnPropertyDescriptor(pT.prototype,"stopReceiving"),pT.prototype),e_(pT.prototype,"restartICE",[K0],Object.getOwnPropertyDescriptor(pT.prototype,"restartICE"),pT.prototype),e_(pT.prototype,"close",[K0],Object.getOwnPropertyDescriptor(pT.prototype,"close"),pT.prototype),e_(pT.prototype,"updateEncoderConfig",[K0],Object.getOwnPropertyDescriptor(pT.prototype,"updateEncoderConfig"),pT.prototype),e_(pT.prototype,"updateSendParameters",[K0],Object.getOwnPropertyDescriptor(pT.prototype,"updateSendParameters"),pT.prototype),e_(pT.prototype,"replaceTrack",[K0],Object.getOwnPropertyDescriptor(pT.prototype,"replaceTrack"),pT.prototype),e_(pT.prototype,"muteLocal",[K0],Object.getOwnPropertyDescriptor(pT.prototype,"muteLocal"),pT.prototype),e_(pT.prototype,"unmuteLocal",[K0],Object.getOwnPropertyDescriptor(pT.prototype,"unmuteLocal"),pT.prototype),pT);function K0(t,e,n){const o=t[e];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,d=await a.lock("From P2PConnection.".concat(e));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await o.apply(this,p)}finally{d()}},n}function N3(t,e){let n=document.createElement("video"),o=document.createElement("canvas");n.setAttribute("style","display:none"),o.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),o.width=BS(e.width),o.height=BS(e.height);const a=BS(e.framerate||15);document.body.append(n),document.body.append(o);let d=t._mediaStreamTrack;n.srcObject=new MediaStream([d]),n.play();const h=o.getContext("2d");if(!h)throw new _s(Y.UNEXPECTED_ERROR,"can not get canvas context");const p=q_(),m=o.captureStream(p.supportRequestFrame?0:a).getVideoTracks()[0];m.canvas||(m.canvas=o),o.startCapture=()=>{if(!n)return o.stopCapture&&o.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const g=n.videoWidth,y=n.videoHeight/g,C=o.width*y;Math.abs(C-o.height)>=2&&(A.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(C)),o.height=C)}h.drawImage(n,0,0,o.width,o.height),m.requestFrame&&m.requestFrame(),d!==t._mediaStreamTrack&&(d=t._mediaStreamTrack,n.srcObject=new MediaStream([d]))},o.stopCapture=l3(()=>o.startCapture&&o.startCapture(),a);const _=m.stop;return m.stop=()=>{_.call(m),n&&(n.remove(),n.srcObject=null,n=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),A.debug("clean low stream renderer")},m}var _M=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(_M||{}),eS=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t}(eS||{}),gO=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(gO||{}),bS=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t}(bS||{}),vO=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(vO||{}),u9=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(u9||{}),AI=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t}(AI||{}),z0=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t}(z0||{}),d9=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(d9||{}),T0=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t}(T0||{});const ZR=1e3,bO=3;function x_(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function l9(t){const e={[T0.CONN_TYPE]:0,[T0.RTT]:t.rtt};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[T0.CONN_TYPE]=1),n==="tcp"&&(e[T0.CONN_TYPE]=3),n==="tls"&&(e[T0.CONN_TYPE]=4);break}case"srflx":e[T0.CONN_TYPE]=2}return e}function h9(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class p9 extends ET{constructor(e){super(),F(this,"store",void 0),F(this,"uploadWRTCStatsTimer",void 0),F(this,"uploadOutboundDenoiserStatsTimer",void 0),F(this,"uploadExtStatsTimer",void 0),F(this,"uploadExtUsageStatsTimer",void 0),F(this,"uploadInboundExtStatsTimer",void 0),F(this,"requestStats",void 0),F(this,"requestTransportStats",void 0),F(this,"requestLocalMedia",void 0),F(this,"requestRemoteMedia",void 0),F(this,"requestAllTracks",void 0),F(this,"requestVideoIsReady",void 0),F(this,"requestUploadStats",void 0),F(this,"requestUpload",void 0),F(this,"uploadOutboundStarted",!1),F(this,"uploadInboundStarted",!1),F(this,"uploadTransportStarted",!1),F(this,"uploadExtensionUsageStarted",!1),F(this,"lastRecvStats",void 0),F(this,"lastSendStats",void 0),F(this,"lastFullRecvStats",void 0),F(this,"lastFullSendStats",void 0),F(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let n,o;if(this.uploadTransportStarted&&(n=this.requestStats(),this.store.useP2P&&(o=this.requestStats(!0))),!n&&this.uploadOutboundStarted&&(n=this.requestStats()),!o&&this.uploadInboundStarted&&(o=this.requestStats(!0)),n||o){const a={};if(this.uploadTransportStarted&&n){const d=this.getTransportStats(n,o,e);d&&(a.misc=[d])}if(this.uploadOutboundStarted&&n){const d=this.getOutboundStats(n,e?this.lastSendStats:this.lastFullSendStats,e);d&&(a.outbound=[d])}if(this.uploadInboundStarted&&o){const d=this.getInboundStats(o,e?this.lastRecvStats:this.lastFullRecvStats,e);d&&(a.inbound=d)}this.requestUploadStats(a)}this.lastRecvStats=o,this.lastSendStats=n,e||(this.lastFullRecvStats=o,this.lastFullSendStats=n)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(e!==bO),++e===bO+1&&(e=1)},ZR)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,n,o){if(!this.requestStats)return;if(o)return e.rtt==null?void 0:{addition:{[T0.RTT]:e.rtt,[T0.CONN_TYPE]:void 0}};const a=l9(e);if(this.store.useP2P){if(n){const d=l9(n);a[T0.CONN_TYPE]+=d[T0.CONN_TYPE]<<3}a[T0.CONN_TYPE]+=110}else a[T0.CONN_TYPE]+=100;return{addition:a}}getOutboundStats(e,n,o){if(!this.requestUploadStats||!this.requestLocalMedia)return;const a=this.requestLocalMedia();if(!a||a.length===0)return;let d,h,p;return a.forEach(m=>{let[_,{track:g,ssrcs:y}]=m;switch(_){case _E.LocalVideoLowTrack:case _E.LocalVideoTrack:if(_===_E.LocalVideoTrack){const C=function(L,U,K,J,_r){const _o=U.videoSend.find(u_=>u_.ssrc===L);if(!_o)return;const na={},{sentFrame:ba,inputFrame:_u}=_o;if(_u&&ba){const u_=_u.frameRate,W_=ba.frameRate;na[eS.FREEZE]=function(_v,hT){let FT=!0;return FT=!(_v<=5)&&(_v<=10?hT<3:_v<=20?hT<4:hT<5),FT}(u_,W_)?1:0}if(x_(na,eS.QP_SUM,_o.qpSumPerFrame),_r)return na;switch(ba&&(x_(na,eS.HEIGHT,ba.height),x_(na,eS.WIDTH,ba.width),x_(na,eS.FRAME_RATE,ba.frameRate)),na[eS.DISABLED]=J._originMediaStreamTrack&&!J._originMediaStreamTrack.enabled||J._mediaStreamTrack&&!J._mediaStreamTrack.enabled?1:0,_o.adaptionChangeReason){case"none":na[eS.ADAPTATION]=0;break;case"cpu":na[eS.ADAPTATION]=1;break;case"bandwidth":na[eS.ADAPTATION]=2;break;case"other":na[eS.ADAPTATION]=3}let _l=0;_o.adaptionChangeReason&&(_l+=h9(_o.adaptionChangeReason)),U.qualityLimitationReason&&(_l+=h9(U.qualityLimitationReason)<<3),na[eS.ADAPTATION]=_l,na[eS.PLAYER_STATUS]=u3[J._player?J._player.videoElementStatus:"uninit"],x_(na,eS.NACKS,_o.nacksCount),x_(na,eS.PLIS,_o.plisCount),x_(na,eS.FIRS,_o.firsCount),x_(na,eS.AVG_ENCODE,_o.avgEncodeMs);const _p=K&&K.videoSend.find(u_=>u_.ssrc===L);if(_p){let u_=_r?ZR:ZR*bO;_p.timestamp&&_o.timestamp&&(u_=_o.timestamp-_p.timestamp),_p.packets!=null&&_o.packets!=null&&x_(na,eS.PACKAGE_RATE,1e3*(_o.packets-_p.packets)/u_),_o.packetsLost!=null&&_p.packetsLost!=null&&x_(na,eS.PACKAGE_LOST,_o.packetsLost-_p.packetsLost),_p.bytes!=null&&_o.bytes!=null&&x_(na,eS.BITRATE,8*(_o.bytes-_p.bytes)/u_)}return na}(y[0].ssrcId,e,n,g,o),O=o?null:function(L,U,K){const J=U.videoSend.find(_l=>_l.ssrc===L);if(!J)return null;const _r={},_o=J.inputFrame,na=_o&&_o.height||K&&K.videoHeight||0,ba=_o&&_o.width||K&&K.videoWidth||0,_u=_o&&_o.frameRate||0;return x_(_r,_M.HEIGHT,na),x_(_r,_M.WIDTH,ba),x_(_r,_M.FRAME_RATE,_u),_r}(y[0].ssrcId,e,g),q=o?null:function(L){const U={};return x_(U,eS.RETRANSMIT,L.bitrate.retransmit),x_(U,eS.TARGET_ENCODED,L.bitrate.targetEncoded),x_(U,eS.ACTUAL_ENCODED,L.bitrate.actualEncoded),x_(U,eS.TRANSMIT,L.bitrate.transmit),x_(U,eS.BANDWIDTH,L.sendBandwidth),U}(e);h=Object.assign({},C,O,q)}else p=o?void 0:function(C,O,q){const L=O.videoSend.find(J=>J.ssrc===C);if(!L)return;const U={},K=L.sentFrame;if(K&&(x_(U,gO.HEIGHT,K.height),x_(U,gO.WIDTH,K.width),x_(U,gO.FRAME_RATE,K.frameRate)),q){const J=q.videoSend.find(_r=>_r.ssrc===C);if(J){let _r=ZR*bO;J.timestamp&&L.timestamp&&(_r=L.timestamp-J.timestamp),J.packets!=null&&L.packets!=null&&x_(U,gO.PACKAGE_RATE,1e3*(L.packets-J.packets)/_r),L.packetsLost!=null&&J.packetsLost!=null&&x_(U,gO.PACKAGE_LOST,L.packetsLost-J.packetsLost),J.bytes!=null&&L.bytes!=null&&x_(U,gO.BITRATE,8*(L.bytes-J.bytes)/_r)}}return U}(y[0].ssrcId,e,n);break;case _E.LocalAudioTrack:d=o?void 0:function(C,O,q,L){const U=O.audioSend.find(na=>na.ssrc===C);if(!U)return;const K={};K[AI.DISABLED]=L._originMediaStreamTrack&&!L._originMediaStreamTrack.enabled||L._mediaStreamTrack&&!L._mediaStreamTrack.enabled?1:0;const J=100*L._source.getAccurateVolumeLevel(),_r=U.inputLevel;if(_r!=null){const na=Math.ceil(50*Math.log10(100*_r+1));x_(K,AI.LEVEL,na)}x_(K,u9.PCM_LEVEL,J),x_(K,AI.AEC_RETURN_LOSS,U.aecReturnLoss),x_(K,AI.AEC_RETURN_LOSS_ENH,U.aecReturnLossEnhancement),K[AI.FREEZE]=0;const _o=q&&q.audioSend.find(na=>na.ssrc===C);if(_o){let na=ZR*bO;_o.timestamp&&U.timestamp&&(na=U.timestamp-_o.timestamp),_o.bytes!=null&&U.bytes!=null&&x_(K,AI.BITRATE,8*(U.bytes-_o.bytes)/na),_o.packets!=null&&U.packets!=null&&x_(K,AI.PACKAGE_RATE,1e3*(U.packets-_o.packets)/na)}return K}(y[0].ssrcId,e,n,g)}}),{high:h,low:p,audio:d}}getInboundStats(e,n,o){if(!this.requestRemoteMedia)return;const a=this.requestRemoteMedia()||[],d=[];return a.forEach(h=>{let[p,m]=h;const _={peer:p.uid};if(m.has(m_.VIDEO)&&p.videoTrack){const g=p._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(p._videoSSRC)||!1,y=p.videoTrack?function(C,O,q,L,U,K,J){var _r;const _o=O.videoRecv.find(W_=>W_.ssrc===C);if(!_o)return;const na={},{receivedFrame:ba,outputFrame:_u,decodeFrameRate:_l}=_o,_p=q&&q.videoRecv.find(W_=>W_.ssrc===C);if(na[bS.FREEZE]=U&&_D.isRemoteVideoFreeze(L,_o,_p)?1:0,x_(na,vO.FRAME_RATE_DECODE,_l),x_(na,bS.QP_SUM,_o.qpSumPerFrame),_o.framesRateFirefox&&x_(na,bS.FRAME_RATE,_o.framesRateFirefox),ba&&x_(na,bS.FRAME_RATE,ba.frameRate),_p){const W_=O.timestamp-q.timestamp||(J?ZR:bO*ZR);_o.packetsLost!=null&&_p.packetsLost!=null&&x_(na,bS.PACKAGE_LOST,_o.packetsLost-_p.packetsLost),_p.bytes!=null&&_o.bytes!=null&&x_(na,bS.BITRATE,8*(_o.bytes-_p.bytes)/W_),_p.packets!=null&&_o.packets!=null&&x_(na,bS.PACKAGE_RATE,1e3*(_o.packets-_p.packets)/W_)}if(J)return na;ba?(x_(na,bS.HEIGHT,ba.height),x_(na,bS.WIDTH,ba.width)):L&&(x_(na,bS.HEIGHT,L._videoHeight||0),x_(na,bS.WIDTH,L._videoWidth||0)),_u&&x_(na,vO.FRAME_RATE_OUTPUT,_u.frameRate);const u_=(_r=L._player)===null||_r===void 0?void 0:_r.rendFrameRate.toFixed(0);if(u_&&x_(na,vO.FRAME_RATE_RENDER,+u_),x_(na,bS.JITTER_BUFFER,_o.jitterBufferMs),x_(na,bS.CURRENT_DELAY,_o.currentDelayMs),x_(na,bS.FIRS,_o.firsCount),x_(na,bS.NACKS,_o.nacksCount),x_(na,bS.PLIS,_o.plisCount),L){na[bS.DISABLED]=L._originMediaStreamTrack.enabled&&L._mediaStreamTrack.enabled?0:1;const W_=L._player;if(W_){const{freezeTimeCounterList:_v,renderFreezeAccTime:hT,videoElementStatus:FT}=W_;if(_v&&_v.length>0&&x_(na,vO.FREEZE_TIME,_v.splice(0,1)[0]),K&&QR.visibility==="visible"&&FT===CS.PLAYING&&q_().supportRequestVideoFrameCallback){const ST=Math.min(6e3,hT);W_.renderFreezeAccTime=Math.max(0,hT-ST),x_(na,vO.FREEZE_TIME_RENDER,ST)}if(typeof _o.totalFreezesDuration=="number"){const ST=_p&&_p.totalFreezesDuration?_o.totalFreezesDuration-_p.totalFreezesDuration:_o.totalFreezesDuration;x_(na,vO.FREEZE_DURATION,1e3*ST)}}}if(na[bS.PLAYER_STATUS]=u3[L._player?L._player.videoElementStatus:"uninit"],_p&&_o.totalInterFrameDelay!==void 0&&_o.totalSquaredInterFrameDelay!==void 0&&_p.totalInterFrameDelay!==void 0&&_p.totalSquaredInterFrameDelay!==void 0){const W_=_o.totalInterFrameDelay-_p.totalInterFrameDelay,_v=_o.totalSquaredInterFrameDelay-_p.totalSquaredInterFrameDelay,hT=_o.framesDecodeCount-_p.framesDecodeCount,FT=W_/hT*1e3,ST=Math.round(1e3*Math.sqrt((_v-Math.pow(W_,2)/hT)/hT));!isNaN(ST)&&FT+ST>Math.max(3*FT,FT+150)&&(na[bS.I_FRAME_DELAY]=ST)}return na}(p._videoSSRC,e,n,p.videoTrack,g===!0,this.needUploadRenderFreezeTime,o):void 0;y&&(_.video=y)}if(m.has(m_.AUDIO)&&p.audioTrack){const g=p.audioTrack?function(y,C,O,q,L){const U=C.audioRecv.find(_p=>_p.ssrc===y);if(!U)return;const K={},J=O&&O.audioRecv.find(_p=>_p.ssrc===y),{receivedFrames:_r,droppedFrames:_o}=U;var na,ba;if(x_(K,z0.JITTER,U.jitterMs),_r!=null&&_o!=null&&(K[z0.FREEZE]=(ba=_o,(na=_r)===0||100*ba/na>20?1:0)),J){const _p=C.timestamp-O.timestamp||(L?ZR:ZR*bO);U.packets!=null&&J.packets!=null&&x_(K,z0.PACKAGE_RATE,1e3*(U.packets-J.packets)/_p),J.bytes!=null&&U.bytes!=null&&x_(K,z0.BITRATE,8*(U.bytes-J.bytes)/_p),U.packetsLost!=null&&J.packetsLost!=null&&x_(K,z0.PACKAGE_LOST,U.packetsLost-J.packetsLost)}if(L)return K;const _u=100*q._source.getAccurateVolumeLevel(),_l=U.outputLevel;if(_l!=null){const _p=Math.ceil(50*Math.log10(100*_l+1));x_(K,d9.LEVEL,_p)}if(x_(K,z0.PCM_LEVEL,_u),q&&(K[z0.DISABLED]=q._originMediaStreamTrack.enabled&&q._mediaStreamTrack.enabled?0:1),x_(K,z0.JITTER_BUFFER,U.jitterBufferMs),x_(K,z0.CURRENT_DELAY,U.jitterBufferMs),K[z0.PLAYER_STATUS]=u3[xS.getPlayerState(q.getTrackId())],J){const _p=U.concealedSamples-J.concealedSamples;_p>0&&x_(K,z0.CONCEALED_SAMPLES,_p)}return K}(p._audioSSRC,e,n,p.audioTrack,o):void 0;g&&(_.audio=g)}(_.video||_.audio)&&d.push(_)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,d}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof cM);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(eO.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,o]=e;o.has(m_.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(a=>{this.requestUpload&&this.requestUpload(a.type,a.stats)}),o.has(m_.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(a=>{this.requestUpload&&this.requestUpload(a.type,a.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),o={connectionInterval:$("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let a=[];const d=this.requestAllTracks&&this.requestAllTracks()||[];for(const _ of d)!_.muted&&_.enabled&&(a=a.concat(await _.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[_,g]of h)g.has(m_.VIDEO)&&_.videoTrack&&(a=a.concat(await _.videoTrack.getProcessorUsage())),g.has(m_.AUDIO)&&_.audioTrack&&(a=a.concat(await _.audioTrack.getProcessorUsage()));if(a.length===0)return;o.details=function(_,g){const y={};for(const{id:L,value:U,level:K,direction:J}of _){var C;const _r=(C=g.get(L))!==null&&C!==void 0?C:0,_o=U===2?_r+$("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:_r;var O,q;g.set(L,_o),y[L]?(U===2&&(y[L].value=U),K>y[L].level&&(y[L].level=K),J==="remote"&&(y[L].remoteUidCount+=1),y[L].totalTs=(O=g.get(L))!==null&&O!==void 0?O:0):y[L]={value:U,level:K,remoteUidCount:J==="local"?0:1,totalTs:(q=g.get(L))!==null&&q!==void 0?q:0}}return Object.keys(y).map(L=>{const{level:U,value:K,totalTs:J}=y[L];return{id:L,level:U,value:K,totalTs:J}})}(a,e);const p=Date.now(),m=p>n?p:n+1;this.requestUpload&&this.requestUpload(eO.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:m})},$("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class NI{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){F(this,"uid",void 0),F(this,"_uintid",void 0),F(this,"_trust_in_room_",!0),F(this,"_trust_audio_enabled_state_",!0),F(this,"_trust_video_enabled_state_",!0),F(this,"_trust_audio_mute_state_",!0),F(this,"_trust_video_mute_state_",!0),F(this,"_audio_muted_",!1),F(this,"_video_muted_",!1),F(this,"_audio_enabled_",!0),F(this,"_video_enabled_",!0),F(this,"_audio_added_",!1),F(this,"_video_added_",!1),F(this,"_is_pre_created",!1),F(this,"_video_pre_subscribed",!1),F(this,"_audio_pre_subscribed",!1),F(this,"_trust_video_stream_added_state_",!0),F(this,"_trust_audio_stream_added_state_",!0),F(this,"_audioTrack",void 0),F(this,"_videoTrack",void 0),F(this,"_dataChannels",[]),F(this,"_audioSSRC",void 0),F(this,"_videoSSRC",void 0),F(this,"_audioOrtc",void 0),F(this,"_videoOrtc",void 0),F(this,"_cname",void 0),F(this,"_rtxSsrcId",void 0),F(this,"_videoMid",void 0),F(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}let dR=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});function Mpt(t,e){var n;let o;switch(e){case _E.LocalAudioTrack:o=lb.Audio;break;case _E.LocalVideoTrack:o=o_(n=t._hints).call(n,lT.SCREEN_TRACK)?lb.Screen:lb.High;break;case _E.LocalVideoLowTrack:o=lb.Low}return o}function P3(t){const e=q_();if(t.some(n=>n._bypassWebAudio))throw new ya(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new ya(Y.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function D3(t,e){P3(t);const n=new YT;return t.forEach(o=>n.addAudioTrack(o)),n}var f9,m9,E9,_9,g9,v9,b9,y9,T9,S9,R9,vT;function C9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function gM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?C9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}let ZS=(f9=lR(dR.SEND_ONLY),m9=lR(dR.SEND_ONLY),E9=lR(),_9=lR(dR.RECEIVE_ONLY),g9=lR(dR.RECEIVE_ONLY),v9=lR(dR.RECEIVE_ONLY),b9=lR(dR.RECEIVE_ONLY),y9=lR(dR.RECEIVE_ONLY),T9=lR(dR.RECEIVE_ONLY),S9=lR(),R9=lR(dR.RECEIVE_ONLY),vT=class extends ET{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(I_.StateChange,e,this._state)}constructor(t,e){super(),F(this,"store",void 0),F(this,"statsUploader",void 0),F(this,"sendConnection",void 0),F(this,"recvConnection",void 0),F(this,"localTrackMap",new Map),F(this,"remoteUserMap",new Map),F(this,"localDataChannels",[]),F(this,"pendingLocalTracks",[]),F(this,"pendingRemoteTracks",[]),F(this,"statsCollector",void 0),F(this,"dtlsFailedCount",0),F(this,"sendMutex",new nS("P2PChannel2-send-mutex")),F(this,"recvMutex",new nS("P2PChannel2-recv-mutex")),F(this,"_state",_b.Disconnected),F(this,"_restartStates",["disconnected","failed"]),F(this,"reconnectInterval",void 0),F(this,"uploadUnplinkStarted",!1),F(this,"uploadDownlinkStarted",!1),F(this,"uplinkStateUploadInterval",void 0),F(this,"downlinkStatsUploadInterval",void 0),F(this,"handleMuteLocalTrack",async(n,o,a)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==_b.Connected)return void a(new ya(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const m=this.filterTobeMutedTracks(n);if(m.length===0)return void o();const _=m.find(O=>O[0]==="videoLowTrack");_&&_[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(m.map(O=>{let[,{id:q}]=O;return q}));let g=!1;var h,p;n.trackMediaType==="video"?g=!((h=this.localTrackMap.get(_E.LocalAudioTrack))===null||h===void 0||!h.track._muted):g=((p=this.localTrackMap.get(_E.LocalVideoTrack))===null||p===void 0?void 0:p.id)===void 0;const y=this.createMuteMessage(m);await oT(this,I_.RequestMuteLocal,y);const C=n.trackMediaType==="video"?gI.MUTE_LOCAL_VIDEO:gI.MUTE_LOCAL_AUDIO;await oT(this,I_.RequestP2PMuteLocal,{action:C,message:y,isMuteAll:g}),o()}catch(m){a(m)}finally{d()}}),F(this,"handleUnmuteLocalTrack",async(n,o,a)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==_b.Connected)return void a(new ya(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(n);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(_=>{let[,{id:g}]=_;return g}));const p=this.createUnmuteMessage(h),m=n.trackMediaType==="video"?gI.UNMUTE_LOCAL_VIDEO:gI.UNMUTE_LOCAL_AUDIO;await oT(this,I_.RequestP2PMuteLocal,{action:m,message:p}),o()}catch(h){a(h)}finally{d()}}),F(this,"handleUpdateVideoEncoder",async(n,o,a)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const h=this.localTrackMap.get(_E.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==n||this.state!==_b.Connected)return void o();const{id:p,track:m}=h;p&&(await this.sendConnection.updateSendParameters(p,m),await this.sendConnection.updateEncoderConfig(p,m),this.emit(I_.UpdateVideoEncoder,m)),o()}catch(h){a(h)}finally{d()}}),F(this,"handleUpdateVideoSendParameters",async(n,o,a)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(_E.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==n||this.state!==_b.Connected)return void o();const{id:p,track:m}=h;p&&await this.sendConnection.updateSendParameters(p,m),o()}catch(h){a(h)}finally{d()}}),F(this,"handleReplaceTrack",async(n,o,a,d)=>{let h;A.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var p;const _=Array.from(this.localTrackMap.entries()).find(g=>{let[,{track:y}]=g;return n===y});if(!this.sendConnection||!_||_[1].id===void 0||this.state!==_b.Connected)return void o();if(await((p=this.sendConnection)===null||p===void 0?void 0:p.replaceTrack(n,_[1].id)),_[0]===_E.LocalVideoTrack&&q_().supportDualStreamEncoding){const g=this.localTrackMap.get(_E.LocalVideoLowTrack);if(g){const y=n._mediaStreamTrack.clone();g.track._originMediaStreamTrack.stop(),g.track._mediaStreamTrack=y,g.track._originMediaStreamTrack=y,await new n_((C,O)=>{this.handleReplaceTrack(g.track,C,O,!0)})}}o()}catch(_){a(_)}finally{var m;(m=h)===null||m===void 0||m()}}),F(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),F(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),F(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),F(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new p9(t),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},$("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new ya(Y.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t,e,n,o,a,d){throw new ya(Y.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(A.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new c9(t,this.store,PS.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(e);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=_b.New,this.sendConnection&&(A.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new c9(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new ya(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=_b.Connected}async addRemoteCandidate(t,e){if(e===PS.RECEIVE_ONLY){if(!this.sendConnection)throw new ya(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new ya(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var o=this;return QS(function*(){const a=yield L_(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==_b.Connected){o.throwIfTrackTypeNotMatch(t);const _=t.filter(g=>o.pendingLocalTracks.indexOf(g)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(_))}o.store.pubId=o.store.pubId+1,gS.markPublishStart(o.store.clientId,o.store.pubId);const d=o.filterTobePublishedTracks(t,e,n);if(d.length===0)return void(yield L_(o.tryToUnmuteAudio(t)));d.forEach(_=>{let{track:g,type:y}=_;const C=Date.now();o.store.publish(g.getTrackId(),y===_E.LocalAudioTrack?"audio":"video",C)}),o.bindLocalTrackEvents(d);const h=yield L_(o.sendConnection.send(d.map(_=>{let{track:g}=_;return g}),o.store.codec,o.store.audioCodec)),p=(yield L_(h.next())).value,m=o.createGatewayPublishMessage(d,p);try{yield m}catch(_){throw h.throw(_),(_==null?void 0:_.code)===Y.WS_ABORT&&d.forEach(g=>{let{track:y}=g;o.pendingLocalTracks.indexOf(y)===-1&&o.pendingLocalTracks.push(y)}),o.unbindLocalTrackEvents(d),_}yield L_(h.next()),d.forEach(_=>{let{type:g}=_;o.statsCollector.addLocalStats(g)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(d,p),d.forEach(_=>{let{track:g,type:y}=_;const C=Date.now();o.store.publish(g.getTrackId(),y===_E.LocalAudioTrack?"audio":"video",void 0,C)}),o.startUploadUplinkState()}finally{a()}})()}async unpublish(t){if(!this.sendConnection||this.state!==_b.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(a=>!o_(t).call(t,a)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(a=>a[0]==="videoLowTrack");n&&n[1].track.close();const o=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(a=>{let[,{id:d}]=a;return d})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(a=>{let[d,{track:h}]=a;return{type:d,track:h}})),e.forEach(a=>{let[d]=a;this.statsCollector.removeLocalStats(d)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===_b.Connected)return n&&n[1].track.close(),o;t.forEach(a=>{const d=this.pendingLocalTracks.indexOf(a);d!==-1&&this.pendingLocalTracks.splice(d,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[a,{track:d,ssrcs:h}]=o;const p={stream_type:Mpt(d,a),ssrcs:h};d._muted||!d._enabled?e.push(p):n.push(p)}),e.length>0&&e.forEach(o=>{oT(this,I_.RequestMuteLocal,[o])}),n.length>0&&n.forEach(o=>{oT(this,I_.RequestUnmuteLocal,[o])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return QS(function*(){throw new ya(Y.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(A.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await GT(this,I_.RequestRePublish,this.pendingLocalTracks),this.emit(I_.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ya(Y.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,o){var a;if(!this.recvConnection)throw new ya(Y.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((a=this.remoteUserMap.get(t))!==null&&a!==void 0&&a.has(e))return;const{track:d,mid:h,transceiver:p}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),o);e===m_.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(d):(t._audioTrack=new ON(d,t.uid,t._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),p&&t._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(d):(t._videoTrack=new wN(d,t.uid,t._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),p&&t._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(t,t._videoTrack));const m=this.remoteUserMap.get(t);m?m.set(e,h):this.remoteUserMap.set(t,new Map([[e,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const _=this.pendingRemoteTracks.findIndex(g=>{let{user:y,kind:C}=g;return y.uid===t.uid&&e===C});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(I_.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,o){if(!this.recvConnection)throw new ya(Y.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),o)}async unsubscribe(t,e,n){const o=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:p}=d;return e!==void 0?h.uid===t.uid&&e===p:h.uid===t.uid});if(o.forEach(d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||n||o.forEach(d=>{let{kind:h}=d;var p;if(h===m_.AUDIO)(p=t._audioTrack)===null||p===void 0||p._destroy(),t._audioTrack=void 0;else if(h===m_.VIDEO){var m;(m=t._videoTrack)===null||m===void 0||m._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const a=this.filterTobeUnSubscribedTracks(t,e);a.length!==0&&(await this.recvConnection.stopReceiving(a.map(d=>{let[,{id:h}]=d;return h})),this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),a.forEach(d=>{let[h,{kind:p}]=d;var m,_;if(p===m_.VIDEO&&h._videoSSRC&&((m=this.recvConnection)===null||m===void 0||m.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),p===m_.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),n||((_=h._videoTrack)===null||_===void 0||_._destroy(),h._videoTrack=void 0);else if(p===m_.AUDIO){var g;this.unbindRemoteTrackEvents(h._audioTrack),!n&&((g=h._audioTrack)===null||g===void 0||g._destroy(),h._audioTrack=void 0)}}),a.forEach(d=>{let[,{kind:h}]=d;oT(this,I_.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[m_.VIDEO,m_.AUDIO].forEach(o=>{n.has(o)?oT(this,I_.RequestP2PUnmuteRemote,o):oT(this,I_.RequestP2PMuteRemote,o)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new ya(Y.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new ya(Y.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new ya(Y.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new ya(Y.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void A.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void A.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const o=e===m_.VIDEO?t._videoSSRC:t._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void A.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||A.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(_E.LocalAudioTrack);if((e==null?void 0:e.track)instanceof YT){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[a]=o;return a!==_E.LocalAudioTrack}).filter(o=>{let[a]=o;return!(t&&a===_E.LocalVideoLowTrack)}).map(o=>{let[,{track:a}]=o;return a}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[o]=n;return!(t&&o===_E.LocalVideoLowTrack)}).map(n=>{let[,{track:o}]=n;return o})}reportPublishEvent(t,e,n,o,a){if(t){const h=this.localTrackMap.get(_E.LocalAudioTrack),p=o?this.localTrackMap.get(_E.LocalVideoLowTrack):this.localTrackMap.get(_E.LocalVideoTrack);E_.publish(this.store.sessionId,{eventElapse:gS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(lT.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var d;n||(n=[]);const h=n.find(m=>m instanceof OT),p=o?(d=this.localTrackMap.get(_E.LocalVideoTrack))===null||d===void 0?void 0:d.track:n.find(m=>m instanceof aT);E_.publish(this.store.sessionId,{eventElapse:gS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:h==null?void 0:h.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(lT.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(t,e,n,o){const a=o===m_.VIDEO?n._videoSSRC:n._audioSSRC;a&&E_.subscribe(this.store.sessionId,{succ:t,ec:e,video:o===m_.VIDEO,audio:o===m_.AUDIO,peerid:n.uid,subscribeRequestid:o===m_.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:gS.measureFromSubscribeStart(this.store.clientId,a)})}reset(){A.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new nS("P2PChannel2-send-mutex"),this.sendMutex=new nS("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(_E.LocalAudioTrack);if((t==null?void 0:t.track)instanceof YT){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=_b.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(_E.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(_E.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof aT||e&&e.track instanceof OT?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(e0(e=this.remoteUserMap).call(e)).find(o=>o.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[o]=n;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(_E.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=$N(t).call(t,(n,o)=>n.level-o.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(A.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=_b.Reconnecting,$("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:o}]=t;switch(n){case _E.LocalVideoTrack:o_(e=o._hints).call(e,lT.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case _E.LocalAudioTrack:o instanceof YT?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case _E.LocalVideoLowTrack:}}),this.emit(I_.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(e0(n).call(n)).forEach(o=>{this.setPendingRemoteMedia(e,o)}),this.emit(I_.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),A.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:o,kind:a}=n;if((t instanceof NI?t.uid:t)===o.uid&&e===a)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,o;if(t===PS.SEND_ONLY){if(!this.sendConnection)throw new ya(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new ya(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(e){const a=await o.restartICE(e);return o.isInRestartIce=!1,a}{const a=await o.restartICE();if(a){const d=await GT(this,I_.RequestP2PRestartICE,{direction:PS.RECEIVE_ONLY,iceParameter:a});await o.restartICE(d),o.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(_E.LocalVideoTrack),n=this.localTrackMap.get(_E.LocalAudioTrack),o=t.videoSend.find(O=>{var q;return O.ssrc===(e==null||(q=e.ssrcs)===null||q===void 0?void 0:q[0].ssrcId)}),a=t.audioSend.find(O=>{var q;return O.ssrc===(n==null||(q=n.ssrcs)===null||q===void 0?void 0:q[0].ssrcId)});if(!o||!a)return 1;const d=JS(this,I_.NeedSignalRTT),h=o?o.rttMs:void 0,p=a?a.rttMs:void 0,m=h&&p?(h+p)/2:h||p,_=(m&&d?(m+d)/2:m||d)||0,g=100*t.sendPacketLossRate*.7/50+.3*_/1500,y=g<.17?1:g<.36?2:g<.59?3:g<.1?4:5,C=e==null?void 0:e.track;if(C&&C._encoderConfig&&C._hints.indexOf(lT.SCREEN_TRACK)===-1){const O=C._encoderConfig.bitrateMax,q=t.bitrate.actualEncoded;if(O&&q){const L=(1e3*O-q)/(1e3*O);return k8[L<.15?0:L<.3?1:L<.45?2:L<.6?3:4][y]}}return y}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[o]=n;const a=o._audioSSRC,d=o._videoSSRC,h=t.audioRecv.find(q=>q.ssrc===a),p=t.videoRecv.find(q=>q.ssrc===d);if(!h&&!p)return void(e+=1);const m=JS(this,I_.NeedSignalRTT),_=t.rtt,g=(_&&m?(_+m)/2:_||m)||0,y=h?h.jitterMs:void 0,C=t.recvPacketLossRate;let O=.7*C*100/50+.3*g/1500;y&&(O=.6*C*100/50+.2*g/1500+.2*y/400),e+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new n_((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const o=[],a=q_(),d=this.getAllTracks();t=ZO(t=t.filter(m=>d.indexOf(m)===-1));let h=!1,p=!1;for(const m of t){if(m instanceof aT&&(this.localTrackMap.has(_E.LocalVideoTrack)||h?new ya(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:m,type:_E.LocalVideoTrack}),h=!0),e)){const _=this.getLowVideoTrack(m,n);o.push({track:_,type:_E.LocalVideoLowTrack})}if(m instanceof OT){const _=this.localTrackMap.get(_E.LocalAudioTrack);if(_){if(!(_.track instanceof YT))throw new ya(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new ya(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(p){const g=o.find(y=>{let{type:C}=y;return C===_E.LocalAudioTrack});if(!(g.track instanceof YT))throw new ya(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new ya(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");g.track.addAudioTrack(m)}else{if(!a.webAudioMediaStreamDest||m instanceof YT||m._bypassWebAudio)o.push({track:m,type:_E.LocalAudioTrack});else{const g=new YT;g.addAudioTrack(m),o.push({track:g,type:_E.LocalAudioTrack})}p=!0}}}return o}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=ZO(t=t.filter(o=>n.indexOf(o)!==-1));for(const o of t){if(o instanceof OT){const a=this.localTrackMap.get(_E.LocalAudioTrack);if(!a)continue;a.track instanceof YT?(a.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),a.track.trackList.length===0&&(e.push([_E.LocalAudioTrack,a]),a.track.close())):e.push([_E.LocalAudioTrack,a])}if(o instanceof aT){const a=this.localTrackMap.get(_E.LocalVideoTrack);if(!a)continue;e.push([_E.LocalVideoTrack,a]);const d=this.localTrackMap.get(_E.LocalVideoLowTrack);d&&e.push([_E.LocalVideoLowTrack,d])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:o}=e;switch(o){case _E.LocalVideoTrack:n.addListener(c_.GET_STATS,this.handleGetLocalVideoStats),n.addListener(c_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(c_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(c_.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(c_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(c_.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(c_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(c_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _E.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case _E.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof YT?t.trackList.forEach(n=>{n.addListener(c_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(c_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(c_.GET_STATS,this.handleGetLocalAudioStats),n.addListener(c_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(c_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(c_.GET_STATS,this.handleGetLocalAudioStats),t.addListener(c_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(c_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(c_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(c_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(c_.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:o}]=e;return{track:o,type:n}})),t.forEach(e=>{let{track:n,type:o}=e;switch(o){case _E.LocalVideoTrack:n.off(c_.GET_STATS,this.handleGetLocalVideoStats),n.off(c_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(c_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(c_.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(c_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(c_.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(c_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(c_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _E.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case _E.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof YT?t.trackList.forEach(e=>{e.off(c_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(c_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(c_.GET_STATS,this.handleGetLocalAudioStats),e.off(c_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(c_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(c_.GET_STATS,this.handleGetLocalAudioStats),t.off(c_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(c_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(c_.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(c_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(c_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof wN&&e.addListener(c_.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof ON&&e.addListener(c_.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(c_.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(m_.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(m_.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,o)=>{var a;let d,{track:h,type:p}=n;switch(p){case _E.LocalAudioTrack:d=lb.Audio;break;case _E.LocalVideoTrack:d=o_(a=h._hints).call(a,lT.SCREEN_TRACK)?lb.Screen:lb.High;break;case _E.LocalVideoLowTrack:d=lb.Low}return{kind:p===_E.LocalAudioTrack?m_.AUDIO:m_.VIDEO,stream_type:d,mid:e[o].id,ssrcs:e[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let o,[a,{track:d,ssrcs:h,id:p}]=e;switch(a){case _E.LocalVideoTrack:o=o_(n=d._hints).call(n,lT.SCREEN_TRACK)?lb.Screen:lb.High;break;case _E.LocalAudioTrack:o=lb.Audio;break;case _E.LocalVideoLowTrack:o=lb.Low}return{stream_type:o,ssrcs:h,mid:p}})}assignLocalTracks(t,e){t.forEach((n,o)=>{let{track:a,type:d}=n;this.localTrackMap.set(d,{track:a,id:e[o].id,ssrcs:e[o].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit(I_.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),o_(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await $T(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),E_.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:IT.TRACER}).onSuccess(),this.emit(I_.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const o=Array.from(e0(n=this.remoteUserMap).call(n)).find(d=>d._audioSSRC===e);var a;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(a=o.audioTrack)===null||a===void 0||a.emit(SN.FIRST_FRAME_DECODED),E_.firstRemoteFrame(this.store.sessionId,rS.FIRST_AUDIO_DECODE,yT.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:gS.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const o=Array.from(e0(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===e);o&&E_.firstRemoteFrame(this.store.sessionId,rS.FIRST_AUDIO_RECEIVED,yT.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:gS.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,o)=>{this.reportVideoFirstFrameDecoded(e,n,o)},t.onFirstVideoReceived=e=>{var n;const o=Array.from(e0(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===e);o&&E_.firstRemoteFrame(this.store.sessionId,rS.FIRST_VIDEO_RECEIVED,yT.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:gS.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const o=e.candidateType==="relay",a=n.candidateType==="relay";n.candidateType!=="unknown"&&o===a||this.emit(I_.ConnectionTypeChange,o),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(bI(n))," -> ").concat(JSON.stringify(bI(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(bI(n))," -> ").concat(JSON.stringify(bI(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(I_.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===PS.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,A.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===PS.SEND_ONLY?this.restartICE(t):GT(this,I_.RequestP2PRestartICE,{direction:PS.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(_E.LocalAudioTrack);if(t instanceof OT&&(n==null?void 0:n.track)instanceof YT)return n.track.isActive||e.push([_E.LocalAudioTrack,n]),e;const o=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:d}]=a;return t===d});if(o&&(e.push(o),o[0]===_E.LocalVideoTrack)){const a=this.localTrackMap.get(_E.LocalVideoLowTrack);a&&e.push([_E.LocalVideoLowTrack,a])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(_E.LocalAudioTrack);if(t instanceof OT&&(n==null?void 0:n.track)instanceof YT)return n.track.isActive&&e.push([_E.LocalAudioTrack,n]),e;const o=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:d}]=a;return t===d});if(o)if(o[0]===_E.LocalVideoTrack){e.push(o);const a=this.localTrackMap.get(_E.LocalVideoLowTrack);a&&e.push([_E.LocalVideoLowTrack,a])}else e.push(o);return e}createMuteMessage(t){return t.map(e=>{var n;let o,[a,{track:d,ssrcs:h,id:p}]=e;switch(a){case _E.LocalAudioTrack:o=lb.Audio;break;case _E.LocalVideoTrack:o=o_(n=d._hints).call(n,lT.SCREEN_TRACK)?lb.Screen:lb.High;break;case _E.LocalVideoLowTrack:o=lb.Low}return{stream_type:o,ssrcs:h,mid:p}})}createUnmuteMessage(t){return t.map(e=>{var n;let o,[a,{track:d,ssrcs:h,id:p}]=e;switch(a){case _E.LocalAudioTrack:o=lb.Audio;break;case _E.LocalVideoTrack:o=o_(n=d._hints).call(n,lT.SCREEN_TRACK)?lb.Screen:lb.High;break;case _E.LocalVideoLowTrack:o=lb.Low}return{stream_type:o,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(t,e){const n=[],o=this.remoteUserMap.get(t);if(!o)return n;if(e){const a=o.get(e);if(!a)return n;n.push([t,{kind:e,id:a}])}else Array.from(o.entries()).forEach(a=>{let[d,h]=a;n.push([t,{kind:d,id:h}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[o,{kind:a,id:d}]=n;switch(a){case m_.VIDEO:return void(o._videoSSRC&&e.push({stream_type:m_.VIDEO,ssrcId:o._videoSSRC}));case m_.AUDIO:return void(o._audioSSRC&&e.push({stream_type:m_.AUDIO,ssrcId:o._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:o}]=e;const a=this.remoteUserMap.get(n);a&&(a.delete(o),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(_E.LocalVideoTrack),n=this.localTrackMap.get(_E.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),n&&t.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof OT){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const o=this.createUnmuteMessage(n);return void await oT(this,I_.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(I_.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(I_.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await $T(y1(this.dtlsFailedCount,xT)),this.emit(I_.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(_E.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof aT)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof aT).length>1)throw new ya(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof OT).length>1&&(t.some(e=>e instanceof OT&&e._bypassWebAudio)||!q_().webAudioMediaStreamDest))throw new ya(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof aT&&this.pendingLocalTracks.some(n=>n instanceof aT))throw new ya(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof OT&&this.pendingLocalTracks.some(n=>n instanceof OT)&&(!q_().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof OT&&n._bypassWebAudio)))throw new ya(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&q_().supportDualStreamEncoding,o=gM(gM({},{width:160,height:120,framerate:15,bitrate:50}),e);let a;a=n?t._mediaStreamTrack.clone():N3(t,o);const d=sT(8,"track-low-"),h=new aT(a,gM(gM({},n&&{scaleResolutionDownBy:sG(o,t)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,d);return h.on(pO.TRANSCEIVER_UPDATED,p=>{t._updateRtpTransceiver(p,yN.LOW_STREAM)}),h._hints.push(lT.LOW_STREAM),t.addListener(c_.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,o){var a;const d=Array.from(e0(a=this.remoteUserMap).call(a)).find(h=>h._videoSSRC===t);if(d){o||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,p=h.subscribe.find(m=>m.userId===d.uid&&m.type==="video");E_.firstRemoteVideoDecode(this.store.sessionId,rS.FIRST_VIDEO_DECODE,yT.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:e,videoheight:n,subscribeElapse:gS.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(t);if(!o)return!1;const a=o.get(e);if(!a)return!1;const d=await this.recvConnection.getRemoteSSRC(a);return d!==void 0&&d!==n}resetConnection(t){A.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(t)),this.state===_b.Connected?(A.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(t){throw new ya(Y.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new ya(Y.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new ya(Y.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new ya(Y.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new ya(Y.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new ya(Y.NOT_SUPPORTED)}async preConnect(t,e,n,o,a,d){throw new ya(Y.NOT_SUPPORTED)}getEstablishParams(){throw new ya(Y.NOT_SUPPORTED)}async reSubscribe(t){throw new ya(Y.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new ya(Y.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===_E.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,yN.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},e_(vT.prototype,"p2pConnect",[f9],Object.getOwnPropertyDescriptor(vT.prototype,"p2pConnect"),vT.prototype),e_(vT.prototype,"unpublish",[m9],Object.getOwnPropertyDescriptor(vT.prototype,"unpublish"),vT.prototype),e_(vT.prototype,"unpublishLowStream",[E9],Object.getOwnPropertyDescriptor(vT.prototype,"unpublishLowStream"),vT.prototype),e_(vT.prototype,"subscribe",[_9],Object.getOwnPropertyDescriptor(vT.prototype,"subscribe"),vT.prototype),e_(vT.prototype,"mockSubscribe",[g9],Object.getOwnPropertyDescriptor(vT.prototype,"mockSubscribe"),vT.prototype),e_(vT.prototype,"unsubscribe",[v9],Object.getOwnPropertyDescriptor(vT.prototype,"unsubscribe"),vT.prototype),e_(vT.prototype,"muteRemote",[b9],Object.getOwnPropertyDescriptor(vT.prototype,"muteRemote"),vT.prototype),e_(vT.prototype,"unmuteRemote",[y9],Object.getOwnPropertyDescriptor(vT.prototype,"unmuteRemote"),vT.prototype),e_(vT.prototype,"hasRemoteMediaWithLock",[T9],Object.getOwnPropertyDescriptor(vT.prototype,"hasRemoteMediaWithLock"),vT.prototype),e_(vT.prototype,"disconnectForReconnect",[S9],Object.getOwnPropertyDescriptor(vT.prototype,"disconnectForReconnect"),vT.prototype),e_(vT.prototype,"remoteMediaSsrcChanged",[R9],Object.getOwnPropertyDescriptor(vT.prototype,"remoteMediaSsrcChanged"),vT.prototype),vT);function lR(t){return function(e,n,o){const a=e[n];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];switch(t){case dR.SEND_ONLY:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await a.apply(this,h)}finally{m()}}case dR.RECEIVE_ONLY:{const m=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await a.apply(this,h)}finally{m()}}default:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(n)),_=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await a.apply(this,h)}finally{m(),_()}}}},o}}function I9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function yO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?I9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}class _D{constructor(e){F(this,"store",void 0),F(this,"onStatsException",void 0),F(this,"onUploadPublishDuration",void 0),F(this,"onStatsChanged",void 0),F(this,"localStats",new Map),F(this,"remoteStats",new Map),F(this,"updateStatsInterval",void 0),F(this,"trafficStats",void 0),F(this,"trafficStatsPeerList",[]),F(this,"uplinkStats",void 0),F(this,"exceptionMonitor",void 0),F(this,"p2pChannel",void 0),F(this,"scalabilityMode",mdt.L1T1),F(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new _pt,this.exceptionMonitor.on("exception",(n,o,a)=>{this.onStatsException&&this.onStatsException(n,o,a)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(_E.LocalAudioTrack)||yO({},a3)}getLocalVideoTrackStats(){return this.localStats.get(_E.LocalVideoTrack)||yO({},c3)}getRemoteAudioTrackStats(e){const n=(d,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(e){var a;const d=(a=this.remoteStats.get(e))===null||a===void 0?void 0:a.audioStats;d&&(o[e]=n(e,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:p}]=d;p&&(o[h]=n(h,p))});return o}getRemoteNetworkQualityStats(e){const n={};if(e){var o;const a=(o=this.remoteStats.get(e))===null||o===void 0?void 0:o.networkStats;a&&(n[e]=a)}else Array.from(this.remoteStats.entries()).forEach(a=>{let[d,{networkStats:h}]=a;h&&(n[d]=h)});return n}getRemoteVideoTrackStats(e){const n=(d,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(e){var a;const d=(a=this.remoteStats.get(e))===null||a===void 0?void 0:a.videoStats;d&&(o[e]=n(e,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:p}]=d;p&&(o[h]=n(h,p))});return o}getRTCStats(){let e=0,n=0,o=0,a=0;const d=this.localStats.get(_E.LocalAudioTrack);d&&(e+=d.sendBytes,n+=d.sendBitrate);const h=this.localStats.get(_E.LocalVideoTrack);h&&(e+=h.sendBytes,n+=h.sendBitrate);const p=this.localStats.get(_E.LocalVideoLowTrack);p&&(e+=p.sendBytes,n+=p.sendBitrate),this.remoteStats.forEach(_=>{let{audioStats:g,videoStats:y}=_;g&&(o+=g.receiveBytes,a+=g.receiveBitrate),y&&(o+=y.receiveBytes,a+=y.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:n,SendBytes:e,RecvBytes:o,RecvBitrate:a,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var o;const a=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(n.peer_uid),d=a!=null&&a.videoSSRC?gS.measureFromSubscribeStart(this.store.clientId,a.videoSSRC):0,h=a!=null&&a.audioSSRC?gS.measureFromSubscribeStart(this.store.clientId,a.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&A.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,o){if(!e)return!1;const a=!!o&&n.framesDecodeFreezeTime>o.framesDecodeFreezeTime,d=!o||n.framesDecodeCount>o.framesDecodeCount;return a||!d}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[o,a]=n;switch(o){case _E.LocalVideoTrack:case _E.LocalVideoLowTrack:{const h=a,p=yO({},c3),m=e.getStats(),_=e.getLocalMedia(o);if(m){const g=m.videoSend.find(y=>y.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(g){const y=e.getLocalVideoSize(),C=e.getEncoderConfig(_E.LocalVideoTrack);g.codec!=="H264"&&g.codec!=="H265"&&g.codec!=="VP8"&&g.codec!=="VP9"&&g.codec!=="AV1X"&&g.codec!=="AV1"||(p.codecType=g.codec),p.sendBytes=g.bytes,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0,g.inputFrame?(p.captureFrameRate=g.inputFrame.frameRate,p.captureResolutionHeight=g.inputFrame.height,p.captureResolutionWidth=g.inputFrame.width):y&&(p.captureResolutionWidth=y.width,p.captureResolutionHeight=y.height),g.sentFrame?(p.sendFrameRate=g.sentFrame.frameRate,p.sendResolutionHeight=g.sentFrame.height,p.sendResolutionWidth=g.sentFrame.width):y&&(p.sendResolutionWidth=y.width,p.sendResolutionHeight=y.height),g.avgEncodeMs&&(p.encodeDelay=g.avgEncodeMs),C&&C.bitrateMax&&(p.targetSendBitrate=1e3*C.bitrateMax),p.sendPackets=g.packets,p.sendPacketsLost=g.packetsLost,p.sendJitterMs=g.jitterMs,p.sendRttMs=g.rttMs,p.totalDuration=h?h.totalDuration+1:1,p.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(g)&&(p.totalFreezeTime+=1),g.scalabilityMode&&this.scalabilityMode!==g.scalabilityMode&&(A.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(g.scalabilityMode)),this.scalabilityMode=g.scalabilityMode)}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(o,p),((h==null?void 0:h.sendResolutionWidth)!==p.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==p.sendResolutionHeight)&&((d=this.onStatsChanged)===null||d===void 0||d.call(this,"resolution",{width:p.sendResolutionWidth,height:p.sendResolutionHeight})),p&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,p);break}case _E.LocalAudioTrack:{const h=a,p=yO({},a3),m=e.getStats(),_=e.getLocalMedia(o);if(m){const g=m.audioSend.find(y=>y.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(g){if(g.codec!=="opus"&&g.codec!=="aac"&&g.codec!=="PCMU"&&g.codec!=="PCMA"&&g.codec!=="G722"||(p.codecType=g.codec),g.inputLevel)p.sendVolumeLevel=Math.round(32767*g.inputLevel);else{const y=e.getLocalAudioVolume();y&&(p.sendVolumeLevel=Math.round(32767*y))}p.sendBytes=g.bytes,p.sendPackets=g.packets,p.sendPacketsLost=g.packetsLost,p.sendJitterMs=g.jitterMs,p.sendRttMs=g.rttMs,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0}}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(_E.LocalAudioTrack,p),p&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,p);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var o,a;let[d,{videoStats:h,audioStats:p,videoPcStats:m}]=n;const _=p,g=h,y=m,C=yO({},VY),O=yO({},FY),q=yO({},opt),{audioTrack:L,videoTrack:U,audioSSRC:K,videoSSRC:J}=e.getRemoteMedia(d);let _r;_r=e instanceof ZS?e.getStats(!0):e.getStats();const _o=(o=_r)===null||o===void 0?void 0:o.audioRecv.find(_u=>_u.ssrc===K),na=(a=_r)===null||a===void 0?void 0:a.videoRecv.find(_u=>_u.ssrc===J),ba=this.trafficStats&&this.trafficStats.peer_delay.find(_u=>_u.peer_uid===d);if(_o&&(_o.codec!=="opus"&&_o.codec!=="aac"&&_o.codec!=="PCMU"&&_o.codec!=="PCMA"&&_o.codec!=="G722"||(C.codecType=_o.codec),_o.outputLevel?C.receiveLevel=Math.round(32767*_o.outputLevel):L&&(C.receiveLevel=Math.round(32767*L.getVolumeLevel())),C.receiveBytes=_o.bytes,C.receivePackets=_o.packets,C.receivePacketsLost=_o.packetsLost,C.packetLossRate=C.receivePacketsLost/(C.receivePackets+C.receivePacketsLost),C.receiveBitrate=_?8*Math.max(0,C.receiveBytes-_.receiveBytes):0,C.totalDuration=_?_.totalDuration+1:1,C.totalFreezeTime=_?_.totalFreezeTime:0,C.freezeRate=C.totalFreezeTime/C.totalDuration,C.receiveDelay=_o.jitterBufferMs,C.totalDuration>10&&_D.isRemoteAudioFreeze(L)&&(C.totalFreezeTime+=1)),na){na.codec!=="H264"&&na.codec!=="H265"&&na.codec!=="VP8"&&na.codec!=="VP9"&&na.codec!=="AV1X"&&na.codec!=="AV1"||(O.codecType=na.codec),O.receiveBytes=na.bytes,O.receiveBitrate=g?8*Math.max(0,O.receiveBytes-g.receiveBytes):0,O.decodeFrameRate=na.decodeFrameRate<0?0:na.decodeFrameRate,O.renderFrameRate=na.decodeFrameRate<0?0:na.decodeFrameRate,na.outputFrame&&(O.renderFrameRate=na.outputFrame.frameRate),na.receivedFrame?(O.receiveFrameRate=na.receivedFrame.frameRate,O.receiveResolutionHeight=na.receivedFrame.height,O.receiveResolutionWidth=na.receivedFrame.width):U&&(O.receiveResolutionHeight=U._videoHeight||0,O.receiveResolutionWidth=U._videoWidth||0),na.framesRateFirefox!==void 0&&(O.receiveFrameRate=Math.round(na.framesRateFirefox)),O.receivePackets=na.packets,O.receivePacketsLost=na.packetsLost,O.packetLossRate=O.receivePacketsLost/(O.receivePackets+O.receivePacketsLost),O.totalDuration=g?g.totalDuration+1:1,O.totalFreezeTime=g?g.totalFreezeTime:0,O.receiveDelay=na.jitterBufferMs||0;const _u=!!J&&e.getRemoteVideoIsReady(J);U&&_u&&_D.isRemoteVideoFreeze(U,na,y)&&(O.totalFreezeTime+=1),O.freezeRate=O.totalFreezeTime/O.totalDuration}ba&&(C.end2EndDelay=ba.B_ad,O.end2EndDelay=ba.B_vd,C.transportDelay=ba.B_ed,O.transportDelay=ba.B_ed,C.currentPacketLossRate=ba.B_ealr4/100,O.currentPacketLossRate=ba.B_evlr4/100,q.uplinkNetworkQuality=ba.B_punq?ba.B_punq:0,q.downlinkNetworkQuality=ba.B_pdnq?ba.B_pdnq:0),this.remoteStats.set(d,{audioStats:C,videoStats:O,videoPcStats:na,networkStats:q}),L&&this.exceptionMonitor.setRemoteAudioStats(L,C),U&&this.exceptionMonitor.setRemoteVideoStats(U,O)})}}function w9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function _k(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?w9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}class Upt extends ET{constructor(e,n,o,a){super(),F(this,"spec",void 0),F(this,"token",void 0),F(this,"websocket",void 0),F(this,"pingpongTimer",void 0),F(this,"reconnectMode","retry"),F(this,"serviceMode",void 0),F(this,"reqId",0),F(this,"commandReqId",0),F(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),F(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):this.serviceMode===iS.INJECT?this.emit(SR.INJECT_STREAM_STATUS,h):(E_.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===iS.TRANSCODE?1:2}),this.emit(SR.PUBLISH_STREAM_STATUS,h))}),this.spec=n,this.token=e,this.serviceMode=a,this.websocket=new TP("live-streaming",o),this.websocket.on(O_.CONNECTED,this.handleWebSocketOpen),this.websocket.on(O_.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(O_.REQUEST_NEW_URLS,(d,h)=>{GT(this,SR.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(O_.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,o,a){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new _s(Y.UNEXPECTED_ERROR);const p=_k({command:e,sdkVersion:E0==="4.21.0"?"0.0.1":E0,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new _s(Y.WS_DISCONNECT);const m=()=>new n_((C,O)=>{this.websocket.once(O_.CLOSED,()=>O(new _s(Y.WS_ABORT))),this.websocket.once(O_.CONNECTED,C)});this.websocket.state!=="connected"&&await m(),p.clientRequest&&(p.clientRequest.workerToken=this.token);const _=new n_((C,O)=>{const q=()=>{O(new _s(Y.WS_ABORT))};this.websocket.once(O_.RECONNECTING,q),this.websocket.once(O_.CLOSED,q),this.once("@".concat(h,"-").concat(this.spec.sid),L=>{C(L)})});a&&E_.workerEvent(this.spec.sid,_k(_k({},a),{},{requestId:d,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const g=Date.now();this.websocket.sendMessage(p);let y=null;try{y=await _}catch(C){if(this.websocket.state==="closed")throw C;return await m(),await this.request(e,n,o)}return a&&E_.workerEvent(this.spec.sid,_k(_k({},a),{},{requestId:d,actionType:"response",payload:JSON.stringify(y.serverResponse),serverCode:y.code,success:y.code===200,responseTime:Date.now()-g})),y.code!==200&&this.handleResponseError(y),y}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=E0==="4.21.0"?"0.0.1":E0;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case zT.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void A.warning("live stream response already exists stream");case zT.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case zT.LIVE_STREAM_RESPONSE_BAD_STREAM:case zT.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new _s(Y.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case zT.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream"||e.serverResponse.command==="UninjectStream")return;throw new _s(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case zT.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new _s(Y.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case zT.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new _s(Y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(SR.WARNING,n,e.serverResponse.url)}case zT.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new _s(Y.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(SR.WARNING,n,e.serverResponse.url)}case zT.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new _s(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case zT.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new _s(Y.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case zT.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new _s(Y.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(SR.WARNING,n,e.serverResponse.url)}case zT.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new _s(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case zT.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new _s(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case zT.LIVE_STREAM_RESPONSE_WORKER_LOST:case zT.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream"||e.serverResponse.command==="UninjectStream")return;throw new _s(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case zT.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream"||e.serverResponse.command==="UninjectStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new _s(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new _s(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case zT.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case zT.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case zT.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case zT.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new _s(Y.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(v1)},6e3)}}function O9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function jS(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?O9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}class xpt extends ET{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:xT,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:xT;super(),F(this,"onLiveStreamWarning",void 0),F(this,"onLiveStreamError",void 0),F(this,"onInjectStatusChange",void 0),F(this,"spec",void 0),F(this,"retryTimeout",1e4),F(this,"connection",void 0),F(this,"httpRetryConfig",void 0),F(this,"wsRetryConfig",void 0),F(this,"streamingTasks",new Map),F(this,"isStartingStreamingTask",!1),F(this,"taskMutex",new nS("live-streaming")),F(this,"cancelToken",MS.CancelToken.source()),F(this,"transcodingConfig",void 0),F(this,"injectConfig",jS({},gdt)),F(this,"injectLoopTimes",0),F(this,"uapResponse",void 0),F(this,"lastTaskId",1),F(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=o,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=jS(jS({},_dt),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(A.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(h=>jS(jS(jS({},Edt),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){CT(h.width)||nT(h.width,"config.width",0,1e4),CT(h.height)||nT(h.height,"config.height",0,1e4),CT(h.videoBitrate)||nT(h.videoBitrate,"config.videoBitrate",1,1e6),CT(h.videoFrameRate)||nT(h.videoFrameRate,"config.videoFrameRate"),CT(h.lowLatency)||BR(h.lowLatency,"config.lowLatency"),CT(h.audioSampleRate)||JT(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),CT(h.audioBitrate)||nT(h.audioBitrate,"config.audioBitrate",1,128),CT(h.audioChannels)||JT(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),CT(h.videoGop)||nT(h.videoGop,"config.videoGop"),CT(h.videoCodecProfile)||JT(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),CT(h.userCount)||nT(h.userCount,"config.userCount",0,17),CT(h.backgroundColor)||nT(h.backgroundColor,"config.backgroundColor",0,16777215),CT(h.userConfigExtraInfo)||cS(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!CT(h.transcodingUsers)&&(GR(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((p,m)=>{w1(p.uid),CT(p.x)||nT(p.x,"transcodingUser[".concat(m,"].x"),0,1e4),CT(p.y)||nT(p.y,"transcodingUser[".concat(m,"].y"),0,1e4),CT(p.width)||nT(p.width,"transcodingUser[".concat(m,"].width"),0,1e4),CT(p.height)||nT(p.height,"transcodingUser[".concat(m,"].height"),0,1e4),CT(p.zOrder)||nT(p.zOrder-1,"transcodingUser[".concat(m,"].zOrder"),0,100),CT(p.alpha)||nT(p.alpha,"transcodingUser[".concat(m,"].alpha"),0,1,!1)})),CT(h.watermark)||nG(h.watermark,"watermark"),CT(h.backgroundImage)||nG(h.backgroundImage,"backgroundImage"),h.images&&!CT(h.images)&&(GR(h.images,"config.images"),h.images.forEach((p,m)=>{nG(p,"images[".concat(m,"]"))}))}(n);const o=[];n.images&&o.push(...n.images.map(h=>jS(jS(jS({},eG),h),{},{zOrder:255}))),n.backgroundImage&&(o.push(jS(jS(jS({},eG),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(o.push(jS(jS(jS({},eG),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=o,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(h=>jS({},h)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const a=(n.userConfigs||[]).map(h=>typeof h.uid=="number"?n_.resolve(h.uid):pK(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await n_.all(a)).forEach((h,p)=>{n.userConfigs&&n.userConfigs[p]&&(n.userConfigs[p].uid=h)}),this.transcodingConfig=n,this.connection)try{var d;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(nR(d=this.streamingTasks).call(d)).map(p=>p.taskId).join("#")});A.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(p=>{A.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,h).then(()=>{A.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(p.url," success"))}).catch(m=>{A.error("[".concat(this.spec.clientId,"] live streaming republish failed"),p.url,m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)})})}}setInjectStreamConfig(e,n){this.injectConfig=Object.assign({},this.injectConfig,e),this.injectLoopTimes=n}async startLiveStreamingTask(e,n,o){var a;if(Array.from(nR(a=this.streamingTasks).call(a)).find(_=>_.mode===iS.INJECT)&&n===iS.INJECT)return new _s(Y.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&n===iS.TRANSCODE)throw new _s(Y.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let h={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};A.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const p=await this.taskMutex.lock();if(!this.connection&&o)return void p();if(this.streamingTasks.get(e)&&!o)return p(),new _s(Y.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(_){throw p(),_}switch(n){case iS.TRANSCODE:h.transcodingConfig=jS({},this.transcodingConfig);break;case iS.RAW:break;case iS.INJECT:h={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:e,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(h.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const m=this.lastTaskId++;try{const _=new n_((y,C)=>{$T(this.retryTimeout).then(()=>{if(o)return C(o);const O=this.statusError.get(e);return O?(this.statusError.delete(e),C(O)):void 0})}),g=await n_.race([this.connection.request("request",{clientRequest:h},!0,{url:e,command:"PublishStream",workerType:n===iS.TRANSCODE?1:2,requestByUser:!o,tid:m.toString()}),_]);this.isStartingStreamingTask=!1,A.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(e,{clientRequest:h,mode:n,url:e,taskId:m}),p()}catch(_){if(p(),this.isStartingStreamingTask=!1,!_.data||!_.data.retry||o)throw _;return _.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,_)):await this.startLiveStreamingTask(e,n,_)}}stopLiveStreamingTask(e){return new n_((n,o)=>{const a=this.streamingTasks.get(e);if(!a||!this.connection)return new _s(Y.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=a.mode;a.abortTask=()=>{A.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:d===iS.INJECT?"UninjectStream":"UnpublishStream",url:a.url}},!1,{url:e,command:"UnPublishStream",workerType:d===iS.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{A.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&d!==iS.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),n(),d===iS.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(eN.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,e)}).catch(o)})}async controlInjectStream(e,n,o,a){const d=this.streamingTasks.get(e);if(!d||!this.connection||d.mode!==iS.INJECT)throw new _s(Y.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:e,control:n,audioVolume:o,position:a}})).serverResponse}resetAllTask(){var e;const n=Array.from(nR(e=this.streamingTasks).call(e));this.terminate();for(const o of n)this.startLiveStreamingTask(o.url,o.mode).catch(a=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,a)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=MS.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new _s(Y.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await GT(this,O1.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new Upt(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(SR.WARNING,(o,a)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(a,o)),this.connection.on(SR.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(SR.INJECT_STREAM_STATUS,o=>this.handleInjectStreamServerStatus(o)),this.connection.on(SR.REQUEST_NEW_ADDRESS,(o,a)=>{if(!this.connection)return a(new _s(Y.UNEXPECTED_ERROR,"can not get new live streaming address list"));GT(this,O1.REQUEST_WORKER_MANAGER_LIST,e).then(d=>{this.uapResponse=d,o(d.addressList)}).catch(a)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",o=this.streamingTasks.get(n),a=e.reason;switch(e.code){case zT.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case zT.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case zT.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case zT.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new _s(Y.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(o)return A.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,h);if(!this.isStartingStreamingTask)return;this.statusError.set(n,h)}case zT.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new _s(Y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,a);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,h)}case zT.LIVE_STREAM_RESPONSE_WORKER_LOST:case zT.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(nR(d=this.streamingTasks).call(d));for(const p of h)p.abortTask?p.abortTask():(A.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new _s(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{A.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(m=>{A.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)}));return}}}handleInjectStreamServerStatus(e){const n=Number(e.uid),o=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(eN.INJECT_STREAM_STATUS_START_SUCCESS,n,o));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(eN.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,n,o),void this.streamingTasks.delete(o);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(eN.INJECT_STREAM_STATUS_START_UNAUTHORIZED,n,o),void this.streamingTasks.delete(o);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(eN.INJECT_STREAM_STATUS_BROKEN,n,o),void this.streamingTasks.delete(o);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(eN.INJECT_STREAM_STATUS_START_TIMEOUT,n,o),void this.streamingTasks.delete(o);default:return void A.debug("inject stream server status",e)}}hasUrl(e){return this.streamingTasks.has(e)}}class A9{constructor(){F(this,"destChannelMediaInfos",new Map),F(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){B8(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){B8(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){I1(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function N9(t){if(!(t instanceof A9))return new _s(Y.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new _s(Y.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new _s(Y.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class jpt extends ET{constructor(e,n,o){super(),F(this,"ws",void 0),F(this,"requestId",1),F(this,"heartBeatTimer",void 0),F(this,"joinInfo",void 0),F(this,"clientId",void 0),F(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),F(this,"onClose",a=>{this.emit("close"),this.dispose()}),F(this,"onMessage",a=>{const d=JSON.parse(a.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=e,this.clientId=n,this.ws=new TP("cross-channel-".concat(this.clientId),o),this.ws.on(O_.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(O_.CONNECTED,this.onOpen),this.ws.on(O_.ON_MESSAGE,this.onMessage),this.ws.on(O_.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new n_((n,o)=>{const a=window.setTimeout(()=>{o(new _s(Y.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,d=>{window.clearTimeout(a),d.state&&d.state!==0?o(new _s(Y.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(a),o(new _s(Y.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new _s(Y.WS_DISCONNECT);const n=()=>new n_((h,p)=>{this.ws.once(O_.CLOSED,()=>p(new _s(Y.WS_ABORT))),this.ws.once(O_.CONNECTED,h)});this.ws.state!=="connected"&&await n();const o=this.sendMessage(e),a=new n_((h,p)=>{const m=()=>{p(new _s(Y.WS_ABORT))};this.ws.once(O_.RECONNECTING,m),this.ws.once(O_.CLOSED,m),this.once("req_".concat(o),h),$T(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(O_.RECONNECTING,m),this.ws.off(O_.CLOSED,m),p(new _s(Y.TIMEOUT,"cross channel ws request timeout"))})}),d=await a;if(!d||d.code!==200)throw new _s(Y.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(e){this.ws.removeAllListeners(O_.REQUEST_NEW_URLS),this.ws.on(O_.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Vpt extends ET{set state(e){e!==this._state&&(e!==FS.RELAY_STATE_FAILURE&&(this.errorCode=nN.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,o,a,d){super(),F(this,"joinInfo",void 0),F(this,"sid",void 0),F(this,"clientId",void 0),F(this,"cancelToken",MS.CancelToken.source()),F(this,"workerToken",void 0),F(this,"requestId",0),F(this,"signal",void 0),F(this,"prevChannelMediaConfig",void 0),F(this,"httpRetryConfig",void 0),F(this,"_resolution",void 0),F(this,"_state",FS.RELAY_STATE_IDLE),F(this,"errorCode",nN.RELAY_OK),F(this,"onStatus",h=>{A.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",HR.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",HR.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=nN.SRC_TOKEN_EXPIRED,this.state=FS.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=nN.DEST_TOKEN_EXPIRED,this.state=FS.RELAY_STATE_FAILURE))}),F(this,"onReconnect",async()=>{A.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",HR.NETWORK_DISCONNECTED),this.state=FS.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==FS.RELAY_STATE_IDLE&&(A.error("auto restart channel media relay failed",h.toString()),this.errorCode=nN.SERVER_CONNECTION_LOST,this.state=FS.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=_P(),this.signal=new jpt(this.joinInfo,this.clientId,o),this.httpRetryConfig=a,this._resolution=d}async startChannelMediaRelay(e){if(this.state!==FS.RELAY_STATE_IDLE)throw new _s(Y.INVALID_OPERATION);this.state=FS.RELAY_STATE_CONNECTING,await this.connect(),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new _s(Y.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new _s(Y.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new _s(Y.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==FS.RELAY_STATE_RUNNING)throw new _s(Y.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==FS.RELAY_STATE_RUNNING)throw new _s(Y.INVALID_OPERATION);const n=this.genMessage(DS.SetVideoProfile);await this.signal.request(n),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),A.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=FS.RELAY_STATE_IDLE,this.dispose()}dispose(){A.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=MS.CancelToken.source(),this.state=FS.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await jdt(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",HR.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(DS.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(DS.SetSdkProfile,e);await this.signal.request(o),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const a=this.genMessage(DS.SetSourceChannel,e);await this.signal.request(a),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",HR.PACKET_JOINED_SRC_CHANNEL),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const d=this.genMessage(DS.SetSourceUserId,e);await this.signal.request(d),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(DS.SetDestChannel,e);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",HR.PACKET_JOINED_DEST_CHANNEL),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const p=this.genMessage(DS.StartPacketTransfer,e);await this.signal.request(p),this.emit("event",HR.PACKET_SENT_TO_DEST_CHANNEL),this.state=FS.RELAY_STATE_RUNNING,A.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(DS.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",HR.PACKET_UPDATE_DEST_CHANNEL),A.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(DS.StopPacketTransfer);await this.signal.request(e),A.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const o=[],a=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:E0,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.21.0"&&(h.sdkVersion="0.0.1");let p=null,m=null;switch(e){case DS.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case DS.SetSourceChannel:if(m=n&&n.getSrcChannelMediaInfo(),!m)throw new _s(Y.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},h;case DS.SetSourceUserId:if(m=n&&n.getSrcChannelMediaInfo(),!m)throw new _s(Y.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:m.uid+""},h;case DS.SetDestChannel:if(p=n&&n.getDestChannelMediaInfo(),!p)throw new _s(Y.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{o.push(_.channelName),a.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:a,token:d},h;case DS.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case DS.Reconnect:return h.clientRequest={command:"Reconnect"},h;case DS.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case DS.UpdateDestChannel:if(p=n&&n.getDestChannelMediaInfo(),!p)throw new _s(Y.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{o.push(_.channelName),a.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:a,token:d},h;case DS.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}function vM(t){var e={},n=!1;function o(a,d){return n=!0,{done:!1,value:new v3(d=new b3(function(h){h(t[a](d))}),1)}}return e[WO!==void 0&&_q||"@@iterator"]=function(){return this},e.next=function(a){return n?(n=!1,a):o("next",a)},typeof t.throw=="function"&&(e.throw=function(a){if(n)throw n=!1,a;return o("throw",a)}),typeof t.return=="function"&&(e.return=function(a){return n?(n=!1,a):o("return",a)}),e}var P9=l(BJ);function D9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function k9(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?D9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):D9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}var cT;function L9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function M9(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?L9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):L9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}let PN=(cT=class iL extends N1{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return o_(n=Object.keys(_A)).call(n,e)}))]}constructor(e,n){super(e,n),F(this,"store",void 0),F(this,"peerConnection",void 0),F(this,"remoteSDP",void 0),F(this,"initialOffer",void 0),F(this,"statsFilter",void 0),F(this,"useRTX",!1),F(this,"localCapabilities",void 0),F(this,"localCandidateCount",0),F(this,"allCandidatesReceived",!1),F(this,"establishPromise",void 0),F(this,"mutex",new nS("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(iL.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=pM(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,iT()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=cR(e.sdp),o=$P(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=e,M9(M9({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:e.sdp})}catch(e){throw new ya(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,n,o,a,d,h){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(m){F(this,"sessionDesc",void 0),F(this,"localCapabilities",void 0),F(this,"rtpCapabilities",void 0),F(this,"candidates",void 0),F(this,"iceParameters",void 0),F(this,"dtlsParameters",void 0),F(this,"setup",void 0),F(this,"currentMidIndex",void 0),F(this,"cname",void 0),m=dT(m);const{remoteIceParameters:_,remoteDtlsParameters:g,candidates:y,remoteRTPCapabilities:C,remoteSetup:O,localCapabilities:q,sdkCodec:L,cname:U}=m,K=gT.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=C,this.candidates=y,this.iceParameters=_,this.dtlsParameters=g,this.setup=O,this.localCapabilities=q,this.cname=U;for(let J=0;J<K.mediaDescriptions.length;J++){const _r=K.mediaDescriptions[J];if(_r.attributes.iceUfrag=_.iceUfrag,_r.attributes.icePwd=_.icePwd,_r.attributes.fingerprints=g.fingerprints,_r.attributes.candidates=y,_r.attributes.setup=O,_r.media.mediaType==="video"){_r.media.fmts=C.videoCodecs.map(na=>na.payloadType.toString(10));let _o=C.videoCodecs.filter(na=>{var ba,_u;return(ba=na.rtpMap)===null||ba===void 0?void 0:o_(_u=ba.encodingName.toLowerCase()).call(_u,L)});_o.length===0&&(_o=C.videoCodecs),_r.attributes.payloads=_o,_r.attributes.extmaps=C.videoExtensions}_r.media.mediaType==="audio"&&(_r.media.fmts=C.audioCodecs.map(_o=>_o.payloadType.toString(10)),_r.attributes.payloads=C.audioCodecs,_r.attributes.extmaps=C.audioExtensions),K.mediaDescriptions[J]=this.mungMediaDesc(_r)}this.sessionDesc=K,this.currentMidIndex=K.mediaDescriptions.length-1}toString(){return gT.print(this.sessionDesc)}send(m,_,g){const{ssrcs:y,ssrcGroups:C}=h0(_,this.cname),O=this.sessionDesc.mediaDescriptions.find(U=>m===m_.VIDEO?U.media.mediaType==="video":U.media.mediaType==="audio"),q=y[0].attributes.label,L=y[0].attributes.mslabel;return O.attributes.ssrcs=O.attributes.ssrcs.concat(y),O.attributes.ssrcGroups=O.attributes.ssrcGroups.concat(C),{id:q,mslabel:L}}batchSend(m){return m.map(_=>{let{kind:g,ssrcMsg:y}=_;return this.send(g,y,void 0)})}stopSending(m){this.sessionDesc.mediaDescriptions.forEach(_=>{const g=[],y=[],C=[];_.attributes.ssrcs.forEach(O=>{o_(m).call(m,O.attributes.label||"")?C.push(O):g.push(O)}),_.attributes.ssrcGroups.forEach(O=>{var q;o_(q=C.map(L=>L.ssrcId)).call(q,O.ssrcIds[0])||y.push(O)}),_.attributes.ssrcs=g,_.attributes.ssrcGroups=y})}mute(m){const _=this.sessionDesc.mediaDescriptions.find(g=>g.attributes.mid===m);if(!_)throw new Error("mediaDescription not found with ".concat(m," in remote SDP when calling RemoteSDP.mute."));_.attributes.direction="inactive"}unmute(m){const _=this.sessionDesc.mediaDescriptions.find(g=>g.attributes.mid===m);if(!_)throw new Error("mediaDescription not found with ".concat(m," in remote SDP when calling RemoteSDP.unmute."));_.attributes.direction="sendonly"}receive(m,_,g){m.forEach((y,C)=>{const O=y._mediaStreamTrack,q=this.sessionDesc.mediaDescriptions.findIndex(U=>U.attributes.mid===O.kind),L=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[q],y);this.sessionDesc.mediaDescriptions[q]=L})}stopReceiving(m){}updateCandidates(m){m===SS.TCP?this.candidates.forEach(_=>{this.candidates.findIndex(g=>g.transport==="tcp"&&g.connectionAddress===_.connectionAddress&&g.port===_.port)===-1&&this.candidates.push(k9(k9({},_),{},{foundation:"tcpcandidate",priority:Number(_.priority)-1+"",transport:"tcp",port:Number(_.port)+90+""}))}):this.candidates=this.candidates.filter(_=>_.transport!=="tcp");for(const _ of this.sessionDesc.mediaDescriptions)_.attributes.candidates=this.candidates}restartICE(m){m=dT(m),this.iceParameters=m,this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.iceUfrag=m.iceUfrag,_.attributes.icePwd=m.icePwd})}predictReceivingMids(m){const _=[];for(let g=0;g<m;g++)_.push((this.currentMidIndex+g+1).toString(10));return _}mungRecvMediaDsec(m,_){const g=dT(m);return wI(g,_),mM(g,_),g}updateRecvMedia(m,_){const g=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===m);if(g!==-1){const y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[g],_);this.sessionDesc.mediaDescriptions[g]=y}}bumpMid(m){this.currentMidIndex+=m}updateTrackLabel(m,_,g){const y=this.sessionDesc.mediaDescriptions.find(O=>m===m_.VIDEO?O.attributes.mid==="video":O.attributes.mid==="audio");if(y){const O=y.attributes.ssrcs.find(q=>q.attributes.label===_);var C;O&&(O.attributes.label=g,(C=O.attributes.msid)===null||C===void 0||C.replace(_,g))}}mungMediaDesc(m){const _=dT(m);return fM(_),function(g){const y=g.attributes.extmaps.find(C=>C.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");y&&g.attributes.extmaps.splice(g.attributes.extmaps.indexOf(y),1),g.attributes.payloads.forEach(C=>{const O=C.rtcpFeedbacks.findIndex(q=>q.type==="transport-cc");O!==-1&&C.rtcpFeedbacks.splice(O,1)})}(_),_}getSSRC(m){for(const _ of this.sessionDesc.mediaDescriptions)for(const g of _.attributes.ssrcs)if(g.attributes.label===m)return[g]}}({remoteIceParameters:e,remoteDtlsParameters:n,candidates:o,remoteRTPCapabilities:a.send,remoteSetup:d,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:h});const p=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(p){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(p.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new ya(Y.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(e,n){var o=this;return QS(function*(){const a=yield L_(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=e.map(C=>o.peerConnection.addTrack(C._mediaStreamTrack)),h=yield L_(o.peerConnection.createOffer()),p=gT.parse(h.sdp),m=e.map(C=>{const O=C._mediaStreamTrack,q=p.mediaDescriptions.find(L=>L.attributes.mid===O.kind);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return function(L,U,K){const J=L.attributes.ssrcs.filter(_o=>_o.attributes.label===U),_r=L.attributes.ssrcGroups;if(J.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(_r&&J.length>1){const _o=_r.find(na=>na.ssrcIds.indexOf(J[0].ssrcId)!==-1);return _o?[{ssrcId:_o.ssrcIds[0],rtx:K?_o.ssrcIds[1]:void 0}]:[{ssrcId:J[0].ssrcId}]}return[{ssrcId:J[0].ssrcId}]}(q,O.id,o.useRTX)});let _;try{_=yield m}catch(C){throw d.forEach(O=>{ZT()&&O.replaceTrack(null),o.peerConnection.removeTrack(O)}),C}const g=o.mungSendOfferSDP(h.sdp,e);o.remoteSDP.receive(e,n,_);const y=o.remoteSDP.toString();return yield L_(o.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield L_(o.applySendEncodings(d,e)),yield L_(o.peerConnection.setRemoteDescription({type:"answer",sdp:y})),e.map((C,O)=>{const q=C._mediaStreamTrack.id;return{localSSRC:m[O],id:q}})}catch(d){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{a()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(d=>{var h;return e.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(d=>{ZT()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(e);const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,o,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:d,mslabel:h}=this.remoteSDP.send(e,n,a),p=new n_((g,y)=>{const C=setTimeout(()=>{y(new Error("Cannot receive track, id: ".concat(d)))},1e4),O=q=>{const L=Y_();if((L.name==="Safari"&&Number(L.version)===11||ES())&&q.track.id!==d&&q.streams[0].id===h){var U;const K=q.streams[0].getTracks()[0];return(U=this.remoteSDP)===null||U===void 0||U.updateTrackLabel(e,d,q.track.id),this.peerConnection.removeEventListener("track",O),clearTimeout(C),void g(K)}if(q.track.id===d)return this.peerConnection.removeEventListener("track",O),clearTimeout(C),void g(q.track)};this.peerConnection.addEventListener("track",O)}),m=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});const _=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(_),{track:await p,id:d}}catch(d){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(o=>{var a;return e.indexOf(((a=o.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(o=>{if(ZT()&&o.track)o.track.enabled=!1;else{const a=o.getParameters();a.encodings.forEach(d=>d.active=!1),o.setParameters(a)}})}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(d=>{var h;return e.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async d=>{if(ZT()&&d.track)d.track.enabled=!0;else{const h=d.getParameters();h.encodings.forEach(p=>p.active=!0),await d.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return QS(function*(){const o=yield L_(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(q_().supportPCSetConfiguration){const m=n.peerConnection.getConfiguration(),_=e===SS.RELAY?"relay":"all";m.iceTransportPolicy!==_&&(A.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,n.peerConnection.setConfiguration(m))}else if(e===SS.RELAY)return;e!==SS.RELAY&&n.remoteSDP.updateCandidates(e);const a=yield L_(n.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=cR(a.sdp),{remoteIceParameters:h}=yield d.iceParameters;n.remoteSDP.restartICE(h);const p=n.remoteSDP.toString();yield L_(n.peerConnection.setLocalDescription(a)),yield L_(n.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(a){A.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),a)}finally{o()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(o.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(o){throw new ya(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(e,n){const o=this.peerConnection.getSenders().filter(a=>{var d;return((d=a.track)===null||d===void 0?void 0:d.id)===e});o.length===1&&await this.applySendEncodings(o,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const o=this.peerConnection.getSenders().find(a=>{var d;return((d=a.track)===null||d===void 0?void 0:d.id)===n});o&&await o.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new ya(Y.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new ya(Y.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(QO(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...iL.turnServerConfigToIceServers(e.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...iL.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(o=>{o.security?o.tcpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var o;if(n||(n=this.peerConnection.getSenders().find(_=>{var g;return((g=_.track)===null||g===void 0?void 0:g.id)===e._mediaStreamTrack.id})),!n)return A.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!q_().supportSetRtpSenderParameters)return A.warn("Browser not support set rtp-sender parameters");const a={},d={};if(e instanceof aT)switch(e._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if($("DSCP_TYPE")&&hI()){var h;const _=$("DSCP_TYPE");o_(h=["very-low","low","medium","high"]).call(h,_)&&(d.networkPriority=_)}const p=n.getParameters(),m=(o=p.encodings)===null||o===void 0?void 0:o[0];m&&Object.assign(m,d),Object.assign(p,a),A.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await n.setParameters(p)}async applySendEncodings(e,n){try{if(!q_().supportSetRtpSenderParameters||e.length!==n.length)return;for(let o=0;o<e.length;o++){const a=e[o],d=n[o];a&&d&&await this.updateRtpSenderEncodings(d,a)}}catch{A.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const o=gT.parse(e);return n.forEach((a,d)=>{const h=a._mediaStreamTrack,p=o.mediaDescriptions.find(m=>m.attributes.mid===h.kind);p&&wI(p,a)}),gT.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,o)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,e,n,o)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((d,h)=>{let{id:p,mslabel:m}=d;const{kind:_}=e[h];return new n_((g,y)=>{const C=setTimeout(()=>{y(new Error("Cannot receive track, id: ".concat(p)))},1e4),O=q=>{const L=Y_();if(L.name==="Safari"&&Number(L.version)===11&&q.track.id!==p&&q.streams[0].id===m){var U;const K=q.streams[0].getTracks()[0];return(U=this.remoteSDP)===null||U===void 0||U.updateTrackLabel(_,p,q.track.id),this.peerConnection.removeEventListener("track",O),clearTimeout(C),void g({track:K,id:p})}if(q.track.id===p)return this.peerConnection.removeEventListener("track",O),clearTimeout(C),void g({track:q.track,id:p})};this.peerConnection.addEventListener("track",O)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const a=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(a),await n_.all(n)}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(q_().supportPCSetConfiguration){const n=iL.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},e_(cT.prototype,"connect",[S0],Object.getOwnPropertyDescriptor(cT.prototype,"connect"),cT.prototype),e_(cT.prototype,"stopSending",[S0],Object.getOwnPropertyDescriptor(cT.prototype,"stopSending"),cT.prototype),e_(cT.prototype,"receive",[S0],Object.getOwnPropertyDescriptor(cT.prototype,"receive"),cT.prototype),e_(cT.prototype,"stopReceiving",[S0],Object.getOwnPropertyDescriptor(cT.prototype,"stopReceiving"),cT.prototype),e_(cT.prototype,"muteRemote",[S0],Object.getOwnPropertyDescriptor(cT.prototype,"muteRemote"),cT.prototype),e_(cT.prototype,"unmuteRemote",[S0],Object.getOwnPropertyDescriptor(cT.prototype,"unmuteRemote"),cT.prototype),e_(cT.prototype,"muteLocal",[S0],Object.getOwnPropertyDescriptor(cT.prototype,"muteLocal"),cT.prototype),e_(cT.prototype,"unmuteLocal",[S0],Object.getOwnPropertyDescriptor(cT.prototype,"unmuteLocal"),cT.prototype),e_(cT.prototype,"close",[S0],Object.getOwnPropertyDescriptor(cT.prototype,"close"),cT.prototype),e_(cT.prototype,"updateEncoderConfig",[S0],Object.getOwnPropertyDescriptor(cT.prototype,"updateEncoderConfig"),cT.prototype),e_(cT.prototype,"updateSendParameters",[S0],Object.getOwnPropertyDescriptor(cT.prototype,"updateSendParameters"),cT.prototype),e_(cT.prototype,"replaceTrack",[S0],Object.getOwnPropertyDescriptor(cT.prototype,"replaceTrack"),cT.prototype),e_(cT.prototype,"getRemoteSSRC",[S0],Object.getOwnPropertyDescriptor(cT.prototype,"getRemoteSSRC"),cT.prototype),cT);function S0(t,e,n){const o=t[e];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,d=await a.lock("Locking from P2PConnection.".concat(e));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await o.apply(this,p)}finally{d()}},n}function U9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function PI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?U9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}const tL="9",x9=4e4;function j9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function $R(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?j9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):j9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}let bM=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({});var DN=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(DN||{});const yM=new Map;function V9(t,e,n,o){let{scale:a}=t;if(a===0&&o===DN.UP||a>=e.length-1&&o===DN.DOWN)return t;let d=$R($R({},t),{},{scale:o===DN.DOWN?++a:--a});switch(n){case"maintain-framerate":d=$R($R({},d),e[a].motion);break;case"maintain-resolution":d=$R($R({},d),e[a].detail);break;case"balanced":d=$R($R({},d),e[a].balanced)}return d}function F9(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:B9(e)};yM.set(t,n)}else yM.delete(t)}function B9(t){const e=$R({},t),{bitrateMax:n,frameRate:o,scaleResolutionDownBy:a,bitrateMin:d}=e,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:p,MAX_SCALE:m,BITRATE_MIN_THRESHOLD:_,BITRATE_MAX_THRESHOLD:g,BWE_SCALE_UP_THRESHOLD:y,BWE_SCALE_DOWN_THRESHOLD:C,PERF_SCALE_DOWN_THRESHOLD:O,PERF_SCALE_UP_THRESHOLD:q,BALANCE_BITRATE_FACTOR:L,BALANCE_FRAMERATE_FACTOR:U,BALANCE_RESOLUTION_FACTOR:K,MOTION_RESOLUTION_FACTOR:J,MOTION_BITRATE_FACTOR:_r,DETAIL_FRAMERATE_FACTOR:_o,DETAIL_BITRATE_FACTOR:na}=zF,ba=Math.min(e.frameRate,p),_u=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(C,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(O,1)*ba),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:n,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:n,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:n,bitrateMin:d}}];for(let _l=1;_l<=m;_l++){const _p={bwe_up:Math.round(Math.pow(y,_l)*n),bwe_down:Math.round(Math.pow(C,_l+1)*n),fps_up:Math.round(Math.pow(q,_l)*ba),fps_down:Math.round(Math.pow(O,_l+1)*ba)},u_={scaleResolutionDownBy:a/Math.pow(K,_l),frameRate:Math.max(Math.round(Math.pow(U,_l)*o),h),bitrateMax:Math.max(Math.round(Math.pow(L,_l)*n),g),bitrateMin:Math.max(Math.round(Math.pow(L,_l)*d),_)},W_={scaleResolutionDownBy:a/Math.pow(J,_l),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(_r,_l)*n),g),bitrateMin:Math.max(Math.round(Math.pow(_r,_l)*d),_)},_v={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(_o,_l)*o),h),bitrateMax:Math.max(Math.round(Math.pow(na,_l)*n),g),bitrateMin:Math.max(Math.round(Math.pow(na,_l)*d),_)};_u.push({scale:_l,threshold:_p,balanced:u_,motion:W_,detail:_v})}return _u}function Fpt(t,e,n,o,a,d){const h=yM.get(t)||{overUse:0,underUse:0,adaptationList:B9(a)},{adaptationList:p}=h;yM.set(t,h);const{OVERUSE_TIMES_THRESHOLD:m,UNDERUSE_TIMES_THRESHOLD:_}=zF,{scale:g}=o;let y,C;return typeof e=="number"&&e>0&&function(O,q,L,U){if(q>=L.length)return!1;let{threshold:{fps_down:K}}=L[q];return $("FORCE_AG_HIGH_FRAMERATE")&&U==="maintain-framerate"&&(K=L[0].threshold.fps_down),O<K}(e,g,p,d)&&(h.overUse++,C=bM.CPU,h.overUse>m)||typeof n=="number"&&n>0&&function(O,q,L){if(q>=L.length)return!1;const{threshold:{bwe_down:U}}=L[q];return O<U}(n,g,p)&&(h.overUse++,C=bM.BANDWIDTH,h.overUse>m)?(h.overUse=0,h.underUse=0,y=V9(o,p,d,DN.DOWN),[y,C]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(O,q,L,U){if(q===0)return;let{threshold:{fps_up:K}}=L[q];return $("FORCE_AG_HIGH_FRAMERATE")&&U==="maintain-framerate"&&(K=L[1].threshold.fps_up),O>K}(e,g,p,d)&&function(O,q,L){if(q===0)return;const{threshold:{bwe_up:U}}=L[q];return O>U}(n,g,p)&&(h.underUse++,h.underUse>_&&(h.overUse=0,h.underUse=0,y=V9(o,p,d,DN.UP),y.scale===0&&(C=bM.NONE))),[y,C])}function G9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function k3(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?G9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):G9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}function Bpt(t){var e;return!!$("ENABLE_AG_ADAPTATION")&&!!(t instanceof _3||o_(e=t._hints).call(e,lT.CUSTOM_TRACK))&&(!!$("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const o=Y_();if(o.os!==QT.IOS||!o.osVersion)return!1;const a=o.osVersion.split(".");return Number(a[0])>=n}(14)&&$4(17,4)||Z4(14)&&t8(17,4)))}const TM=new Map;function SM(t){const e=TM.get(t);if(e){const{timer:n,adaptationFunc:o,originConfig:a}=e;window.clearTimeout(n),o(a),TM.delete(t)}F9(t)}var J_;function H9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function DI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?H9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}let hR=(J_=class oL extends N1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return o_(n=Object.keys(_A)).call(n,e)}))]}constructor(e,n){super(e,n),F(this,"store",void 0),F(this,"peerConnection",void 0),F(this,"id",sT(5,"connection-")),F(this,"remoteSDP",void 0),F(this,"initialOffer",void 0),F(this,"transportEventReceiver",void 0),F(this,"statsFilter",void 0),F(this,"useXR",$("USE_XR")),F(this,"localCapabilities",void 0),F(this,"remoteCodecs",void 0),F(this,"localCandidateCount",0),F(this,"allCandidatesReceived",!1),F(this,"dataStreamChannelMap",new Map),F(this,"establishPromise",void 0),F(this,"recoveredDataChannelIds",[]),F(this,"currentDataChannelId",1),F(this,"mutex",new nS("P2PConnection-mutex")),F(this,"qualityLimitationReason",bM.NONE),this.store=n,this.peerConnection=new RTCPeerConnection(oL.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=pM(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,iT()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void A.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const d=this.remoteSDP.toString();a==null||a(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else A.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=cR(e.sdp),o=await O3({filterRTX:!$("USE_PUB_RTX")&&!$("USE_SUB_RTX"),filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterVideoCodec:$("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=NN(o),this.initialOffer=e,DI(DI({},n),{},{rtpCapabilities:o,offerSDP:e.sdp})}catch(e){throw new ya(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,n,o,a,d,h){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return dT(this._localCapabilities)}get rtpCapabilities(){return dT(this._rtpCapabilities)}get candidates(){return dT(this._candidates)}get iceParameters(){return dT(this._iceParameters)}get dtlsParameters(){return dT(this._dtlsParameters)}constructor(O){F(this,"sessionDesc",void 0),F(this,"_localCapabilities",void 0),F(this,"_rtpCapabilities",void 0),F(this,"_candidates",void 0),F(this,"_iceParameters",void 0),F(this,"_dtlsParameters",void 0),F(this,"setup",void 0),F(this,"currentMidIndex",void 0),F(this,"cname",void 0),F(this,"firefoxSsrcMidMap",new Map),O=dT(O);const{remoteIceParameters:q,remoteDtlsParameters:L,candidates:U,remoteRTPCapabilities:K,remoteSetup:J,localCapabilities:_r,cname:_o}=O,na=gT.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=K,this._candidates=U,this._iceParameters=q,this._dtlsParameters=L,this._localCapabilities=_r,this.setup=J,this.cname=_o;const ba=this.rtpCapabilities.send;for(const _u of na.mediaDescriptions){if(_u.attributes.iceUfrag=q.iceUfrag,_u.attributes.icePwd=q.icePwd,_u.attributes.fingerprints=L.fingerprints,_u.attributes.candidates=U,_u.attributes.setup=J,_u.media.mediaType==="video"&&(_u.media.fmts=ba.videoCodecs.map(_l=>_l.payloadType.toString(10)),_u.attributes.payloads=ba.videoCodecs,_u.attributes.extmaps=ba.videoExtensions,$("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:_l,ssrcGroups:_p}=h0([{ssrcId:x9,rtx:$("USE_SUB_RTX")?40001:void 0}],this.cname);_u.attributes.ssrcs=_l,_u.attributes.ssrcGroups=_p}if(_u.media.mediaType==="audio"&&(_u.media.fmts=ba.audioCodecs.map(_l=>_l.payloadType.toString(10)),_u.attributes.payloads=ba.audioCodecs,_u.attributes.extmaps=ba.audioExtensions,uR(_u),$("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:_l,ssrcGroups:_p}=h0([{ssrcId:2e4}],this.cname);_u.attributes.ssrcs=_l,_u.attributes.ssrcGroups=_p}}this.sessionDesc=na,this.currentMidIndex=na.mediaDescriptions.length-1}preloadRemoteMedia(){const O=$("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const q=this.candidates,L=this.dtlsParameters,U=this.iceParameters,K=this.rtpCapabilities.send;for(let J=1;J<O;J++){const _r=2*J+2e4,_o=2*J+x9,{ssrcs:na,ssrcGroups:ba}=h0([{ssrcId:_r}],this.cname),{ssrcs:_u,ssrcGroups:_l}=h0([{ssrcId:_o,rtx:$("USE_SUB_RTX")?_o+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:tL,protos:["UDP","TLS","RTP","SAVPF"],fmts:K.videoCodecs.map(_p=>_p.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:U.iceUfrag,icePwd:U.icePwd,unrecognized:[],candidates:q,extmaps:K.videoExtensions,fingerprints:L.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_u,ssrcGroups:_l,rtcpFeedbackWildcards:[],payloads:K.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*J)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:tL,protos:["UDP","TLS","RTP","SAVPF"],fmts:K.audioCodecs.map(_p=>_p.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:U.iceUfrag,icePwd:U.icePwd,unrecognized:[],candidates:q,extmaps:K.audioExtensions,fingerprints:L.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:na,ssrcGroups:ba,rtcpFeedbackWildcards:[],payloads:K.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*J+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return gT.print(this.sessionDesc)}send(O,q,L,U){const{ssrcs:K,ssrcGroups:J}=h0(q,this.cname,$("SYNC_GROUP")?L:void 0),_r=this.findPreloadMediaDesc(K);if(_r){if(iT()&&this.firefoxSsrcMidMap.set(K[0].ssrcId,_r.attributes.mid),U&&(U.twcc||U.remb)){const _o=this.sessionDesc.mediaDescriptions.indexOf(_r);return this.sessionDesc.mediaDescriptions[_o]=this.mungSendMediaDesc(_r,U),{mid:_r.attributes.mid,needExchangeSDP:!0}}return{mid:_r.attributes.mid,needExchangeSDP:!1}}{const _o=this.findAvailableMediaIndex(O,K);let na;return _o===-1||_o===1&&(ZT()||n8())||_o===0&&$("USE_SUB_RTX")||r8()?(na=this.createOrRecycleSendMedia(O,K,J,"sendonly",U),this.updateBundleMids()):(na=dT(this.sessionDesc.mediaDescriptions[_o]),na.attributes.direction="sendonly",na.attributes.ssrcs=K,na.attributes.ssrcGroups=J,this.sessionDesc.mediaDescriptions[_o]=this.mungSendMediaDesc(na,U)),iT()&&this.firefoxSsrcMidMap.set(K[0].ssrcId,na.attributes.mid),{mid:na.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:O,needExchangeSDP:q}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:O.attributes.mid,needExchangeSDP:q}}batchSend(O){const q=O.map(K=>{let{kind:J,ssrcMsg:_r,mslabel:_o}=K;return this.send(J,_r,_o)}),L=[];let U=!1;return q.forEach(K=>{let{mid:J,needExchangeSDP:_r}=K;_r&&(U=!0),L.push(J)}),{mids:L,needExchangeSDP:U}}stopSending(O){const q=this.sessionDesc.mediaDescriptions.filter(L=>L.attributes.mid&&O.indexOf(L.attributes.mid)!==-1);if(q.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");q.forEach(L=>{L.attributes.mid==="0"||iT()||r8()?L.attributes.ssrcs=[]:(L.attributes.ssrcs=[],L.attributes.direction="inactive",L.media.port="0")}),this.updateBundleMids()}mute(O){const q=this.sessionDesc.mediaDescriptions.find(L=>L.attributes.mid===O);if(!q)throw new Error("mediaDescription not found with ".concat(O," in remote SDP when calling RemoteSDP.mute."));q.attributes.direction="inactive"}unmute(O){const q=this.sessionDesc.mediaDescriptions.find(L=>L.attributes.mid===O);if(!q)throw new Error("mediaDescription not found with ".concat(O," in remote SDP when calling RemoteSDP.unmute."));q.attributes.direction="sendonly"}muteRemote(O){const q=this.sessionDesc.mediaDescriptions.filter(L=>o_(O).call(O,L.attributes.mid||""));if(q.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");q.forEach(L=>{L.attributes.direction="inactive"})}unmuteRemote(O){const q=this.sessionDesc.mediaDescriptions.filter(L=>o_(O).call(O,L.attributes.mid||""));if(q.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");q.forEach(L=>{L.attributes.direction="recvonly"})}receive(O,q,L,U){O.forEach((K,J)=>{this.createOrRecycleRecvMedia(K,[],"recvonly",q,L,U[J])}),this.updateBundleMids()}stopReceiving(O){const q=this.sessionDesc.mediaDescriptions.filter(L=>O.indexOf(L.attributes.mid)!==-1);if(q.length!==O.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");q.forEach(L=>{L.media.port="0",L.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(O){const q=this._candidates.filter(L=>L.transport==="udp");if(O===SS.TCP){if(q.length===0)return;if($("TCP_CANDIDATE_ONLY")){const L=this._candidates.filter(U=>U.transport==="tcp");q.forEach(U=>{L.findIndex(K=>K.connectionAddress===U.connectionAddress)===-1&&L.push(PI(PI({},U),{},{foundation:"tcpcandidate",priority:Number(U.priority)-1+"",transport:"tcp",port:Number(U.port)+90+""}))}),this._candidates=L}else{const L=[];q.forEach(U=>{L.push(PI(PI({},U),{},{foundation:"tcpcandidate",priority:Number(U.priority)-1+"",transport:"tcp",port:Number(U.port)+90+""}))}),this._candidates=[...q,...L]}}else if(O===SS.RELAY){if(q.length!==0)return;{const L=this._candidates.filter(U=>U.transport==="tcp");L.forEach(U=>{q.push(PI(PI({},U),{},{foundation:"udpcandidate",priority:Number(U.priority)+1+"",transport:"udp",port:Number(U.port)-90+""}))}),this._candidates=[...q,...L]}}else q.length===0?(this._candidates.filter(L=>L.transport==="tcp").forEach(L=>{q.push(PI(PI({},L),{},{foundation:"udpcandidate",priority:Number(L.priority)+1+"",transport:"udp",port:Number(L.port)-90+""}))}),this._candidates=q):this._candidates=this._candidates.filter(L=>L.transport!=="tcp");for(const L of this.sessionDesc.mediaDescriptions)L.attributes.candidates=this.candidates}restartICE(O){O=dT(O),this._iceParameters=O,this.sessionDesc.mediaDescriptions.forEach(q=>{q.attributes.iceUfrag=O.iceUfrag,q.attributes.icePwd=O.icePwd})}predictReceivingMids(O){const q=[];for(let L=0;L<O;L++)q.push((this.currentMidIndex+L+1).toString(10));return q}findAvailableMediaIndex(O,q){return this.sessionDesc.mediaDescriptions.findIndex(L=>{const U=L.media.mediaType===O&&L.media.port!=="0"&&(L.attributes.direction==="sendonly"||L.attributes.direction==="sendrecv")&&L.attributes.ssrcs.length===0;if(iT()){if(U){const K=this.firefoxSsrcMidMap.get(q[0].ssrcId);return!(K||L.attributes.mid!=="0"&&L.attributes.mid!=="1")||!(!K||K!==L.attributes.mid)}return!1}return U})}createOrRecycleDataChannel(){for(const L of this.sessionDesc.mediaDescriptions)if(L.media.mediaType==="application")return{mediaDesc:L,needExchangeSDP:!1};this.currentMidIndex+=1;const O="".concat(this.currentMidIndex),q={media:{mediaType:"application",port:tL,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(O),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(q),{mediaDesc:q,needExchangeSDP:!0}}createOrRecycleRecvMedia(O,q,L,U,K,J){const _r=O._mediaStreamTrack.kind,_o=this.rtpCapabilities.recv,na=_O(_r,_o,this.localCapabilities.send,_r===m_.VIDEO?U:K),ba=_r===m_.VIDEO?_o.videoExtensions:_o.audioExtensions;this.currentMidIndex+=1;const _u="".concat(this.currentMidIndex);let _l={media:{mediaType:_r,port:tL,protos:["UDP","TLS","RTP","SAVPF"],fmts:na.map(u_=>u_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ba,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:q,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:na,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:L,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_u)}};_l=this.mungRecvMediaDsec(_l,O,J);const _p=this.findFirstClosedMedia(_r);if(_p){const u_=this.sessionDesc.mediaDescriptions.indexOf(_p);this.sessionDesc.mediaDescriptions[u_]=_l}else this.sessionDesc.mediaDescriptions.push(_l);return _l}updateRemoteCodec(O,q,L){const U=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(_l=>_l.rtpMap&&_l.rtpMap.encodingName.toLowerCase()||"").filter(_l=>{var _p;return o_(_p=Object.keys(_A)).call(_p,_l)}))],K=new Set(q);if(U.every(_l=>K.has(_l)))return A.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(q)),!1;const J=this._rtpCapabilities.recv.videoCodecs.filter(_l=>q.some(_p=>{var u_;return o_(u_=_l.rtpMap&&_l.rtpMap.encodingName.toLowerCase()||"").call(u_,_p)}));if(J.length===0)return A.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(U," codecs: ").concat(q)),!1;const _r=[...new Set(J.map(_l=>_l.rtpMap&&_l.rtpMap.encodingName.toLowerCase()||""))];let _o;if(A.debug("updateRemoteCodec, from ".concat(U," to ").concat(_r)),O.length===0)_o=this.sessionDesc.mediaDescriptions.filter(_l=>_l.media.mediaType==="video"&&_l.attributes.direction==="recvonly");else if(_o=this.sessionDesc.mediaDescriptions.filter(_l=>_l.attributes.mid&&o_(O).call(O,_l.attributes.mid)&&_l.attributes.direction==="recvonly"),_o.length!==O.length)return A.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(O,", codecs: ").concat(q)),!1;if($("USE_PUB_RTX")||$("USE_SUB_RTX")){const _l=A3(J,this.rtpCapabilities.recv.videoCodecs);J.push(..._l)}this._rtpCapabilities.recv.videoCodecs=J;const na=this.localCapabilities.send,ba=this.rtpCapabilities.recv,_u=_O(m_.VIDEO,ba,na,L);return _o.forEach(_l=>{const _p=_u.map(u_=>u_.payloadType.toString(10));A.debug("updateRemoteCodec mid: ".concat(_l.attributes.mid,", from ").concat(_l.attributes.payloads," to ").concat(_u)),_l.attributes.payloads=_u,_l.media.fmts=_p}),!0}createOrRecycleSendMedia(O,q,L,U,K){const J=this.rtpCapabilities.send,_r=O===m_.VIDEO?J.videoCodecs:J.audioCodecs,_o=O===m_.VIDEO?J.videoExtensions:J.audioExtensions;this.currentMidIndex+=1;const na="".concat(this.currentMidIndex);let ba={media:{mediaType:O,port:tL,protos:["UDP","TLS","RTP","SAVPF"],fmts:_r.map(_l=>_l.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:_o,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:q,ssrcGroups:L,rtcpFeedbackWildcards:[],payloads:_r,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:U,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(na)}};ba=this.mungSendMediaDesc(ba,K);const _u=this.findFirstClosedMedia(O);if(_u){const _l=this.sessionDesc.mediaDescriptions.indexOf(_u);this.sessionDesc.mediaDescriptions[_l]=ba}else this.sessionDesc.mediaDescriptions.push(ba);return ba}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(O=>O.media.port!=="0").map(O=>O.attributes.mid)}mungRecvMediaDsec(O,q,L){const U=dT(O);return fM(U),wI(U,q),mM(U,q),I3(U),AN(U,L,this.localCapabilities.send),U}mungSendMediaDesc(O,q){const L=dT(O);return AN(L,q,this.localCapabilities.recv),uR(L),L}updateRecvMedia(O,q){const L=this.sessionDesc.mediaDescriptions.findIndex(U=>U.attributes.mid===O);if(L!==-1){const U=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[L],q);this.sessionDesc.mediaDescriptions[L]=U}}bumpMid(O){this.currentMidIndex+=O}findFirstClosedMedia(O){return this.sessionDesc.mediaDescriptions.find(q=>iT()?q.media.port==="0"&&q.media.mediaType===O:q.media.port==="0")}findPreloadMediaDesc(O){return this.sessionDesc.mediaDescriptions.find(q=>{var L;return((L=q.attributes)===null||L===void 0||(L=L.ssrcs[0])===null||L===void 0?void 0:L.ssrcId)===O[0].ssrcId})}getSSRC(O){var q;return(q=this.sessionDesc.mediaDescriptions.find(L=>L.attributes.mid===O))===null||q===void 0?void 0:q.attributes.ssrcs}}({remoteIceParameters:e,remoteDtlsParameters:n,candidates:o,remoteRTPCapabilities:a,remoteSetup:d,localCapabilities:this.localCapabilities,cname:h}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const p=this.remoteSDP.toString(),m=gT.parse(this.initialOffer.sdp),_=m.mediaDescriptions.find(O=>O.media.mediaType==="audio");_&&uR(_),this.useXR&&EM(m);const g=gT.print(m),y=this.logSDPExchange(g||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:g}),y==null||y(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p});const C=this.peerConnection.getTransceivers()[0];if(C!=null&&C.receiver&&this.tryBindTransportEvents(C.receiver),$("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const O=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:O});const q=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(q)}}catch(p){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(p.toString()))}}send(e,n,o){var a=this;return QS(function*(){const d=yield L_(a.mutex.lock("From P2PConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[];e.forEach(L=>{const U=a.peerConnection.addTransceiver(L._mediaStreamTrack,{direction:"sendonly"});h.push(U),L._updateRtpTransceiver(U)}),iT()&&$("SIMULCAST")===!0&&(yield L_(a.applySimulcastForFirefox(h,e)));const p=yield L_(a.peerConnection.createOffer()),m=a.remoteSDP.predictReceivingMids(e.length),_=a.mungSendOfferSDP(p.sdp,e,m),g=gT.parse(_),y=m.map(L=>{const U=g.mediaDescriptions.find(K=>K.attributes.mid===L);if(!U)throw new Error("Cannot extract ssrc from mediaDescription.");return C3(U,$("USE_PUB_RTX"))});let C;try{C=yield y}catch(L){C=[],a.remoteSDP.receive(e,n,o,C);const U=a.remoteSDP.toString();throw yield L_(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield L_(a.peerConnection.setRemoteDescription({type:"answer",sdp:U})),yield L_(a.stopSending(m,!0)),L}a.remoteSDP.receive(e,n,o,C);const O=a.remoteSDP.toString(),q=a.logSDPExchange(_,"offer","local","send");return yield L_(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield L_(a.applySimulcastEncodings(h,e)),yield L_(a.applySendEncodings(h,e)),q==null||q(O),yield L_(a.peerConnection.setRemoteDescription({type:"answer",sdp:O})),h.map((L,U)=>{const K=m[U];return{localSSRC:y[U],id:K,transceiver:L}})}catch(h){throw h instanceof ya?h:new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(e);if(o&&o.readyState==="open")A.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:$("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,o)}n.forEach(d=>{d._updateOriginDataChannel(o)});const{needExchangeSDP:a}=this.remoteSDP.sendDataChannel();if(a){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),A.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else A.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof ya?o:new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof ya?n:new ya(Y.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const o=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=this.peerConnection.getTransceivers().filter(m=>e.indexOf(m.mid)!==-1);if(a.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map(m=>{var _;SM(this.id+m.mid),m.direction="inactive",(_=m.stop)===null||_===void 0||_.call(m)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(e);const p=this.remoteSDP.toString();h==null||h(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(a){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}finally{o&&o()}}async receive(e,n,o,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(e,n,o,a);if(h){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});const g=await this.peerConnection.createAnswer(),y=this.mungReceiveAnswerSDP(g.sdp,d,e);_==null||_(y||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:y}),A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const p=this.peerConnection.getTransceivers().find(m=>m.mid===d);if(!p)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,id:d,transceiver:p}}catch(d){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:o}=this.remoteSDP.batchSend(e);if(o){const a=this.remoteSDP.toString(),d=this.logSDPExchange(a,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const h=await this.peerConnection.createAnswer();d==null||d(h.sdp||""),await this.peerConnection.setLocalDescription(h),A.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else A.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return n.map(a=>{const d=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:a,transceiver:d}})}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),o=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),o=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),o=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(h=>h.mid&&e.indexOf(h.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(e);const d=this.remoteSDP.toString();a==null||a(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(h=>h.mid&&e.indexOf(h.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(h,p)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(e);const d=this.remoteSDP.toString();a==null||a(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(n){throw new ya(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return QS(function*(){const o=yield L_(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(q_().supportPCSetConfiguration){const _=n.peerConnection.getConfiguration(),g=e===SS.RELAY?"relay":"all";_.iceTransportPolicy!==g&&(A.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(g,"]")),_.iceTransportPolicy=g,n.peerConnection.setConfiguration(_))}else if(e===SS.RELAY)return;n.remoteSDP.updateCandidates(e);const a=yield L_(n.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=cR(a.sdp),{remoteIceParameters:h}=yield d.iceParameters;n.remoteSDP.restartICE(h);const p=n.remoteSDP.toString(),m=n.logSDPExchange(a.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield L_(n.peerConnection.setLocalDescription(a)),m==null||m(p),yield L_(n.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(a){A.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),a)}finally{o()}})()}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{SM(this.id+n.mid)}),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return DI(DI({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(o.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const d=this.remoteSDP.toString(),h=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(o){throw new ya(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(e,n){const o=this.peerConnection.getTransceivers().filter(a=>a.mid===e);o.length===1&&(this.isVP8Simulcast(n)?iT()||await this.applySimulcastEncodings(o,[n]):await this.applySendEncodings(o,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const o=this.peerConnection.getTransceivers().find(a=>a.mid===n);o&&await o.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:o,remote:a}=n.getSelectedCandidatePair();return{local:DI(DI({},kR),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:DI(DI({},kR),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(QO(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...oL.turnServerConfigToIceServers(e.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...oL.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),$("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(n.iceTransportPolicy="relay")}))),$("ENABLE_ENCODED_TRANSFORM")&&q_().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(o=>{o.security?o.tcpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(vI(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!$("FORCE_TURN_TCP")&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var a;n!=null&&n.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,n.state))},n.onerror=a=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in a?a.error:a)};const o=n.iceTransport;o&&(o.onstatechange=()=>{const a=n==null?void 0:n.iceTransport.state;var d;a&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,a))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:a,remote:d}=o.getSelectedCandidatePair();A.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var o,a;if(n||(n=this.peerConnection.getSenders().find(U=>U.track===e._mediaStreamTrack)),!n)return A.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return A.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!q_().supportSetRtpSenderParameters)return A.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(e._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const p=function(L,U){return L.getTransceivers().find(K=>K.sender.track===U||K.receiver.track===U)}(this.peerConnection,e._mediaStreamTrack),m=dpt(e);if(Bpt(e)&&p&&n&&m&&this.getLocalVideoStats&&o_(o=["vp8","vp9"]).call(o,this.store.codec)){var _;const L=d.degradationPreference||(o_(_=e._hints).call(_,lT.CUSTOM_TRACK)?$("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(U,K,J,_r,_o,na){if(SM(U),_r!=="balanced"&&_r!=="maintain-framerate"&&_r!=="maintain-resolution")return;let ba=-1;F9(U,K);const _u=window.setInterval(()=>{const _p=TM.get(U);if(!$("ENABLE_AG_ADAPTATION")||!_p)return void SM(U);const u_=na();if(u_.sendPackets>0&&u_.OutgoingAvailableBandwidth>0){if(ba===-1)return void(ba=Date.now());if(Date.now()-ba<1e3)return;const W_=u_.sendFrameRate,_v=u_.OutgoingAvailableBandwidth,[hT,FT]=Fpt(U,W_,_v,_p.adaptationConfig,K,_r);FT&&(J.qualityLimitationReason=FT),hT&&_p.adaptationConfig.scale!==hT.scale&&(A.debug("[".concat(U,"] applyAdaptation: ").concat(J.qualityLimitationReason,`
           sendFps `).concat(W_,", bwe ").concat(_v,", switch from ").concat(_p.adaptationConfig.scale," to ").concat(hT.scale," ")),_p.adaptationConfig=k3(k3({},_p.adaptationConfig),hT),_o(hT))}},$("CHECK_LOCAL_STATS_INTERVAL")),_l=k3({},K);TM.set(U,{timer:_u,adaptationConfig:_l,originConfig:K,adaptationFunc:_o}),A.debug("[".concat(U,"] start adaptation, originConfig: ").concat(JSON.stringify(K),", degradationPreference: ").concat(_r))})(this.id+p.mid,m,this,L,U=>{n&&this.updateAdaptation(n,U)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var g;const{bitrateMax:L,frameRate:U,scaleResolutionDownBy:K}=e._encoderConfig;L&&(h.maxBitrate=1e3*L),(o_(g=e._hints).call(g,lT.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(U&&(h.maxFramerate=BS(U)),K&&K>=1&&(h.scaleResolutionDownBy=K))}const{maxFramerate:y}=$("ENCODER_CONFIG_LIMIT");if(y&&typeof y=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,y):y),$("DSCP_TYPE")&&hI()){var C;const L=$("DSCP_TYPE");o_(C=["very-low","low","medium","high"]).call(C,L)&&(h.networkPriority=L)}const O=n.getParameters(),q=(a=O.encodings)===null||a===void 0?void 0:a[0];iT()&&!q&&(d.encodings=[h]),q&&Object.assign(q,h),Object.assign(O,d),A.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(O.encodings))),await n.setParameters(O)}async updateAdaptation(e,n){var o,a;if(!e)return A.debug("[updateAdaptation] no rtpSender found");if(!q_().supportSetRtpSenderParameters)return A.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:h,frameRate:p,scaleResolutionDownBy:m}=n;h&&(d.maxBitrate=1e3*h),p&&(d.maxFramerate=BS(p)),m&&m>=1&&o_(o=["vp8","vp9"]).call(o,this.store.codec)&&(d.scaleResolutionDownBy=m);const _=e.getParameters(),g=(a=_.encodings)===null||a===void 0?void 0:a[0];g&&Object.assign(g,d),Object.assign(_,{});try{await e.setParameters(_),A.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(_.encodings)))}catch(y){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?A.debug("[updateAdaptation] peerConnection not connected}"):A.debug("[updateAdaptation] updateRtpSenderEncodings failed",y):A.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!q_().supportSetRtpSenderParameters||e.length!==n.length)return;for(let o=0;o<e.length;o++){const a=e[o],d=n[o];d instanceof aT&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,a.sender)}}catch{A.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,o){const a=gT.parse(e);return n.forEach((d,h)=>{const p=o[h],m=a.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(wI(m,d),w3(m,d,this.store.codec))}),gT.print(a)}mungReceiveAnswerSDP(e,n,o){const a=gT.parse(e),d=a.mediaDescriptions.find(h=>h.attributes.mid===n);return d&&(o===m_.AUDIO&&d.media.mediaType==="audio"&&uR(d),this.useXR&&EM(a)),gT.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,o)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,e,n,o)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let m=0;m<e.length;m++){var o,a,d,h,p;const _=e[m],g=n[m];if(g instanceof aT&&!o_(o=g._hints).call(o,lT.LOW_STREAM)&&(a=g._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((d=g._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=g._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=g._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){const y={},C={high:1e3*(g._encoderConfig.bitrateMax-50),medium:5e4};y.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];const O=_.sender.getParameters();await _.sender.setParameters(Object.assign(O,y))}}}async applySimulcastEncodings(e,n){if(!iT()&&e.length===n.length)for(let o=0;o<e.length;o++){const a=n[o];if(a instanceof aT&&this.isVP8Simulcast(a)){const d=e[o],h={},p={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];const m=d.sender.getParameters();await d.sender.setParameters(Object.assign(m,h))}}}isVP8Simulcast(e){var n,o,a,d,h;return!!(e instanceof aT&&$("SIMULCAST")&&this.store.codec==="vp8"&&!o_(n=e._hints).call(n,lT.LOW_STREAM)&&(o=e._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((a=e._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(d=e._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=e._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(e,n,o,a){if($("SDP_LOGGING"))return A.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(n," SDP during P2PConnection.").concat(a,`
`),e),n==="offer"?d=>{this.logSDPExchange(d,"answer",o==="local"?"remote":"local",a)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(q_().supportPCSetConfiguration){const n=oL.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},e_(J_.prototype,"updateRemoteRTPCapabilities",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"updateRemoteRTPCapabilities"),J_.prototype),e_(J_.prototype,"connect",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"connect"),J_.prototype),e_(J_.prototype,"createDataChannels",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"createDataChannels"),J_.prototype),e_(J_.prototype,"receive",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"receive"),J_.prototype),e_(J_.prototype,"batchReceive",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"batchReceive"),J_.prototype),e_(J_.prototype,"stopReceiving",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"stopReceiving"),J_.prototype),e_(J_.prototype,"muteRemote",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"muteRemote"),J_.prototype),e_(J_.prototype,"unmuteRemote",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"unmuteRemote"),J_.prototype),e_(J_.prototype,"muteLocal",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"muteLocal"),J_.prototype),e_(J_.prototype,"unmuteLocal",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"unmuteLocal"),J_.prototype),e_(J_.prototype,"close",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"close"),J_.prototype),e_(J_.prototype,"updateEncoderConfig",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"updateEncoderConfig"),J_.prototype),e_(J_.prototype,"updateSendParameters",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"updateSendParameters"),J_.prototype),e_(J_.prototype,"replaceTrack",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"replaceTrack"),J_.prototype),e_(J_.prototype,"updateAdaptation",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"updateAdaptation"),J_.prototype),e_(J_.prototype,"getRemoteSSRC",[GS],Object.getOwnPropertyDescriptor(J_.prototype,"getRemoteSSRC"),J_.prototype),J_);function GS(t,e,n){const o=t[e];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,d=await a.lock("From P2PConnection.".concat(e));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await o.apply(this,p)}finally{d()}},n}function W9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function q9(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?W9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):W9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}const K9=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,RM="9",L3=2e4,M3=4e4;class Gpt{get localCapabilities(){return dT(this._localCapabilities)}get rtpCapabilities(){return dT(this._rtpCapabilities)}get candidates(){return dT(this._candidates)}get iceParameters(){return dT(this._iceParameters)}get dtlsParameters(){return dT(this._dtlsParameters)}constructor(e){F(this,"sessionDesc",void 0),F(this,"_localCapabilities",void 0),F(this,"_rtpCapabilities",void 0),F(this,"_candidates",void 0),F(this,"_iceParameters",void 0),F(this,"_dtlsParameters",void 0),F(this,"setup",void 0),F(this,"currentMidIndex",void 0),F(this,"cname",void 0),F(this,"firefoxSsrcMidMap",new Map),e=dT(e);const{remoteIceParameters:n,remoteDtlsParameters:o,candidates:a,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:p,cname:m}=e,_=gT.parse(K9);this._rtpCapabilities=d,this._candidates=a,this._iceParameters=n,this._dtlsParameters=o,this._localCapabilities=p,this.setup=h,this.cname=m;const g=this.rtpCapabilities.send;for(const y of _.mediaDescriptions){if(y.attributes.iceUfrag=n.iceUfrag,y.attributes.icePwd=n.icePwd,y.attributes.fingerprints=o.fingerprints,y.attributes.candidates=a,y.attributes.setup=h,y.media.mediaType==="application"&&(y.attributes.sctpPort="5000"),y.media.mediaType==="video"&&(y.media.fmts=g.videoCodecs.map(C=>C.payloadType.toString(10)),y.attributes.payloads=g.videoCodecs,y.attributes.extmaps=g.videoExtensions,$("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:C,ssrcGroups:O}=h0([{ssrcId:M3,rtx:$("USE_SUB_RTX")?40001:void 0}],this.cname);y.attributes.ssrcs=C,y.attributes.ssrcGroups=O}if(y.media.mediaType==="audio"&&(y.media.fmts=g.audioCodecs.map(C=>C.payloadType.toString(10)),y.attributes.payloads=g.audioCodecs,y.attributes.extmaps=g.audioExtensions,uR(y),$("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:C,ssrcGroups:O}=h0([{ssrcId:L3}],this.cname);y.attributes.ssrcs=C,y.attributes.ssrcGroups=O}}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}updateRemoteRTPCapabilities(e){const n=gT.parse(K9);this._rtpCapabilities=e;const o=this.rtpCapabilities.send;for(const a of n.mediaDescriptions){if(a.attributes.iceUfrag=this._iceParameters.iceUfrag,a.attributes.icePwd=this._iceParameters.icePwd,a.attributes.fingerprints=this._dtlsParameters.fingerprints,a.attributes.candidates=this._candidates,a.attributes.setup=this.setup,a.media.mediaType==="application"&&(a.attributes.sctpPort="5000"),a.media.mediaType==="video"&&(a.media.fmts=o.videoCodecs.map(d=>d.payloadType.toString(10)),a.attributes.payloads=o.videoCodecs,a.attributes.extmaps=o.videoExtensions,$("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=h0([{ssrcId:M3,rtx:$("USE_SUB_RTX")?40001:void 0}],this.cname);a.attributes.ssrcs=d,a.attributes.ssrcGroups=h}if(a.media.mediaType==="audio"&&(a.media.fmts=o.audioCodecs.map(d=>d.payloadType.toString(10)),a.attributes.payloads=o.audioCodecs,a.attributes.extmaps=o.audioExtensions,$("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=h0([{ssrcId:L3}],this.cname);a.attributes.ssrcs=d,a.attributes.ssrcGroups=h}}this.sessionDesc=n,this.currentMidIndex=n.mediaDescriptions.length-1}preloadRemoteMedia(e){this.rtpCapabilities;const n=this.candidates,o=this.dtlsParameters,a=this.iceParameters,d=this.rtpCapabilities.send;for(let h=1;h<e;h++){const p=2*h+L3,m=2*h+M3,{ssrcs:_,ssrcGroups:g}=h0([{ssrcId:p}],this.cname),{ssrcs:y,ssrcGroups:C}=h0([{ssrcId:m,rtx:$("USE_SUB_RTX")?m+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:RM,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.videoCodecs.map(O=>O.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:a.iceUfrag,icePwd:a.icePwd,unrecognized:[],candidates:n,extmaps:d.videoExtensions,fingerprints:o.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:C,rtcpFeedbackWildcards:[],payloads:d.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:RM,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.audioCodecs.map(O=>O.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:a.iceUfrag,icePwd:a.icePwd,unrecognized:[],candidates:n,extmaps:d.audioExtensions,fingerprints:o.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:g,rtcpFeedbackWildcards:[],payloads:d.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return gT.print(this.sessionDesc)}send(e,n,o,a){const{ssrcs:d,ssrcGroups:h}=h0(n,this.cname,$("SYNC_GROUP")?o:void 0),p=this.findPreloadMediaDesc(d);if(p){if(iT()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,p.attributes.mid),a&&(a.twcc||a.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,a),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(e,d);let _;return m===-1||ZT()||ES()||n8()||m===0&&$("USE_SUB_RTX")?(_=this.createOrRecycleSendMedia(e,d,h,"sendonly",a),this.updateBundleMids()):(_=dT(this.sessionDesc.mediaDescriptions[m]),_.attributes.direction="sendonly",_.attributes.ssrcs=d,_.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(_,a)),iT()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,_.attributes.mid),{mid:_.attributes.mid,needExchangeSDP:!0}}}batchSend(e){const n=e.map(d=>{let{kind:h,ssrcMsg:p,mslabel:m}=d;return this.send(h,p,m)}),o=[];let a=!1;return n.forEach(d=>{let{mid:h,needExchangeSDP:p}=d;p&&(a=!0),o.push(h)}),{mids:o,needExchangeSDP:a}}stopSending(e){const n=this.sessionDesc.mediaDescriptions.filter(o=>o.attributes.mid&&e.indexOf(o.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(o=>{o.attributes.mid==="0"||iT()||ZT()||ES()?o.attributes.ssrcs=[]:(o.attributes.ssrcs=[],o.attributes.direction="inactive",o.media.port="0")}),this.updateBundleMids()}mute(e){const n=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(o=>o_(e).call(e,o.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(o=>{o.attributes.direction="inactive"})}unmuteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(o=>o_(e).call(e,o.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(o=>{o.attributes.direction="recvonly"})}receive(e,n,o,a){e.forEach((d,h)=>{this.createOrRecycleRecvMedia(d,[],"recvonly",n,o,a[h])}),this.updateBundleMids()}stopReceiving(e){const n=this.sessionDesc.mediaDescriptions.filter(o=>e.indexOf(o.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(o=>{o.media.port="0",o.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(e){e===SS.TCP?this._candidates.forEach(n=>{this._candidates.findIndex(o=>o.transport==="tcp"&&o.connectionAddress===n.connectionAddress&&o.port===n.port)===-1&&this._candidates.push(q9(q9({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this._candidates=this._candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(e){e=dT(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let o=0;o<e;o++)n.push((this.currentMidIndex+o+1).toString(10));return n}findAvailableMediaIndex(e,n){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const a=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(iT()){if(a){const d=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(d||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!d||d!==o.attributes.mid)}return!1}return a})}createOrRecycleRecvMedia(e,n,o,a,d,h){const p=e._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,_=_O(p,m,this.localCapabilities.send,p===m_.VIDEO?a:d),g=p===m_.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const y="".concat(this.currentMidIndex);let C={media:{mediaType:p,port:RM,protos:["UDP","TLS","RTP","SAVPF"],fmts:_.map(q=>q.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:_,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};C=this.mungRecvMediaDsec(C,e,h);const O=this.findFirstClosedMedia(p);if(O){const q=this.sessionDesc.mediaDescriptions.indexOf(O);this.sessionDesc.mediaDescriptions[q]=C}else this.sessionDesc.mediaDescriptions.push(C);return C}updateRemoteCodec(e,n,o){const a=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(C=>C.rtpMap&&C.rtpMap.encodingName.toLowerCase()||"").filter(C=>{var O;return o_(O=Object.keys(_A)).call(O,C)}))],d=new Set(n);if(a.every(C=>d.has(C)))return A.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(n)),!1;const h=this._rtpCapabilities.recv.videoCodecs.filter(C=>n.some(O=>{var q;return o_(q=C.rtpMap&&C.rtpMap.encodingName.toLowerCase()||"").call(q,O)}));if(h.length===0)return A.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(a," codecs: ").concat(n)),!1;const p=[...new Set(h.map(C=>C.rtpMap&&C.rtpMap.encodingName.toLowerCase()||""))];let m;if(A.debug("updateRemoteCodec, from ".concat(a," to ").concat(p)),e.length===0)m=this.sessionDesc.mediaDescriptions.filter(C=>C.media.mediaType==="video"&&C.attributes.direction==="recvonly");else if(m=this.sessionDesc.mediaDescriptions.filter(C=>C.attributes.mid&&o_(e).call(e,C.attributes.mid)&&C.attributes.direction==="recvonly"),m.length!==e.length)return A.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(n)),!1;this._rtpCapabilities.recv.videoCodecs=h;const _=this.localCapabilities.send,g=this.rtpCapabilities.recv,y=_O(m_.VIDEO,g,_,o);return m.forEach(C=>{const O=y.map(q=>q.payloadType.toString(10));A.debug("updateRemoteCodec mid: ".concat(C.attributes.mid,", from ").concat(C.attributes.payloads," to ").concat(y)),C.attributes.payloads=y,C.media.fmts=O}),!0}createOrRecycleSendMedia(e,n,o,a,d){const h=this.rtpCapabilities.send,p=e===m_.VIDEO?h.videoCodecs:h.audioCodecs,m=e===m_.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let g={media:{mediaType:e,port:RM,protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:o,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};g=this.mungSendMediaDesc(g,d);const y=this.findFirstClosedMedia(e);if(y){const C=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[C]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,n,o){const a=dT(e);return fM(a),wI(a,n),mM(a,n),I3(a),AN(a,o,this.localCapabilities.send),a}mungSendMediaDesc(e,n){const o=dT(e);return AN(o,n,this.localCapabilities.recv),uR(o),o}updateRecvMedia(e,n){const o=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===e);if(o!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],n);this.sessionDesc.mediaDescriptions[o]=a}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(n=>iT()?n.media.port==="0"&&n.media.mediaType===e:n.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(n=>{var o;return((o=n.attributes)===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId)===e[0].ssrcId})}getSSRC(e){var n;return(n=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===e))===null||n===void 0?void 0:n.attributes.ssrcs}}var X_;function z9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function CM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?z9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):z9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}let Hpt=(X_=class jM extends N1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){let e;return this.localCapabilities&&(e=NN(this.localCapabilities)),[...new Set(e&&e.send.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var o;return o_(o=Object.keys(_A)).call(o,n)}))]}constructor(e,n,o){super(e,n),F(this,"store",void 0),F(this,"peerConnection",void 0),F(this,"remoteSDP",void 0),F(this,"initialOffer",void 0),F(this,"transportEventReceiver",void 0),F(this,"statsFilter",void 0),F(this,"useXR",$("USE_XR")),F(this,"localCapabilities",void 0),F(this,"localCandidateCount",0),F(this,"allCandidatesReceived",!1),F(this,"remoteCodecs",void 0),F(this,"dataStreamChannelMap",new Map),F(this,"establishPromise",void 0),F(this,"mutex",new nS("NVExtentionsConnection-mutex")),F(this,"rtcMedia",void 0),this.store=n,this.peerConnection=o,this.statsFilter=pM(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,iT()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(e){try{const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=cR(n.sdp),a=await O3({filterRTX:!$("USE_PUB_RTX")&&!$("USE_SUB_RTX"),filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterVideoCodec:$("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=a,this.initialOffer=n,CM(CM({},o),{},{rtpCapabilities:a,offerSDP:n.sdp})}catch(n){throw new _s(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e,n,o,a,d,h){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new Gpt({remoteIceParameters:e,remoteDtlsParameters:n,candidates:o,remoteRTPCapabilities:a,remoteSetup:d,localCapabilities:NN(this.localCapabilities),cname:h});const p=this.remoteSDP.toString(),m=gT.parse(this.initialOffer.sdp),_=m.mediaDescriptions.find(C=>C.media.mediaType==="audio");_&&uR(_),this.useXR&&EM(m);const g=gT.print(m),y=this.logSDPExchange(g||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:g}),y==null||y(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(p){throw new _s(Y.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(p.toString()))}}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void A.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const d=this.remoteSDP.toString();a==null||a(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else A.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async updateRemoteConnect(e){var n,o,a,d;(n=this.remoteSDP)===null||n===void 0||n.updateRemoteRTPCapabilities(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&((d=this.remoteSDP)===null||d===void 0||d.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),(o=this.remoteSDP)===null||o===void 0||o.preloadRemoteMedia(2);const h=(a=this.remoteSDP)===null||a===void 0?void 0:a.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(p),A.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(e,n,o){var a=this;return QS(function*(){const d=yield L_(a.mutex.lock("From NVExtentionsConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const h=[];e.forEach(L=>{const U=a.peerConnection.addTransceiver(L._mediaStreamTrack,{direction:"sendonly"});h.push(U)}),iT()&&$("SIMULCAST")===!0&&(yield L_(a.applySimulcastForFirefox(h,e)));const p=yield L_(a.peerConnection.createOffer()),m=a.remoteSDP.predictReceivingMids(e.length),_=a.mungSendOfferSDP(p.sdp,e,m),g=gT.parse(_),y=m.map(L=>{const U=g.mediaDescriptions.find(K=>K.attributes.mid===L);if(!U)throw new Error("Cannot extract ssrc from mediaDescription.");return C3(U,$("USE_PUB_RTX"))});let C;try{C=yield y}catch(L){C=[],a.remoteSDP.receive(e,n,o,C);const U=a.remoteSDP.toString();throw yield L_(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield L_(a.peerConnection.setRemoteDescription({type:"answer",sdp:U})),yield L_(a.stopSending(m,!0)),L}a.remoteSDP.receive(e,n,o,C);const O=a.remoteSDP.toString(),q=a.logSDPExchange(_,"offer","local","send");return yield L_(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield L_(a.applySimulcastEncodings(h,e)),yield L_(a.applySendEncodings(h,e)),q==null||q(O),yield L_(a.peerConnection.setRemoteDescription({type:"answer",sdp:O})),h.map((L,U)=>{const K=m[U];return{localSSRC:y[U],id:K,transceiver:L}})}catch(h){throw h instanceof _s?h:new _s(Y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(e,n){const o=n?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const a=this.peerConnection.getTransceivers().filter(m=>e.indexOf(m.mid)!==-1);if(a.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");a.map(m=>{var _;m.direction="inactive",(_=m.stop)===null||_===void 0||_.call(m)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(e);const p=this.remoteSDP.toString();h==null||h(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(a){throw new _s(Y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(a.toString()))}finally{o&&o()}}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(e);return o&&o.readyState==="open"?A.debug("[P2PConnection] Channels are already available and can be reused directly."):(o=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:$("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,o)),void n.forEach(a=>{a._updateOriginDataChannel(o)})}catch(o){throw o instanceof _s?o:new _s(Y.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n==null||n.close(),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof _s?n:new _s(Y.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(n.toString()))}}async receive(e,n,o,a){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(e," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(e,n,o,a);if(h){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});const g=await this.peerConnection.createAnswer(),y=this.mungReceiveAnswerSDP(g.sdp,d,e);_==null||_(y||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:y}),A.debug("[NVExtentionsConnection] receive ".concat(e," by exchanging SDP."))}else A.debug("[NVExtentionsConnection] receive ".concat(e," no need to exchange SDP."));const p=this.peerConnection.getTransceivers().find(m=>m.mid===d);if(!p)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,id:d}}catch(d){throw new _s(Y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(d.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:o}=this.remoteSDP.batchSend(e);if(o){const a=this.remoteSDP.toString(),d=this.logSDPExchange(a,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const h=await this.peerConnection.createAnswer();d==null||d(h.sdp||""),await this.peerConnection.setLocalDescription(h),A.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else A.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return n.map(a=>{const d=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:a}})}catch(n){throw new _s(Y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),o=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new _s(Y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),o=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new _s(Y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),o=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new _s(Y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(h=>h.mid&&e.indexOf(h.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(e);const d=this.remoteSDP.toString();a==null||a(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(n){throw new _s(Y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(h=>h.mid&&e.indexOf(h.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(h,p)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(e);const d=this.remoteSDP.toString();a==null||a(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(n){throw new _s(Y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return QS(function*(){const o=yield L_(n.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(q_().supportPCSetConfiguration){const _=n.peerConnection.getConfiguration(),g=e===SS.RELAY?"relay":"all";_.iceTransportPolicy!==g&&(A.debug("restartICE change iceTransportPolicy from [".concat(_.iceTransportPolicy,"] to [").concat(g,"]")),_.iceTransportPolicy=g,n.peerConnection.setConfiguration(_))}else if(e===SS.RELAY)return;e!==SS.RELAY&&n.remoteSDP.updateCandidates(e);const a=yield L_(n.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=cR(a.sdp),{remoteIceParameters:h}=yield d.iceParameters;n.remoteSDP.restartICE(h);const p=n.remoteSDP.toString(),m=n.logSDPExchange(a.sdp||"","offer","local","restartICE");yield L_(n.peerConnection.setLocalDescription(a)),m==null||m(p),yield L_(n.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(a){A.warning("restart ICE failed, abort operation",a)}finally{o()}})()}close(){var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(o.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const d=this.remoteSDP.toString(),h=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(o){throw new _s(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(e,n){const o=this.peerConnection.getTransceivers().filter(a=>a.mid===e);o.length===1&&(this.isVP8Simulcast(n)?iT()||await this.applySimulcastEncodings(o,[n]):await this.applySendEncodings(o,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const o=this.peerConnection.getTransceivers().find(a=>a.mid===n);o&&await o.sender.replaceTrack(e._mediaStreamTrack)}getP2PConnectionParams(){var e;if((e=this.peerConnection.currentLocalDescription)===null||e===void 0||!e.sdp||!this.localCapabilities)throw new Error;return CM(CM({},cR(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,A.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,A.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(QO(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...jM.turnServerConfigToIceServers(e.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...jM.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),$("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(o=>{o.security?o.tcpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(vI(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!$("FORCE_TURN_TCP")&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),n}async applySendEncodings(e,n){try{if(!q_().supportSetRtpSenderParameters||e.length!==n.length)return;for(let y=0;y<e.length;y++){const C=e[y],O=n[y];if(O&&O instanceof aT){var o,a,d;if(this.isVP8Simulcast(O))continue;const q={},L={};switch(O._optimizationMode){case"motion":q.degradationPreference="maintain-framerate";break;case"detail":q.degradationPreference="maintain-resolution";break;default:q.degradationPreference="balanced"}var h,p,m,_;if((o=O._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&(L.maxBitrate=1e3*((h=O._encoderConfig)===null||h===void 0?void 0:h.bitrateMax)),o_(a=O._hints).call(a,lT.LOW_STREAM)&&((p=O._encoderConfig)!==null&&p!==void 0&&p.frameRate&&(L.maxFramerate=BS(O._encoderConfig.frameRate)),(m=O._encoderConfig)!==null&&m!==void 0&&m.scaleResolutionDownBy&&((_=O._encoderConfig)===null||_===void 0?void 0:_.scaleResolutionDownBy)>1&&(L.scaleResolutionDownBy=O._encoderConfig.scaleResolutionDownBy)),$("DSCP_TYPE")&&hI()){var g;const J=$("DSCP_TYPE");o_(g=["very-low","low","medium","high"]).call(g,J)&&(L.networkPriority=J)}const U=C.sender.getParameters(),K=(d=U.encodings)===null||d===void 0?void 0:d[0];iT()&&!K&&(q.encodings=[L]),K&&Object.assign(K,L),Object.assign(U,q),await C.sender.setParameters(U)}}}catch{A.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(e,n,o){const a=gT.parse(e);return n.forEach((d,h)=>{const p=o[h],m=a.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(wI(m,d),w3(m,d,this.store.codec))}),gT.print(a)}mungReceiveAnswerSDP(e,n,o){const a=gT.parse(e),d=a.mediaDescriptions.find(h=>h.attributes.mid===n);return d&&o===m_.AUDIO&&d.media.mediaType==="audio"&&uR(d),this.useXR&&EM(a),gT.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,o)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,e,n,o)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let m=0;m<e.length;m++){var o,a,d,h,p;const _=e[m],g=n[m];if(g instanceof aT&&!o_(o=g._hints).call(o,lT.LOW_STREAM)&&(a=g._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((d=g._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=g._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=g._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){const y={},C={high:1e3*(g._encoderConfig.bitrateMax-50),medium:5e4};y.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];const O=_.sender.getParameters();await _.sender.setParameters(Object.assign(O,y))}}}async applySimulcastEncodings(e,n){if(!iT()&&e.length===n.length)for(let o=0;o<e.length;o++){const a=n[o];if(a instanceof aT&&this.isVP8Simulcast(a)){const d=e[o],h={},p={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];const m=d.sender.getParameters();await d.sender.setParameters(Object.assign(m,h))}}}isVP8Simulcast(e){var n,o,a,d,h;return!!(e instanceof aT&&$("SIMULCAST")&&this.store.codec==="vp8"&&!o_(n=e._hints).call(n,lT.LOW_STREAM)&&(o=e._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((a=e._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(d=e._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=e._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(e,n,o,a){if($("SDP_LOGGING"))return A.upload("exchanging ".concat(o," ").concat(n," SDP during NVExtentionsConnection.").concat(a,`
`),e),n==="offer"?d=>{this.logSDPExchange(d,"answer",o==="local"?"remote":"local",a)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(q_().supportPCSetConfiguration){const n=jM.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},e_(X_.prototype,"connect",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"connect"),X_.prototype),e_(X_.prototype,"updateRemoteRTPCapabilities",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"updateRemoteRTPCapabilities"),X_.prototype),e_(X_.prototype,"updateRemoteConnect",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"updateRemoteConnect"),X_.prototype),e_(X_.prototype,"createDataChannels",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"createDataChannels"),X_.prototype),e_(X_.prototype,"receive",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"receive"),X_.prototype),e_(X_.prototype,"batchReceive",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"batchReceive"),X_.prototype),e_(X_.prototype,"stopReceiving",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"stopReceiving"),X_.prototype),e_(X_.prototype,"muteRemote",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"muteRemote"),X_.prototype),e_(X_.prototype,"unmuteRemote",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"unmuteRemote"),X_.prototype),e_(X_.prototype,"muteLocal",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"muteLocal"),X_.prototype),e_(X_.prototype,"unmuteLocal",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"unmuteLocal"),X_.prototype),e_(X_.prototype,"close",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"close"),X_.prototype),e_(X_.prototype,"updateEncoderConfig",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"updateEncoderConfig"),X_.prototype),e_(X_.prototype,"updateSendParameters",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"updateSendParameters"),X_.prototype),e_(X_.prototype,"replaceTrack",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"replaceTrack"),X_.prototype),e_(X_.prototype,"getRemoteSSRC",[HS],Object.getOwnPropertyDescriptor(X_.prototype,"getRemoteSSRC"),X_.prototype),X_);function HS(t,e,n){const o=t[e];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,d=await a.lock("From NVExtentionsConnection.".concat(e));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await o.apply(this,p)}finally{d()}},n}var Bb;function Y9(t){var e,n,o,a=2;for(typeof Symbol<"u"&&(n=P9,o=Symbol.iterator);a--;){if(n&&(e=t[n])!=null)return e.call(t);if(o&&(e=t[o])!=null)return new IM(e.call(t));n="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function IM(t){function e(n){if(Object(n)!==n)return n_.reject(new TypeError(n+" is not an object."));var o=n.done;return n_.resolve(n.value).then(function(a){return{value:a,done:o}})}return IM=function(n){this.s=n,this.n=n.next},IM.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var o=this.s.return;return o===void 0?n_.resolve({value:n,done:!0}):e(o.apply(this.s,arguments))},throw:function(n){var o=this.s.return;return o===void 0?n_.reject(n):e(o.apply(this.s,arguments))}},new IM(t)}let kI=(Bb=class VM extends N1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(e,n){super(e,n),F(this,"store",void 0),F(this,"peerConnection",void 0),F(this,"cname",void 0),F(this,"mutex",new nS("DataChannelConnection-mutex")),F(this,"dataChannel",void 0),F(this,"_p2pConnection",void 0),F(this,"establishPromise",void 0),F(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(VM.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Hpt(e,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var e;const n=(e=this._nvMedia)===null||e===void 0?void 0:e.getLocalRtpCapabilities();return await this._p2pConnection.establish(n)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(e,n,o,a,d,h){return this.cname=h,await this._p2pConnection.connect(e,n,o,a,d,h),await new n_((p,m)=>{const _=setTimeout(()=>{this.closeSignal(),m(new _s(Y.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(o))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(_),void p()},this.dataChannel.onerror=g=>{this.closeSignal(),m(g)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(e,n){return this._p2pConnection.updateRemoteRTPCapabilities(e,n)}send(e,n,o){var a=this;return QS(function*(){const d=yield L_(a.mutex.lock("From DataChannelConnection.send"));try{return yield*vM(Y9(a._p2pConnection.send(e,n,o)))}finally{d()}})()}async stopSending(e,n){return this._p2pConnection.stopSending(e,n)}async createDataChannels(e,n){return this._p2pConnection.createDataChannels(e,n)}async stopDataChannels(e){return this._p2pConnection.stopDataChannels(e)}async receive(e,n,o,a){return this._nvMedia?(A.debug("[DataChannelConnection] receive ".concat(e," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(e,n,this.cname)):(A.debug("[DataChannelConnection] receive ".concat(e," by WebRTC.")),await this._p2pConnection.receive(e,n,o,a))}async batchReceive(e){return[...await this._p2pConnection.batchReceive(e)]}async stopReceiving(e){return await this._p2pConnection.stopReceiving(e)}async muteRemote(e){return await this._p2pConnection.muteRemote(e)}async unmuteRemote(e){return await this._p2pConnection.unmuteRemote(e)}async muteLocal(e){return await this._p2pConnection.muteLocal(e)}async unmuteLocal(e){return await this._p2pConnection.unmuteLocal(e)}restartICE(e){var n=this;return QS(function*(){return yield*vM(Y9(n._p2pConnection.restartICE(e)))})()}close(){var e;(e=this._nvMedia)===null||e===void 0||e.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(e){return this._p2pConnection.getRemoteVideoIsReady(e)}updateRemoteConnect(e){var n;(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(e),this._p2pConnection.updateRemoteConnect(e)}async updateEncoderConfig(e,n){return await this._p2pConnection.updateEncoderConfig(e,n)}async updateSendParameters(e,n){return await this._p2pConnection.updateSendParameters(e,n)}setStatsRemoteVideoIsReady(e,n){this._p2pConnection.setStatsRemoteVideoIsReady(e,n)}async replaceTrack(e,n){return await this._p2pConnection.replaceTrack(e,n)}async getRemoteSSRC(e){return this._p2pConnection.getRemoteSSRC(e)}logSDPExchange(e,n,o,a){if($("SDP_LOGGING"))return A.upload("exchanging ".concat(o," ").concat(n," SDP during DataChannelConnection.").concat(a,`
`),e),n==="offer"?d=>{this.logSDPExchange(d,"answer",o==="local"?"remote":"local",a)}:void 0}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(QO(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...VM.turnServerConfigToIceServers(e.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...VM.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),$("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(o=>{o.security?o.tcpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(vI(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!$("FORCE_TURN_TCP")&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=e=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,e)},this._p2pConnection.onConnectionStateChange=e=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,e)},this._p2pConnection.onDTLSTransportStateChange=e=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,e)},this._p2pConnection.onDTLSTransportError=e=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,e)},this._p2pConnection.onICETransportStateChange=e=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,e)},this._p2pConnection.onFirstAudioReceived=e=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,e)},this._p2pConnection.onFirstVideoReceived=e=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,e)},this._p2pConnection.onFirstAudioDecoded=e=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,e)},this._p2pConnection.onFirstVideoDecoded=(e,n,o)=>{var a;return(a=this.onFirstVideoDecoded)===null||a===void 0?void 0:a.call(this,e,n,o)},this._p2pConnection.onFirstVideoDecodedTimeout=e=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,e)},this._p2pConnection.onSelectedLocalCandidateChanged=(e,n)=>{var o;return(o=this.onSelectedLocalCandidateChanged)===null||o===void 0?void 0:o.call(this,e,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(e,n)=>{var o;return(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0?void 0:o.call(this,e,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}setConfiguration(e){this._p2pConnection.setConfiguration(e)}},e_(Bb.prototype,"connect",[p0],Object.getOwnPropertyDescriptor(Bb.prototype,"connect"),Bb.prototype),e_(Bb.prototype,"updateRemoteRTPCapabilities",[p0],Object.getOwnPropertyDescriptor(Bb.prototype,"updateRemoteRTPCapabilities"),Bb.prototype),e_(Bb.prototype,"createDataChannels",[p0],Object.getOwnPropertyDescriptor(Bb.prototype,"createDataChannels"),Bb.prototype),e_(Bb.prototype,"receive",[p0],Object.getOwnPropertyDescriptor(Bb.prototype,"receive"),Bb.prototype),e_(Bb.prototype,"stopReceiving",[p0],Object.getOwnPropertyDescriptor(Bb.prototype,"stopReceiving"),Bb.prototype),e_(Bb.prototype,"muteRemote",[p0],Object.getOwnPropertyDescriptor(Bb.prototype,"muteRemote"),Bb.prototype),e_(Bb.prototype,"unmuteRemote",[p0],Object.getOwnPropertyDescriptor(Bb.prototype,"unmuteRemote"),Bb.prototype),e_(Bb.prototype,"muteLocal",[p0],Object.getOwnPropertyDescriptor(Bb.prototype,"muteLocal"),Bb.prototype),e_(Bb.prototype,"unmuteLocal",[p0],Object.getOwnPropertyDescriptor(Bb.prototype,"unmuteLocal"),Bb.prototype),e_(Bb.prototype,"close",[p0],Object.getOwnPropertyDescriptor(Bb.prototype,"close"),Bb.prototype),e_(Bb.prototype,"updateEncoderConfig",[p0],Object.getOwnPropertyDescriptor(Bb.prototype,"updateEncoderConfig"),Bb.prototype),e_(Bb.prototype,"updateSendParameters",[p0],Object.getOwnPropertyDescriptor(Bb.prototype,"updateSendParameters"),Bb.prototype),e_(Bb.prototype,"replaceTrack",[p0],Object.getOwnPropertyDescriptor(Bb.prototype,"replaceTrack"),Bb.prototype),e_(Bb.prototype,"getRemoteSSRC",[p0],Object.getOwnPropertyDescriptor(Bb.prototype,"getRemoteSSRC"),Bb.prototype),Bb);function p0(t,e,n){const o=t[e];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,d=await a.lock("From DataChannelConnection.".concat(e));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await o.apply(this,p)}finally{d()}},n}var M_;function J9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function LR(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?J9(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J9(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}function X9(t){var e,n,o,a=2;for(typeof Symbol<"u"&&(n=P9,o=Symbol.iterator);a--;){if(n&&(e=t[n])!=null)return e.call(t);if(o&&(e=t[o])!=null)return new wM(e.call(t));n="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function wM(t){function e(n){if(Object(n)!==n)return n_.reject(new TypeError(n+" is not an object."));var o=n.done;return n_.resolve(n.value).then(function(a){return{value:a,done:o}})}return wM=function(n){this.s=n,this.n=n.next},wM.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var o=this.s.return;return o===void 0?n_.resolve({value:n,done:!0}):e(o.apply(this.s,arguments))},throw:function(n){var o=this.s.return;return o===void 0?n_.reject(n):e(o.apply(this.s,arguments))}},new wM(t)}let OM=(M_=class extends ET{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(I_.StateChange,e,this._state)}constructor(t,e){super(),F(this,"store",void 0),F(this,"statsUploader",void 0),F(this,"connection",void 0),F(this,"localTrackMap",new Map),F(this,"remoteUserMap",new Map),F(this,"localDataChannels",[]),F(this,"remoteDataChannelMap",new Map),F(this,"pendingLocalTracks",[]),F(this,"pendingRemoteTracks",[]),F(this,"pendingLocalDataChannels",[]),F(this,"pendingRemoteDataChannels",[]),F(this,"statsCollector",void 0),F(this,"isPlanB",!1),F(this,"shouldForwardP2PCreation",void 0),F(this,"iceFailedCount",0),F(this,"dtlsFailedCount",0),F(this,"mutex",new nS("P2PChannel-mutex")),F(this,"_state",_b.Disconnected),F(this,"_pcStatsUploadType",$("NEW_ICE_RESTART")?WR.FIRST_CONNECTION:WR.OLD_FIRST_CONNECTION),F(this,"_isInRestartIce",!1),F(this,"_isStartRestartIce",!1),F(this,"_restartStates",["disconnected","failed"]),F(this,"_restartTimer",void 0),F(this,"_isFirstConnected",!0),F(this,"handleMuteLocalTrack",async(n,o,a)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==_b.Connected)return void a(new ya(Y.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(n);if(h.length===0)return void o();const p=h.find(_=>_[0]==="videoLowTrack");p&&p[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(_=>{let[,{id:g}]=_;return g}));const m=this.createMuteMessage(h);await oT(this,I_.RequestMuteLocal,m),o()}catch(h){a(h)}finally{d()}}),F(this,"handleUnmuteLocalTrack",async(n,o,a)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==_b.Connected)return void a(new ya(Y.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(n);if(h.length===0)return void o();const p=h.find(_=>_[0]==="videoLowTrack");if(p){const _=p[1];if(_.track._originMediaStreamTrack.stop(),!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&q_().supportDualStreamEncoding){const g=n._mediaStreamTrack.clone();_.track._mediaStreamTrack=g,_.track._originMediaStreamTrack=g}else{const g=N3(n,QI(this,I_.RequestLowStreamParameter));_.track._mediaStreamTrack=g,_.track._originMediaStreamTrack=g}await new n_((g,y)=>{this.handleReplaceTrack(_.track,g,y,!0)})}await this.connection.unmuteLocal(h.map(_=>{let[,{id:g}]=_;return g}));const m=this.createUnmuteMessage(h);await oT(this,I_.RequestUnmuteLocal,m),o()}catch(h){a(h)}finally{d()}}),F(this,"handleUpdateVideoEncoder",async(n,o,a)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const h=this.localTrackMap.get(_E.LocalVideoTrack);if(!this.connection||!h||h.track!==n||this.state!==_b.Connected)return void o();const{id:p,track:m}=h;await this.connection.updateSendParameters(p,m),await this.connection.updateEncoderConfig(p,m),this.emit(I_.UpdateVideoEncoder,m),o()}catch(h){a(h)}finally{d()}}),F(this,"handleUpdateVideoSendParameters",async(n,o,a)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(_E.LocalVideoTrack);if(!this.connection||!h||h.track!==n||this.state!==_b.Connected)return void o();const{id:p,track:m}=h;await this.connection.updateSendParameters(p,m),o()}catch(h){a(h)}finally{d()}}),F(this,"handleReplaceMixingTrack",async(n,o,a,d)=>{if(!this.connection||this.state!==_b.Connected)return void o();const h=D3([n]);let p;A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof d=="boolean"&&d||(p=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,h),o()}catch(_){a(_)}finally{var m;(m=p)===null||m===void 0||m()}}),F(this,"handleReplaceTrack",async(n,o,a,d)=>{let h;A.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var p;const _=Array.from(this.localTrackMap.entries()).find(g=>{let[,{track:y}]=g;return n===y});if(!this.connection||!_||this.state!==_b.Connected)return void o();if(await((p=this.connection)===null||p===void 0?void 0:p.replaceTrack(n,_[1].id)),this.isPlanB){const g=_[1];g.id=n._mediaStreamTrack.id,this.localTrackMap.set(_[0],g)}if(_[0]===_E.LocalVideoTrack&&!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&q_().supportDualStreamEncoding){const g=this.localTrackMap.get(_E.LocalVideoLowTrack);if(g){const y=n._mediaStreamTrack.clone();g.track._originMediaStreamTrack.stop(),g.track._mediaStreamTrack=y,g.track._originMediaStreamTrack=y,await new n_((C,O)=>{this.handleReplaceTrack(g.track,C,O,!0)})}}o()}catch(_){a(_)}finally{var m;(m=h)===null||m===void 0||m()}}),F(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),F(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),F(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),F(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),F(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new p9(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!q_().supportUnifiedPlan||$("CHROME_FORCE_PLAN_B")&&hI(),this.shouldForwardP2PCreation=$("FORWARD_P2P_CREATION")&&q_().supportPCSetConfiguration&&LF(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new kI({},this.store):this.isPlanB?new PN({},this.store):new hR({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,e){var n;this.state=_b.New;const o=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!o||(o&&this.connection&&(A.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new kI(t,this.store):this.isPlanB?new PN(t,this.store):new hR(t,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new ya(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=$("NEW_ICE_RESTART")?WR.FIRST_CONNECTION:WR.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t,e,n,o,a,d){if(!this.connection)throw new ya(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof kI?this.connection.updateRemoteConnect(o):(this.store.peerConnectionStart(),await this.connection.connect(t,e,n,o,a,d),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=_b.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(a=>{var d;let[h]=a;return o_(d=[_E.LocalVideoLowTrack,_E.LocalVideoTrack]).call(d,h)}),n=e.map(a=>{let[,{id:d}]=a;return d}),o=e.map(a=>{let[d]=a;return d});if(this.connection instanceof hR){if(E_.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!o_(t).call(t,this.store.codec)){const a=["vp9","vp8","h264"].find(d=>o_(t).call(t,d));a&&(this.store.codec=a,A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(a,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async preConnect(t,e,n,o,a,d){if(!this.connection)throw new ya(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const h=await this.connection.connect(t,e,n,o,a,d);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=_b.Connected,h}getEstablishParams(){if(this.connection instanceof kI)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(t){if(!this.connection||this.state!==_b.Connected){if(this.state===_b.Disconnected)throw new ya(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return void t.forEach(n=>{var o;o_(o=this.pendingLocalDataChannels).call(o,n)||this.pendingLocalDataChannels.push(n)})}const e=this.filterTobePublishedDataChannels(t);e.length!==0&&(e.forEach(n=>{const o=Date.now();this.store.publish(n.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const o=Date.now();this.store.publish(n.id+"","datachannel",void 0,o)}))}publish(t,e,n){var o=this;return QS(function*(){const a=yield L_(o.mutex.lock("From P2PChannel.publish"));try{if(!o.connection||o.state!==_b.Connected){if(o.state===_b.Disconnected)throw new ya(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(t);const h=t.filter(p=>o.pendingLocalTracks.indexOf(p)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(h))}o.store.pubId=o.store.pubId+1,gS.markPublishStart(o.store.clientId,o.store.pubId);const d=o.filterTobePublishedTracks(t,e,n);if(d.length===0)return void(yield L_(o.tryToUnmuteAudio(t)));yield*vM(X9(o.doPublish(o.connection,d)))}finally{a()}})()}doPublish(t,e){var n=this;return QS(function*(){e.forEach(y=>{let{track:C,type:O}=y;const q=Date.now();n.store.publish(C.getTrackId(),O===_E.LocalAudioTrack?"audio":"video",q)}),n.bindLocalTrackEvents(e);const o=e.map(y=>{let{track:C}=y;return C}),a=yield L_(t.send(e.map(y=>{let{track:C}=y;return C}),n.store.codec,n.store.audioCodec)),d=(yield L_(a.next())).value,h=n.createGatewayPublishMessage(e,d);let p;try{p=yield h}catch(y){throw a.throw(y),(y==null?void 0:y.code)===Y.WS_ABORT&&e.forEach(C=>{let{track:O}=C;n.pendingLocalTracks.indexOf(O)===-1&&n.pendingLocalTracks.push(O)}),n.unbindLocalTrackEvents(e),y}const m=n.mapPubResToRemoteConfig(h,p),_=(yield L_(a.next(m))).value,g=$("ENABLE_VIDEO_SEI");o.forEach(async y=>{const C=y.getRTCRtpTransceiver();C&&g&&(y.trackMediaType===m_.VIDEO?await mpt(C.sender,y):y.trackMediaType===m_.AUDIO&&await async function(O){if(!q_().supportWebRTCEncodedTransform)return void A.warning("browser not support audio encoded transform");if(dM.has(O)||!O.track)return;const q={track:O.track};if(lI()){if(!O.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");let U=null;try{U=O.createEncodedStreams()}catch(J){return void A.error("create audio-encoded-streams error",J&&J.message)}const K=new TransformStream({transform(J,_r){q.controller||(q.controller=_r),O.track&&O.track.id!==q.track.id&&(A.debug("audio track changed: ".concat(q.track.id," => ").concat(O.track.id)),q.track.removeEventListener("ended",L),q.track=O.track,q.track.addEventListener("ended",L)),_r.enqueue(J)}});U.readable.pipeThrough(K).pipeTo(U.writable)}else if(ZT()){if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");const U=uM(),K=new MessageChannel;await new n_(_r=>U.onmessage=_o=>{_o.data==="registered"&&_r(void 0)});const J=new RTCRtpScriptTransform(U,{name:"tx",port:K.port2},[K.port2]);O.transform=J,await new n_(_r=>U.onmessage=_o=>{_o.data==="started"&&_r(void 0)}),K.port1.onmessage=_r=>{var _o;_r.data.transformed&&O.track&&((_o=O.track)===null||_o===void 0?void 0:_o.id)!==q.track.id&&(A.debug("audio track changed: ".concat(q.track.id," => ").concat(O.track.id)),q.track.removeEventListener("ended",L),q.track=O.track,q.track.addEventListener("ended",L))},q.worker=U}function L(){if(O.track){if(this.id!==O.track.id)return;O.track.removeEventListener("ended",L)}const U=dM.get(O);if(U){dM.delete(O);try{var K,J;(K=U.controller)===null||K===void 0||K.terminate(),(J=U.worker)===null||J===void 0||J.terminate()}catch(_r){A.warning(_r&&_r.message)}}}dM.set(O,q),O.track.addEventListener("ended",L)}(C.sender))}),e.forEach(y=>{let{type:C}=y;n.statsCollector.addLocalStats(C)}),n.assignLocalTracks(e,_),n.statsUploader.startUploadOutboundStats(),e.forEach(y=>{let{track:C,type:O}=y;const q=Date.now();n.store.publish(C.getTrackId(),O===_E.LocalAudioTrack?"audio":"video",void 0,q)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n)return;if(!(n.track instanceof aT))return A.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof hR||this.connection instanceof PN))return A.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:o}=n,a=function(d,h){const p={};return d.height&&d.width&&(p.scaleResolutionDownBy=sG(d,h)),p.maxFramerate=d.framerate?BS(d.framerate):void 0,p.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,p}(t,o);if(o._encoderConfig||(o._encoderConfig={}),e!==_E.LocalVideoLowTrack||!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&q_().supportDualStreamEncoding)a.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=a.scaleResolutionDownBy);else{const d=o._originMediaStreamTrack;if(!d.canvas)return A.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,p){const m=h.canvas;p.width&&(m.width=BS(p.width)),p.height&&(m.height=BS(p.height)),p.framerate&&(m.stopCapture&&m.stopCapture(),m.stopCapture=l3(()=>{!m.startCapture&&m.stopCapture&&m.stopCapture(),m.startCapture&&m.startCapture()},BS(p.framerate)))})(d,t)}a.maxBitrate!=null&&(o._encoderConfig.bitrateMax=a.maxBitrate/1e3),a.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=a.maxFramerate:o._encoderConfig.frameRate={max:a.maxFramerate}),A.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(t){var e=this;return QS(function*(){if(!e.connection||e.state!==_b.Connected)return;const n=yield L_(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const a=e.localTrackMap.get(_E.LocalVideoTrack);if(!a)throw new ya(Y.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(_E.LocalVideoLowTrack))throw new ya(Y.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:e.getLowVideoTrack(a.track,t),type:_E.LocalVideoLowTrack}];if(yield*vM(X9(e.doPublish(e.connection,d))),a.track.muted||!a.track.enabled){var o;const h=(o=e.localTrackMap.get(_E.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield L_(e.connection.muteLocal([h])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(A.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await GT(this,I_.RequestRePublish,this.pendingLocalTracks),this.emit(I_.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(A.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await GT(this,I_.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:o}=this.pendingRemoteTracks[e];(o!==m_.AUDIO||n._audio_added_&&n._audioSSRC)&&(o!==m_.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await GT(this,I_.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===m_.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit(I_.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==_b.Connected)return void t.forEach(o=>{const a=this.pendingLocalTracks.indexOf(o);a!==-1&&this.pendingLocalTracks.splice(a,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(o=>o[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==_b.Connected)return void t.forEach(n=>{const o=this.pendingLocalDataChannels.indexOf(n);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const o=this.localDataChannels.indexOf(n);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==_b.Connected)return;const t=this.localTrackMap.get(_E.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[_E.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(o=>{let[,{id:a}]=o;return a})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(o=>{let[a,{track:d}]=o;return{type:a,track:d}})),e.forEach(o=>{let[a]=o;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==_b.Connected)throw new ya(Y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(o=>{var a;return!((a=this.remoteDataChannelMap.get(t))!==null&&a!==void 0&&a.get(o.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(o=>{var a;this.remoteDataChannelMap.has(t)?(a=this.remoteDataChannelMap.get(t))===null||a===void 0||a.set(o.id,o):this.remoteDataChannelMap.set(t,new Map([[o.id,o]]));const d=this.pendingRemoteDataChannels.findIndex(h=>{let{user:p,id:m}=h;return p.uid===t.uid&&m===o.id});d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),n.map(o=>o.id)}async subscribe(t,e,n,o,a){var d;if(!this.connection||this.state!==_b.Connected)throw new ya(Y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(t))!==null&&d!==void 0&&d.has(e))return;let h,p,m;if(a){const y=a.find(O=>{let{stream_type:q}=O;return q===e});if(!y)throw new ya(Y.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const C=await this.connection.receive(e,y.ssrcs,String(t._uintid),y.attributes);this.connection instanceof hR&&(m=C.transceiver),h=C.track,p=C.id}else{const y=await this.connection.receive(e,[{ssrcId:n,rtx:o}],String(t._uintid),void 0);this.connection instanceof hR&&(m=y.transceiver),h=y.track,p=y.id}e===m_.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new ON(h,t.uid,t._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new wN(h,t.uid,t._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack)),$("ENABLE_VIDEO_SEI")&&m&&(e==m_.VIDEO?await Ept(m.receiver,{onSei:y=>{var C;(C=t._videoTrack)===null||C===void 0||C._onSei(y)}}):e==m_.AUDIO&&await async function(y){if(!q_().supportWebRTCEncodedTransform)return void A.warning("browser not support audio encoded transform");if(lM.has(y))return;const C={track:y.track};if(lI()){if(!y.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");let q=null;try{q=y.createEncodedStreams()}catch(U){return void A.error("create audio-encoded-streams error",U&&U.message)}const L=new TransformStream({transform(U,K){C.controller||(C.controller=K),y.track&&y.track.id!==C.track.id&&(A.debug("audio track changed: ".concat(C.track.id," => ").concat(y.track.id)),C.track.removeEventListener("ended",O),C.track=y.track,C.track.addEventListener("ended",O)),K.enqueue(U)}});q.readable.pipeThrough(L).pipeTo(q.writable)}else if(ZT()){if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");const q=uM(),L=new MessageChannel;await new n_(K=>q.onmessage=J=>{J.data==="registered"&&K(void 0)});const U=new RTCRtpScriptTransform(q,{name:"rx",port:L.port2},[L.port2]);y.transform=U,await new n_(K=>q.onmessage=J=>{J.data==="started"&&K(void 0)}),L.port1.onmessage=K=>{var J;K.data.transformed&&y.track&&((J=y.track)===null||J===void 0?void 0:J.id)!==C.track.id&&(A.debug("audio track changed: ".concat(C.track.id," => ").concat(y.track.id)),C.track.removeEventListener("ended",O),C.track=y.track,C.track.addEventListener("ended",O))},C.worker=q}function O(){y.track.removeEventListener("ended",O),function(q){const L=lM.get(q);if(L){lM.delete(q);try{var U,K;(U=L.controller)===null||U===void 0||U.terminate(),(K=L.worker)===null||K===void 0||K.terminate()}catch(J){A.warning(J&&J.message)}}}(y)}lM.set(y,C),y.track.addEventListener("ended",O)}(m.receiver));const _=this.remoteUserMap.get(t);_?_.set(e,p):this.remoteUserMap.set(t,new Map([[e,p]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const g=this.pendingRemoteTracks.findIndex(y=>{let{user:C,kind:O}=y;return C.uid===t.uid&&e===O});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(I_.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==_b.Connected)throw new ya(Y.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(n=>{var o;let{user:a,mediaType:d}=n;return!((o=this.remoteUserMap.get(a))!==null&&o!==void 0&&o.has(d))});const e=await this.connection.batchReceive(t.map(n=>{let{user:o,mediaType:a,ssrcId:d,rtxSsrcId:h}=n;return{kind:a,ssrcMsg:[{ssrcId:d,rtx:h}],mslabel:String(o._uintid)}}));t.forEach((n,o)=>{let{user:a,mediaType:d}=n;const{track:h,id:p,transceiver:m}=e[o];d===m_.AUDIO?(a._audioTrack?a._audioTrack._updateOriginMediaStreamTrack(h):(a._audioTrack=new ON(h,a.uid,a._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(a._audioTrack.getTrackId()))),m&&a._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(a,a._audioTrack)):(a._videoTrack?a._videoTrack._updateOriginMediaStreamTrack(h):(a._videoTrack=new wN(h,a.uid,a._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(a._videoTrack.getTrackId()))),m&&a._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(a,a._videoTrack));const _=this.remoteUserMap.get(a);_?_.set(d,p):this.remoteUserMap.set(a,new Map([[d,p]])),this.statsCollector.addRemoteStats(a.uid),this.statsUploader.startUploadInboundStats();const g=this.pendingRemoteTracks.findIndex(y=>{let{user:C,kind:O}=y;return C.uid===a.uid&&d===O});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(I_.MediaReconnectEnd,a.uid))})}async unsubscribe(t,e,n){const o=this.pendingRemoteTracks.filter(h=>{let{user:p,kind:m}=h;return e!==void 0?p.uid===t.uid&&e===m:p.uid===t.uid});if(o.forEach(h=>{const p=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(p,1)}),this.connection&&this.state===_b.Connected||n||o.forEach(h=>{let{kind:p}=h;var m;if(p===m_.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(p===m_.VIDEO){var _;(_=t._videoTrack)===null||_===void 0||_._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==_b.Connected)return;const a=this.filterTobeUnSubscribedTracks(t,e);if(a.length===0)return;await this.connection.stopReceiving(a.map(h=>{let[,{id:p}]=h;return p}));const d=this.createUnsubscribeMessage(a);return this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),a.forEach(h=>{let[p,{kind:m}]=h;var _,g;if(m===m_.VIDEO&&p._videoSSRC&&((_=this.connection)===null||_===void 0||_.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),m===m_.VIDEO)this.unbindRemoteTrackEvents(p._videoTrack),n||((g=p._videoTrack)===null||g===void 0||g._destroy(),p._videoTrack=void 0);else if(m===m_.AUDIO){var y;this.unbindRemoteTrackEvents(p._audioTrack),!n&&((y=p._audioTrack)===null||y===void 0||y._destroy(),p._audioTrack=void 0)}}),d}async unsubscribeDataChannel(t,e){if(e.forEach(a=>{const d=this.pendingRemoteDataChannels.findIndex(h=>h.id===a.id);d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(a=>{a._close()});const o=this.remoteDataChannelMap.get(t);return n.forEach(a=>{o&&o.delete(a.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(a=>a.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:a,mediaType:d}of t){const h=this.pendingRemoteTracks.filter(p=>{let{user:m,kind:_}=p;return d!==void 0?m.uid===a.uid&&d===_:m.uid===a.uid});h.forEach(p=>{const m=this.pendingRemoteTracks.indexOf(p);this.pendingRemoteTracks.splice(m,1)}),e=e.concat(h)}if(!this.connection||this.state!==_b.Connected)return void e.forEach(a=>{let{user:d,kind:h}=a;var p;if(h===m_.AUDIO)(p=d._audioTrack)===null||p===void 0||p._destroy(),d._audioTrack=void 0;else if(h===m_.VIDEO){var m;(m=d._videoTrack)===null||m===void 0||m._destroy(),d._videoTrack=void 0}});const n=Z0(t).call(t,(a,d)=>{let{user:h,mediaType:p}=d;const m=this.filterTobeUnSubscribedTracks(h,p);return a.concat(m)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(a=>{let[,{id:d}]=a;return d}));const o=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(a=>{let[d,{kind:h}]=a;var p,m;if(h===m_.VIDEO&&d._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===m_.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(m=d._videoTrack)===null||m===void 0||m._destroy(),d._videoTrack=void 0;else if(h===m_.AUDIO){var _;this.unbindRemoteTrackEvents(d._audioTrack),(_=d._audioTrack)===null||_===void 0||_._destroy(),d._audioTrack=void 0}}),o}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void A.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void A.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const o=e===m_.VIDEO?t._videoSSRC:t._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void A.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||A.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(_E.LocalAudioTrack);if((e==null?void 0:e.track)instanceof YT){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[a]=o;return a!==_E.LocalAudioTrack}).filter(o=>{let[a]=o;return!(t&&a===_E.LocalVideoLowTrack)}).map(o=>{let[,{track:a}]=o;return a}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[o]=n;return!(t&&o===_E.LocalVideoLowTrack)}).map(n=>{let[,{track:o}]=n;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,o,a){if(t){const h=this.localTrackMap.get(_E.LocalAudioTrack),p=o?this.localTrackMap.get(_E.LocalVideoLowTrack):this.localTrackMap.get(_E.LocalVideoTrack);E_.publish(this.store.sessionId,{eventElapse:gS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(lT.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var d;n||(n=[]);const h=n.find(m=>m instanceof OT),p=o?(d=this.localTrackMap.get(_E.LocalVideoTrack))===null||d===void 0?void 0:d.track:n.find(m=>m instanceof aT);E_.publish(this.store.sessionId,{eventElapse:gS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:h==null?void 0:h.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(lT.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(t,e,n,o){const a=o===m_.VIDEO?n._videoSSRC:n._audioSSRC;a&&E_.subscribe(this.store.sessionId,{succ:t,ec:e,video:o===m_.VIDEO,audio:o===m_.AUDIO,peerid:n.uid,subscribeRequestid:o===m_.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:gS.measureFromSubscribeStart(this.store.clientId,a)})}reset(){A.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new nS("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new kI({},this.store):this.isPlanB?new PN({},this.store):new hR({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(_E.LocalAudioTrack);if((t==null?void 0:t.track)instanceof YT){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=_b.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(_E.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(_E.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof aT||e&&e.track instanceof OT?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(e0(e=this.remoteUserMap).call(e)).find(o=>o.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[o]=n;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(_E.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=$N(t).call(t,(n,o)=>n.level-o.level),t}async disconnectForReconnect(){this.connection&&(A.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=_b.Reconnecting,$("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new kI({},this.store):this.isPlanB?new PN({},this.store):new hR({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:o}]=t;switch(n){case _E.LocalVideoTrack:o_(e=o._hints).call(e,lT.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case _E.LocalAudioTrack:o instanceof YT?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case _E.LocalVideoLowTrack:}}),this.emit(I_.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(e0(n).call(n)).forEach(o=>{this.setPendingRemoteMedia(e,o)}),this.emit(I_.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(e0(n).call(n)).forEach(o=>{this.setPendingRemoteDataChannel(e,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),A.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:o,id:a}=n;if((t instanceof NI?t.uid:t)===o.uid&&a===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:o,kind:a}=n;if((t instanceof NI?t.uid:t)===o.uid&&e===a)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return QS(function*(){if(!e.connection||e.state!==_b.Connected||e.connection instanceof kI)return;const n=yield L_(e.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield L_(e.connection.restartICE(t));const d=yield L_(o.next());if(d.done)return;const h=d.value,p=yield h;switch(e.reportPCDisconnectedOrFailed(t),t){case SS.TCP:e._pcStatsUploadType=WR.TCP_RESTART;break;case SS.RELAY:e._pcStatsUploadType=WR.RELAY_RESTART;break;default:e._pcStatsUploadType=WR.OLD_RESTART}e._isInRestartIce=!0,o.next(p)}catch(d){var a;(a=o)===null||a===void 0||a.throw(d)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(_E.LocalVideoTrack),n=this.localTrackMap.get(_E.LocalAudioTrack),o=t.videoSend.find(O=>O.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),a=t.audioSend.find(O=>O.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!o||!a)return 1;const d=JS(this,I_.NeedSignalRTT),h=o?o.rttMs:void 0,p=a?a.rttMs:void 0,m=h&&p?(h+p)/2:h||p,_=(m&&d?(m+d)/2:m||d)||0,g=100*t.sendPacketLossRate*.7/50+.3*_/1500,y=g<.17?1:g<.36?2:g<.59?3:g<.1?4:5,C=e==null?void 0:e.track;if(C&&C._encoderConfig&&C._hints.indexOf(lT.SCREEN_TRACK)===-1){const O=C._encoderConfig.bitrateMax,q=t.bitrate.actualEncoded;if(O&&q){const L=(1e3*O-q)/(1e3*O);return k8[L<.15?0:L<.3?1:L<.45?2:L<.6?3:4][y]}}return y}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[o]=n;const a=o._audioSSRC,d=o._videoSSRC,h=t.audioRecv.find(q=>q.ssrc===a),p=t.videoRecv.find(q=>q.ssrc===d);if(!h&&!p)return void(e+=1);const m=JS(this,I_.NeedSignalRTT),_=t.rtt,g=(_&&m?(_+m)/2:_||m)||0,y=h?h.jitterMs:void 0,C=t.recvPacketLossRate;let O=.7*C*100/50+.3*g/1500;y&&(O=.6*C*100/50+.2*g/1500+.2*y/400),e+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new n_((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(A.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==_b.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return t===h});if(!o)return;const a=o[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:a}]),this.bindLocalTrackEvents([{track:e,type:a}]),o[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,o[1].id)),this.isPlanB){const d=o[1];d.id=e._mediaStreamTrack.id,this.localTrackMap.set(a,d)}if(a===_E.LocalVideoTrack&&!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&q_().supportDualStreamEncoding){const d=this.localTrackMap.get(_E.LocalVideoLowTrack);if(d){const h=t._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=h,d.track._originMediaStreamTrack=h,await new n_((p,m)=>{this.handleReplaceTrack(d.track,p,m,!0)})}}}filterTobePublishedTracks(t,e,n){const o=[],a=this.getAllTracks();t=ZO(t=t.filter(m=>a.indexOf(m)===-1));let d,h=!1;const p=this.localTrackMap.get(_E.LocalAudioTrack);for(const m of t){if(m instanceof aT&&(this.localTrackMap.has(_E.LocalVideoTrack)||h?new ya(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:m,type:_E.LocalVideoTrack}),h=!0),e)){const _=this.getLowVideoTrack(m,n);o.push({track:_,type:_E.LocalVideoLowTrack})}if(m instanceof OT)if(p){const _=p.track;if(_ instanceof YT)P3([m]),_.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0);else{const g=D3([_,m]);A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(g.getTrackId(),"]")),this.replaceTrack(_,g)}}else d instanceof YT?(P3([m]),d.addAudioTrack(m)):d||!m._useAudioElement&&q_().webAudioMediaStreamDest&&!m._bypassWebAudio?d=D3(d?[m,d]:[m]):d=m}return d&&(A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),o.push({track:d,type:_E.LocalAudioTrack})),o}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=ZO(t=t.filter(o=>n.indexOf(o)!==-1));for(const o of t){if(o instanceof OT){const a=this.localTrackMap.get(_E.LocalAudioTrack);if(!a)continue;a.track instanceof YT?(a.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),a.track.trackList.length===0&&(e.push([_E.LocalAudioTrack,a]),a.track.close())):e.push([_E.LocalAudioTrack,a])}if(o instanceof aT){const a=this.localTrackMap.get(_E.LocalVideoTrack);if(!a)continue;e.push([_E.LocalVideoTrack,a]);const d=this.localTrackMap.get(_E.LocalVideoLowTrack);d&&e.push([_E.LocalVideoLowTrack,d])}}return e}filterTobePublishedDataChannels(t){return t=(t=ZO(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=ZO(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:o}=e;switch(o){case _E.LocalVideoTrack:n.addListener(c_.GET_STATS,this.handleGetLocalVideoStats),n.addListener(c_.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(c_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(c_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(c_.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(c_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(c_.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(c_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(c_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _E.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case _E.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof YT?t.trackList.forEach(n=>{n.addListener(c_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(c_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(c_.GET_STATS,this.handleGetLocalAudioStats),n.addListener(c_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(c_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(c_.GET_STATS,this.handleGetLocalAudioStats),t.addListener(c_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(c_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(c_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(c_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(c_.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(c_.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:o}]=e;return{track:o,type:n}})),t.forEach(e=>{let{track:n,type:o}=e;switch(o){case _E.LocalVideoTrack:n.off(c_.GET_STATS,this.handleGetLocalVideoStats),n.off(c_.GET_RTC_STATS,this.handleGetRTCStats),n.off(c_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(c_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(c_.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(c_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(c_.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(c_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(c_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _E.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case _E.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof YT?t.trackList.forEach(e=>{e.off(c_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(c_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(c_.GET_STATS,this.handleGetLocalAudioStats),e.off(c_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(c_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(c_.GET_STATS,this.handleGetLocalAudioStats),t.off(c_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(c_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(c_.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(c_.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(c_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(c_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof wN&&e.addListener(c_.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof ON&&e.addListener(c_.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(c_.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(m_.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(m_.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,o)=>{var a;let d,h,{track:p,type:m}=n;switch(m){case _E.LocalAudioTrack:d=lb.Audio,h={dtx:p instanceof cM&&p._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case _E.LocalVideoTrack:d=o_(a=p._hints).call(a,lT.SCREEN_TRACK)?lb.Screen:lb.High,h=LR(LR({},Z8(p)),{},{codec:this.store.codec});break;case _E.LocalVideoLowTrack:d=lb.Low,h=LR(LR({},Z8(p)),{},{codec:this.store.codec})}return{stream_type:d,attributes:h,ssrcs:e[o]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let o,[a,{track:d,ssrcs:h,id:p}]=e;switch(a){case _E.LocalVideoTrack:o=o_(n=d._hints).call(n,lT.SCREEN_TRACK)?lb.Screen:lb.High;break;case _E.LocalAudioTrack:o=lb.Audio;break;case _E.LocalVideoLowTrack:o=lb.Low}return{stream_type:o,ssrcs:h,mid:p}})}assignLocalTracks(t,e){t.forEach((n,o)=>{let{track:a,type:d}=n;this.localTrackMap.set(d,{track:a,id:e[o].id,ssrcs:e[o].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(I_.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),$("NEW_ICE_RESTART")){var n;if(o_(n=this._restartStates).call(n,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const o=h=>{(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")&&(A.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(h)),JS(this,I_.QueryClientConnectionState)==="CONNECTED"&&this.emit(I_.RequestRestartICE,h))},a=()=>{t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="checking"&&t.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),A.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(I_.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},d=$("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if($("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&q_().supportPCSetConfiguration)o(SS.RELAY),this._restartTimer=window.setTimeout(a,d);else if(iT())o(SS.UDP),this._restartTimer=window.setTimeout(a,4e3);else{if(o(SS.TCP),q_().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{o(SS.RELAY),this._restartTimer=window.setTimeout(a,d)},d));this._restartTimer=window.setTimeout(a,d)}},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&$("ICE_RESTART")&&JS(this,I_.QueryClientConnectionState)==="CONNECTED"&&this.emit(I_.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(I_.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(I_.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),E_.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:IT.TRACER}).onSuccess(),this.emit(I_.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const o=Array.from(e0(n=this.remoteUserMap).call(n)).find(d=>d._audioSSRC===e);var a;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(a=o.audioTrack)===null||a===void 0||a.emit(SN.FIRST_FRAME_DECODED),E_.firstRemoteFrame(this.store.sessionId,rS.FIRST_AUDIO_DECODE,yT.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:gS.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const o=Array.from(e0(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===e);o&&E_.firstRemoteFrame(this.store.sessionId,rS.FIRST_AUDIO_RECEIVED,yT.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:gS.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,o)=>{this.reportVideoFirstFrameDecoded(e,n,o)},t.onFirstVideoReceived=e=>{var n;const o=Array.from(e0(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===e);o&&E_.firstRemoteFrame(this.store.sessionId,rS.FIRST_VIDEO_RECEIVED,yT.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:gS.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const o=e.candidateType==="relay",a=n.candidateType==="relay";n.candidateType!=="unknown"&&o===a||this.emit(I_.ConnectionTypeChange,o),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(bI(n))," -> ").concat(JSON.stringify(bI(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(bI(n))," -> ").concat(JSON.stringify(bI(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return LR(LR({},e),n)}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(_E.LocalAudioTrack);if(t instanceof OT&&(n==null?void 0:n.track)instanceof YT)return n.track.isActive||e.push([_E.LocalAudioTrack,n]),e;const o=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:d}]=a;return t===d});if(o&&(e.push(o),o[0]===_E.LocalVideoTrack)){const a=this.localTrackMap.get(_E.LocalVideoLowTrack);a&&e.push([_E.LocalVideoLowTrack,a])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(_E.LocalAudioTrack);if(t instanceof OT&&(n==null?void 0:n.track)instanceof YT)return n.track.isActive&&e.push([_E.LocalAudioTrack,n]),e;const o=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:d}]=a;return t===d});if(o)if(o[0]===_E.LocalVideoTrack){e.push(o);const a=this.localTrackMap.get(_E.LocalVideoLowTrack);a&&e.push([_E.LocalVideoLowTrack,a])}else e.push(o);return e}createMuteMessage(t){return t.map(e=>{var n;let o,[a,{track:d,ssrcs:h,id:p}]=e;switch(a){case _E.LocalAudioTrack:o=lb.Audio;break;case _E.LocalVideoTrack:o=o_(n=d._hints).call(n,lT.SCREEN_TRACK)?lb.Screen:lb.High;break;case _E.LocalVideoLowTrack:o=lb.Low}return{stream_type:o,ssrcs:h,mid:p}})}createUnmuteMessage(t){return t.map(e=>{var n;let o,[a,{track:d,ssrcs:h,id:p}]=e;switch(a){case _E.LocalAudioTrack:o=lb.Audio;break;case _E.LocalVideoTrack:o=o_(n=d._hints).call(n,lT.SCREEN_TRACK)?lb.Screen:lb.High;break;case _E.LocalVideoLowTrack:o=lb.Low}return{stream_type:o,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(t,e){const n=[],o=this.remoteUserMap.get(t);if(!o)return n;if(e){const a=o.get(e);if(!a)return n;n.push([t,{kind:e,id:a}])}else Array.from(o.entries()).forEach(a=>{let[d,h]=a;n.push([t,{kind:d,id:h}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(o=>{var a;(a=this.remoteDataChannelMap.get(t))!==null&&a!==void 0&&a.has(o.id)&&n.push(o)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[o,{kind:a,id:d}]=n;switch(a){case m_.VIDEO:return void(o._videoSSRC&&e.push({stream_type:m_.VIDEO,ssrcId:o._videoSSRC}));case m_.AUDIO:return void(o._audioSSRC&&e.push({stream_type:m_.AUDIO,ssrcId:o._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[o,{kind:a}]=n;if(e.has(o)){let d=e.get(o);a===m_.VIDEO?d|=tS.Video:d|=tS.Audio,e.set(o,d)}else a===m_.VIDEO?e.set(o,tS.Video):e.set(o,tS.Audio)}),{users:Array.from(e.entries()).map(n=>{let[o,a]=n;return{stream_id:o.uid,stream_type:a}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:o}]=e;const a=this.remoteUserMap.get(n);a&&(a.delete(o),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(_E.LocalVideoTrack),n=this.localTrackMap.get(_E.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),n&&t.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e){return t.map((n,o)=>{var a;let{stream_type:d}=n;return(a=e.find(h=>{let{stream_type:p}=h;return d===p}))===null||a===void 0?void 0:a.attributes})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof OT){var e;const o=this.filterTobeUnmutedTracks(t[n]);if(o.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(o.map(d=>{let[,{id:h}]=d;return h})));const a=this.createUnmuteMessage(o);return void await oT(this,I_.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(I_.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(I_.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await $T(y1(this.dtlsFailedCount,xT)),this.emit(I_.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await GT(this,I_.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(I_.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(_E.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof aT)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof aT).length>1)throw new ya(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof OT).length>1&&(t.some(e=>e instanceof OT&&e._bypassWebAudio)||!q_().webAudioMediaStreamDest))throw new ya(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof aT&&this.pendingLocalTracks.some(n=>n instanceof aT))throw new ya(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof OT&&this.pendingLocalTracks.some(n=>n instanceof OT)&&(!q_().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof OT&&n._bypassWebAudio)))throw new ya(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&q_().supportDualStreamEncoding,o=LR(LR({},{width:160,height:120,framerate:15,bitrate:50}),e);let a;a=n?t._mediaStreamTrack.clone():N3(t,o);const d=sT(8,"track-low-"),h=new aT(a,LR(LR({},n&&{scaleResolutionDownBy:sG(o,t)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,d);return h.on(pO.TRANSCEIVER_UPDATED,p=>{t._updateRtpTransceiver(p,yN.LOW_STREAM)}),h._hints.push(lT.LOW_STREAM),t.on("sei-to-send",p=>{h.emit("sei-to-send",p)}),t.addListener(c_.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof hR){var a,d,h,p;const m=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:_,dtlsTransportState:g,peerConnectionState:y}=this.connection,{local:C,remote:O}=await this.connection.getSelectedCandidatePair();E_.pcStats(this.store.sessionId,{startTime:m,eventElapse:t-m||0,iceconnectionsate:_,dtlsstate:g,connectionstate:y,intSucc:e?1:2,error:o,selectedLocalCandidateProtocol:(a=C==null?void 0:C.protocol)!==null&&a!==void 0?a:"",selectedLocalCandidateType:(d=C.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(C.address,":").concat(C.port),selectedRemoteCandidateProtocol:(h=O.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(p=O.candidateType)!==null&&p!==void 0?p:"",selectedRemoteCandidateAddress:"".concat(O.address,":").concat(O.port),restartCnt:n})}}reportVideoFirstFrameDecoded(t,e,n,o){var a;const d=Array.from(e0(a=this.remoteUserMap).call(a)).find(h=>h._videoSSRC===t);if(d){o||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,p=h.subscribe.find(m=>m.userId===d.uid&&m.type==="video");E_.firstRemoteVideoDecode(this.store.sessionId,rS.FIRST_VIDEO_DECODE,yT.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:e,videoheight:n,subscribeElapse:gS.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const o=this.remoteUserMap.get(t);if(!o)return!1;const a=o.get(e);if(!a)return!1;const d=await this.connection.getRemoteSSRC(a);return d!==void 0&&d!==n}resetConnection(t){A.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(t)),this.state===_b.Connected?(A.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=t===G8.datachannel?new kI({},this.store):this.isPlanB?new PN({},this.store):new hR({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===_E.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,yN.LOW_STREAM):n._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(t){this.connection&&this.connection instanceof hR&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===WR.TCP_RESTART&&t===SS.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,WR.DISCONNECTED_OR_FAILED)))}},e_(M_.prototype,"startP2PConnection",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"startP2PConnection"),M_.prototype),e_(M_.prototype,"connect",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"connect"),M_.prototype),e_(M_.prototype,"updateRemoteRTPCapabilities",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"updateRemoteRTPCapabilities"),M_.prototype),e_(M_.prototype,"preConnect",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"preConnect"),M_.prototype),e_(M_.prototype,"publishDataChannel",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"publishDataChannel"),M_.prototype),e_(M_.prototype,"unpublish",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"unpublish"),M_.prototype),e_(M_.prototype,"unpublishDataChannel",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"unpublishDataChannel"),M_.prototype),e_(M_.prototype,"unpublishLowStream",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"unpublishLowStream"),M_.prototype),e_(M_.prototype,"subscribeDataChannel",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"subscribeDataChannel"),M_.prototype),e_(M_.prototype,"subscribe",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"subscribe"),M_.prototype),e_(M_.prototype,"massSubscribe",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"massSubscribe"),M_.prototype),e_(M_.prototype,"unsubscribe",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"unsubscribe"),M_.prototype),e_(M_.prototype,"unsubscribeDataChannel",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"unsubscribeDataChannel"),M_.prototype),e_(M_.prototype,"massUnsubscribe",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"massUnsubscribe"),M_.prototype),e_(M_.prototype,"muteRemote",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"muteRemote"),M_.prototype),e_(M_.prototype,"unmuteRemote",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"unmuteRemote"),M_.prototype),e_(M_.prototype,"hasRemoteMediaWithLock",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"hasRemoteMediaWithLock"),M_.prototype),e_(M_.prototype,"disconnectForReconnect",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"disconnectForReconnect"),M_.prototype),e_(M_.prototype,"updateBitrateLimit",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"updateBitrateLimit"),M_.prototype),e_(M_.prototype,"remoteMediaSsrcChanged",[yS],Object.getOwnPropertyDescriptor(M_.prototype,"remoteMediaSsrcChanged"),M_.prototype),M_);function yS(t,e,n){const o=t[e];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,d=await a.lock("From P2PChannel.".concat(e));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await o.apply(this,p)}finally{d()}},n}function Wpt(t){let e=$9();return function(n,o){let a=n.appId;a!==void 0&&(_y(o,10),MR(o,a));let d=n.cid;d!==void 0&&(_y(o,16),_y(o,d));let h=n.cname;h!==void 0&&(_y(o,26),MR(o,h));let p=n.deviceId;p!==void 0&&(_y(o,34),MR(o,p));let m=n.elapse;m!==void 0&&(_y(o,40),LI(o,m));let _=n.fileSize;_!==void 0&&(_y(o,48),LI(o,kN(_)));let g=n.height;g!==void 0&&(_y(o,56),LI(o,kN(g)));let y=n.jpg;y!==void 0&&(_y(o,66),_y(o,y.length),function(J0,_h){let t_=LN(J0,_h.length);J0.bytes.set(_h,t_)}(o,y));let C=n.networkType;C!==void 0&&(_y(o,72),LI(o,kN(C)));let O=n.osType;O!==void 0&&(_y(o,80),LI(o,kN(O)));let q=n.requestId;q!==void 0&&(_y(o,90),MR(o,q));let L=n.sdkVersion;L!==void 0&&(_y(o,98),MR(o,L));let U=n.sequence;U!==void 0&&(_y(o,104),LI(o,kN(U)));let K=n.sid;K!==void 0&&(_y(o,114),MR(o,K));let J=n.timestamp;J!==void 0&&(_y(o,120),LI(o,J));let _r=n.uid;_r!==void 0&&(_y(o,128),_y(o,_r));let _o=n.vid;_o!==void 0&&(_y(o,136),_y(o,_o));let na=n.width;na!==void 0&&(_y(o,144),LI(o,kN(na)));let ba=n.service;ba!==void 0&&(_y(o,152),_y(o,ba));let _u=n.callbackData;_u!==void 0&&(_y(o,162),MR(o,_u));let _l=n.jpgEncryption;_l!==void 0&&(_y(o,168),_y(o,_l));let _p=n.requestType;_p!==void 0&&(_y(o,176),_y(o,_p));let u_=n.scorePorn;u_!==void 0&&(_y(o,185),F3(o,u_));let W_=n.scoreSexy;W_!==void 0&&(_y(o,193),F3(o,W_));let _v=n.scoreNeutral;_v!==void 0&&(_y(o,201),F3(o,_v));let hT=n.scene;hT!==void 0&&(_y(o,208),_y(o,hT));let FT=n.ossFilePrefix;FT!==void 0&&(_y(o,218),MR(o,FT));let ST=n.serviceVendor;if(ST!==void 0)for(let J0 of ST){_y(o,226);let _h=$9();zpt(J0,_h),_y(o,_h.limit),Qpt(o,_h),Xpt(_h)}}(t,e),function(n){let o=n.bytes,a=n.limit;return o.length===a?o:o.subarray(0,a)}(e)}function qpt(t){return function(n){let o={};t:for(;!tX(n);){let a=UR(n);switch(a>>>3){case 0:break t;case 1:o.code=UR(n);break;case 2:o.msg=eX(n,UR(n));break;case 3:{let d=Ypt(n);o.data=Kpt(n),n.limit=d;break}default:Q9(n,7&a)}}return o}({bytes:e=t,offset:0,limit:e.length});var e}function Kpt(t){let e={};t:for(;!tX(t);){let n=UR(t);switch(n>>>3){case 0:break t;case 1:e.requestId=eX(t,UR(t));break;case 2:e.requestType=UR(t)>>>0;break;case 3:e.scorePorn=V3(t);break;case 4:e.scoreSexy=V3(t);break;case 5:e.scoreNeutral=V3(t);break;case 6:e.requestScene=UR(t)>>>0;break;case 7:e.scene=UR(t)>>>0;break;default:Q9(t,7&n)}}return e}function zpt(t,e){let n=t.service;n!==void 0&&(_y(e,8),_y(e,n));let o=t.vendor;o!==void 0&&(_y(e,16),_y(e,o));let a=t.token;a!==void 0&&(_y(e,26),MR(e,a));let d=t.callbackUrl;d!==void 0&&(_y(e,34),MR(e,d))}function Ypt(t){let e=UR(t),n=t.limit;return t.limit=t.offset+e,n}function Q9(t,e){switch(e){case 0:for(;128&nX(t););break;case 2:x3(t,UR(t));break;case 5:x3(t,4);break;case 1:x3(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let Jpt=new Float32Array(1);new Uint8Array(Jpt.buffer);let U3=new Float64Array(1),WS=new Uint8Array(U3.buffer);function kN(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let Z9=[];function $9(){const t=Z9.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function Xpt(t){Z9.push(t)}function x3(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function tX(t){return t.offset>=t.limit}function LN(t,e){let n=t.bytes,o=t.offset,a=t.limit,d=o+e;if(d>n.length){let h=new Uint8Array(2*d);h.set(n),t.bytes=h}return t.offset=d,d>a&&(t.limit=d),o}function j3(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function eX(t,e){let n=j3(t,e),o=String.fromCharCode,a=t.bytes,d="ï¿½",h="";for(let p=0;p<e;p++){let m,_,g,y,C=a[p+n];128&C?(224&C)==192?p+1>=e?h+=d:(m=a[p+n+1],(192&m)!=128?h+=d:(y=(31&C)<<6|63&m,y<128?h+=d:(h+=o(y),p++))):(240&C)==224?p+2>=e?h+=d:(m=a[p+n+1],_=a[p+n+2],(49344&(m|_<<8))!=32896?h+=d:(y=(15&C)<<12|(63&m)<<6|63&_,y<2048||y>=55296&&y<=57343?h+=d:(h+=o(y),p+=2))):(248&C)==240?p+3>=e?h+=d:(m=a[p+n+1],_=a[p+n+2],g=a[p+n+3],(12632256&(m|_<<8|g<<16))!=8421504?h+=d:(y=(7&C)<<18|(63&m)<<12|(63&_)<<6|63&g,y<65536||y>1114111?h+=d:(y-=65536,h+=o(55296+(y>>10),56320+(1023&y)),p+=3))):h+=d:h+=o(C)}return h}function MR(t,e){let n=e.length,o=0;for(let h=0;h<n;h++){let p=e.charCodeAt(h);p>=55296&&p<=56319&&h+1<n&&(p=(p<<10)+e.charCodeAt(++h)-56613888),o+=p<128?1:p<2048?2:p<65536?3:4}_y(t,o);let a=LN(t,o),d=t.bytes;for(let h=0;h<n;h++){let p=e.charCodeAt(h);p>=55296&&p<=56319&&h+1<n&&(p=(p<<10)+e.charCodeAt(++h)-56613888),p<128?d[a++]=p:(p<2048?d[a++]=p>>6&31|192:(p<65536?d[a++]=p>>12&15|224:(d[a++]=p>>18&7|240,d[a++]=p>>12&63|128),d[a++]=p>>6&63|128),d[a++]=63&p|128)}}function Qpt(t,e){let n=LN(t,e.limit),o=t.bytes,a=e.bytes;for(let d=0,h=e.limit;d<h;d++)o[d+n]=a[d]}function nX(t){return t.bytes[j3(t,1)]}function rX(t,e){let n=LN(t,1);t.bytes[n]=e}function V3(t){let e=j3(t,8),n=t.bytes;return WS[0]=n[e++],WS[1]=n[e++],WS[2]=n[e++],WS[3]=n[e++],WS[4]=n[e++],WS[5]=n[e++],WS[6]=n[e++],WS[7]=n[e++],U3[0]}function F3(t,e){let n=LN(t,8),o=t.bytes;U3[0]=e,o[n++]=WS[0],o[n++]=WS[1],o[n++]=WS[2],o[n++]=WS[3],o[n++]=WS[4],o[n++]=WS[5],o[n++]=WS[6],o[n++]=WS[7]}function UR(t){let e,n=0,o=0;do e=nX(t),n<32&&(o|=(127&e)<<n),n+=7;while(128&e);return o}function _y(t,e){for(e>>>=0;e>=128;)rX(t,127&e|128),e>>>=7;rX(t,e)}function LI(t,e){let n=e.low>>>0,o=(e.low>>>28|e.high<<4)>>>0,a=e.high>>>24,d=a===0?o===0?n<16384?n<128?1:2:n<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:a<128?9:10,h=LN(t,d),p=t.bytes;switch(d){case 10:p[h+9]=a>>>7&1;case 9:p[h+8]=d!==9?128|a:127&a;case 8:p[h+7]=d!==8?o>>>21|128:o>>>21&127;case 7:p[h+6]=d!==7?o>>>14|128:o>>>14&127;case 6:p[h+5]=d!==6?o>>>7|128:o>>>7&127;case 5:p[h+4]=d!==5?128|o:127&o;case 4:p[h+3]=d!==4?n>>>21|128:n>>>21&127;case 3:p[h+2]=d!==3?n>>>14|128:n>>>14&127;case 2:p[h+1]=d!==2?n>>>7|128:n>>>7&127;case 1:p[h]=d!==1?128|n:127&n}}function iX(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}const Zpt=new Map([["moderation",1],["supervise",2]]);class AM extends ET{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(oS.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=Z0(n=e.map(o=>Zpt.get(o)||0)).call(n,(o,a)=>o+a),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),F(this,"name","AgoraRTCVideoContentInspect"),F(this,"_connectionState",k0.CONNECTING),F(this,"_innerConnectionState",void 0),F(this,"sequence",0),F(this,"inspectStartTime",void 0),F(this,"workerManagerConnection",void 0),F(this,"workerConnection",void 0),F(this,"workerMessageLengthLimit",void 0),F(this,"inspectIntervalMinimum",void 0),F(this,"qualityRatio",void 0),F(this,"_connectInfo",void 0),F(this,"_cancelTokenSource",MS.CancelToken.source()),F(this,"_retryConfig",void 0),F(this,"wmSequence",0),F(this,"inspectInterval",void 0),F(this,"inspectTimer",null),F(this,"ossFilePrefix",void 0),F(this,"extraInfo",void 0),F(this,"_inspectType",void 0),F(this,"_inspectMode",void 0),F(this,"_quality",1),F(this,"qualityTimer",null),F(this,"_inspectId",void 0),F(this,"_needWorkUrlOnly",!1),F(this,"inspectImage",()=>{if(this.connectionState!==k0.CONNECTED)throw new _s(Y.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===k0.CONNECTED?this.requestToInspectImage():A.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=sT(5,"inspect-"),this.workerMessageLengthLimit=$("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=$("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=$("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new TP("worker-manager-"+this._inspectId,xT),this.on(oS.STATE_CHANGE,(n,o)=>{this._innerConnectionState=n,A.debug("[".concat(this._inspectId,"] Inspect operation :").concat(L0[n]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new TP("worker-"+this._inspectId,xT),this.handleWorkerEvents()}async init(e,n){this.emit(oS.STATE_CHANGE,L0.CONNECT_AP),this._connectInfo=e;const o=this._cancelTokenSource.token;return this._retryConfig=n,new n_((a,d)=>{this.on(oS.CONNECTION_STATE_CHANGE,(h,p)=>{p===k0.CONNECTED&&a()}),this.requestAP(e,o,n).then(h=>{this.connectWorkerManager(h)}).catch(h=>{d(h)})})}async requestAP(e,n,o){const a=$("WEBCS_DOMAIN").map(p=>"https://".concat(p,"/api/v1")),d=await function(p,m,_,g){let{appId:y,areaCode:C,cname:O,sid:q,token:L,uid:U}=m;sN++;const K="image_moderation_api",J={service_name:K,json_body:JSON.stringify({appId:y,areaCode:C,cname:O,command:"allocateEdge",requestId:sN,seq:sN,sid:q,token:L,ts:Date.now(),uid:U+""})};let _r,_o,na=p[0];return eR(async()=>{_r=Date.now();const ba=await oR(na,{data:J,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_o=Date.now()-_r,ba.code!==0){const u_=new _s(Y.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ba.code,{retry:!0,responseTime:_o});throw A.error(u_.toString()),u_}const _u=JSON.parse(ba.json_body);if(_u.code!==200){const u_=new _s(Y.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(_u.code,", reason: ").concat(_u.reason),{code:_u.code,responseTime:_o});throw A.error(u_.toString()),u_}if(!_u.servers||!Array.isArray(_u.servers)||_u.servers.length===0){const u_=new _s(Y.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:_u.code,responseTime:_o});throw A.error(u_.toString()),u_}const _l=$("VIDEO_INSPECT_WORKER_MANAGER_HOST"),_p=$("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:_u.servers.map(u_=>{let{address:W_,wss:_v}=u_;if(W_&&_v)return"wss://".concat(W_.replace(/\./g,"-"),".").concat(_l,":").concat(_p||_v)}).filter(u_=>!!u_),workerToken:_u.workerToken,vid:_u.vid,responseTime:_o}},(ba,_u)=>(E_.apworkerEvent(q,{success:!0,sc:200,serviceName:K,responseDetail:JSON.stringify(ba.addressList),firstSuccess:_u===0,responseTime:_o,serverIp:p[_u%p.length]}),!1),(ba,_u)=>(E_.apworkerEvent(q,{success:!1,sc:ba.data&&ba.data.code||200,serviceName:K,responseTime:_o,serverIp:p[_u%p.length]}),!!(ba.code!==Y.OPERATION_ABORTED&&ba.code!==Y.UNEXPECTED_RESPONSE||ba.data&&ba.data.retry)&&(na=p[(_u+1)%p.length],!0)),g)}(a,e,n,o);this.emit(oS.STATE_CHANGE,L0.AP_CONNECTED);const{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(oS.STATE_CHANGE,L0.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(O_.CONNECTED,async()=>{this.emit(oS.STATE_CHANGE,L0.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.21.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(O_.CLOSED,()=>{this._innerConnectionState<L0.GET_WORKER_MANAGER_RESPONSE&&A.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(O_.FAILED,()=>{this._innerConnectionState<L0.GET_WORKER_MANAGER_RESPONSE&&A.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(O_.RECONNECTING,()=>{this._innerConnectionState<L0.GET_WORKER_MANAGER_RESPONSE&&A.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(O_.ON_MESSAGE,async e=>{this.emit(oS.STATE_CHANGE,L0.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(e.data);if(o.code!==200)throw A.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new _s(Y.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&n))throw A.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new _s(Y.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const a=$("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,d=n.replace(/:\d+\/?$/,":".concat(a));this.emit(oS.STATE_CHANGE,L0.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(oS.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}}),this.workerManagerConnection.on(O_.WILL_RECONNECT,(e,n,o)=>{o(e)}),this.workerManagerConnection.on(O_.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on(O_.CONNECTED,async()=>{this.emit(oS.STATE_CHANGE,L0.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=k0.CONNECTED}),this.workerConnection.on(O_.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const o=qpt(new Uint8Array(e.data));if($("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&A.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(oS.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var n;const a={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},d=Z0(n=Object.keys(a)).call(n,(p,m)=>a[p]>a[m]?p:m,"porn"),h=Object.keys(a).find(p=>p===d);this.emit(oS.INSPECT_RESULT,h)}else this.emit(oS.INSPECT_RESULT,void 0,new _s(Y.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(oS.INSPECT_RESULT,void 0,new _s(Y.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else A.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(oS.INSPECT_RESULT,void 0,new _s(Y.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(O_.CLOSED,()=>{this.connectionState=k0.CLOSED}),this.workerConnection.on(O_.FAILED,()=>{this.connectionState=k0.CLOSED}),this.workerConnection.on(O_.RECONNECTING,()=>{this.connectionState=this.connectionState===k0.CONNECTED?k0.RECONNECTING:k0.CONNECTING}),this.workerConnection.on(O_.WILL_RECONNECT,(e,n,o)=>{e==="recover"&&o(e),o("tryNext")}),this.workerConnection.on(O_.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(oS.REQUEST_NEW_WORKER_URL,o=>{e([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{n(o)})})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){this.sequence++;const e=JS(this,oS.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(oS.INSPECT_RESULT,void 0,new _s(Y.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(e,n);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(oS.INSPECT_RESULT,void 0,new _s(Y.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:o,cname:a,cid:d,vid:h,sid:p,uid:m}=n;const _=Date.now(),g=await e.getCurrentFrameImage("image/jpeg",this.quality),y=await o7(g,o,a),C=this.sequence+"-"+d+"-"+m+"-"+_+"-"+sT(12,""),O={appId:o,cid:d,cname:a,deviceId:"",elapse:AM.intToLong(Number(_-this.inspectStartTime)),fileSize:y.byteLength,jpgEncryption:2,height:g.height,width:g.width,jpg:y,networkType:6,osType:7,requestId:C,sdkVersion:"4.21.0",sequence:this.sequence,sid:p,timestamp:AM.intToLong(_),uid:m,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete O.callbackData,this.ossFilePrefix===void 0&&delete O.ossFilePrefix;const q=Wpt(O);if(q.byteLength<this.workerMessageLengthLimit){if($("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const L=function(U){for(var K=1;K<arguments.length;K++){var J=arguments[K]!=null?arguments[K]:{};K%2?iX(Object(J),!0).forEach(function(_r){F(U,_r,J[_r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(U,Object.getOwnPropertyDescriptors(J)):iX(Object(J)).forEach(function(_r){Object.defineProperty(U,_r,Object.getOwnPropertyDescriptor(J,_r))})}return U}({},O);delete L.jpg,A.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(L))}return q}{const L=this.quality*this.qualityRatio;return this.quality=L,await this.generateRequestData(e,{appId:o,cname:a,cid:d,vid:h,sid:p,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=MS.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=k0.CLOSED,this.emit(oS.STATE_CHANGE,L0.CLOSED)}}function $pt(t){let e=function(){const n=nft.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,o){let a=n.appId;a!==void 0&&(VT(o,10),MI(o,a));let d=n.cid;d!==void 0&&(VT(o,16),VT(o,d));let h=n.cname;h!==void 0&&(VT(o,26),MI(o,h));let p=n.deviceId;p!==void 0&&(VT(o,34),MI(o,p));let m=n.elapse;m!==void 0&&(VT(o,40),UI(o,m));let _=n.fileSize;_!==void 0&&(VT(o,48),UI(o,MN(_)));let g=n.height;g!==void 0&&(VT(o,56),UI(o,MN(g)));let y=n.jpg;y!==void 0&&(VT(o,66),VT(o,y.length),sX(o,y));let C=n.networkType;C!==void 0&&(VT(o,72),UI(o,MN(C)));let O=n.osType;O!==void 0&&(VT(o,80),UI(o,MN(O)));let q=n.requestId;q!==void 0&&(VT(o,90),MI(o,q));let L=n.sdkVersion;L!==void 0&&(VT(o,98),MI(o,L));let U=n.sequence;U!==void 0&&(VT(o,104),UI(o,MN(U)));let K=n.sid;K!==void 0&&(VT(o,114),MI(o,K));let J=n.timestamp;J!==void 0&&(VT(o,120),UI(o,J));let _r=n.uid;_r!==void 0&&(VT(o,128),VT(o,_r));let _o=n.vid;_o!==void 0&&(VT(o,136),VT(o,_o));let na=n.width;na!==void 0&&(VT(o,144),UI(o,MN(na)));let ba=n.service;ba!==void 0&&(VT(o,152),VT(o,ba));let _u=n.callbackData;_u!==void 0&&(VT(o,162),VT(o,_u.length),sX(o,_u));let _l=n.ticket;_l!==void 0&&(VT(o,170),MI(o,_l));let _p=n.vendorConfigs;_p!==void 0&&(VT(o,178),MI(o,_p))}(t,e),function(n){let o=n.bytes,a=n.limit;return o.length===a?o:o.subarray(0,a)}(e)}function tft(t){return function(n){let o={};t:for(;!rft(n);){let a=eL(n);switch(a>>>3){case 0:break t;case 1:o.code=eL(n);break;case 2:o.msg=aX(n,eL(n));break;case 3:o.requestId=aX(n,eL(n));break;case 4:o.timestamp=ift(n,!1);break;default:eft(n,7&a)}}return o}({bytes:e=t,offset:0,limit:e.length});var e}function eft(t,e){switch(e){case 0:for(;128&Y0(t););break;case 2:B3(t,eL(t));break;case 5:B3(t,4);break;case 1:B3(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function MN(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let nft=[];function B3(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function rft(t){return t.offset>=t.limit}function NM(t,e){let n=t.bytes,o=t.offset,a=t.limit,d=o+e;if(d>n.length){let h=new Uint8Array(2*d);h.set(n),t.bytes=h}return t.offset=d,d>a&&(t.limit=d),o}function oX(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function sX(t,e){let n=NM(t,e.length);t.bytes.set(e,n)}function aX(t,e){let n=oX(t,e),o=String.fromCharCode,a=t.bytes,d="ï¿½",h="";for(let p=0;p<e;p++){let m,_,g,y,C=a[p+n];128&C?(224&C)==192?p+1>=e?h+=d:(m=a[p+n+1],(192&m)!=128?h+=d:(y=(31&C)<<6|63&m,y<128?h+=d:(h+=o(y),p++))):(240&C)==224?p+2>=e?h+=d:(m=a[p+n+1],_=a[p+n+2],(49344&(m|_<<8))!=32896?h+=d:(y=(15&C)<<12|(63&m)<<6|63&_,y<2048||y>=55296&&y<=57343?h+=d:(h+=o(y),p+=2))):(248&C)==240?p+3>=e?h+=d:(m=a[p+n+1],_=a[p+n+2],g=a[p+n+3],(12632256&(m|_<<8|g<<16))!=8421504?h+=d:(y=(7&C)<<18|(63&m)<<12|(63&_)<<6|63&g,y<65536||y>1114111?h+=d:(y-=65536,h+=o(55296+(y>>10),56320+(1023&y)),p+=3))):h+=d:h+=o(C)}return h}function MI(t,e){let n=e.length,o=0;for(let h=0;h<n;h++){let p=e.charCodeAt(h);p>=55296&&p<=56319&&h+1<n&&(p=(p<<10)+e.charCodeAt(++h)-56613888),o+=p<128?1:p<2048?2:p<65536?3:4}VT(t,o);let a=NM(t,o),d=t.bytes;for(let h=0;h<n;h++){let p=e.charCodeAt(h);p>=55296&&p<=56319&&h+1<n&&(p=(p<<10)+e.charCodeAt(++h)-56613888),p<128?d[a++]=p:(p<2048?d[a++]=p>>6&31|192:(p<65536?d[a++]=p>>12&15|224:(d[a++]=p>>18&7|240,d[a++]=p>>12&63|128),d[a++]=p>>6&63|128),d[a++]=63&p|128)}}function Y0(t){return t.bytes[oX(t,1)]}function cX(t,e){let n=NM(t,1);t.bytes[n]=e}function eL(t){let e,n=0,o=0;do e=Y0(t),n<32&&(o|=(127&e)<<n),n+=7;while(128&e);return o}function VT(t,e){for(e>>>=0;e>=128;)cX(t,127&e|128),e>>>=7;cX(t,e)}function ift(t,e){let n,o=0,a=0,d=0;return n=Y0(t),o=127&n,128&n&&(n=Y0(t),o|=(127&n)<<7,128&n&&(n=Y0(t),o|=(127&n)<<14,128&n&&(n=Y0(t),o|=(127&n)<<21,128&n&&(n=Y0(t),a=127&n,128&n&&(n=Y0(t),a|=(127&n)<<7,128&n&&(n=Y0(t),a|=(127&n)<<14,128&n&&(n=Y0(t),a|=(127&n)<<21,128&n&&(n=Y0(t),d=127&n,128&n&&(n=Y0(t),d|=(127&n)<<7))))))))),{low:o|a<<28,high:a>>>4|d<<24,unsigned:e}}function UI(t,e){let n=e.low>>>0,o=(e.low>>>28|e.high<<4)>>>0,a=e.high>>>24,d=a===0?o===0?n<16384?n<128?1:2:n<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:a<128?9:10,h=NM(t,d),p=t.bytes;switch(d){case 10:p[h+9]=a>>>7&1;case 9:p[h+8]=d!==9?128|a:127&a;case 8:p[h+7]=d!==8?o>>>21|128:o>>>21&127;case 7:p[h+6]=d!==7?o>>>14|128:o>>>14&127;case 6:p[h+5]=d!==6?o>>>7|128:o>>>7&127;case 5:p[h+4]=d!==5?128|o:127&o;case 4:p[h+3]=d!==4?n>>>21|128:n>>>21&127;case 3:p[h+2]=d!==3?n>>>14|128:n>>>14&127;case 2:p[h+1]=d!==2?n>>>7|128:n>>>7&127;case 1:p[h]=d!==1?128|n:127&n}}const uX={},dX={},PM=4294967296,oft=PM*PM,lX=oft/2;pX(0,!0);const hX=pX(0),sft=nL(0,-2147483648,!1),aft=nL(-1,2147483647,!1);function pX(t,e){let n,o,a;return e?(a=0<=(t>>>=0)&&t<256)&&(o=dX[t],o)?o:(n=nL(t,0,!0),a&&(dX[t]=n),n):(a=-128<=(t|=0)&&t<128)&&(o=uX[t],o)?o:(n=nL(t,t<0?-1:0,!1),a&&(uX[t]=n),n)}function nL(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function cft(t,e){if(isNaN(t))return hX;{if(t<=-lX)return sft;if(t+1>=lX)return aft}return t<0?hX:nL(t%PM|0,t/PM|0,e)}function fX(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}class G3 extends ET{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(rR.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),F(this,"name","AgoraRTCImageModeration"),F(this,"_connectionState",g0.CONNECTING),F(this,"_sequence",0),F(this,"_moderationStartTime",void 0),F(this,"_workerConnection",void 0),F(this,"_workerMessageLengthLimit",void 0),F(this,"_qualityRatio",void 0),F(this,"_connectInfo",void 0),F(this,"_cancelTokenSource",MS.CancelToken.source()),F(this,"_retryConfig",void 0),F(this,"_moderationInterval",void 0),F(this,"_moderationTimer",null),F(this,"_moderationMode",1),F(this,"_quality",1),F(this,"_qualityTimer",null),F(this,"_ticket",void 0),F(this,"_moderationIntervalMinimum",void 0),F(this,"_uploadFailedNum",0),F(this,"_uploadNum",0),F(this,"_uploadTimer",null),F(this,"_extraInfo",void 0),F(this,"_vendor",""),F(this,"_encoder",new TextEncoder),F(this,"_moderationId",void 0),F(this,"inspectImage",()=>{if(this.connectionState!==g0.CONNECTED)throw new _s(Y.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===g0.CONNECTED?this.requestToInspectImage():A.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=sT(5,"image-moderation-"),this._workerMessageLengthLimit=$("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=$("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=$("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new TP("worker-"+this._moderationId,xT),this.on(rR.STATE_CHANGE,(o,a)=>{A.debug("[".concat(this._moderationId,"] Moderation operation :").concat(rN[o]," ").concat(a||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(rR.STATE_CHANGE,rN.CONNECT_AP),this._connectInfo=e;const o=this._cancelTokenSource.token;return this._retryConfig=n,new n_((a,d)=>{this.on(rR.CONNECTION_STATE_CHANGE,(h,p)=>{h===g0.CONNECTED&&a()}),this.requestAP(e,o,n).then(h=>{this.connectWorker(h)}).catch(h=>{d(h)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),A.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===g0.CONNECTED&&this.inspectImage()}async requestAP(e,n,o){const a=$("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),d=await function(m,_,g,y){let{appId:C,areaCode:O,cname:q,sid:L,token:U,uid:K}=_;sN++;const J="moderation_plugin",_r={service_name:J,json_body:JSON.stringify({appId:C,areaCode:O,cname:q,command:"allocateEdge",requestId:sN,seq:sN,sid:L,appToken:U,ts:Date.now(),uid:K+""})};let _o,na,ba=m[0];return eR(async()=>{_o=Date.now();const _u=await oR(ba,{data:_r,cancelToken:g,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(na=Date.now()-_o,_u.code!==0){const u_=new _s(Y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+_u.code,{retry:!0,responseTime:na});throw A.error(u_.toString()),u_}const _l=JSON.parse(_u.json_body);if(_l.code!==200){const u_=new _s(Y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(_l.code,", reason: ").concat(_l.reason),{code:_l.code,responseTime:na});throw A.error(u_.toString()),u_}if(!_l.servers||!Array.isArray(_l.servers)||_l.servers.length===0){const u_=new _s(Y.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:_l.code,responseTime:na});throw A.error(u_.toString()),u_}if(!_l.servers.some(u_=>!!u_.wss)){const u_=new _s(Y.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:_l.code,responseTime:na});throw A.error(u_.toString()),u_}const _p=$("IMAGE_MODERATION_WORKER_HOST");return{addressList:_l.servers.map(u_=>{let{address:W_,wss:_v}=u_;if(W_&&_v)return"wss://".concat(W_.replace(/\./g,"-"),".").concat(_p,":").concat(_v,"/moderation")}).filter(u_=>!!u_),workerToken:_l.workerToken,vid:_l.vid,ticket:_l.appTicket,responseTime:na}},(_u,_l)=>(E_.apworkerEvent(L,{success:!0,sc:200,serviceName:J,responseDetail:JSON.stringify(_u.addressList),firstSuccess:_l===0,responseTime:na,serverIp:m[_l%m.length]}),!1),(_u,_l)=>(E_.apworkerEvent(L,{success:!1,sc:_u.data&&_u.data.code||200,serviceName:J,responseTime:na,serverIp:m[_l%m.length]}),!!(_u.code!==Y.OPERATION_ABORTED&&_u.code!==Y.UNEXPECTED_RESPONSE||_u.data&&_u.data.retry)&&(ba=m[(_l+1)%m.length],!0)),y)}(a,e,n,o);this.emit(rR.STATE_CHANGE,rN.AP_CONNECTED);const{addressList:h,ticket:p}=d;return this._ticket=p,h}async connectWorker(e){this.emit(rR.STATE_CHANGE,rN.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(O_.CONNECTED,async()=>{this.emit(rR.STATE_CHANGE,rN.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=g0.CONNECTED}),this._workerConnection.on(O_.CLOSED,()=>{this.connectionState=g0.CLOSED}),this._workerConnection.on(O_.FAILED,()=>{this.connectionState=g0.CLOSED}),this._workerConnection.on(O_.RECONNECTING,()=>{this.connectionState=this.connectionState===g0.CONNECTED?g0.RECONNECTING:g0.CONNECTING}),this._workerConnection.on(O_.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=tft(new Uint8Array(e.data));$("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&A.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,A.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{E_.reportApiInvoke(this._connectInfo.sid||null,{name:BT.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:IT.TRACER}).onError(new _s(Y.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},$("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else A.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(O_.WILL_RECONNECT,(e,n,o)=>{e==="recover"&&o(e),o("tryNext")}),this._workerConnection.on(O_.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=JS(this,rR.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void($("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&A.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(e,n);this._workerConnection.sendMessage(o,!0,!0)}else $("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&A.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:o,cname:a,cid:d,vid:h,sid:p,uid:m}=n;const _=Date.now(),g=await e.getCurrentFrameImage("image/jpeg",this.quality),y=await o7(g,o,a),C=this._sequence+"-"+d+"-"+m+"-"+_+"-"+sT(12,""),O={appId:o,cid:d,cname:a,deviceId:"",elapse:G3.intToLong(Number(_-this._moderationStartTime)),fileSize:g.buffer.byteLength,height:g.height,width:g.width,jpg:y,networkType:6,osType:7,requestId:C,sdkVersion:"4.21.0",sequence:this._sequence,sid:p,timestamp:cft(_),uid:m,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete O.callbackData;const q=$pt(O);if(q.byteLength<this._workerMessageLengthLimit){if($("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const L=function(U){for(var K=1;K<arguments.length;K++){var J=arguments[K]!=null?arguments[K]:{};K%2?fX(Object(J),!0).forEach(function(_r){F(U,_r,J[_r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(U,Object.getOwnPropertyDescriptors(J)):fX(Object(J)).forEach(function(_r){Object.defineProperty(U,_r,Object.getOwnPropertyDescriptor(J,_r))})}return U}({},O);delete L.jpg,A.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(L))}return q}{const L=this.quality*this._qualityRatio;return this.quality=L,await this.generateRequestData(e,{appId:o,cname:a,cid:d,vid:h,sid:p,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=MS.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=g0.CLOSED,this.emit(rR.STATE_CHANGE,rN.CLOSED)}}function mX(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function EX(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?mX(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mX(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}const uft=Date.now(),dft=20,H3=new Map,DM=new Map;async function _X(t){const e=H3.get(t),n=Array.isArray(e)&&e[e.length-1],o=DM.get(t);if(!n)return void(o.isSyncing=!1);const a={uid:n.uid,payload:n.payload};o.firstRecvTs===0&&(o.firstRecvTs=n.recvTs,o.firstSendTs=n.sendTs);const d=n.sendTs-o.firstSendTs,h=d-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-d);let p=n.mediaDelay+h;p<=0?(e.pop(),gX(n.context,a),p=0):p=Math.min(p,dft),setTimeout(()=>e.length&&_X(t),p)}function gX(t,e){t.safeEmit(G_.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function lft(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return gX(n,{uid:t.uid,payload:t.payload});const o="".concat(n.id,"-").concat(t.uid),a=H3.get(o)||[],d=a.findIndex(_=>t.sendTs>=_.sendTs),h=EX(EX({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});d===-1?a.push(h):a.splice(d,0,h),H3.set(o,a);let p=!1;var m;DM.has(o)?p=!((m=DM.get(o))===null||m===void 0||!m.isSyncing):DM.set(o,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||_X(o)}const hft=Y_().name;function vX(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function bX(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vX(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vX(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}const UN="websdk_ng_cache_parameter",pft=$("MAX_PRELOAD_ASYNC_LENGTH"),fft=1e4,TO=new Map,SO=[];let W3=null,q3=0,K3=0;const kM=new Map,mft=function(t,e){const n=[];let o=0;const a=async()=>{const d=n.shift();d&&await d(),n.length>0&&o<e?a():o--};return async function(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return new n_(async(m,_)=>{n.push(async()=>{try{const g=await t(...h);m(g)}catch(g){_(g)}}),o<e&&(o++,a())})}}(yX,pft),z3=MS.CancelToken.source();async function yX(t,e,n,o,a){try{if(!$("ENABLE_PRELOAD"))return;if(!q_().supportWebCrypto)return void pI(()=>{A.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new ya(Y.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&cS(n,"token",1,2047),cS(t,"appid",1,2047),I1(e),o&&w1(o);const d=_P();A.debug("preload channel ".concat(e,", uid is ").concat(o));const h={appId:t,cname:e,token:n||t,uid:typeof o!="string"?o:null,sid:d,proxyServer:a};let p,m;typeof o=="string"?(h.stringUid=o,[m,p]=await n_.all([Udt(o,{sid:d,appId:t},z3.token),fK(bX(bX({},h),{},{token:n||t,uid:0}),z3.token)]),h.uid=m.uid,p.gatewayInfo.uid=h.uid,p.gatewayInfo.res.uid=h.uid):p=await fK(h,z3.token);const _={sid:d,appId:t,cname:e,token:n||t,uid:h.stringUid||o,intUid:h.uid||p.gatewayInfo.uid,stringUid:h.stringUid,ts:Date.now(),sua:m,ap:p};await async function(g){let y;try{g.uid&&SX({appId:g.appId,cname:g.cname,token:g.token,uid:g.uid,stringUid:g.stringUid});const C=wX(g),O=await async function(L,U){try{const K=await window.crypto.subtle.importKey("raw",g8(U),"AES-GCM",!1,["encrypt"]),J=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},K,$I(window.btoa(JSON.stringify(L))));return fI(new Uint8Array(J))}catch{return}}(g,g.token||g.appId);if(!O)return;y=IX(UN);const q=y?JSON.parse(y):[];q.push({[C]:O}),q.length>$("AP_CACHE_NUM")&&q.shift(),LM(UN,JSON.stringify(q))}catch(C){A.warn("Error caching server parameters:",C.message),LM(UN,"")}}(_),q3++}catch(d){throw K3++,function(h){W3||(W3=window.setTimeout(()=>{let m="";kM.forEach((_,g)=>{m+="".concat(g,": ").concat(_," ;")}),E_.reportApiInvoke(null,{name:BT.PRELOAD,options:{success:q3,failed:K3,err:m}}).onError(h),q3=0,K3=0,kM.clear(),W3=null},fft));const p=kM.get(h.code)||0;kM.set(h.code,p+1)}(d),d}}async function TX(t){try{const e=SX(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(o,a){try{const d=await window.crypto.subtle.importKey("raw",g8(a),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},d,$I(o));return JSON.parse(window.atob(fI(new Uint8Array(h))))}catch{return}}(e,t.token||t.appId);if(!n||!function(o,a){return o.cname===a.cname&&o.appId===a.appId&&o.token===a.token?a.stringUid?o.stringUid===a.stringUid:typeof a.uid=="number"?o.uid===a.uid:o.uid==a.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<$("AP_CACHE_LIFETIME"))return n}catch(e){A.warn("Error get preloadInfo",e.message)}}function SX(t){let e;try{if(e=IX(UN),!e)return;const n=JSON.parse(e),o=wX(t),a=function(h,p){for(let m=h.length-1;m>=0;m--)if(p(h[m]))return m;return-1}(n,h=>o in h);if(a===-1)return;const d=n.splice(a,1)[0];return LM(UN,JSON.stringify(n)),d[o]}catch(n){A.warn("Error delete preload info: ".concat(e),n.message),LM(UN,"")}}function Y3(t){if(t){let e=TO.get(t);e&&(window.clearTimeout(e),e=null,TO.delete(t)),o_(SO).call(SO,t)||t.cloudProxyServer!=="disabled"||SO.push(t)}if(TO.size<$("AP_CACHE_NUM")&&SO.length>0){const e=SO.shift();TO.set(e,window.setTimeout(async()=>{const{appId:n,cname:o,token:a,uid:d,proxyServer:h}=e;try{await mft(n,o,a,d,h),TO.has(e)&&Y3(e)}catch(p){A.warn("update preload failed",p.message),RX(e)}},$("AP_UPDATE_INTERVAL")))}}function RX(t){const e=SO.indexOf(t);e!==-1&&SO.splice(e,1);let n=TO.get(t);n&&(window.clearTimeout(n),n=null,TO.delete(t),Y3())}function CX(t,e){const n=t.sua,o=t.ap;e&&n&&E_.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),E_.reportResourceTiming(t.ap.url,t.sid),E_.joinWebProxyAP(t.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(a=>a.ip).join(","),eventType:"disabled",unilbsServerIds:[jT.CHOOSE_SERVER,jT.CLOUD_PROXY_FALLBACK].toString()}),E_.joinChooseServer(t.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(a=>a.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[jT.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function IX(t){return window.atob(window.localStorage.getItem(t)||"")}function LM(t,e){window.localStorage.setItem(t,window.btoa(e))}function wX(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),C8(e)}var OX,AX,NX,PX,DX,kX,LX,MX,UX,xX,jX,VX,FX,BX,GX,HX,WX,qX,KX,zX,YX,JX,XX,QX,ZX,$X,tQ,eQ,nQ,rQ,iQ,oQ,sQ,aQ,cQ,uQ,dQ,lQ,hQ,pQ,fQ,mQ,s_;function EQ(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function R0(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?EQ(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):EQ(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}nS.setLogger(A);let Eft=(OX=C_(),AX=C_({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof RN))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),NX=C_({argsMap:(t,e)=>(e||(e=[]),e instanceof VJ?[e.getChannelId()]:(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())))}),PX=C_({argsMap:(t,e,n,o)=>[typeof e=="object"?e.uid:e,n,o]}),DX=C_({argsMap:(t,e,n)=>[e,n]}),kX=C_({argsMap:(t,e)=>e.map(n=>{let{user:o,mediaType:a}=n;return[o==null?void 0:o.uid,a]})}),LX=C_({argsMap:(t,e,n,o)=>[typeof e=="object"?e.uid:e,n,o]}),MX=C_({argsMap:(t,e)=>e.map(n=>{let{user:o,mediaType:a}=n;return{uid:o==null?void 0:o.uid,mediaType:a}})}),UX=C_(),xX=C_(),jX=C_(),VX=C_(),FX=C_(),BX=C_(),GX=C_(),HX=C_(),WX=C_(),qX=C_(),KX=C_(),zX=C_(),YX=C_(),JX=C_(),XX=C_({argsMap:(t,e)=>[e]}),QX=C_(),ZX=C_(),$X=C_(),tQ=C_(),eQ=C_(),nQ=C_(),rQ=C_(),iQ=C_(),oQ=C_(),sQ=C_(),aQ=C_({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),cQ=C_(),uQ=C_(),dQ=C_(),lQ=C_(),hQ=C_(),pQ=C_(),fQ=C_({reportResult:!0}),mQ=C_(),s_=class extends ET{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t){let e;if(super(),F(this,"store",void 0),F(this,"_uid",void 0),F(this,"_channelName",void 0),F(this,"_uintUid",void 0),F(this,"_users",[]),F(this,"_config",void 0),F(this,"_clientId",void 0),F(this,"_appId",void 0),F(this,"_sessionId",null),F(this,"_key",void 0),F(this,"_rtmConfig",{}),F(this,"_joinInfo",void 0),F(this,"_gateway",void 0),F(this,"_statsCollector",void 0),F(this,"_configDistribute",void 0),F(this,"_leaveMutex",new nS("client-leave")),F(this,"_publishMutex",new nS("client-publish")),F(this,"_renewTokenMutex",new nS("client-renewtoken")),F(this,"_subscribeMutex",new nS("client-subscribe")),F(this,"_encryptionMode","none"),F(this,"_encryptionSecret",null),F(this,"_encryptionSalt",null),F(this,"_encryptDataStream",!1),F(this,"_encryptDataStreamKey",null),F(this,"_encryptDataStreamIv",null),F(this,"_proxyServer",void 0),F(this,"_turnServer",{servers:[],mode:"auto"}),F(this,"_cloudProxyServerMode","disabled"),F(this,"_isDualStreamEnabled",!1),F(this,"_defaultStreamFallbackType",void 0),F(this,"_lowStreamParameter",void 0),F(this,"_streamFallbackTypeCacheMap",new Map),F(this,"_remoteStreamTypeCacheMap",new Map),F(this,"_axiosCancelSource",MS.CancelToken.source()),F(this,"_audioVolumeIndicationInterval",void 0),F(this,"_networkQualityInterval",void 0),F(this,"_userOfflineTimeout",void 0),F(this,"_streamRemovedTimeout",void 0),F(this,"_injectStreamingClient",void 0),F(this,"_liveTranscodeStreamingClient",void 0),F(this,"_liveRawStreamingClient",void 0),F(this,"_channelMediaRelayClient",void 0),F(this,"_networkQualitySensitivity","normal"),F(this,"_p2pChannel",void 0),F(this,"_useLocalAccessPoint",!1),F(this,"_setLocalAPVersion",void 0),F(this,"_joinAndNotLeaveYet",!1),F(this,"_numberOfJoinCount",0),F(this,"_remoteDefaultVideoStreamType",void 0),F(this,"_inspect",void 0),F(this,"_moderation",void 0),F(this,"_license",void 0),F(this,"_pendingPublishedUsers",[]),F(this,"ntpAlignErrorCount",0),F(this,"remoteInboundOffset",0),F(this,"_handleLocalTrackEnable",(n,o,a)=>{this.publish(n,!1).then(o).catch(a)}),F(this,"_handleLocalTrackDisable",(n,o,a)=>{this.unpublish(n).then(o).catch(a)}),F(this,"_handleUserOnline",n=>{if($("BLOCK_LOCAL_CLIENT")&&tO(n.uid,this.channelName))return void A.debug("[".concat(n.uid,"] will be ignored in local"));this.isStringUID&&typeof n.uid!="string"&&A.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const o=this._users.find(a=>a.uid===n.uid);if(o)o._trust_in_room_=!0,o._is_pre_created&&(o._is_pre_created=!1,this.safeEmit(G_.USER_JOINED,o));else{const a=new NI(n.uid,n.uint_id||n.uid);this._users.push(a),A.debug("[".concat(this._clientId,"] user online"),n.uid),this.safeEmit(G_.USER_JOINED,a)}}),F(this,"_handleUserOffline",n=>{if($("BLOCK_LOCAL_CLIENT")&&tO(n.uid,this.channelName))return;const o=this._users.find(a=>a.uid===n.uid);o&&(this._handleRemoveStream(n),this._handleRemoveDataChannels(n),o._audio_pre_subscribed||o._video_pre_subscribed?o._is_pre_created=!0:_1(this._users,o),this._remoteStreamTypeCacheMap.delete(o.uid),this._streamFallbackTypeCacheMap.delete(o.uid),A.debug("[".concat(this._clientId,"] user offline"),n.uid,"reason:",n.reason),this.safeEmit(G_.USER_LEAVED,o,n.reason))}),F(this,"_handleAddAudioOrVideoStream",(n,o,a,d,h,p,m)=>{if($("BLOCK_LOCAL_CLIENT")&&tO(o,this.channelName))return;const _=this._users.find(y=>y.uid===o);if(!_)return void A.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));A.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(n)),this.store.subscribe(_.uid,n,void 0,void 0,void 0,Date.now());const g=n==="audio"?_.hasAudio:_.hasVideo;_._uintid||(_._uintid=h||o),n==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,n==="audio"?(_._audio_added_=!0,a!==void 0&&(_._audioSSRC=a),d!==void 0&&(_._cname=d),p&&(_._audioOrtc=p)):(_._video_added_=!0,a!==void 0&&(_._videoSSRC=a),d!==void 0&&(_._cname=d),m!==void 0&&(_._rtxSsrcId=m),p&&(_._videoOrtc=p)),(n==="audio"?_.hasAudio:_.hasVideo)&&!g&&(A.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(n)),this.safeEmit(G_.USER_PUBLISHED,_,n)),n==="video"?E_.onGatewayStream(this._sessionId,rS.ON_ADD_VIDEO_STREAM,yT.ON_ADD_VIDEO_STREAM,{peer:h||o,ssrc:_._videoSSRC}):E_.onGatewayStream(this._sessionId,rS.ON_ADD_AUDIO_STREAM,yT.ON_ADD_AUDIO_STREAM,{peer:h||o,ssrc:_._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(_,n,a).then(y=>{if(y&&(A.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(_.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof OM))return this._p2pChannel.unsubscribe(_,n,!0).then(()=>this._subscribe(_,n,!0).catch(C=>{A.error("[".concat(this._clientId,"] resubscribe error"),C.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(_,n)&&(A.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,n,!0).catch(y=>{A.error("[".concat(this._clientId,"] resubscribe error"),y.toString())}))}),F(this,"_handleRemoveStream",n=>{if($("BLOCK_LOCAL_CLIENT")&&tO(n.uid,this.channelName))return;const o=this._users.find(d=>d.uid===n.uid);if(!o)return void A.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));A.debug("[".concat(this._clientId,"] stream removed with uid ").concat(n.uid));let a=()=>{};o.hasAudio&&o.hasVideo?a=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(G_.USER_UNPUBLISHED,o,"audio"),A.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(G_.USER_UNPUBLISHED,o,"video")}:o.hasVideo?a=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(G_.USER_UNPUBLISHED,o,"video")}:o.hasAudio&&(a=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(G_.USER_UNPUBLISHED,o,"audio")}),o._video_pre_subscribed||o._audio_pre_subscribed||(o._trust_audio_stream_added_state_=!0,o._trust_video_stream_added_state_=!0,o._audio_added_=!1,o._video_added_=!1,this._p2pChannel instanceof OM&&this._p2pChannel.unsubscribe(o).then(d=>{if(d)return this._gateway.unsubscribe(d,o.uid)}),o._audioSSRC=void 0,o._videoSSRC=void 0,o._audioOrtc=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),E_.onGatewayStream(this._sessionId,rS.ON_REMOVE_STREAM,yT.ON_REMOVE_STREAM,{peer:n.uint_id||n.uid}),a()}),F(this,"_handleSetStreamLocalEnable",(n,o,a)=>{if($("BLOCK_LOCAL_CLIENT")&&tO(o,this.channelName))return;const d=this._users.find(m=>m.uid===o);if(!d)return void A.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));A.debug("[".concat(this._clientId,"] local ").concat(n," ").concat(a?"enabled":"disabled"," with uid ").concat(o));const h=n==="audio"?d.hasAudio:d.hasVideo;if(n==="audio"){d._trust_audio_enabled_state_=!0;const m=d._audio_enabled_;if(d._audio_enabled_=a,d._audio_enabled_===m)return;{const _=d._audio_enabled_?"enable-local-audio":"disable-local-audio";A.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(o,", msg: ").concat(_)),this.safeEmit(G_.USER_INFO_UPDATED,o,_)}}else{d._trust_video_enabled_state_=!0;const m=d._video_enabled_;if(d._video_enabled_=a,d._video_enabled_===m)return;{const _=d._video_enabled_?"enable-local-video":"disable-local-video";A.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(_)),this.safeEmit(G_.USER_INFO_UPDATED,o,_)}}const p=n==="audio"?d.hasAudio:d.hasVideo;return h!==p?!h&&p?(A.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(n)),void this.safeEmit(G_.USER_PUBLISHED,d,n)):(n==="video"&&d._videoTrack&&d._videoTrack._destroy(),n==="audio"&&d._audioTrack,this._p2pChannel.muteRemote(d,n),A.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(n)),void this.safeEmit(G_.USER_UNPUBLISHED,d,n)):void 0}),F(this,"_handleMuteStream",(n,o,a)=>{if($("BLOCK_LOCAL_CLIENT")&&tO(n,this.channelName))return;A.debug("[".concat(this._clientId,"] receive mute message"),n,o,a);const d=this._users.find(m=>m.uid===n);if(!d)return void A.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n));const h=o==="audio"?d.hasAudio:d.hasVideo;if(o==="audio"){d._trust_audio_mute_state_=!0;const m=d._audio_muted_;if(d._audio_muted_=a,d._audio_muted_===m)return;{const _=d._audio_muted_?"mute-audio":"unmute-audio";A.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(_)),this.safeEmit(G_.USER_INFO_UPDATED,n,_)}}else{d._trust_video_mute_state_=!0;const m=d._video_muted_;if(d._video_muted_=a,d._video_muted_===m)return;{const _=d._video_muted_?"mute-video":"unmute-video";A.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(_)),this.safeEmit(G_.USER_INFO_UPDATED,n,_)}}const p=o==="audio"?d.hasAudio:d.hasVideo;if(h!==p){if(!h&&p)return(o==="audio"?d._audioSSRC:d._videoSSRC)?(A.info("[".concat(this._clientId,"] remote user ").concat(n," published ").concat(o)),void this.safeEmit(G_.USER_PUBLISHED,d,o)):void A.warning("[".concat(this._clientId,"] remote user ").concat(n," receive ").concat(o," unmute message  before add stream message, ").concat(o," SSRC doesn't exist yet."));o==="video"&&d._videoTrack&&!d._video_pre_subscribed&&d._videoTrack._destroy(),o==="audio"&&d._audioTrack,this._p2pChannel.muteRemote(d,o),A.info("[".concat(this._clientId,"] remote user ").concat(n," unpublished ").concat(o)),this.safeEmit(G_.USER_UNPUBLISHED,d,o)}}),F(this,"_handleP2PLost",async n=>{A.debug("[".concat(this._clientId,"] receive p2p lost"),n),parseInt(n.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():A.warning("[".concat(this._clientId,"] P2PLost stream not found"),n)}),F(this,"_handleTokenWillExpire",()=>{A.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(G_.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),F(this,"_handleBeforeUnload",n=>{n.type==="beforeunload"&&n.returnValue!==void 0&&n.returnValue!==""||(this.leave(),A.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),F(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(G_.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const n={downlinkNetworkQuality:0,uplinkNetworkQuality:0};n.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),n.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(G_.NETWORK_QUALITY,n)}),F(this,"_handleP2PAddAudioOrVideoStream",(n,o,a,d)=>{const h=this._users.find(m=>m.uid===o);if(!h)return void A.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));A.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(n)),this.store.subscribe(h.uid,n,void 0,void 0,void 0,Date.now());const p=n==="audio"?h.hasAudio:h.hasVideo;n==="audio"?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,n==="audio"?(h._audio_added_=!0,a!==void 0&&(h._audioSSRC=a),d!==void 0&&(h._audioMid=d)):(h._video_added_=!0,a!==void 0&&(h._videoSSRC=a),d!==void 0&&(h._videoMid=d)),(n==="audio"?h.hasAudio:h.hasVideo)&&!p&&(A.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(n)),this.safeEmit(G_.USER_PUBLISHED,h,n)),this._p2pChannel.hasPendingRemoteMedia(h,n)&&(A.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,n,!0).catch(m=>{A.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=t,this._clientId=sT(5,"client-"),this.store=new but(t.codec,t.audioCodec,t.mode,this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),A.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(E0," build: ").concat(YF,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{E8(t.clientRoleOptions),e=Object.assign({},t.clientRoleOptions)}catch(n){A.warning("[".concat(this._clientId,"] ").concat(n.toString()))}this._statsCollector=new _D(this.store),this._statsCollector.onStatsException=(n,o,a)=>{A.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(n,", msg: ").concat(o,", uid: ").concat(a)),this.safeEmit(G_.EXCEPTION,{code:n,msg:o,uid:a})},this._statsCollector.onUploadPublishDuration=(n,o,a,d)=>{const h=this._users.find(p=>p.uid===n);h&&E_.peerPublishStatus(this._sessionId,{subscribeElapse:d,audioPublishDuration:o,videoPublishDuration:a,peer:h._uintid})},this.store.useDataChannel=q_().supportDataChannel&&$("SIGNAL_CHANNEL"),this.store.useP2P=t.mode==="p2p",this._gateway=new Ndt(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||xT,httpRetryConfig:t.httpRetryConfig||xT,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:e}),this._configDistribute=new Fdt,this.store.useP2P?(this._p2pChannel=new ZS(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new OM(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,o,a){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];rT("JOIN_GATEWAY_USE_443PORT_ONLY",d),rT("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const p=this._gateway.signal.websocket;return p instanceof yP&&(p.use443PortOnly=d,p.tryDoubleDomain=h),async function(m,_,g){h1.get(m)||h1.set(m,[]),p1.get(m)||p1.set(m,_),yR.get(m)||yR.set(m,0);const y=h1.get(m),C=p1.get(m);if(!y||!C)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(yR.get(m)===C){const K=pP();y.push(K),await K.promise}yR.set(m,yR.get(m)+1);for(var O=arguments.length,q=new Array(O>3?O-3:0),L=3;L<O;L++)q[L-3]=arguments[L];const U=await g(...q);return yR.set(m,yR.get(m)-1),yR.get(m)===C-1&&y.length>0&&(y[0].resolve(),y.shift()),yR.get(m)===0&&(h1.set(m,[]),p1.set(m,0),yR.set(m,0)),U}("client.join",$("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,o,a)}async join(t,e,n,o,a){const d=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(T1||T1||(T1=(window.location.protocol.split(":")[0]||"").toUpperCase(),T1))==="HTTPS",p=I8()?window.isSecureContext:"Browser Not Support";(!I8()&&!h||!window.isSecureContext)&&A.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),A.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),E_.setAppId(t);try{if(!n&&n!==null)throw new _s(Y.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&cS(n,"token",1,2047),cS(t,"appid",1,2047),I1(e),o&&w1(o),a&&cS(a,"optionalInfo",1,2047)}catch(L){throw E_.reportApiInvoke(_P(),{name:BT.JOIN,options:[t,e,n,o],states:{isHttps:h,isSecureContext:p},tag:IT.TRACER}).onError(L),L}const m=await TX({appId:t,cname:e,uid:o,stringUid:typeof o=="string"?o:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode}),_=(m==null?void 0:m.sid)||_P(),g=E_.reportApiInvoke(_,{name:BT.JOIN,options:[t,e,n,o],states:{isHttps:h,isSecureContext:p},tag:IT.TRACER});if(A.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(d)),this._leaveMutex.isLocked&&(A.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),A.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const L=new _s(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw g.onError(L),L}this._sessionId||(this._sessionId=_,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const y=R0(R0({},this._rtmConfig),{},{clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:a,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!m},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(y.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(y.stringUid=o,this._uintUid?(y.uid=this._uintUid,this._uintUid=void 0):y.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(y.aesmode=this._encryptionMode,y.aespassword=await(async L=>{const U=function(_o){const na=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ba=new Uint8Array(new ArrayBuffer(na.length));for(let _u=0;_u<na.length;_u+=1)ba[_u]=na.charCodeAt(_u);return ba}(),K=await window.crypto.subtle.importKey("spki",U,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),J=xF(L),_r=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},K,J);return function(_o){let na="";for(let ba=0;ba<_o.length;ba+=1)na+=String.fromCharCode(_o[ba]);return window.btoa(na)}(new Uint8Array(_r))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new _s(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(y.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const L=new TextEncoder,U=$("USE_PURE_ENCRYPTION_MASTER_KEY")?L.encode(y.appId+this._encryptionSecret+this._encryptionSecret):L.encode(y.appId+y.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(K,J,_r){const _o=await window.crypto.subtle.importKey("raw",J,"PBKDF2",!1,["deriveBits","deriveKey"]),na=K==="aes-128-gcm2"?128:256,ba=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:O8,hash:"SHA-256",salt:_r},_o,na+yut);return new Uint8Array(ba).subarray(na/8)}(this._encryptionMode,U,$I(this._encryptionSalt)),this._encryptDataStreamKey=await async function(K,J,_r){const _o=await window.crypto.subtle.importKey("raw",J,"PBKDF2",!1,["deriveBits","deriveKey"]),na=K==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:O8,hash:"SHA-256",salt:_r},_o,{name:"AES-GCM",length:na},!0,["encrypt","decrypt"])}(this._encryptionMode,U,$I(this._encryptionSalt))}else p?A.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):A.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,A.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:y.stringUid,preload:y.preload});const C=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&C===this._sessionId&&E_.joinChannelTimeout(this._sessionId,5)},5e3);try{var O;let L;const U=y.cloudProxyServer;if(o_(O=["proxy3","proxy4","proxy5"]).call(O,U)){const na=$("PROXY_SERVER_TYPE3");Array.isArray(na)?y.proxyServer=na[0]:y.proxyServer=na}if(E_.setProxyServer(y.proxyServer),A.setProxyServer(y.proxyServer),this.store.requestAPStart(),m){if(A.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(y.stringUid?", ".concat(y.stringUid," => ").concat(m.intUid):""," ")),y.stringUid&&!y.uid&&(y.uid=m.intUid),L={gatewayInfo:m.ap.gatewayInfo},$("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&y.turnServer.mode==="auto")if(m.ap.proxyInfo.addresses.length===0)A.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const na=(await tK(m.ap.proxyInfo,m.ap.gatewayInfo.uid)).map(ba=>({turnServerURL:ba.address,tcpport:ba.tcpport||hS.tcpport,udpport:ba.udpport||hS.udpport,username:ba.username||hS.username,password:ba.password||hS.password,forceturn:!1,security:!0}));y.turnServer={mode:"manual",servers:na}}CX(m,y.stringUid)}else{if(y.stringUid&&!y.uid){let na;[na,L]=await n_.all([pK(y.stringUid,y,this._axiosCancelSource.token,this._config.httpRetryConfig||xT,this.store),hK(y,this._axiosCancelSource.token,this._config.httpRetryConfig||xT,!0,this.store)]),A.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(y.stringUid," => ").concat(na)),y.uid=na,L.gatewayInfo.uid=na,L.gatewayInfo.res.uid=na}else L=await hK(y,this._axiosCancelSource.token,this._config.httpRetryConfig||xT,!0,this.store);if(!this._joinAndNotLeaveYet)throw new _s(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(y,this._axiosCancelSource.token),this._configDistribute.on(rG.UPDATE_BITRATE_LIMIT,na=>{this._p2pChannel.updateBitrateLimit(na)})},0),this._key=n||t;const K=L.gatewayInfo,J=y.uid?y.uid:K.uid;this._joinInfo=R0(R0({},y),{},{cid:K.cid,uid:J,vid:K.vid,apResponse:K.res,uni_lbs_ip:K.uni_lbs_ip,gatewayAddrs:K.gatewayAddrs}),this.store.intUid=J;const _r=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new _s(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));g.onSuccess(_r),this._appId=t,this._channelName=y.cname,this._uid=_r,this.store.uid=_r,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(ZT()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const _o=y.stringUid?"string uid: ".concat(y.stringUid,",uid: ").concat(y.uid):"uid: ".concat(this._uid);return A.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(_o)),setTimeout(()=>{A.startUpload()},5e3),this.store.joinEnd(),q=this,o_(EI).call(EI,q)||EI.push(q),this._cloudProxyServerMode==="disabled"&&q_().supportWebCrypto&&$("ENABLE_PRELOAD")&&Y3(this._joinInfo),_r}catch(L){const U=Array.isArray(L)?L[0]:L;throw U&&U.code===Y.OPERATION_ABORTED?A.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),U):A.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),U),U.code!==Y.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),g.onError(U),U}var q}_joinGateway(){if(!this._joinInfo||!this._key)throw new _s(Y.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!$("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(t=>t).catch(t=>{if(t.code===Y.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,B_.FALLBACK),t;if(t.code===Y.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,B_.FALLBACK),t;throw t}).then(t=>{if(t instanceof _s){if(t.code===Y.INIT_WEBSOCKET_TIMEOUT){if(A.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new _s(Y.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const e=$("PROXY_SERVER_TYPE3");if(Array.isArray(e))if(this._joinInfo.apUrl){const o=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),a=o.slice(o.length-2).join(".");e.forEach(d=>{this._joinInfo&&o_(d).call(d,a)&&(this._joinInfo.proxyServer=d)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=e[0])}else this._joinInfo.proxyServer=e[0];else this._joinInfo.proxyServer=e;const n=$("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return n&&n[1]&&n[1]!=="443"&&A.setProxyServer(this._joinInfo.proxyServer),$("STATS_COLLECTOR_PORT").toString()!=="443"&&E_.setProxyServer(this._joinInfo.proxyServer),E_.reportApiInvoke(this._sessionId,{name:BT.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:IT.TRACER}).onSuccess(),this.safeEmit(G_.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),$("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(o=>{"forceturn"in o&&(o.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(A.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new _s(Y.INVALID_OPERATION);return E_.reportApiInvoke(this._sessionId,{name:BT.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:IT.TRACER}).onSuccess(),this._joinGateway()}return t}).then(t=>t)}async leave(){A.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(ZT()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=EI.indexOf(e);n!==-1&&EI.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return A.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED"),A.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof RN))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new _s(Y.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new _s(Y.INVALID_OPERATION,"audience can not publish stream");for(const a of n){if(!(a instanceof RN))throw new _s(Y.INVALID_PARAMS,"parameter is not local track");if(!a._enabled&&e)throw new _s(Y.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(a.getTrackId()))}A.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(a=>"".concat(a.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(a=>{const d=this._configDistribute.getBitrateLimit();a instanceof aT&&d&&a.setBitrateLimit(d.uplink)});try{await this._publishHighStream(n),A.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(a=>"".concat(a.getTrackId()," "))))}catch(a){throw A.error("[".concat(this._clientId,"] publish error"),a.toString()),a}finally{o()}}async _publishDataChannel(t){nT(t.id,"id",0,65535,!0),BR(t.ordered,"ordered"),cS(t.metadata,"metadata",0,512),A.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(o=>o.id===t.id)!==-1)throw new _s(Y.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new _s(Y.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&$("FORCE_TURN")&&!$("TURN_ENABLE_TCP")&&!$("TURN_ENABLE_UDP"))throw new _s(Y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=new VJ(t);if(await this._p2pChannel.publishDataChannel([n]),!this._p2pChannel.isP2PDisconnected()){if(typeof n._originDataChannelId!="number")throw A.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new _s(Y.CREATE_DATACHANNEL_ERROR);try{const o={streamId:t.id,ordered:t.ordered,maxRetransmits:$("DATASTREAM_MAX_RETRANSMITS"),metadata:t.metadata,channelId:n._originDataChannelId};await this._gateway.publishDataChannel(this._uid,o,!0),await n._waitTillOpen()}catch(o){if(o.code!==Y.DISCONNECT_P2P)throw o}}return A.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw A.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new _s(Y.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof RN))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);A.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(o=>"".concat(o.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this._p2pChannel instanceof ZS){const o=await this._p2pChannel.unpublish(e);o&&await this._gateway.sendExtensionMessage(DT.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(e);o&&await this._gateway.unpublish(o,this._uid),A.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(a=>"".concat(a.getTrackId()))))}}catch(o){throw A.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),A.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),A.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(o=>"".concat(o.id))))}catch(n){throw A.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof NI)){const o=this.remoteUsers.find(a=>a.uid===t);if(!o)throw new _s(Y.INVALID_REMOTE_USER,"user is not in the channel");t=o}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(JT(e,"mediaType",["audio","video"]),this._p2pChannel instanceof ZS)throw new _s(Y.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===m_.AUDIO,o=e===m_.VIDEO,a=await this._subscribeMutex.lock();try{const{ssrcId:d,ortc:h,rtxSsrcId:p,cname:m,uint_id:_}=await this._gateway.presubscribe(t,e,!0);if(d==null)throw new _s(Y.UNEXPECTED_RESPONSE,"no ssrc id");let g=this._users.find(C=>C.uid===t);g||(g=new NI(t,_||t),g._is_pre_created=!0,this._users.push(g)),m&&(g._cname=m),g._uintid||(g._uintid=_||t),n&&(g._audioSSRC=d,g._audio_pre_subscribed=!0,h&&(g._audioOrtc=h)),o&&(g._videoSSRC=d,g._video_pre_subscribed=!0,h&&(g._videoOrtc=h),p!=null&&(g._rtxSsrcId=p)),A.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(g,e,d,p,h);const y=n?g._audioTrack:g._videoTrack;if(!y)throw new _s(Y.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(g._trust_audio_stream_added_state_=!0,g._audio_added_=!0),o&&(g._trust_video_stream_added_state_=!0,g._video_added_=!0),y}catch(d){throw A.error("[".concat(this._clientId,"] presub user ").concat(t," error"),d),d}finally{a()}}async _subscribeDataChannel(t,e){var n;if(nT(e,"channelId",0,65535,!0),!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===t))throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new _s(Y.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new _s(Y.INVALID_REMOTE_USER,"user is not published");const a=(n=t._dataChannels)===null||n===void 0?void 0:n.find(p=>p.id===e);if(!a)throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new _s(Y.REMOTE_USER_IS_NOT_PUBLISHED);const d=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const p=await this._p2pChannel.subscribeDataChannel(t,[a]);if(p&&o_(p).call(p,a.id))try{var h;if(typeof a._originDataChannelId!="number")throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new _s(Y.CREATE_DATACHANNEL_ERROR);const m={id:a.id,datachannelId:a._originDataChannelId,ordered:a.ordered,maxRetransmits:a.maxRetransmits,metadata:(h=a.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,m,!0),await a._waitTillOpen()}catch(m){if((m==null?void 0:m.code)!==Y.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[a]),m;await this._p2pChannel.unsubscribeDataChannel(t,[a]),this._p2pChannel.setPendingRemoteDataChannel(t,a.id)}return A.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),a}finally{d()}}async _p2pSubscribe(t,e,n){if(JT(e,"mediaType",["audio","video"]),!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===t)){const d=new _s(Y.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),d}if(!t.hasAudio&&!t.hasVideo){const d=new _s(Y.INVALID_REMOTE_USER,"user is not published");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),d}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const d=new _s(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),d}const a=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const h=e==="audio"?t._audioSSRC:t._videoSSRC,p=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this._p2pChannel instanceof ZS&&await this._p2pChannel.subscribe(t,e,h,p)}catch(h){throw h}A.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{A.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const d=e==="audio"?t._audioTrack:t._videoTrack;if(!d)throw new _s(Y.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw A.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),d),d}finally{a()}}async _subscribe(t,e,n){if(this._p2pChannel instanceof ZS)return this._p2pSubscribe(t,e);if(JT(e,"mediaType",["audio","video"]),!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(_=>_===t)){const _=new _s(Y.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),_}if(!t.hasAudio&&!t.hasVideo){const _=new _s(Y.INVALID_REMOTE_USER,"user is not published");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),_}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const _=new _s(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),_}let a=e==="audio"?t._audioSSRC:t._videoSSRC,d=e==="audio"?t._audioOrtc:t._videoOrtc,h=e==="video"?t._rtxSsrcId:void 0,p={stream_type:e==="audio"?m_.AUDIO:m_.VIDEO,ssrcId:a};const m=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const g=e==="audio"?t._audioSSRC:t._videoSSRC;g!==void 0&&g!==a&&(a=g,d=e==="audio"?t._audioOrtc:t._videoOrtc,h=e==="video"?t._rtxSsrcId:void 0,p={stream_type:e==="audio"?m_.AUDIO:m_.VIDEO,ssrcId:a}),gS.markSubscribeStart(this.store.clientId,a),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,a,h,d);try{await this._gateway.subscribe(t.uid,p,!0)}catch(y){if((y==null?void 0:y.code)!==Y.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),y;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(g){throw this._p2pChannel.reportSubscribeEvent(!1,g==null?void 0:g.code,t,e),g}A.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(g=>{A.warning("[".concat(this._clientId,"] auto set fallback failed"),g)});const _=e==="audio"?t._audioTrack:t._videoTrack;if(!_)throw new _s(Y.UNEXPECTED_ERROR,"can not find remote track in user object");return _}catch(_){throw A.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),_),_}finally{m()}}async massSubscribe(t){if(GR(t,"subscribeList"),!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,o=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(p=>{let{user:m,mediaType:_}=p;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(_)}).join("; ")));const a=(t=[...t]).map(p=>{let{user:m,mediaType:_}=p;return{user:m,mediaType:_}}),d=await this._p2pChannel.globalLock();try{var h;for(let m=t.length-1;m>=0;m--){const _=t[m],{user:g,mediaType:y}=_;if(JT(y,"mediaType",["audio","video"]),!g){const L=new _s(Y.INVALID_PARAMS,"user property does not exist in subscribeList item");throw A.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),L}if(!this._users.find(L=>L===g)){const L=new _s(Y.INVALID_REMOTE_USER,"user is not in the channel");A.error("[".concat(this._clientId,"] can not massSubscribe ").concat(g.uid,", this user is not in the channel")),a[m].error=L,t.splice(m,1);continue}if(y==="audio"&&(!g.hasAudio||g._audioSSRC===void 0)||y==="video"&&(!g.hasVideo||g._videoSSRC===void 0)){const L=new _s(Y.REMOTE_USER_IS_NOT_PUBLISHED);A.error("[".concat(this._clientId,"] can not subscribe ").concat(g.uid," with mediaType ").concat(y,", remote user is not published")),a[m].error=L,t.splice(m,1);continue}const O=tS.Video|tS.LwoVideo,q=n.get(g);if(q){if(y==="video"?q&O:q&tS.Audio){t.splice(m,1),A.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(g.uid,", mediaType:").concat(y," twice"));continue}n.set(g,q|(y==="video"?O:tS.Audio))}else n.set(g,y==="video"?O:tS.Audio)}for(let m=t.length-1;m>=0;m--){const _=t[m],{user:g,mediaType:y}=_,C=tS.Video|tS.LwoVideo;if(this._p2pChannel.hasRemoteMedia(g,y)){await this._p2pChannel.unmuteRemoteNoLock(g,y);const O=n.get(g);n.set(g,y==="video"?O^C:O^tS.Audio),t.splice(m,1)}}this.store.massSubscribe(t.map(m=>({userId:m.user.uid,type:m.mediaType})),e);const p=Z0(h=Array.from(n.entries())).call(h,(m,_)=>{let[g,y]=_;if(y===0)return m;const C={stream_id:g.uid,stream_type:y};return y&tS.Audio&&(C.audio_ssrc=g._audioSSRC),y&tS.Video&&(C.video_ssrc=g._videoSSRC),m.push(C),m},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(_=>{let{user:g,mediaType:y}=_;return{user:g,mediaType:y,ssrcId:y===m_.VIDEO?g._videoSSRC:g._audioSSRC,rtxSsrcId:y===m_.VIDEO?g._rtxSsrcId:void 0}}));const m=new Map;if(p.length>0){const _=await this._gateway.subscribeAll(p,!0);((_==null?void 0:_.users)||[]).forEach(g=>{let{stream_id:y,video_error_code:C,audio_error_code:O,error_code:q}=g;(C||O||q)&&m.set(y,{video_error_code:C,audio_error_code:O,error_code:q})})}if(Array.from(m.entries()).length>0){const _=[];Array.from(m.entries()).forEach(g=>{let[y,C]=g;const O=this.remoteUsers.find(q=>q.uid===y);if(O){let q;C.error_code||C.video_error_code&&C.audio_error_code?q=void 0:C.video_error_code?q=m_.VIDEO:C.audio_error_code&&(q=m_.AUDIO),_.push({user:O,mediaType:q})}}),_.length>0&&await this._p2pChannel.massUnsubscribeNoLock(_)}for(const _ of a){const g=m.get(_.user.uid);if(g){const y=g.error_code||_.mediaType==="audio"&&g.audio_error_code||_.mediaType==="video"&&g.video_error_code;if(y){const C=nO(y);A.error("user:".concat(_.user.uid," mediaType:").concat(_.mediaType," has massSubscribe error ").concat(C.desc)),_.error=new _s(Y.SUBSCRIBE_FAILED,"code ".concat(y,": ").concat(C.desc))}}_.error||(_.mediaType==="video"?_.track=_.user.videoTrack:_.track=_.user.audioTrack)}return this.store.massSubscribe(a.filter(_=>!_.error).map(_=>({userId:_.user.uid,type:_.mediaType})),void 0,Date.now()),a.forEach(_=>{var g;E_.subscribe(this.store.sessionId,{succ:!!_.error,ec:((g=_.error)===null||g===void 0?void 0:g.code)||null,video:_.mediaType===m_.VIDEO,audio:_.mediaType===m_.AUDIO,peerid:_.user.uid,subscribeRequestid:_.mediaType===m_.VIDEO?_.user._videoSSRC:_.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e)},!0)}),A.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(_=>{let{user:g,mediaType:y}=_;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(y)}).join("; "))),a}catch(m){throw await this._p2pChannel.massUnsubscribeNoLock(t),m}}finally{d(),o()}}async unsubscribe(t,e,n){if(!(t instanceof NI)){const d=this.remoteUsers.find(h=>h.uid===t);if(!d)throw new _s(Y.INVALID_REMOTE_USER,"user is not in the channel");t=d}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&JT(e,"mediaType",["audio","video"]),!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(d=>d===t)){const d=new _s(Y.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),d}A.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const a=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof ZS)await this._p2pChannel.unsubscribe(t,e);else{const d=await this._p2pChannel.unsubscribe(t,e);d&&await this._gateway.unsubscribe(d,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&_1(this._users,t),A.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(d){if(d.code===Y.DISCONNECT_P2P)return void A.warning("disconnecting p2p, abort unsubscribe request.");throw A.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),d.toString()),d}finally{a()}}async _unsubscribeDataChannel(t,e){if(e&&nT(e,"id",0,65535,!0),!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(a=>a===t)){const a=new _s(Y.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),a}let o;if(typeof e=="number"){const a=t._dataChannels.find(d=>d.id===e);a&&(o=[a])}else o=t._dataChannels;if(o===void 0){const a=new _s(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw A.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),a}A.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(o.map(a=>a.id)));try{const a=await this._p2pChannel.unsubscribeDataChannel(t,o);a&&await this._gateway.unsubscribeDataChannel(a,t.uid),A.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(a))}catch(a){if(a.code===Y.DISCONNECT_P2P)return void A.warning("disconnecting p2p, abort unsubscribe request.");throw A.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),a.toString()),a}}async massUnsubscribe(t){if(GR(t,"unsubscribeList"),!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");A.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:o,mediaType:a}=n;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(a,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:o,mediaType:a}=t[n];if(!o){const p=new _s(Y.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw A.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),p}if(JT(a,"mediaType",["video","audio",void 0]),!this._users.find(p=>p===o)){A.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),t.splice(n,1);continue}const h=tS.Video|tS.LwoVideo;if(e.has(o)){const p=e.get(o);let m;switch(a){case"video":m=p&h;break;case"audio":m=p&tS.Audio;break;default:m=p&(tS.Audio|h)}if(m){A.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(a," twice.")),t.splice(n,1);continue}a?a==="audio"?e.set(o,p|tS.Audio):a==="video"&&e.set(o,p|h):e.set(o,p|tS.Audio|h)}else a?a==="audio"?e.set(o,tS.Audio):a==="video"&&e.set(o,h):e.set(o,tS.Audio|h)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),A.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(o=>{let{user:a,mediaType:d}=o;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(d,";")}).join()))}catch(n){if(n.code===Y.DISCONNECT_P2P)return void A.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw A.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new ya(Y.INVALID_PARAMS);CT(n.width)||MF(n.width,"streamParameter.width"),CT(n.height)||MF(n.height,"streamParameter.height"),CT(n.framerate)||MF(n.framerate,"streamParameter.framerate"),CT(n.bitrate)||nT(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&A.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),A.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,_E.LocalVideoLowTrack)}async enableDualStream(){if(!q_().supportDualStream)throw E_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new _s(Y.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new _s(Y.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw E_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,E_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),A.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(_E.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw E_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,E_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),A.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(n){JT(n,"role",["audience","host"])}(t),e&&E8(e),this.mode==="rtc"||this.mode==="p2p")throw A.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new _s(Y.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new _s(Y.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new _s(Y.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(t,e),this._config.role=t,A.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(cS(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new _s(Y.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new _s(Y.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,E_.setProxyServer(this._proxyServer),A.setProxyServer(this._proxyServer),A.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new _s(Y.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new _s(Y.INVALID_OPERATION,"You have already set the proxy")}if(QO(t))return this._turnServer={servers:t,mode:"original-manual"},void A.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>m8(n)),this._turnServer={servers:t,mode:"manual"},A.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new _s(Y.INVALID_OPERATION,"you should set license before join channel");if(cS(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new _s(Y.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,A.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new _s(Y.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new _s(Y.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new _s(Y.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new _s(Y.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,A.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new _s(Y.INVALID_OPERATION,"Stop proxy server after leave channel");E_.setProxyServer(),A.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",A.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new _s(Y.INVALID_PARAMS,"accessPoints is required.");GR(t.accessPoints.serverList,"accessPoints.serverList"),cS(t.accessPoints.domain,"accessPoints.domain");const e=(C,O)=>{nT(C,O,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new _s(Y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");$("CLOSE_AFB_FOR_LOCAL_AP")&&(rT("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),rT("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,a=t.accessPoints.domain,d=t.accessPoints.serverList.map(C=>o.test(C)?"".concat(C.replace(/\./g,"-"),".").concat(a):C),h=d.map(C=>"".concat(C,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,rT("WEBCS_DOMAIN",h),rT("WEBCS_DOMAIN_BACKUP_LIST",h),rT("GATEWAY_DOMAINS",[a]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(GR(t.report.hostname,"report.hostname"),rT("EVENT_REPORT_DOMAIN",t.report.hostname[0]),rT("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(rT("EVENT_REPORT_DOMAIN",d[0]),rT("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let p=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),p=t.report.port),rT("STATS_COLLECTOR_PORT",p),t.report?rT("ENABLE_EVENT_REPORT",!0):rT("ENABLE_EVENT_REPORT",!1);let m="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(GR(t.log.hostname,"log.hostname"),m=t.log.hostname[0]):m=d[0];let _=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),_=t.log.port),rT("LOG_UPLOAD_SERVER","".concat(m,":").concat(_));let g=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(GR(t.cds.hostname,"cds.hostname"),g=t.cds.hostname):g=d;let y=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),y=t.cds.port),rT("CDS_AP",g.map(C=>"".concat(C,":").concat(y))),t.cds?rT("ENABLE_CONFIG_DISTRIBUTE",!0):rT("ENABLE_CONFIG_DISTRIBUTE",!1),A.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(GR(t,"serverList"),cS(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new _s(Y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(o=>n.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(e):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,rT("WEBCS_DOMAIN",t),rT("WEBCS_DOMAIN_BACKUP_LIST",t),rT("GATEWAY_DOMAINS",[e]),rT("EVENT_REPORT_DOMAIN",t[0]),rT("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),rT("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),A.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(JT(t,"streamType",[0,1]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw A.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else A.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){JT(e,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(o=>o.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw A.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}A.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){JT(e,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw A.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}A.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,o){(function(d){JT(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),cS(e,"secret");const a=["aes-128-gcm2","aes-256-gcm2"];if(o_(a).call(a,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new _s(Y.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new _s(Y.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(BR(o,"encryptDataStream"),!o_(a).call(a,t))throw new _s(Y.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||A.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=fI(n))}async renewToken(t){if(cS(t,"token",1,2047),!this._key||!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if($("USE_NEW_TOKEN")){A.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await Vdt(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||xT);A.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:o})}else A.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});A.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=e,this._joinInfo.token=e,A.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?A.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(G_.VOLUME_INDICATOR,t)},$("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new _s(Y.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new _s(Y.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new _s(Y.LIVE_STREAMING_TASK_CONFLICT);const n=e?iS.TRANSCODE:iS.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(iS.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new _s(Y.INVALID_PARAMS,"can not find live streaming url to stop");await n_.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async addInjectStreamUrl(t,e){if(!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const n=this._createLiveStreamingClient(iS.INJECT);n.setInjectStreamConfig(e,0),await n.startLiveStreamingTask(t,iS.INJECT)}async removeInjectStreamUrl(){var t;const e=this._createLiveStreamingClient(iS.INJECT),n=Array.from(nR(t=e.streamingTasks).call(t)).find(o=>o.mode===iS.INJECT);if(!this._joinInfo||!n)throw new _s(Y.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await e.stopLiveStreamingTask(n.url)}async startChannelMediaRelay(t){N9(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){N9(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const a=new TextEncoder;t.payload=a.encode(t.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&o_(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(o=!0,t.payload=await async function(a,d,h){var p;const m=Z0(p=Array.from(h)).call(p,(L,U)=>L+U,0),_={serverTs:0,seq:Tut++,length:h.length,checkSum:m},g=new Uint8Array(R8(m,2)),y=new ArrayBuffer(tN),C=new DataView(y);C.setUint32(0,_.serverTs),C.setUint16(4,_.seq),C.setUint16(6,_.length),C.setUint16(8,_.checkSum);const O=16-h.length%16;h=v8(h,new Uint8Array(O));const q=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a,tagLength:w8,additionalData:g},d,h);return v8(new Uint8Array(y),new Uint8Array(q))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new _s(Y.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(b_.DATA_STREAM,{payload:fI(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-uft},!n)}sendMetadata(t){if(!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new _s(Y.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(b_.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:fI(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(Rut),!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"can not send custom report, not joined");await E_.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){JT(e.spatialLayer,"spatialLayer",[0,1,2,3]),JT(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw A.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(BR(e,"apRTM"),nT(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,A.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(A.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=MS.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&RX(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new nS("client-publish"),this._subscribeMutex=new nS("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const o=t||_P();t?A.debug("[".concat(this._clientId,"] new Session ").concat(o)):A.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const a=t?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o;const d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:a,clientRole:this.role==="audience"?2:1};e?E_.sessionInit(this._sessionId,R0({cname:e.channel,appid:e.appId,preload:e.preload},d)):this._joinInfo?E_.sessionInit(this._sessionId,R0({cname:this._joinInfo.cname,appid:this._joinInfo.appId,preload:!!this._joinInfo.recoverPreloadCache},d)):this._gateway.joinInfo&&E_.sessionInit(this._sessionId,R0({cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId},d)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new _s(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&$("FORCE_TURN")&&!$("TURN_ENABLE_TCP")&&!$("TURN_ENABLE_UDP"))throw new _s(Y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");A.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof ZS){const o=(await n.next()).value;if(o){try{await this._gateway.sendExtensionMessage(DT.PUBLISH,o,!0)}catch(a){throw n.throw(a),a}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await n.next()).value;if(o){var e;let a;try{a=await this._gateway.publish(this._uid,o,!0)}catch(d){if(d.code!==Y.DISCONNECT_P2P)throw n.throw(d),d}await n.next(((e=a)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const a of t)a instanceof aT&&a._encoderConfig&&this._gateway.setVideoProfile(a._encoderConfig),!a.muted&&a.enabled||await this._p2pChannel.muteLocalTrack(a)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===Y.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new _s(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _s(Y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));A.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await n.next()).value;if(o){var e;let a;try{a=await this._gateway.publish(this._uid,o,!0)}catch(d){if(d.code!==Y.DISCONNECT_P2P)throw n.throw(d),d}n.next(((e=a)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===Y.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){if(!this._joinInfo||!this._appId)return new _s(Y.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const e=()=>new xpt(this._joinInfo,this._config.websocketRetryConfig||xT,this._config.httpRetryConfig||xT),n=o=>{o.onLiveStreamError=(a,d)=>{E_.reportApiInvoke(this._sessionId,{name:BT.ON_LIVE_STREAM_ERROR,options:[a,d],tag:IT.TRACER}).onSuccess(),this.safeEmit(G_.LIVE_STREAMING_ERROR,a,d)},o.onLiveStreamWarning=(a,d)=>{E_.reportApiInvoke(this._sessionId,{name:BT.ON_LIVE_STREAM_WARNING,options:[a,d],tag:IT.TRACER}).onSuccess(),this.safeEmit(G_.LIVE_STREAMING_WARNING,a,d)},o.on(O1.REQUEST_WORKER_MANAGER_LIST,(a,d,h)=>{if(!this._joinInfo)return h(new _s(Y.INVALID_OPERATION,"can not find join info to get worker manager"));EK(a,this._joinInfo,this._axiosCancelSource.token,xT).then(d).catch(h)})};switch(t){case iS.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=e(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case iS.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=e(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case iS.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=e(),this._injectStreamingClient.on(O1.REQUEST_WORKER_MANAGER_LIST,(o,a,d)=>{if(!this._joinInfo)return d(new _s(Y.INVALID_OPERATION,"can not find join info to get worker manager"));EK(o,this._joinInfo,this._axiosCancelSource.token,xT).then(a).catch(d)}),this._injectStreamingClient.onInjectStatusChange=(o,a,d)=>{this.safeEmit(G_.INJECT_STREAM_STATUS,o,a,d)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new _s(Y.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:e}=this.getLocalVideoStats(),n={width:t,height:e};this._channelMediaRelayClient=new Vpt(this._joinInfo,this._clientId,this._config.websocketRetryConfig||xT,this._config.httpRetryConfig||xT,n),this._channelMediaRelayClient.on("state",o=>{o===FS.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(G_.CHANNEL_MEDIA_RELAY_STATE,o)}),this._channelMediaRelayClient.on("event",o=>{this.safeEmit(G_.CHANNEL_MEDIA_RELAY_EVENT,o)}),this._statsCollector.onStatsChanged=(o,a)=>{var d;o==="resolution"&&((d=this._channelMediaRelayClient)===null||d===void 0||d.setVideoProfile(a))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:o}=t,a=[];Array.isArray(n)&&n.length>0&&n.forEach(d=>{const{uid:h,stream_id:p,ordered:m,max_retrans_times:_,metadata:g}=d,y=this._users.find(C=>C._uintid===h);if(!y)return void A.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(A.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),o_(a).call(a,y)||a.push(y),y._uintid||(y._uintid=h),y._dataChannels.findIndex(C=>C.id===d.stream_id)===-1){const C={id:p,ordered:!!m,maxRetransmits:_,metadata:g},O=new fpt(C);y._dataChannels.push(O),A.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published datachannel")),e||this.safeEmit(G_.USER_PUBLISHED,y,"datachannel",C)}this._p2pChannel.hasPendingRemoteDataChannel(y,d.stream_id)&&(A.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(y.uid," after reconnect.")),this._subscribeDataChannel(y,d.stream_id).catch(C=>{A.error("[".concat(this._clientId,"] resubscribe datachannel error"),C.toString())}))}),e&&(this.safeEmit(G_.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(d=>{const{uid:h,stream_id:p}=d,m=this._users.find(g=>g._uintid===h);if(!m)return void A.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const _=m._dataChannels.find(g=>g.id===d.stream_id);_&&(A.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(m,[_]).then(g=>{if(m._dataChannels=m._dataChannels.filter(y=>y!==_),g)return this._gateway.unsubscribeDataChannel(g,m.uid)}),A.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(_.id)),this.safeEmit(G_.USER_UNPUBLISHED,m,"datachannel",_._config))})}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){A.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(o=>{this.safeEmit(G_.USER_UNPUBLISHED,e,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,e.uid)}),n()}}else A.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(PT.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(PT.CONNECTION_STATE_CHANGE,(t,e,n)=>{var o;if(n===B_.FALLBACK)return;const a=()=>{this.safeEmit(G_.CONNECTION_STATE_CHANGE,t,e,n)};if(E_.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:BT.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:IT.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),A.info("[".concat(this._clientId,"] connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void a();if(t==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((h,p)=>{this._gateway.setStreamFallbackOption(p,h).catch(m=>{A.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),m)})}),this._remoteStreamTypeCacheMap.forEach((h,p)=>{this._gateway.setRemoteVideoStreamType(p,h).catch(m=>{A.warning("[".concat(this._clientId,"] auto set remote stream type failed"),m)})}),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{A.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{A.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{A.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(A.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,m_.AUDIO,!1)),h._trust_video_mute_state_||(A.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,m_.VIDEO,!1)),h._trust_audio_enabled_state_||(A.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(A.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(A.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(A.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(A.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}a()}),this._gateway.on(PT.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new _s(Y.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;this._joinInfo.recoverPreloadCache?(n=this._joinInfo.recoverPreloadCache.ap,CX(this._joinInfo.recoverPreloadCache),this._joinInfo.recoverPreloadCache=void 0):n=await EG(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||xT,this.store),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const o=[];n.gatewayInfo.gatewayAddrs.forEach(a=>{let{address:d}=a;const[h,p]=d.split(":");this._joinInfo&&this._joinInfo.proxyServer?o.push({proxy:this._joinInfo.proxyServer,host:h,port:p}):o.push({host:h,port:p})}),t(o)}catch(n){e(n)}}),this._gateway.on(PT.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(G_.NETWORK_QUALITY,t)}),this._gateway.on(PT.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(G_.STREAM_TYPE_CHANGED,t,e),E_.reportApiInvoke(this._sessionId,{name:BT.STREAM_TYPE_CHANGE,options:[t,e],tag:IT.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(PT.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(PT.NEED_RENEW_SESSION,async t=>{if(t==="recover"&&this._joinInfo){const e=await TX(R0(R0({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));this._joinInfo.recoverPreloadCache=e,this._startSession(e==null?void 0:e.sid)}else this._startSession()}),this._gateway.on(PT.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{e(await this._p2pChannel.startP2PConnection(t))}catch(o){n(o)}}),this._gateway.on(PT.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;const{dtlsParameters:n,iceParameters:o,candidates:a,rtpCapabilities:d,setup:h,cname:p}=i9(t.ortc,e);this._p2pChannel.connect(o,n,a,d,h,p)}),this._gateway.on(PT.REQUEST_DC_CONNECTION_PARAMS,t=>{t(this._p2pChannel.getEstablishParams())}),this._gateway.on(PT.RESET_SIGNAL,t=>{this._p2pChannel.resetConnection(t),this._handleGatewaySignalEvents()}),this._gateway.on(PT.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(PT.DATACHANNEL_PRECONNECT,async(t,e,n,o)=>{var a,d,h,p,m,_;await this._p2pChannel.startP2PConnection({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},!0);const g=function(y,C){let O;return C&&C.ip&&typeof C.port=="number"?(O=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:C.ip,port:C.port.toString(),type:"host",extension:{}}],A.debug("Using remote candidate from AP ".concat(C.ip,":").concat(C.port)),C.ip6&&(O.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:C.ip6,port:C.port.toString(),type:"host",extension:{}}),A.debug("Using IPV6 remote candidate from AP ".concat(C.ip6,":").concat(C.port)))):O=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:y.ip,port:y.port.toString(),type:"host",extension:{}}],O}(t,e);return this._p2pChannel.preConnect({iceUfrag:"".concat((d=this._joinInfo)===null||d===void 0?void 0:d.apResponse.cid,"_").concat((h=this._joinInfo)===null||h===void 0?void 0:h.apResponse.cert),icePwd:"".concat((p=this._joinInfo)===null||p===void 0?void 0:p.apResponse.cid,"_").concat((m=this._joinInfo)===null||m===void 0?void 0:m.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(_=$("FINGERPRINT"))!==null&&_!==void 0?_:t.fingerprint}]},g,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(n).catch(o)})}_handleGatewaySignalEvents(){this._gateway.signal.on(D_.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(D_.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(D_.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(D_.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(D_.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(D_.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams,deleted:[]},!0)}),this._gateway.signal.on(D_.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(D_.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(D_.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,m_.AUDIO,!0)),this._gateway.signal.on(D_.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,m_.AUDIO,!1)),this._gateway.signal.on(D_.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,m_.VIDEO,!0)),this._gateway.signal.on(D_.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,m_.VIDEO,!1)),this._gateway.signal.on(D_.RECEIVE_METADATA,t=>{const e=$I(t.metadata);this.safeEmit(G_.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(D_.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=$I(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&o_(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<tN)throw new _s(Y.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(tN));n=await async function(d,h,p){const m=p.subarray(0,tN),_=m.slice(8,tN),g=(_[0]<<8)+_[1],y=(m[6]<<8)+m[7],C=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:d,tagLength:w8,additionalData:new Uint8Array(R8(g,2))},h,p.subarray(tN));return new Uint8Array(C).subarray(0,y)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let o=0;if(t.ordered||t.syncWithAudio){const a=this._p2pChannel.getStats(),d=this.remoteUsers.find(p=>p.uid===t.uid),h=a==null?void 0:a.audioRecv.find(p=>p.ssrc===(d==null?void 0:d._audioSSRC));o=h==null?void 0:h.jitterBufferMs}o==null&&(o=0),lft(R0(R0({},t),{},{payload:n}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(D_.ON_CRYPT_ERROR,()=>{pI(()=>{A.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(G_.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(D_.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(D_.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{A.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,B_.TOKEN_EXPIRE),this.safeEmit(G_.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(D_.ON_STREAM_FALLBACK_UPDATE,t=>{A.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(G_.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(D_.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),A.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(D_.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(D_.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(h_.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case b_.PUBLISH:{if(!e)return;const a=e.ortc;if(a){var n,o;const d=a.some(m=>{let{stream_type:_}=m;return _===lb.Audio}),h=a.some(m=>{let{stream_type:_}=m;return _!==lb.Audio}),p=a.some(m=>{let{stream_type:_}=m;return _===lb.Screen||_===lb.ScreenLow});e.state==="offer"&&E_.publish(this._joinInfo.sid,{eventElapse:gS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Y.TIMEOUT,audio:d,video:h,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:p,audioName:d?(n=a.find(m=>{let{stream_type:_}=m;return _===lb.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:h?(o=a.find(m=>{let{stream_type:_}=m;return _!==lb.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case b_.SUBSCRIBE:e&&E_.subscribe(this._joinInfo.sid,{succ:!1,ec:Y.TIMEOUT,audio:e.stream_type===m_.AUDIO,video:e.stream_type===m_.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:gS.measureFromSubscribeStart(this.store.clientId,e.ssrcId)})}}),this._gateway.signal.on(D_.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(D_.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;$("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(o=>!tO(o.string_id||o.stream_id,this.channelName)));const e=[],n=[];for(const o of t.users){let a=this._users.find(g=>g._uintid===o.stream_id);a?a._trust_in_room_=!0:(a=new NI(o.string_id||o.stream_id,o.stream_id),this._users.push(a),this.getListeners(G_.PUBLISHED_USER_LIST).length===0&&(A.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(G_.USER_JOINED,a)));const d=tS.Audio&o.stream_type,h=(tS.Video|tS.LwoVideo)&o.stream_type,p=(65280&o.stream_type)!=0,m=d&&a.hasAudio,_=h&&a.hasVideo;h&&(a._trust_video_stream_added_state_=!0,a._video_added_=!0,a._videoSSRC=o.video_ssrc,a._rtxSsrcId=o.video_rtx),d&&(a._trust_audio_stream_added_state_=!0,a._audio_added_=!0,a._audioSSRC=o.audio_ssrc),d&&!m&&this.getListeners(G_.PUBLISHED_USER_LIST).length===0&&(A.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published audio")),this.safeEmit(G_.USER_PUBLISHED,a,"audio")),h&&!_&&this.getListeners(G_.PUBLISHED_USER_LIST).length===0&&(A.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published video")),this.safeEmit(G_.USER_PUBLISHED,a,"video")),(d&&!m||h&&!_||p)&&e.push(a),h&&this._p2pChannel.hasPendingRemoteMedia(a,"video")&&n.push({user:a,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(a,"audio")&&n.push({user:a,mediaType:"audio"})}n.length>0&&(A.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(o=>{A.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(G_.PUBLISHED_USER_LIST).length>0?$("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(A.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(o=>o.uid).join(", "))),this.safeEmit(G_.PUBLISHED_USER_LIST,e)):A.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(D_.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof OM&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var o;return o_(o=Object.keys(_A)).call(o,n)}))})}_handleP2PEvents(){this._gateway.signal.on(D_.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(DT.PUBLISH,(t,e,n)=>{const{uid:o}=t;t.forEach(a=>{const{kind:d,ssrcs:h,mid:p,isMuted:m}=a;this._handleP2PAddAudioOrVideoStream(d,o,h[0].ssrcId,p);const _=this._users.find(g=>g.uid===o);return _&&this._p2pChannel instanceof ZS?this._p2pChannel.mockSubscribe(_,d,h[0].ssrcId,p).then(()=>{e()}).catch(n):e(),this._handleMuteStream(o,d,!!m)})}),this._gateway.signal.on(DT.CALL,async(t,e,n)=>{if(this._p2pChannel instanceof ZS)try{var o;e(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},t))}catch(a){n(a)}}),this._gateway.signal.on(h_.P2P_CONNECTION,async t=>{this._p2pChannel instanceof ZS&&await this._p2pChannel.p2pConnect(t)}),this._gateway.signal.on(DT.UNPUBLISH,async(t,e,n)=>{if(this._p2pChannel instanceof ZS){const{unpubMsg:o,uid:a}=t,d=this._users.find(h=>h.uid===a);if(!d)return A.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a)),void e();try{o.forEach(async h=>{let{stream_type:p}=h;const m=p===lb.Audio?m_.AUDIO:m_.VIDEO;await this._p2pChannel.unsubscribe(d,m),this._handleMuteStream(a,m,!0)}),e()}catch(h){n(h)}}}),this._gateway.signal.on(DT.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case gI.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,m_.VIDEO,!0);break;case gI.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,m_.AUDIO,!0);break;case gI.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,m_.VIDEO,!1);break;case gI.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,m_.AUDIO,!1)}}),this._gateway.signal.on(DT.RESTART_ICE,async(t,e,n)=>{if(this._p2pChannel instanceof ZS)try{const{direction:o,iceParameter:a}=t;o!==PS.SEND_ONLY||a?e(await this._p2pChannel.restartICE(o,a)):(this._p2pChannel.handleDisconnect(o),e())}catch(o){n(o)}}),this._gateway.signal.on(DT.CANDIDATE,t=>{if(this._p2pChannel instanceof ZS){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on(I_.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:o}=t;e(await this._gateway.sendExtensionMessage(DT.RESTART_ICE,t,o===PS.SEND_ONLY))}catch(o){n(o)}}),this._p2pChannel.on(I_.LocalCandidate,t=>{this._gateway.sendExtensionMessage(DT.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(I_.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(DT.CONTROL,t,!0),e()}catch(o){n(o)}}),this._p2pChannel.on(I_.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(o){o.code===Y.DISCONNECT_P2P?e():n(o)}else e()}),this._p2pChannel.on(I_.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(o){o.code===Y.DISCONNECT_P2P?e():n(o)}else e()}),this._p2pChannel.on(I_.StateChange,(t,e)=>{e===_b.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(I_.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(o){o.code===Y.DISCONNECT_P2P?e():n(o)}else e()}),this._p2pChannel.on(I_.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(o){o.code===Y.DISCONNECT_P2P?e():n(o)}else e()}),this._p2pChannel.on(I_.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(I_.RequestRePublishDataChannel,(t,e,n)=>{n_.all(t.map(async o=>{await this._p2pChannel.publishDataChannel([o]);const a={streamId:o.id,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:o.metadata,channelId:o._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,a,!0)}catch(d){if(d.code!==Y.DISCONNECT_P2P)throw d}})).then(e).catch(n)}),this._p2pChannel.on(I_.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:o,kind:a}of t)a===m_.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");e()}catch(o){n(o)}}),this._p2pChannel.on(I_.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on(I_.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(I_.MediaReconnectStart,t=>{this.safeEmit(G_.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(I_.MediaReconnectEnd,t=>{this.safeEmit(G_.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(I_.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(I_.RequestRestartICE,async t=>{if(this._p2pChannel instanceof ZS)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const o=n.value;let a;try{a=await this._gateway.restartICE({iceParameters:o})}catch(h){return void e.throw(h)}const{iceParameters:d}=function(h){const p=h.iceParameters;return{iceParameters:{iceUfrag:p.iceUfrag,icePwd:p.icePwd}}}(a);await e.next({remoteIceParameters:d})}),this._p2pChannel.on(I_.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(I_.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:a,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:o}),{dtlsParameters:h,iceParameters:p,candidates:m,rtpCapabilities:_,setup:g,cname:y}=i9(a,d);await this._p2pChannel.connect(p,h,m,_,g,y),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(I_.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(I_.P2PLost,()=>{this.safeEmit(G_.P2P_LOST,this.store.uid)}),this._p2pChannel.on(I_.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(I_.ConnectionTypeChange,t=>{this.safeEmit(G_.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(I_.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(I_.QueryClientConnectionState,t=>{t(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new _s(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!t)throw new _s(Y.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!t.inspectType||!Array.isArray(t.inspectType))throw new _s(Y.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const e=[...new Set(t.inspectType)];e.forEach(n=>{var o;if(!o_(o=["supervise","moderation"]).call(o,n))throw new _s(Y.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(n," is not a valid inspect type."))}),t.inspectType=e}if(t&&t.extraInfo&&t.extraInfo.length>1024)throw new _s(Y.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const e=new AM(t);this._inspect=e,this.handleVideoInspectEvents(this._inspect),await e.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},xT)}catch(e){throw Array.isArray(e)?e[0]:e}}async disableContentInspect(){if(!this._inspect)throw new _s(Y.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(BR(t,"enabled"),t){if(!e)throw new _s(Y.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(nT(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new _s(Y.INVALID_PARAMS,"[".concat(this._clientId,"] config.extraInfo length cannot exceed 1024 bytes"));if(e&&e.vendor&&e.vendor.length>1024)throw new _s(Y.INVALID_PARAMS,"[".concat(this._clientId,"] config.vendor length cannot exceed 1024 bytes"));if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new _s(Y.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(e);const n=new G3(e);this._moderation=n,this.handleImageModerationEvents(this._moderation),await n.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},xT)}catch(n){throw Array.isArray(n)?n[0]:n}}else{if(!this._moderation)throw new _s(Y.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}}setP2PTransport(t){if(function(e){JT(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new _s(Y.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,A.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}handleImageModerationEvents(t){t.on(rR.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(G_.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===g0.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new _s(Y.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(rR.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}handleVideoInspectEvents(t){t.on(oS.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(G_.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===k0.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(G_.CONTENT_INSPECT_ERROR,new _s(Y.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(oS.INSPECT_RESULT,(e,n)=>{var o;if((n==null?void 0:n.code)===Y.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return A.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(G_.CONTENT_INSPECT_RESULT,e,n)}),t.on(oS.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return A.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){BR(t,"enabled"),rT("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},e_(s_.prototype,"leave",[OX],Object.getOwnPropertyDescriptor(s_.prototype,"leave"),s_.prototype),e_(s_.prototype,"publish",[AX],Object.getOwnPropertyDescriptor(s_.prototype,"publish"),s_.prototype),e_(s_.prototype,"unpublish",[NX],Object.getOwnPropertyDescriptor(s_.prototype,"unpublish"),s_.prototype),e_(s_.prototype,"subscribe",[PX],Object.getOwnPropertyDescriptor(s_.prototype,"subscribe"),s_.prototype),e_(s_.prototype,"presubscribe",[DX],Object.getOwnPropertyDescriptor(s_.prototype,"presubscribe"),s_.prototype),e_(s_.prototype,"massSubscribe",[kX],Object.getOwnPropertyDescriptor(s_.prototype,"massSubscribe"),s_.prototype),e_(s_.prototype,"unsubscribe",[LX],Object.getOwnPropertyDescriptor(s_.prototype,"unsubscribe"),s_.prototype),e_(s_.prototype,"massUnsubscribe",[MX],Object.getOwnPropertyDescriptor(s_.prototype,"massUnsubscribe"),s_.prototype),e_(s_.prototype,"setLowStreamParameter",[UX],Object.getOwnPropertyDescriptor(s_.prototype,"setLowStreamParameter"),s_.prototype),e_(s_.prototype,"enableDualStream",[xX],Object.getOwnPropertyDescriptor(s_.prototype,"enableDualStream"),s_.prototype),e_(s_.prototype,"disableDualStream",[jX],Object.getOwnPropertyDescriptor(s_.prototype,"disableDualStream"),s_.prototype),e_(s_.prototype,"setClientRole",[VX],Object.getOwnPropertyDescriptor(s_.prototype,"setClientRole"),s_.prototype),e_(s_.prototype,"setProxyServer",[FX],Object.getOwnPropertyDescriptor(s_.prototype,"setProxyServer"),s_.prototype),e_(s_.prototype,"setTurnServer",[BX],Object.getOwnPropertyDescriptor(s_.prototype,"setTurnServer"),s_.prototype),e_(s_.prototype,"setLicense",[GX],Object.getOwnPropertyDescriptor(s_.prototype,"setLicense"),s_.prototype),e_(s_.prototype,"startProxyServer",[HX],Object.getOwnPropertyDescriptor(s_.prototype,"startProxyServer"),s_.prototype),e_(s_.prototype,"stopProxyServer",[WX],Object.getOwnPropertyDescriptor(s_.prototype,"stopProxyServer"),s_.prototype),e_(s_.prototype,"setLocalAccessPointsV2",[qX],Object.getOwnPropertyDescriptor(s_.prototype,"setLocalAccessPointsV2"),s_.prototype),e_(s_.prototype,"setLocalAccessPoints",[KX],Object.getOwnPropertyDescriptor(s_.prototype,"setLocalAccessPoints"),s_.prototype),e_(s_.prototype,"setRemoteDefaultVideoStreamType",[zX],Object.getOwnPropertyDescriptor(s_.prototype,"setRemoteDefaultVideoStreamType"),s_.prototype),e_(s_.prototype,"setRemoteVideoStreamType",[YX],Object.getOwnPropertyDescriptor(s_.prototype,"setRemoteVideoStreamType"),s_.prototype),e_(s_.prototype,"setStreamFallbackOption",[JX],Object.getOwnPropertyDescriptor(s_.prototype,"setStreamFallbackOption"),s_.prototype),e_(s_.prototype,"setEncryptionConfig",[XX],Object.getOwnPropertyDescriptor(s_.prototype,"setEncryptionConfig"),s_.prototype),e_(s_.prototype,"renewToken",[QX],Object.getOwnPropertyDescriptor(s_.prototype,"renewToken"),s_.prototype),e_(s_.prototype,"enableAudioVolumeIndicator",[ZX],Object.getOwnPropertyDescriptor(s_.prototype,"enableAudioVolumeIndicator"),s_.prototype),e_(s_.prototype,"startLiveStreaming",[$X],Object.getOwnPropertyDescriptor(s_.prototype,"startLiveStreaming"),s_.prototype),e_(s_.prototype,"setLiveTranscoding",[tQ],Object.getOwnPropertyDescriptor(s_.prototype,"setLiveTranscoding"),s_.prototype),e_(s_.prototype,"stopLiveStreaming",[eQ],Object.getOwnPropertyDescriptor(s_.prototype,"stopLiveStreaming"),s_.prototype),e_(s_.prototype,"addInjectStreamUrl",[nQ],Object.getOwnPropertyDescriptor(s_.prototype,"addInjectStreamUrl"),s_.prototype),e_(s_.prototype,"removeInjectStreamUrl",[rQ],Object.getOwnPropertyDescriptor(s_.prototype,"removeInjectStreamUrl"),s_.prototype),e_(s_.prototype,"startChannelMediaRelay",[iQ],Object.getOwnPropertyDescriptor(s_.prototype,"startChannelMediaRelay"),s_.prototype),e_(s_.prototype,"updateChannelMediaRelay",[oQ],Object.getOwnPropertyDescriptor(s_.prototype,"updateChannelMediaRelay"),s_.prototype),e_(s_.prototype,"stopChannelMediaRelay",[sQ],Object.getOwnPropertyDescriptor(s_.prototype,"stopChannelMediaRelay"),s_.prototype),e_(s_.prototype,"sendCustomReportMessage",[aQ],Object.getOwnPropertyDescriptor(s_.prototype,"sendCustomReportMessage"),s_.prototype),e_(s_.prototype,"pickSVCLayer",[cQ],Object.getOwnPropertyDescriptor(s_.prototype,"pickSVCLayer"),s_.prototype),e_(s_.prototype,"setRTMConfig",[uQ],Object.getOwnPropertyDescriptor(s_.prototype,"setRTMConfig"),s_.prototype),e_(s_.prototype,"enableContentInspect",[dQ],Object.getOwnPropertyDescriptor(s_.prototype,"enableContentInspect"),s_.prototype),e_(s_.prototype,"disableContentInspect",[lQ],Object.getOwnPropertyDescriptor(s_.prototype,"disableContentInspect"),s_.prototype),e_(s_.prototype,"setImageModeration",[hQ],Object.getOwnPropertyDescriptor(s_.prototype,"setImageModeration"),s_.prototype),e_(s_.prototype,"setP2PTransport",[pQ],Object.getOwnPropertyDescriptor(s_.prototype,"setP2PTransport"),s_.prototype),e_(s_.prototype,"getJoinChannelServiceRecords",[fQ],Object.getOwnPropertyDescriptor(s_.prototype,"getJoinChannelServiceRecords"),s_.prototype),e_(s_.prototype,"setPublishAudioFilterEnabled",[mQ],Object.getOwnPropertyDescriptor(s_.prototype,"setPublishAudioFilterEnabled"),s_.prototype),s_);class rL{constructor(e,n){F(this,"id",0),F(this,"element",void 0),F(this,"peerPair",void 0),F(this,"context",void 0),F(this,"audioPlayerElement",void 0),F(this,"audioTrack",void 0),rL.count+=1,this.id=rL.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(o,a)=>{const d=a==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(d),o.iceGatheringState==="complete"?o.localDescription:new n_(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},n=async(o,a)=>await o.setRemoteDescription(a);try{const o=await e(this.peerPair[0],"offer");await n(this.peerPair[1],o);const a=await e(this.peerPair[1],"answer");await n(this.peerPair[0],a)}catch(o){throw new _s(Y.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(a){throw new _s(Y.LOCAL_AEC_ERROR,a.toString()).print()}if(!n)throw new _s(Y.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=n.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){A.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var _Q,MM;F(rL,"count",0);const _ft=window.AudioContext||window.webkitAudioContext,gft=new(_Q=C_({report:E_}),e_((MM=class{constructor(){F(this,"units",[]),F(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return A.debug("the system does not need to process local aec"),-1;this.context||(this.context=new _ft);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new rL(t,this.context),this.units.push(e)),e.startEchoCancellation(),A.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return Y_().name!==kv.SAFARI}}).prototype,"processExternalMediaAEC",[_Q],Object.getOwnPropertyDescriptor(MM.prototype,"processExternalMediaAEC"),MM.prototype),MM);function gQ(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function vQ(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?gQ(Object(n),!0).forEach(function(o){F(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gQ(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}const J3=window||document;function bQ(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!J3)return;const n=WT._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const o=a=>{if(!(a&&a.blockedURI&&(WT.onSecurityPolicyViolation||WT.getListeners(RR.SECURITY_POLICY_VIOLATION).length>0)))return;const d=a.blockedURI;$("CSP_DETECTED_HOSTNAME_LIST").some(h=>o_(d).call(d,h))&&(WT.onSecurityPolicyViolation&&typeof WT.onSecurityPolicyViolation=="function"&&WT.onSecurityPolicyViolation(a),WT.getListeners(RR.SECURITY_POLICY_VIOLATION).length>0&&WT.safeEmit(RR.SECURITY_POLICY_VIOLATION,a))};n&&J3.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||WT.getListeners(RR.SECURITY_POLICY_VIOLATION).length>0)&&J3.addEventListener("securitypolicyviolation",o),WT._cspEventHandlerPointer=o}rT("PROCESS_ID","process-".concat(sT(8,""),"-").concat(sT(4,""),"-").concat(sT(4,""),"-").concat(sT(4,""),"-").concat(sT(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void A.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();A.debug("Loading global parameters from cache",e),Object.keys(e).forEach(o=>{if(Object.prototype.hasOwnProperty.call(KT,o)){const{value:a,expires:d}=e[o];if(d&&d<=n)return;mI[o]=a,KT[o]=a}})}catch(e){A.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(mI.AREAS)&&mI.AREAS.length>0&&dG(mI.AREAS,!0);const yQ=(t,e,n)=>{A.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),rT(t,e,n)},WT=function(t){const e=new ET,n=t,o={getListeners:e.getListeners.bind(e),on:(a,d)=>(function(h,p){h===RR.SECURITY_POLICY_VIOLATION&&bQ(p,!0)}(a,d),e.on.bind(e)(a,d)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return vQ(vQ({},n),o)}({__TRACK_LIST__:bN,VERSION:E0,BUILD:YF,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:yQ,getParameter:$,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(o){let a;return q_().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),a=(await o.createOffer()).sdp):a=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,a}(e);if(!n)return t;e.close(),e=null,t=function(o){const a={video:[],audio:[]};return o.match(/ VP8/i)&&a.video.push("VP8"),o.match(/ VP9/i)&&a.video.push("VP9"),o.match(/ AV1/i)&&a.video.push("AV1"),o.match(/ H264/i)&&a.video.push("H264"),o.match(/ H265/i)&&a.video.push("H265"),o.match(/ opus/i)&&a.audio.push("OPUS"),o.match(/ PCMU/i)&&a.audio.push("PCMU"),o.match(/ PCMA/i)&&a.audio.push("PCMA"),o.match(/ G722/i)&&a.audio.push("G722"),a}(n)}catch(e){throw new _s(Y.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=E_.reportApiInvoke(null,{name:BT.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:IT.TRACER});let e=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;e=!!(d&&h&&p),e&&LF()&&function(m){const _=Y_();return!(_.name!==kv.CHROME||!_.osVersion)&&Number(_.version)<m}(75)&&new d().close()}catch(d){return A.error("check system requirement failed: ",d),!1}let n=!1;const o=Y_();o.name===kv.CHROME&&Number(o.version)>=58&&(tR.engine.name!=="WebKit"||function(){const d=Y_();if(m1()){if(d.os===QT.MAC_OS)return!0;if(d.os===QT.IOS){const h=tR.os.version&&tR.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(n=!0),(o.name===kv.FIREFOX&&Number(o.version)>=56||o.name===kv.OPERA&&Number(o.version)>=45||o.name===kv.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(ES()||P0())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||o8()||Y_().name===kv.QQ)&&(n=!0),A.debug("checkSystemRequirements, api:",e,"browser",n);const a=e&&n;return t.onSuccess(a),a},getDevices:function(t){return u0.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return u0.getRecordingDevices(t)},getCameras:function(t){return u0.getCamerasDevices(t)},getElectronScreenSources:YY,getPlaybackDevices:function(t){return u0.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=E_.reportApiInvoke(null,{name:BT.CREATE_CLIENT,options:[e],tag:IT.TRACER});try{(function(o){JT(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),JT(o.mode,"config.mode",["rtc","live","p2p"]),o.audioCodec!==void 0&&JT(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),o.proxyServer!==void 0&&cS(o.proxyServer,"config.proxyServer",1,1e4),o.turnServer!==void 0&&m8(o.turnServer),o.httpRetryConfig!==void 0&&f8(o.httpRetryConfig),o.websocketRetryConfig!==void 0&&f8(o.websocketRetryConfig)})(e)}catch(o){throw n.onError(o),o}return($4(16,0)||t8(16,0))&&(e.codec==="vp9"&&(e.codec="vp8",A.debug("browser not support vp9, force use vp8")),rT("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),n.onSuccess(),new Eft(R0(R0({forceWaitGatewayResponse:!0},e),{},{role:o_(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}))},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=$("CAMERA_CAPTURE_CONFIG"),n=E_.reportApiInvoke(null,{tag:IT.TRACER,name:BT.CREATE_CAM_VIDEO_TRACK,options:[_T({},t),e]});e&&(t.encoderConfig=e);const o=aM(t),a=sT(8,"track-cam-");let d=null;const h=t.encoderConfig==="720p_auto";A.info("start create camera video track with config",JSON.stringify(t),"trackId",a);try{d=(await c0({video:o},a)).getVideoTracks()[0]||null}catch(m){throw n.onError(m),m}if(!d){const m=new ya(Y.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(m),m.throw(A)}t.optimizationMode&&g3(a,d,t,NR(t.encoderConfig));const p=new _3(d,t,o,t.scalabiltyMode?rM(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a);return h&&p.startMonitorStats(),n.onSuccess(p.getTrackId()),A.info("create camera video success, trackId:",a),p},createCustomVideoTrack:function(t){const e=E_.reportApiInvoke(null,{tag:IT.TRACER,name:BT.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),n=new aT(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?rM(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,sT(8,"track-cus-"),[lT.CUSTOM_TRACK]);return e.onSuccess(n.getTrackId()),A.info("create custom video track success with config",t,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=E_.reportApiInvoke(null,{tag:IT.TRACER,name:BT.CREATE_SCREEN_VIDEO_TRACK,options:[_T({},t),e]}),o=t.encoderConfig==="720p_auto";t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const a=function(y){const C={};y.screenSourceType&&(C.mediaSource=y.screenSourceType),y.extensionId&&lI()&&(C.extensionId=y.extensionId);const{displaySurface:O,selfBrowserSurface:q,surfaceSwitching:L,systemAudio:U}=y;(PF(107)||Q4(107)||e8(93))&&(O&&(JT(O,"displaySurface",["browser","window","monitor"]),C.displaySurface=O),q?(JT(q,"selfBrowserSurface",["exclude","include"]),C.selfBrowserSurface=q):C.selfBrowserSurface="include",L&&(JT(L,"surfaceSwitching",["exclude","include"]),C.surfaceSwitching=L)),(PF(105)||Q4(105)||e8(91))&&U&&(JT(U,"systemAudio",["exclude","include"]),C.systemAudio=U),y.electronScreenSourceId&&(C.sourceId=y.electronScreenSourceId);const K=y.encoderConfig?s3(y.encoderConfig):null;return C.mandatory={chromeMediaSource:"desktop",maxWidth:K?K.width:void 0,maxHeight:K?K.height:void 0},K&&(K.frameRate&&(typeof K.frameRate=="number"?(C.mandatory.maxFrameRate=K.frameRate,C.mandatory.minFrameRate=K.frameRate):(C.mandatory.maxFrameRate=K.frameRate.max||K.frameRate.ideal||K.frameRate.exact||void 0,C.mandatory.minFrameRate=K.frameRate.min||K.frameRate.ideal||K.frameRate.exact||void 0),C.frameRate=K.frameRate),K.width&&(C.width=K.width),K.height&&(C.height=K.height)),C}(t),d=sT(8,"track-scr-v-");let h=null,p=null;const m=q_();if(!m.supportShareAudio&&e==="enable"){const y=new ya(Y.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(y),y.throw(A)}A.info("start create screen video track with config",t,"withAudio",e,"trackId",d);try{const y=await c0({screen:a,screenAudio:e==="auto"?m.supportShareAudio:e==="enable"},d);h=y.getVideoTracks()[0]||null,p=y.getAudioTracks()[0]||null}catch(y){throw n.onError(y),y}if(!h){const y=new ya(Y.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(y),y.throw(A)}if(!p&&e==="enable"){h&&h.stop();const y=new ya(Y.SHARE_AUDIO_NOT_ALLOWED);return n.onError(y),y.throw(A)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(g3(d,h,t,t.encoderConfig&&s3(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const _=new aT(h,t.encoderConfig?s3(t.encoderConfig):{},t.scalabiltyMode?rM(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,d,[lT.SCREEN_TRACK]);if(o&&_.startMonitorStats(),!p)return n.onSuccess(_.getTrackId()),A.info("create screen video track success","video:",_.getTrackId()),_;const g=new OT(p,void 0,sT(8,"track-scr-a-"),!1);return n.onSuccess([_.getTrackId(),g.getTrackId()]),A.info("create screen video track success","video:",_.getTrackId(),"audio:",g.getTrackId()),[_,g]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=$("CAMERA_CAPTURE_CONFIG"),o=E_.reportApiInvoke(null,{tag:IT.TRACER,name:BT.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const a=e.encoderConfig==="720p_auto",d=aM(e),h=i7(t),p=sT(8,"track-mic-"),m=sT(8,"track-cam-");let _=null,g=null;A.info("start create camera video track(".concat(m,") and microphone audio track(").concat(p,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const O=await c0({audio:h,video:d},"".concat(p,"-").concat(m));_=O.getAudioTracks()[0],g=O.getVideoTracks()[0]}catch(O){throw o.onError(O),O}if(!_||!g){const O=new ya(Y.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(O),O.throw(A)}e.optimizationMode&&g3(m,g,e,NR(e.encoderConfig));const y=new cM(_,t,h,p),C=new _3(g,e,d,e.scalabiltyMode?rM(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,m);return a&&C.startMonitorStats(),o.onSuccess([y.getTrackId(),C.getTrackId()]),A.info("create camera video track(".concat(m,") and microphone audio track(").concat(p,") success")),[y,C]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=E_.reportApiInvoke(null,{tag:IT.TRACER,name:BT.CREATE_MIC_AUDIO_TRACK,options:[t]}),n=i7(t),o=sT(8,"track-mic-");let a=null;A.info("start create microphone audio track with config",JSON.stringify(t),"trackId",o);try{a=(await c0({audio:n},o)).getAudioTracks()[0]||null}catch(h){throw e.onError(h),h}if(!a){const h=new ya(Y.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(h),h.throw(A)}const d=new cM(a,t,n,o);return e.onSuccess(d.getTrackId()),A.info("create microphone audio track success, trackId:",o),d},createCustomAudioTrack:function(t){const e=E_.reportApiInvoke(null,{tag:IT.TRACER,name:BT.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),n=new OT(t.mediaStreamTrack,t.encoderConfig?iM(t.encoderConfig):{},sT(8,"track-cus-"),!1);return A.info("create custom audio track success with config",t,"trackId",n.getTrackId()),e.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:o}=t;let{source:a}=t;const d={source:a instanceof AudioBuffer?"AudioBuffer":a instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":a,cacheOnlineFile:n,encoderConfig:o},h=E_.reportApiInvoke(null,{tag:IT.TRACER,name:BT.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if($("DISABLE_WEBAUDIO"))throw new ya(Y.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const p=sT(8,"track-buf-");A.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",p);const m=a;if(!(a instanceof AudioBuffer))try{a=await async function(y,C){let O=null;if(typeof y=="string"){const L=W7.get(y);if(L)return A.debug("use cached audio resource: ",y),L;try{O=(await eR(()=>MS.get(y,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(U){throw new ya(Y.FETCH_AUDIO_FILE_FAILED,U.toString())}}else O=await new n_((U,K)=>{const J=new FileReader;J.onload=_r=>{_r.target?U(_r.target.result):K(new ya(Y.READ_LOCAL_AUDIO_FILE_ERROR))},J.onerror=()=>{K(new ya(Y.READ_LOCAL_AUDIO_FILE_ERROR))},J.readAsArrayBuffer(y)});const q=await function(L){const U=CN();return new n_((K,J)=>{U.decodeAudioData(L,_r=>{K(_r)},_r=>{J(new ya(Y.DECODE_AUDIO_FILE_FAILED,_r.toString()))})})}(O);return typeof y=="string"&&C&&W7.set(y,q),q}(a,n)}catch(y){return h.onError(y),y.throw(A)}const _=new hpt(a),g=new lpt(m,_,o?iM(o):{},p);return A.info("create buffer source audio track success, trackId:",p),h.onSuccess(g.getTrackId()),g},setAppType:function(t){if(A.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw A.debug("Invalid appType"),new _s(Y.INVALID_PARAMS,"invalid app type",t);rT("APP_TYPE",Math.floor(t))},setLogLevel:function(t){A.setLogLevel(t)},enableLogUpload:function(){$("USE_NEW_LOG")?rT("UPLOAD_LOG",!0):A.enableLogUpload()},disableLogUpload:function(){$("USE_NEW_LOG")?rT("UPLOAD_LOG",!1):A.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new A9},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=E_.reportApiInvoke(null,{tag:IT.TRACER,name:BT.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof OT||t instanceof ON)){const m=new _s(Y.INVALID_TRACK,"the parameter is not a audio track");return n.onError(m),m.throw()}e&&e<1e3&&(e=1e3);const o=t instanceof OT?t.getTrackLabel():"remote_track",a=t.getVolumeLevel();let d=a,h=a;const p=Date.now();return new n_(m=>{const _=setInterval(()=>{const g=t.getVolumeLevel();d=g>d?g:d,h=g<h?g:h;const y=d-h>1e-4,C=Date.now()-p;if(y||C>e){clearInterval(_);const O=y,q={duration:C,deviceLabel:o,maxVolumeLevel:d,result:O};A.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(q))),n.onSuccess(q),m(O)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=E_.reportApiInvoke(null,{tag:IT.TRACER,name:BT.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof aT||t instanceof wN)){const y=new _s(Y.INVALID_TRACK,"the parameter is not a video track");return n.onError(y),y.throw()}e&&e<1e3&&(e=1e3);const o=t instanceof aT?t.getTrackLabel():"remote_track",a=t.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(ZT()||m1())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([a]),d.play();const h=document.createElement("canvas");h.width=160,h.height=120;let p=0,m=0;try{const y=Date.now();p=await function(C,O,q,L){let U,K=0,J=null;return new n_((_r,_o)=>{function na(){K>L&&U&&(U(),_r(K));const ba=q.getContext("2d");if(!ba){const _p=new _s(Y.UNEXPECTED_ERROR,"can not get canvas 2d context.");return A.error(_p.toString()),void _o(_p)}ba.drawImage(C,0,0,160,120);const _u=ba.getImageData(0,0,q.width,q.height),_l=Math.floor(_u.data.length/3);if(J){for(let _p=0;_p<_l;_p+=3)if(_u.data[_p]!==J[_p])return K+=1,void(J=_u.data);J=_u.data}else J=_u.data}setTimeout(()=>{U&&(U(),_r(K))},O),U=l3(()=>{na()},30)})}(d,e,h,4),m=Date.now()-y}catch(y){throw n.onError(y),y}hft===kv.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const _=p>4,g={duration:m,changedPicNum:p,deviceLabel:o,result:_};return A.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(g))),n.onSuccess(g),_},setArea:dG,audioElementPlayCenter:xS,resumeAudioContext:function(){xS.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){gft.processExternalMediaAEC(t)},registerExtensions:function(t){const e=$("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!o_(e).call(e,n.name)&&e.push(n.name);const o=n;o.__registered__=!0,o.logger.hookLog=A.extLog,o.reporter.hookApiInvoke=E_.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(a=>{o.parameters[a]=$(a)})}),yQ("PLUGIN_INFO",e)},ChannelMediaRelayError:nN,ChannelMediaRelayEvent:HR,ChannelMediaRelayState:FS,RemoteStreamFallbackType:ipt,RemoteStreamType:rpt,ConnectionDisconnectedReason:B_,AudienceLatencyLevelType:Eut,AREAS:Z_,preload:async function(t,e,n,o){return yX(t,e,n,o)}});return Object.defineProperties(WT,{onAudioAutoplayFailed:{get:()=>d0.onAudioAutoplayFailed,set:t=>{d0.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>d0.onAutoplayFailed,set:t=>{d0.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>WT._onSecurityPolicyViolation,set(t){WT._onSecurityPolicyViolation=t,bQ(t)}},__CLIENT_LIST__:{get:()=>$("SHOW_GLOBAL_CLIENT_LIST")?EI:[]}}),u0.on(fO.CAMERA_DEVICE_CHANGED,t=>{A.info("camera device changed",JSON.stringify(t)),WT.onCameraChanged&&WT.onCameraChanged(t),WT.safeEmit(RR.CAMERA_CHANGED,t)}),u0.on(fO.RECORDING_DEVICE_CHANGED,t=>{A.info("microphone device changed",JSON.stringify(t)),WT.onMicrophoneChanged&&WT.onMicrophoneChanged(t),WT.safeEmit(RR.MICROPHONE_CHANGED,t)}),u0.on(fO.PLAYOUT_DEVICE_CHANGED,t=>{A.debug("playout device changed",JSON.stringify(t)),WT.onPlaybackDeviceChanged&&WT.onPlaybackDeviceChanged(t),WT.safeEmit(RR.PLAYBACK_DEVICE_CHANGED,t)}),xS.onAutoplayFailed=()=>{A.info("detect audio element autoplay failed"),d0.onAudioAutoplayFailed&&d0.onAudioAutoplayFailed()},tT.on("autoplay-failed",()=>{A.info("detect webaudio autoplay failed"),d0.onAudioAutoplayFailed&&d0.onAudioAutoplayFailed(),WT.safeEmit(RR.AUTOPLAY_FAILED)}),tT.on(uS.STATE_CHANGE,(t,e)=>{A.info("audio context state changed: ".concat(e," => ").concat(t)),WT.onAudioContextStateChanged&&WT.onAudioContextStateChanged(t,e),WT.safeEmit(RR.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),wT.on(XI.NETWORK_STATE_CHANGE,(t,e)=>{A.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=WT),WT})})(AgoraRTC_NProduction);var AgoraRTC_NProductionExports=AgoraRTC_NProduction.exports;const AgoraRTC=getDefaultExportFromCjs(AgoraRTC_NProductionExports);var agoraRtmSdk={exports:{}};agoraRtmSdk.exports;(function(module,exports){var define_process_env_default={};/*
 @preserve
 AgoraRTM Web SDK 1.5.1 - commit: v1.5.1-0-g5bbbcd72
 Copyright (C) 2018-2022 Agora Lab.
 This file is licensed under the AGORA, INC. SDK LICENSE AGREEMENT
 A copy of this license may be found at https://www.agora.io/en/sdk-license-agreement/
*/(function(i,r){module.exports=r()})(commonjsGlobal,function(){function Be(i,r){var s=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);r&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),s.push.apply(s,u)}return s}function Wa(i){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Be(Object(s),!0).forEach(function(u){x(i,u,s[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(s)):Be(Object(s)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(s,u))})}return i}function qa(i){return(qa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(i)}function wm(i,r,s,u,l,f,E){try{var T=i[f](E),v=T.value}catch(w){return void s(w)}T.done?r(v):Promise.resolve(v).then(u,l)}function ma(i){return function(){var r=this,s=arguments;return new Promise(function(u,l){function f(v){wm(T,u,l,f,E,"next",v)}function E(v){wm(T,u,l,f,E,"throw",v)}var T=i.apply(r,s);f(void 0)})}}function va(i,r){if(!(i instanceof r))throw new TypeError("Cannot call a class as a function")}function xm(i,r){for(var s=0;s<r.length;s++){var u=r[s];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}function eb(i,r,s){return r&&xm(i.prototype,r),s&&xm(i,s),i}function x(i,r,s){return r in i?Object.defineProperty(i,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[r]=s,i}function Ga(i,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(r&&r.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),r&&Jf(i,r)}function Td(i){return(Td=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)})(i)}function Jf(i,r){return(Jf=Object.setPrototypeOf||function(s,u){return s.__proto__=u,s})(i,r)}function ym(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ji(i,r,s){return(Ji=ym()?Reflect.construct:function(u,l,f){var E=[null];return E.push.apply(E,l),u=new(Function.bind.apply(u,E)),f&&Jf(u,f.prototype),u}).apply(null,arguments)}function Kf(i){var r=typeof Map=="function"?new Map:void 0;return(Kf=function(s){function u(){return Ji(s,arguments,Td(this).constructor)}if(s===null||Function.toString.call(s).indexOf("[native code]")===-1)return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(r!==void 0){if(r.has(s))return r.get(s);r.set(s,u)}return u.prototype=Object.create(s.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),Jf(u,s)})(i)}function Ki(i,r){if(i==null)return{};if(i==null)var s={};else{s={};var u,l=Object.keys(i);for(u=0;u<l.length;u++){var f=l[u];0<=r.indexOf(f)||(s[f]=i[f])}}if(Object.getOwnPropertySymbols)for(u=Object.getOwnPropertySymbols(i),f=0;f<u.length;f++)l=u[f],0<=r.indexOf(l)||Object.prototype.propertyIsEnumerable.call(i,l)&&(s[l]=i[l]);return s}function z(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Ha(i){var r=ym();return function(){var s=Td(i);if(r){var u=Td(this).constructor;s=Reflect.construct(s,arguments,u)}else s=s.apply(this,arguments);return s=!s||typeof s!="object"&&typeof s!="function"?z(this):s}}function Li(i,r,s){return(Li=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(u,l,f){for(;!Object.prototype.hasOwnProperty.call(u,l)&&(u=Td(u))!==null;);if(u)return(l=Object.getOwnPropertyDescriptor(u,l)).get?l.get.call(f):l.value})(i,r,s||i)}function $a(i,r){var s=Array.isArray(i)?i:void 0;if(!s)if((s=i&&(typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"]))==null)s=void 0;else{var u,l=[],f=!0,E=!1;try{for(s=s.call(i);!(f=(u=s.next()).done)&&(l.push(u.value),!r||l.length!==r);f=!0);}catch(v){E=!0;var T=v}finally{try{f||s.return==null||s.return()}finally{if(E)throw T}}s=l}if(!(i=s||zm(i,r)))throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return i}function Z(i){var r=Array.isArray(i)?Mi(i):void 0;if(r||(r=typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null?Array.from(i):void 0),!(i=r||zm(i)))throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return i}function zm(i,r){if(i){if(typeof i=="string")return Mi(i,r);var s=Object.prototype.toString.call(i).slice(8,-1);if(s==="Object"&&i.constructor&&(s=i.constructor.name),s==="Map"||s==="Set")return Array.from(i);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Mi(i,r)}}function Mi(i,r){(r==null||r>i.length)&&(r=i.length);for(var s=0,u=Array(r);s<r;s++)u[s]=i[s];return u}function Da(i,r,s,u,l){var f={};return Object.keys(u).forEach(function(E){f[E]=u[E]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=s.slice().reverse().reduce(function(E,T){return T(i,r,E)||E},f),l&&f.initializer!==void 0&&(f.value=f.initializer?f.initializer.call(l):void 0,f.initializer=void 0),f.initializer===void 0&&(Object.defineProperty(i,r,f),f=null),f}function xb(i){var r={exports:{}};return i(r,r.exports),r.exports}function Ce(i){i||(i={});var r=i.ua;if(r||typeof navigator>"u"||(r=navigator.userAgent),r&&r.headers&&typeof r.headers["user-agent"]=="string"&&(r=r.headers["user-agent"]),typeof r!="string")return!1;var s=Zt.test(r)&&!$t.test(r)||!!i.tablet&&au.test(r);return!s&&i.tablet&&i.featureDetect&&navigator&&1<navigator.maxTouchPoints&&r.indexOf("Macintosh")!==-1&&r.indexOf("Safari")!==-1&&(s=!0),s}function Am(i,r){var s,u=3>arguments.length?i:arguments[2];return Ia(i)===u?i[r]:(s=dc.f(i,r))?ka(s,"value")?s.value:s.get===void 0?void 0:s.get.call(u):xa(s=uc(i))?Am(s,r,u):void 0}function bu(i){var r=i.charCodeAt(0)<<24,s=0|cu(~r),u=0,l=0|i.length,f="";if(5>s&&l>=s){for(r=r<<s>>>24+s,u=1;u<s;u=u+1|0)r=r<<6|63&i.charCodeAt(u);65535>=r?f+=Ud(r):1114111>=r?f+=Ud(55296+((r=r-65536|0)>>10)|0,56320+(1023&r)|0):u=0}for(;u<l;u=u+1|0)f+="ï¿½";return f}function Bm(){}function du(i){var r=0|i.charCodeAt(0);if(55296<=r&&56319>=r){var s=0|i.charCodeAt(1);if(!(s==s&&56320<=s&&57343>=s))return Ud(239,191,189);if(65535<(r=(r-55296<<10)+s-56320+65536|0))return Ud(240|r>>>18,128|r>>>12&63,128|r>>>6&63,128|63&r)}return 127>=r?i:2047>=r?Ud(192|r>>>6,128|63&r):Ud(224|r>>>12,128|r>>>6&63,128|63&r)}function Cm(){}function Ba(){Ba.init.call(this)}function Wg(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+qa(i))}function Dm(i,r,s,u){Wg(s);var l=i._events;if(l===void 0)l=i._events=Object.create(null),i._eventsCount=0;else{l.newListener!==void 0&&(i.emit("newListener",r,s.listener?s.listener:s),l=i._events);var f=l[r]}return f===void 0?(l[r]=s,++i._eventsCount):(typeof f=="function"?f=l[r]=u?[s,f]:[f,s]:u?f.unshift(s):f.push(s),0<(s=i._maxListeners===void 0?Ba.defaultMaxListeners:i._maxListeners)&&f.length>s&&!f.warned&&(f.warned=!0,(s=Error("Possible EventEmitter memory leak detected. "+f.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",s.emitter=i,s.type=r,s.count=f.length,console&&console.warn&&console.warn(s))),i}function eu(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Em(i,r,s){return i={fired:!1,wrapFn:void 0,target:i,type:r,listener:s},(r=eu.bind(i)).listener=s,i.wrapFn=r}function Fm(i,r,s){if((i=i._events)===void 0)return[];if((r=i[r])===void 0)return[];if(typeof r=="function")return s?[r.listener||r]:[r];if(s)for(s=Array(r.length),i=0;i<s.length;++i)s[i]=r[i].listener||r[i];else s=Gm(r,r.length);return s}function Hm(i){var r=this._events;if(r!==void 0){if(typeof(i=r[i])=="function")return 1;if(i!==void 0)return i.length}return 0}function Gm(i,r){for(var s=Array(r),u=0;u<r;++u)s[u]=i[u];return s}function fu(i,r,s){typeof i.on=="function"&&Im(i,"error",r,s)}function Im(i,r,s,u){if(typeof i.on=="function")u.once?i.once(r,s):i.on(r,s);else{if(typeof i.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+qa(i));i.addEventListener(r,function l(f){u.once&&i.removeEventListener(r,l),s(f)})}}function gu(i){return i?Z(i):hu(function(){return[]},function(r,s){return r.push(s),r})}function Jm(i,r){var s,u,l,f;return N.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:s=Km(i)([Lm,Lm,function(T,v){return v}])[2],u=0;case 2:if(!(u<r.length)){E.next=17;break}if(l=r[u],!((f=s(Ni,l))instanceof Xg)){E.next=11;break}if((f=Oi(f.deref()))===Ni){E.next=10;break}return E.next=10,f;case 10:return E.abrupt("return");case 11:if(f===Ni){E.next=14;break}return E.next=14,f;case 14:u++,E.next=2;break;case 17:case"end":return E.stop()}},iu)}function Yg(i,r){return r!=null&&typeof r[Symbol.iterator]=="function"?Jm(Yg(i),r):function(s){var u=s[2];return ju(s,function(l,f){return u(l,i(f))})}}function $c(i){return Object.prototype.toString.call(i).slice(8,-1)}function De(i){return $c(i)==="Object"&&i.constructor===Object&&Object.getPrototypeOf(i)===Object.prototype}function Mm(i){var r;return(r=$c(i)==="Boolean"||$c(i)==="Null"||$c(i)==="Undefined")||(r=$c(i)==="Number"&&!isNaN(i)),r||$c(i)==="String"||$c(i)==="Symbol"}function Vd(i){var r=-1,s=i==null?0:i.length;for(this.clear();++r<s;){var u=i[r];this.set(u[0],u[1])}}function Ee(i){var r=-1,s=i==null?0:i.length;for(this.clear();++r<s;){var u=i[r];this.set(u[0],u[1])}}function Fe(i){var r=-1,s=i==null?0:i.length;for(this.clear();++r<s;){var u=i[r];this.set(u[0],u[1])}}function Lf(i){var r=-1,s=i==null?0:i.length;for(this.__data__=new Zg;++r<s;)this.add(i[r])}function Ge(i){this.size=(this.__data__=new $g(i)).size}function He(i,r,s,u,l,f){var E,T=1&r,v=2&r,w=4&r;if(s&&(E=l?s(i,u,l,f):s(i)),E!==void 0)return E;if(!Gb(i))return i;if(u=ub(i)){if(E=ku(i),!T)return Pi(i,E)}else{var k=Mf(i),B=k=="[object Function]"||k=="[object GeneratorFunction]";if(Nf(i))return Nm(i,T);if(k=="[object Object]"||k=="[object Arguments]"||B&&!l){if(E=v||B?{}:Om(i),!T)return v?lu(i,mu(E,i)):nu(i,ou(E,i))}else{if(!Oa[k])return l?i:{};E=pu(i,k,T)}}if(f||(f=new Ie),l=f.get(i))return l;f.set(i,E),qu(i)?i.forEach(function(X){E.add(He(X,r,s,X,i,f))}):ru(i)&&i.forEach(function(X,_e){E.set(_e,He(X,r,s,_e,i,f))}),v=w?v?Pm:Qi:v?Of:Wd;var Q=u?void 0:v(i);return su(Q||i,function(X,_e){Q&&(X=i[_e=X]),Qm(E,_e,He(X,r,s,_e,i,f))}),E}function Ri(i,r){if(typeof i!="function"||r!=null&&typeof r!="function")throw new TypeError("Expected a function");var s=function u(){var l=arguments,f=r?r.apply(this,l):l[0],E=u.cache;return E.has(f)?E.get(f):(l=i.apply(this,l),u.cache=E.set(f,l)||E,l)};return s.cache=new(Ri.Cache||Zg),s}function Rm(i){if(typeof i=="string")return i;if(ub(i))return Je(i,Rm)+"";if(Ke(i))return Sm?Sm.call(i):"";var r=i+"";return r=="0"&&1/i==-tu?"-0":r}function Si(i,r,s,u,l){var f=-1,E=i.length;for(s||(s=uu),l||(l=[]);++f<E;){var T=i[f];s(T)?Ti(l,T):l[l.length]=T}return l}function Le(i,r,s,u,l){if(i===r)r=!0;else if(i==null||r==null||!Hc(i)&&!Hc(r))r=i!=i&&r!=r;else t:{var f=ub(i),E=ub(r),T=f?"[object Array]":Mf(i),v=E?"[object Array]":Mf(r),w=(T=T=="[object Arguments]"?"[object Object]":T)=="[object Object]";if(E=(v=v=="[object Arguments]"?"[object Object]":v)=="[object Object]",(v=T==v)&&Nf(i)){if(!Nf(r)){r=!1;break t}f=!0,w=!1}if(v&&!w)l||(l=new Ie),r=f||Ui(i)?Tm(i,r,s,u,Le,l):vu(i,r,T,s,u,Le,l);else{if(!(1&s)&&(f=w&&Um.call(i,"__wrapped__"),T=E&&Um.call(r,"__wrapped__"),f||T)){i=f?i.value():i,r=T?r.value():r,l||(l=new Ie),r=Le(i,r,s,u,l);break t}if(v)e:if(l||(l=new Ie),f=1&s,T=Qi(i),E=T.length,v=Qi(r).length,E==v||f){for(v=E;v--;){var k=T[v];if(!(f?k in r:wu.call(r,k))){r=!1;break e}}if(w=l.get(i),k=l.get(r),w&&k)r=w==r&&k==i;else{w=!0,l.set(i,r),l.set(r,i);for(var B=f;++v<E;){var Q=i[k=T[v]],X=r[k];if(u)var _e=f?u(X,Q,k,r,i,l):u(Q,X,k,i,r,l);if(_e===void 0?Q!==X&&!Le(Q,X,s,u,l):!_e){w=!1;break}B||(B=k=="constructor")}w&&!B&&(s=i.constructor)!=(u=r.constructor)&&"constructor"in i&&"constructor"in r&&!(typeof s=="function"&&s instanceof s&&typeof u=="function"&&u instanceof u)&&(w=!1),l.delete(i),l.delete(r),r=w}}else r=!1;else r=!1}}return r}function Pa(i,r,s){this.low=0|i,this.high=0|r,this.unsigned=!!s}function Hb(i){return(i&&i.__isLong__)===!0}function Xd(i,r){var s;if(r){if((r=0<=(i>>>=0)&&256>i)&&(s=Vm[i]))return s;s=Qa(i,0>(0|i)?-1:0,!0),r&&(Vm[i]=s)}else{if((r=-128<=(i|=0)&&128>i)&&(s=Wm[i]))return s;s=Qa(i,0>i?-1:0,!1),r&&(Wm[i]=s)}return s}function ec(i,r){if(isNaN(i))return r?Yd:fc;if(r){if(0>i)return Yd;if(i>=Xm)return Ym}else{if(i<=-Zm)return Ib;if(i+1>=Zm)return $m}return 0>i?ec(-i,r).neg():Qa(i%Me|0,i/Me|0,r)}function Qa(i,r,s){return new Pa(i,r,s)}function Vi(i,r,s){if(i.length===0)throw Error("empty string");if(i==="NaN"||i==="Infinity"||i==="+Infinity"||i==="-Infinity")return fc;if(typeof r=="number"?(s=r,r=!1):r=!!r,2>(s=s||10)||36<s)throw RangeError("radix");var u;if(0<(u=i.indexOf("-")))throw Error("interior hyphen");if(u===0)return Vi(i.substring(1),r,s).neg();u=ec(ah(s,8));for(var l=fc,f=0;f<i.length;f+=8){var E=Math.min(8,i.length-f),T=parseInt(i.substring(f,f+E),s);8>E?(E=ec(ah(s,E)),l=l.mul(E).add(ec(T))):l=(l=l.mul(u)).add(ec(T))}return l.unsigned=r,l}function vc(i,r){return typeof i=="number"?ec(i,r):typeof i=="string"?Vi(i,r):Qa(i.low,i.high,typeof r=="boolean"?r:i.unsigned)}function ha(i,r){function s(){this.constructor=i}Wi(i,r),i.prototype=r===null?Object.create(r):(s.prototype=r.prototype,new s)}function Ne(i){return typeof i=="function"}function Oe(i){setTimeout(function(){throw i},0)}function Xi(i){return i!==null&&qa(i)==="object"}function an(i){return i.reduce(function(r,s){return r.concat(s instanceof Pf?s.errors:s)},[])}function Yi(i){for(;i;){var r=i.destination,s=i.isStopped;if(i.closed||s)return!1;i=r&&r instanceof za?r:null}return!0}function wd(i){return i}function Zi(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return bn(i)}function bn(i){return i.length===0?wd:i.length===1?i[0]:function(r){return i.reduce(function(s,u){return u(s)},r)}}function cn(i){if(i||(i=gc.Promise||Promise),!i)throw Error("no Promise impl found");return i}function dn(){return function(i){return i.lift(new xu(i))}}function Qf(i){return i?yu(i):Sb}function yu(i){return new ua(function(r){return i.schedule(function(){return r.complete()})})}function ad(i){return i&&typeof i.schedule=="function"}function $i(i,r){return new ua(function(s){var u=new nb,l=0;return u.add(r.schedule(function(){l===i.length?s.complete():(s.next(i[l++]),s.closed||u.add(this.schedule()))})),u})}function Rf(i,r){return r?$i(i,r):new ua(en(i))}function ob(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return ad(r=i[i.length-1])?(i.pop(),$i(i,r)):Rf(i)}function ra(i,r){return new ua(r?function(s){return r.schedule(zu,0,{error:i,subscriber:s})}:function(s){return s.error(i)})}function zu(i){i.subscriber.error(i.error)}function Au(i,r){return r===void 0&&(r=0),function(s){return s.lift(new Bu(i,r))}}function fn(i){return i in aj&&(delete aj[i],!0)}function Ic(){}function Ea(i,r){return function(s){if(typeof i!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return s.lift(new Cu(i,r))}}function gn(i,r,s){if(r){if(!ad(r))return function(){for(var u=[],l=0;l<arguments.length;l++)u[l]=arguments[l];return gn(i,s).apply(void 0,u).pipe(Ea(function(f){return hc(f)?r.apply(void 0,f):r(f)}))};s=r}return function(){for(var u=[],l=0;l<arguments.length;l++)u[l]=arguments[l];var f,E=this,T={context:E,subject:f,callbackFunc:i,scheduler:s};return new ua(function(v){if(s)return s.schedule(Du,0,{args:u,subscriber:v,params:T});if(!f){f=new Sf;try{i.apply(E,u.concat([function(){for(var w=[],k=0;k<arguments.length;k++)w[k]=arguments[k];f.next(1>=w.length?w[0]:w),f.complete()}]))}catch(w){Yi(f)?f.error(w):console.warn(w)}}return f.subscribe(v)})}}function Du(i){var r=this,s=i.args,u=i.subscriber,l=i.params;i=l.callbackFunc;var f=l.context,E=l.scheduler,T=l.subject;if(!T){T=l.subject=new Sf,l=function(){for(var v=[],w=0;w<arguments.length;w++)v[w]=arguments[w];r.add(E.schedule(Eu,0,{value:1>=v.length?v[0]:v,subject:T}))};try{i.apply(f,s.concat([l]))}catch(v){T.error(v)}}this.add(T.subscribe(u))}function Eu(i){var r=i.subject;r.next(i.value),r.complete()}function hn(i,r,s){if(r){if(!ad(r))return function(){for(var u=[],l=0;l<arguments.length;l++)u[l]=arguments[l];return hn(i,s).apply(void 0,u).pipe(Ea(function(f){return hc(f)?r.apply(void 0,f):r(f)}))};s=r}return function(){for(var u=[],l=0;l<arguments.length;l++)u[l]=arguments[l];var f={subject:void 0,args:u,callbackFunc:i,scheduler:s,context:this};return new ua(function(E){var T=f.context,v=f.subject;if(s)return s.schedule(Fu,0,{params:f,subscriber:E,context:T});if(!v){v=f.subject=new Sf;try{i.apply(T,u.concat([function(){for(var w=[],k=0;k<arguments.length;k++)w[k]=arguments[k];(k=w.shift())?v.error(k):(v.next(1>=w.length?w[0]:w),v.complete())}]))}catch(w){Yi(v)?v.error(w):console.warn(w)}}return v.subscribe(E)})}}function Fu(i){var r=this,s=i.params,u=i.subscriber;i=i.context;var l=s.callbackFunc,f=s.args,E=s.scheduler,T=s.subject;if(!T){T=s.subject=new Sf,s=function(){for(var v=[],w=0;w<arguments.length;w++)v[w]=arguments[w];(w=v.shift())?r.add(E.schedule(jn,0,{err:w,subject:T})):r.add(E.schedule(Gu,0,{value:1>=v.length?v[0]:v,subject:T}))};try{l.apply(i,f.concat([s]))}catch(v){this.add(E.schedule(jn,0,{err:v,subject:T}))}}this.add(T.subscribe(u))}function Gu(i){var r=i.subject;r.next(i.value),r.complete()}function jn(i){i.subject.error(i.err)}function kn(i){return!!i&&typeof i.subscribe!="function"&&typeof i.then=="function"}function bj(i,r,s,u,l){if(l===void 0&&(l=new Hu(i,s,u)),!l.closed)return r instanceof ua?r.subscribe(l):Tf(r)(l)}function Iu(i,r){return new ua(function(s){var u=new nb;return u.add(r.schedule(function(){var l=i[Pe]();u.add(l.subscribe({next:function(f){u.add(r.schedule(function(){return s.next(f)}))},error:function(f){u.add(r.schedule(function(){return s.error(f)}))},complete:function(){u.add(r.schedule(function(){return s.complete()}))}}))})),u})}function Ju(i,r){return new ua(function(s){var u=new nb;return u.add(r.schedule(function(){return i.then(function(l){u.add(r.schedule(function(){s.next(l),u.add(r.schedule(function(){return s.complete()}))}))},function(l){u.add(r.schedule(function(){return s.error(l)}))})})),u})}function Ku(i,r){if(!i)throw Error("Iterable cannot be null");return new ua(function(s){var u,l=new nb;return l.add(function(){u&&typeof u.return=="function"&&u.return()}),l.add(r.schedule(function(){u=i[xd](),l.add(r.schedule(function(){if(!s.closed){try{var f=u.next(),E=f.value,T=f.done}catch(v){return void s.error(v)}T?s.complete():(s.next(E),this.schedule())}}))})),l})}function ln(i,r){if(i!=null){if(i&&typeof i[Pe]=="function")return Iu(i,r);if(kn(i))return Ju(i,r);if(mn(i))return $i(i,r);if(i&&typeof i[xd]=="function"||typeof i=="string")return Ku(i,r)}throw new TypeError((i!==null&&qa(i)||i)+" is not observable")}function Jc(i,r){return r?ln(i,r):i instanceof ua?i:new ua(Tf(i))}function bd(i,r){if(!r.closed){if(i instanceof ua)return i.subscribe(r);try{var s=Tf(i)(r)}catch(u){r.error(u)}return s}}function Cb(i,r,s){return s===void 0&&(s=Number.POSITIVE_INFINITY),typeof r=="function"?function(u){return u.pipe(Cb(function(l,f){return Jc(i(l,f)).pipe(Ea(function(E,T){return r(l,E,f,T)}))},s))}:(typeof r=="number"&&(s=r),function(u){return u.lift(new Lu(i,s))})}function bh(i){return i===void 0&&(i=Number.POSITIVE_INFINITY),Cb(wd,i)}function nn(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return bh(1)(ob.apply(void 0,i))}function yd(i){return new ua(function(r){try{var s=i()}catch(u){return void r.error(u)}return(s?Jc(s):Qf()).subscribe(r)})}function ch(i,r){return new ua(function(s){var u=i.length;if(u===0)s.complete();else for(var l=Array(u),f=0,E=0,T=function(w){var k=Jc(i[w]),B=!1;s.add(k.subscribe({next:function(Q){B||(B=!0,E++),l[w]=Q},error:function(Q){return s.error(Q)},complete:function(){++f!==u&&B||(E===u&&s.next(r?r.reduce(function(Q,X,_e){return Q[X]=l[_e],Q},{}):l),s.complete())}}))},v=0;v<u;v++)T(v)})}function Db(i,r,s,u){return Ne(s)&&(u=s,s=void 0),u?Db(i,r,s).pipe(Ea(function(l){return hc(l)?u.apply(void 0,l):u(l)})):new ua(function(l){on(i,r,function(f){1<arguments.length?l.next(Array.prototype.slice.call(arguments)):l.next(f)},l,s)})}function on(i,r,s,u,l){if(i&&typeof i.addEventListener=="function"&&typeof i.removeEventListener=="function"){i.addEventListener(r,s,l);var f=function(){return i.removeEventListener(r,s,l)}}else if(i&&typeof i.on=="function"&&typeof i.off=="function")i.on(r,s),f=function(){return i.off(r,s)};else if(i&&typeof i.addListener=="function"&&typeof i.removeListener=="function")i.addListener(r,s),f=function(){return i.removeListener(r,s)};else{if(!i||!i.length)throw new TypeError("Invalid event target");for(var E=0,T=i.length;E<T;E++)on(i[E],r,s,u,l)}u.add(f)}function pn(i,r,s){return s?pn(i,r).pipe(Ea(function(u){return hc(u)?s.apply(void 0,u):s(u)})):new ua(function(u){var l=function(){for(var E=[],T=0;T<arguments.length;T++)E[T]=arguments[T];return u.next(E.length===1?E[0]:E)};try{var f=i(l)}catch(E){return void u.error(E)}if(Ne(r))return function(){return r(l,f)}})}function Mu(i){var r=i.subscriber,s=i.condition;if(!r.closed){if(i.needIterate)try{i.state=i.iterate(i.state)}catch(f){return void r.error(f)}else i.needIterate=!0;if(s){var u=void 0;try{u=s(i.state)}catch(f){return void r.error(f)}if(!u)return void r.complete();if(r.closed)return}try{var l=i.resultSelector(i.state)}catch(f){return void r.error(f)}if(!r.closed&&(r.next(l),!r.closed))return this.schedule(i)}}function cj(i){return!hc(i)&&0<=i-parseFloat(i)+1}function Qe(i,r){return i===void 0&&(i=0),r===void 0&&(r=cd),(!cj(i)||0>i)&&(i=0),r&&typeof r.schedule=="function"||(r=cd),new ua(function(s){return s.add(r.schedule(Nu,i,{subscriber:s,counter:0,period:i})),s})}function Nu(i){var r=i.subscriber,s=i.counter;i=i.period,r.next(s),this.schedule({subscriber:r,counter:s+1,period:i},i)}function Jb(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];r=Number.POSITIVE_INFINITY;var s=null,u=i[i.length-1];return ad(u)?(s=i.pop(),1<i.length&&typeof i[i.length-1]=="number"&&(r=i.pop())):typeof u=="number"&&(r=i.pop()),s===null&&i.length===1&&i[0]instanceof ua?i[0]:bh(r)(Rf(i,s))}function dj(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];if(i.length===0)return Sb;var s=i[0],u=i.slice(1);return i.length===1&&hc(s)?dj.apply(void 0,s):new ua(function(l){var f=function(){return l.add(dj.apply(void 0,u).subscribe(l))};return Jc(s).subscribe({next:function(E){l.next(E)},error:f,complete:f})})}function Ou(i){var r=i.keys,s=i.index,u=i.subscriber,l=i.subscription;if(i=i.obj,!u.closed)if(s<r.length){var f=r[s];u.next([f,i[f]]),l.add(this.schedule({keys:r,index:s+1,subscriber:u,subscription:l,obj:i}))}else u.complete()}function Pu(i,r){function s(){return!s.pred.apply(s.thisArg,arguments)}return s.pred=i,s.thisArg=r,s}function yb(i,r){return function(s){return s.lift(new Qu(i,r))}}function fb(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];if(i.length===1){if(!hc(i[0]))return i[0];i=i[0]}return Rf(i,void 0).lift(new Ru)}function Su(i){var r=i.start,s=i.index,u=i.subscriber;s>=i.count?u.complete():(u.next(r),u.closed||(i.index=s+1,i.start=r+1,this.schedule(i)))}function dd(i,r,s){i===void 0&&(i=0);var u=-1;return cj(r)?u=1>Number(r)?1:Number(r):ad(r)&&(s=r),ad(s)||(s=cd),new ua(function(l){var f=cj(i)?i:+i-s.now();return s.schedule(Tu,f,{index:0,period:u,subscriber:l})})}function Tu(i){var r=i.index,s=i.period,u=i.subscriber;if(u.next(r),!u.closed){if(s===-1)return u.complete();i.index=r+1,this.schedule(i,s)}}function ej(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return typeof(r=i[i.length-1])=="function"&&i.pop(),Rf(i,void 0).lift(new Uu(r))}function dh(i){var r=arguments.length,s=cd;ad(arguments[arguments.length-1])&&(s=arguments[arguments.length-1],r--);var u=null;2<=r&&(u=arguments[1]);var l=Number.POSITIVE_INFINITY;return 3<=r&&(l=arguments[2]),function(f){return f.lift(new Vu(i,u,l,s))}}function qn(i){var r=i.subscriber,s=i.context;s&&r.closeContext(s),r.closed||(i.context=r.openContext(),i.context.closeAction=this.schedule(i,i.bufferTimeSpan))}function Wu(i){var r=i.bufferCreationInterval,s=i.bufferTimeSpan,u=i.subscriber,l=i.scheduler,f=u.openContext();u.closed||(u.add(f.closeAction=l.schedule(rn,s,{subscriber:u,context:f})),this.schedule(i,r))}function rn(i){i.subscriber.closeContext(i.context)}function ab(i){return function(r){var s=new Xu(i);return r=r.lift(s),s.caught=r}}function fj(i,r){return Cb(i,r,1)}function sn(i){return i===void 0&&(i=null),function(r){return r.lift(new Yu(i))}}function Zd(i,r){r===void 0&&(r=cd);var s=i instanceof Date&&!isNaN(+i)?+i-r.now():Math.abs(i);return function(u){return u.lift(new Zu(s,r))}}function tn(i,r){return function(s){return s.lift(new $u(i,r))}}function $d(i){return i===void 0&&(i=av),function(r){return r.lift(new bv(i))}}function av(){return new eh}function hb(i){return function(r){return i===0?Qf():r.lift(new cv(i))}}function fh(i){return function(r){return r.lift(new dv(i))}}function Ca(i,r){var s=2<=arguments.length;return function(u){return u.pipe(i?yb(function(l,f){return i(l,f,u)}):wd,hb(1),s?sn(r):$d(function(){return new eh}))}}function ev(){return function(i){return i.lift(new fv)}}function un(i){return function(r){return i===0?Qf():r.lift(new gv(i))}}function Uf(i){return function(r){return r.lift(new hv(i))}}function gh(i,r){var s=!1;return 2<=arguments.length&&(s=!0),function(u){return u.lift(new iv(i,r,s))}}function vn(i,r){return 2<=arguments.length?function(s){return Zi(gh(i,r),un(1),sn(r))(s)}:function(s){return Zi(gh(function(u,l,f){return i(u,l,f+1)}),un(1))(s)}}function jv(i,r){return function(s){var u=typeof i=="function"?i:function(){return i},l=Object.create(s,lv);return l.source=s,l.subjectFactory=u,l}}function Re(i){return function(r){return r.lift(new mv(i,r))}}function nv(){return new rb}function Se(){return function(i){return dn()(jv(nv)(i))}}function wn(i,r,s){var u=i&&qa(i)==="object"?i:{bufferSize:i,windowTime:r,refCount:!1,scheduler:s};return function(l){return l.lift(ov(u))}}function ov(i){var r,s,u=i.bufferSize,l=u===void 0?Number.POSITIVE_INFINITY:u,f=(u=i.windowTime)===void 0?Number.POSITIVE_INFINITY:u,E=i.refCount,T=i.scheduler,v=0,w=!1,k=!1;return function(B){if(v++,!r||w){w=!1;var Q=(r=new Te(l,f,T)).subscribe(this);s=B.subscribe({next:function(X){r.next(X)},error:function(X){w=!0,r.error(X)},complete:function(){k=!0,s=void 0,r.complete()}}),k&&(s=void 0)}else Q=r.subscribe(this);this.add(function(){v--,Q.unsubscribe(),Q=void 0,s&&!k&&E&&v===0&&(s.unsubscribe(),r=s=void 0)})}}function Kb(i,r){return typeof r=="function"?function(s){return s.pipe(Kb(function(u,l){return Jc(i(u,l)).pipe(Ea(function(f,E){return r(u,f,l,E)}))}))}:function(s){return s.lift(new pv(i))}}function Kc(i){return function(r){return r.lift(new qv(i))}}function sa(i,r,s){return function(u){return u.lift(new rv(i,r,s))}}function sv(i,r,s){return r===void 0&&(r=cd),s===void 0&&(s=tv),function(u){return u.lift(new uv(i,r,s.leading,s.trailing))}}function vv(i){i.subscriber.clearThrottle()}function wv(i,r,s){return s===void 0&&(s=cd),function(u){var l=i instanceof Date&&!isNaN(+i),f=l?+i-s.now():Math.abs(i);return u.lift(new xv(f,l,r,s))}}function Lb(i,r){return r===void 0&&(r=cd),wv(i,ra(new Tb),r)}function yv(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return function(s){var u;return typeof i[i.length-1]=="function"&&(u=i.pop()),s.lift(new zv(i,u))}}function xn(i){(gj||i)&&(yn.abort(),i&&(yn=new AbortController),gj=i)}function zn(i,r,s,u,l){i!==r&&An(r,function(f,E){if(l||(l=new Ie),Gb(f)){f=l;var T=hj(i,E),v=hj(r,E),w=f.get(v);if(w)ij(i,E,w);else{var k=(w=u?u(T,v,E+"",i,r,f):void 0)===void 0;if(k){var B=ub(v),Q=!B&&Nf(v),X=!B&&!Q&&Ui(v);w=v,B||Q||X?ub(T)?w=T:Hc(T)&&ae(T)?w=Pi(T):Q?(k=!1,w=Nm(v,!0)):X?(k=!1,w=Bn(v,!0)):w=[]:Cn(v)||Vf(v)?(w=T,Vf(T)?w=Ue(T,Of(T)):Gb(T)&&!jj(T)||(w=Om(v))):k=!1}k&&(f.set(v,w),zn(w,v,s,u,f),f.delete(v)),ij(i,E,w)}}else(T=u?u(hj(i,E),f,E+"",i,r,l):void 0)===void 0&&(T=f),ij(i,E,T)},Of)}function Av(i){var r=1,s=kj;(1>=arguments.length?0:arguments.length-1)==1?typeof(1>=arguments.length?void 0:arguments[1])=="number"?r=1>=arguments.length?void 0:arguments[1]:s=1>=arguments.length?void 0:arguments[1]:(1>=arguments.length?0:arguments.length-1)==2&&(r=1>=arguments.length?void 0:arguments[1],s=2>=arguments.length?void 0:arguments[2]);var u=r||1;return function(l){return l.pipe(gh(function(f,E){var T=s.now(),v=T-i;if((f=f.filter(function(B){return B.until>v})).length>=u){var w=f[f.length-1],k=f[0].until+i*Math.floor(f.length/u);f.push({delay:w.until<T?k-T:k-w.until,until:k,value:E})}else f.push({delay:0,until:T,value:E});return f},[]),Ea(function(f){return f[f.length-1]}),fj(function(f){var E=ob(f.value);return f.delay?E.pipe(Zd(f.delay,s)):E}))}}function Bv(i,r){var s=(r=r===void 0?{protocols:Dn,makeWebSocket:En}:r).protocols,u=s===void 0?Dn:s,l=(r=r.makeWebSocket)===void 0?En:r;return new ua(function(f){var E,T=new rb,v=l(i,u),w=!1,k=!1,B=!1,Q=function(X){if(E)throw w=!0,X=Error("Web socket message factory function called more than once"),f.error(X),X;return E=X.subscribe(function(_e){v.send(_e)}),T};return v.onopen=function(){B=!0,k?(w=!0,v.close()):f.next(Q)},v.onmessage=function(X){T.next(X.data)},v.onerror=function(X){w=!0,f.error(Error(X.message))},v.onclose=function(X){w||(w=!0,k?(f.complete(),T.complete()):f.error(Error(X.code===1e3?"Normal closure":X.reason)))},function(){k=!0,E&&E.unsubscribe(),w||(w=!0,B&&v.close())}})}function hh(){this._listeners={}}function Fn(i){return typeof Float32Array<"u"?function(){function r(v,w,k){f[0]=v,w[k]=E[0],w[k+1]=E[1],w[k+2]=E[2],w[k+3]=E[3]}function s(v,w,k){f[0]=v,w[k]=E[3],w[k+1]=E[2],w[k+2]=E[1],w[k+3]=E[0]}function u(v,w){return E[0]=v[w],E[1]=v[w+1],E[2]=v[w+2],E[3]=v[w+3],f[0]}function l(v,w){return E[3]=v[w],E[2]=v[w+1],E[1]=v[w+2],E[0]=v[w+3],f[0]}var f=new Float32Array([-0]),E=new Uint8Array(f.buffer),T=E[3]===128;i.writeFloatLE=T?r:s,i.writeFloatBE=T?s:r,i.readFloatLE=T?u:l,i.readFloatBE=T?l:u}():function(){function r(u,l,f,E){var T=0>l?1:0;if(T&&(l=-l),l===0)u(0<1/l?0:2147483648,f,E);else if(isNaN(l))u(2143289344,f,E);else if(34028234663852886e22<l)u((T<<31|2139095040)>>>0,f,E);else if(11754943508222875e-54>l)u((T<<31|Math.round(l/1401298464324817e-60))>>>0,f,E);else{var v=Math.floor(Math.log(l)/Math.LN2);u((T<<31|v+127<<23|8388607&Math.round(l*Math.pow(2,-v)*8388608))>>>0,f,E)}}function s(u,l,f){return f=u(l,f),u=2*(f>>31)+1,l=f>>>23&255,f&=8388607,l===255?f?NaN:1/0*u:l===0?1401298464324817e-60*u*f:u*Math.pow(2,l-150)*(f+8388608)}i.writeFloatLE=r.bind(null,Gn),i.writeFloatBE=r.bind(null,Hn),i.readFloatLE=s.bind(null,In),i.readFloatBE=s.bind(null,Jn)}(),typeof Float64Array<"u"?function(){function r(v,w,k){f[0]=v,w[k]=E[0],w[k+1]=E[1],w[k+2]=E[2],w[k+3]=E[3],w[k+4]=E[4],w[k+5]=E[5],w[k+6]=E[6],w[k+7]=E[7]}function s(v,w,k){f[0]=v,w[k]=E[7],w[k+1]=E[6],w[k+2]=E[5],w[k+3]=E[4],w[k+4]=E[3],w[k+5]=E[2],w[k+6]=E[1],w[k+7]=E[0]}function u(v,w){return E[0]=v[w],E[1]=v[w+1],E[2]=v[w+2],E[3]=v[w+3],E[4]=v[w+4],E[5]=v[w+5],E[6]=v[w+6],E[7]=v[w+7],f[0]}function l(v,w){return E[7]=v[w],E[6]=v[w+1],E[5]=v[w+2],E[4]=v[w+3],E[3]=v[w+4],E[2]=v[w+5],E[1]=v[w+6],E[0]=v[w+7],f[0]}var f=new Float64Array([-0]),E=new Uint8Array(f.buffer),T=E[7]===128;i.writeDoubleLE=T?r:s,i.writeDoubleBE=T?s:r,i.readDoubleLE=T?u:l,i.readDoubleBE=T?l:u}():function(){function r(u,l,f,E,T,v){var w=0>E?1:0;if(w&&(E=-E),E===0)u(0,T,v+l),u(0<1/E?0:2147483648,T,v+f);else if(isNaN(E))u(0,T,v+l),u(2146959360,T,v+f);else if(17976931348623157e292<E)u(0,T,v+l),u((w<<31|2146435072)>>>0,T,v+f);else if(22250738585072014e-324>E)u((E/=5e-324)>>>0,T,v+l),u((w<<31|E/4294967296)>>>0,T,v+f);else{var k=Math.floor(Math.log(E)/Math.LN2);k===1024&&(k=1023),u(4503599627370496*(E*=Math.pow(2,-k))>>>0,T,v+l),u((w<<31|k+1023<<20|1048576*E&1048575)>>>0,T,v+f)}}function s(u,l,f,E,T){return l=u(E,T+l),E=u(E,T+f),u=2*(E>>31)+1,l=4294967296*(1048575&E)+l,(f=E>>>20&2047)===2047?l?NaN:1/0*u:f===0?5e-324*u*l:u*Math.pow(2,f-1075)*(l+4503599627370496)}i.writeDoubleLE=r.bind(null,Gn,0,4),i.writeDoubleBE=r.bind(null,Hn,4,0),i.readDoubleLE=s.bind(null,In,0,4),i.readDoubleBE=s.bind(null,Jn,4,0)}(),i}function Gn(i,r,s){r[s]=255&i,r[s+1]=i>>>8&255,r[s+2]=i>>>16&255,r[s+3]=i>>>24}function Hn(i,r,s){r[s]=i>>>24,r[s+1]=i>>>16&255,r[s+2]=i>>>8&255,r[s+3]=255&i}function In(i,r){return(i[r]|i[r+1]<<8|i[r+2]<<16|i[r+3]<<24)>>>0}function Jn(i,r){return(i[r]<<24|i[r+1]<<16|i[r+2]<<8|i[r+3])>>>0}function vb(i,r){this.lo=i>>>0,this.hi=r>>>0}function Wf(i,r,s){this.fn=i,this.len=r,this.next=void 0,this.val=s}function lj(){}function Cv(i){this.head=i.head,this.tail=i.tail,this.len=i.len,this.next=i.states}function Aa(){this.len=0,this.tail=this.head=new Wf(lj,0,0),this.states=null}function mj(i,r,s){r[s]=255&i}function nj(i,r){this.len=i,this.next=void 0,this.val=r}function oj(i,r,s){for(;i.hi;)r[s++]=127&i.lo|128,i.lo=(i.lo>>>7|i.hi<<25)>>>0,i.hi>>>=7;for(;127<i.lo;)r[s++]=127&i.lo|128,i.lo>>>=7;r[s++]=i.lo}function pj(i,r,s){r[s]=255&i,r[s+1]=i>>>8&255,r[s+2]=i>>>16&255,r[s+3]=i>>>24}function Lc(){qj.call(this)}function Dv(i,r,s){40>i.length?pa.utf8.write(i,r,s):r.utf8Write?r.utf8Write(i,s):r.write(i,s)}function wc(i,r){return RangeError("index out of range: "+i.pos+" + "+(r||1)+" > "+i.len)}function ib(i){this.buf=i,this.pos=0,this.len=i.length}function rj(){var i=new Kn(0,0),r=0;if(!(4<this.len-this.pos)){for(;3>r;++r){if(this.pos>=this.len)throw wc(this);if(i.lo=(i.lo|(127&this.buf[this.pos])<<7*r)>>>0,128>this.buf[this.pos++])return i}return i.lo=(i.lo|(127&this.buf[this.pos++])<<7*r)>>>0,i}for(;4>r;++r)if(i.lo=(i.lo|(127&this.buf[this.pos])<<7*r)>>>0,128>this.buf[this.pos++])return i;if(i.lo=(i.lo|(127&this.buf[this.pos])<<28)>>>0,i.hi=(i.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return i;if(r=0,4<this.len-this.pos){for(;5>r;++r)if(i.hi=(i.hi|(127&this.buf[this.pos])<<7*r+3)>>>0,128>this.buf[this.pos++])return i}else for(;5>r;++r){if(this.pos>=this.len)throw wc(this);if(i.hi=(i.hi|(127&this.buf[this.pos])<<7*r+3)>>>0,128>this.buf[this.pos++])return i}throw Error("invalid varint encoding")}function ih(i,r){return(i[r-4]|i[r-3]<<8|i[r-2]<<16|i[r-1]<<24)>>>0}function Ln(){if(this.pos+8>this.len)throw wc(this,8);return new Kn(ih(this.buf,this.pos+=4),ih(this.buf,this.pos+=4))}function be(i){sj.call(this,i)}function Xf(i,r,s){if(typeof i!="function")throw TypeError("rpcImpl must be a function");pa.EventEmitter.call(this),this.rpcImpl=i,this.requestDelimited=!!r,this.responseDelimited=!!s}function Mn(i){var r=[];return function s(u){if(u===null||qa(u)!=="object")return u;if(r.indexOf(u)!==-1)return"[Circular]";if(r.push(u),typeof u.toJSON=="function")try{var l=s(u.toJSON());return r.pop(),l}catch(f){return"[Throws: "+(f?f.message:"?")+"]"}return Array.isArray(u)?(l=u.map(s),r.pop(),l):(l=Object.keys(u).reduce(function(f,E){t:{if(Ev.call(u,E))try{var T=u[E];break t}catch(v){T="[Throws: "+(v?v.message:"?")+"]";break t}T=u[E]}return f[E]=s(T),f},{}),r.pop(),l)}(i)}function Fv(i){if(!(100<(i=String(i)).length)&&(i=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(i))){var r=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return 864e5*r;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r}}}function jh(i,r,s,u){return Math.round(i/s)+" "+u+(r>=1.5*s?"s":"")}function Gv(i){var r=i.areas,s=i.excludedArea;if(r.length===1&&r[0]===S.GLOBAL&&s===S.CHINA)return Ve([S.OVERSEA]);if(r.includes(S.GLOBAL)){if(i=Yf(kh).filter(function(f){return f!==S.GLOBAL&&f!==S.OVERSEA}),s in Zf){r=Zf[s];var u=[].concat(Z(r??[]),[s]);return Ve(i.filter(function(f){return!u.includes(f)}))}if(Nn(s)){var l=Hv(s);return Ve(i.filter(function(f){return f!==s&&f!==l}))}}if(Nn(s)||s in Zf)return Ve(r);throw new ca("Invalid excludedArea area config")}function jb(i,r,s){s===void 0&&(s=Object.getOwnPropertyDescriptor(i,r));var u=s.value;return s.value=function(){for(var l=this,f=arguments.length,E=Array(f),T=0;T<f;T++)E[T]=arguments[T];this.invokeTracker.apply(this,["%s: ".concat(0<E.length?"%s with args: ".concat(E.map(function(){return"%o"})):"%s"),this.name,r].concat(Z(E.map(We))));try{var v=u.apply(this,E)}catch(k){throw this.logError.apply(this,["".concat(k.code!==void 0?"Error Code ".concat(k.code,": "):"","%s failed").concat(0<E.length?" with args: ".concat(E.map(function(){return"%o"})):""),r].concat(Z(E.map(We)))),k.originalError&&this.logError(k.originalError),this.errorTracker(k),k}var w=Date.now();return ma(N.mark(function k(){var B,Q;return N.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return X.prev=0,X.next=3,v;case 3:B=X.sent,X.next=12;break;case 6:return X.prev=6,X.t0=X.catch(0),l.logError.apply(l,["".concat(X.t0.code!==void 0?"Error Code ".concat(X.t0.code,": "):"","%s failed").concat(0<E.length?" with args: ".concat(E.map(function(){return"%o"})):""),r].concat(Z(E.map(We)))),X.t0.originalError&&l.logError(X.t0.originalError),l.errorTracker(X.t0),X.abrupt("return");case 12:B!==v?B===void 0?l.resultTracker("%s promise resolves after %dms",r,Date.now()-w):l.resultTracker("%s promise resolves after %dms, result is %o",r,Date.now()-w,We(B)):$c(B)!=="Object"||De(B)?l.resultTracker("%s result is %o",r,We(B)):l.resultTracker("%s result is %s",r,B.name||((Q=B.constructor)===null||Q===void 0?void 0:Q.name));case 13:case"end":return X.stop()}},k,null,[[0,6]])}))(),v},s}function Mc(i,r,s){s===void 0&&(s=Object.getOwnPropertyDescriptor(i,r));var u=s.value;return s.value=function(){for(var l=this,f=arguments.length,E=Array(f),T=0;T<f;T++)E[T]=arguments[T];this.invokeTracker.apply(this,["%s: ".concat(0<E.length?"%s with args: ".concat(E.map(function(){return"%o"})):"%s"),this.name,r].concat(E));try{var v=u.apply(this,E)}catch(k){throw this.logError.apply(this,["".concat(k.code!==void 0?"Error Code ".concat(k.code,": "):"","%s failed").concat(0<E.length?" with args: ".concat(E.map(function(){return"%o"})):""),r].concat(E)),k.originalError&&this.logError(k.originalError),this.errorTracker(k),k}var w=Date.now();return ma(N.mark(function k(){var B,Q;return N.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return X.prev=0,X.next=3,v;case 3:B=X.sent,X.next=12;break;case 6:return X.prev=6,X.t0=X.catch(0),l.logError.apply(l,["".concat(X.t0.code!==void 0?"Error Code ".concat(X.t0.code,": "):"","%s failed").concat(0<E.length?" with args: ".concat(E.map(function(){return"%o"})):""),r].concat(E)),X.t0.originalError&&l.logError(X.t0.originalError),l.errorTracker(X.t0),X.abrupt("return");case 12:B!==v?B===void 0?l.resultTracker("%s promise resolves after %dms",r,Date.now()-w):l.resultTracker("%s promise resolves after %dms, result is %o",r,Date.now()-w,B):$c(B)!=="Object"||De(B)?l.resultTracker("%s result is %o",r,B):l.resultTracker("%s result is %s",r,B.name||((Q=B.constructor)===null||Q===void 0?void 0:Q.name));case 13:case"end":return X.stop()}},k,null,[[0,6]])}))(),v},s}function bb(i,r,s){return tj.apply(this,arguments)}function tj(){return(tj=ma(N.mark(function i(r,s,u){var l,f,E,T=arguments;return N.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l=3<T.length&&T[3]!==void 0&&T[3],f=Iv[r].encode(s).finish(),E=function(){var w=ma(N.mark(function k(B){var Q,X,_e,aa=arguments;return N.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(!(3<(X=1<aa.length&&aa[1]!==void 0?aa[1]:0))){_i.next=3;break}return _i.abrupt("return");case 3:if(_e=Xe(_e=u?"https://".concat((Q=fa==null?void 0:fa.PROXY_NGINX[0])!==null&&Q!==void 0?Q:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(B,"&p=443&d=events/proto-raw"):"https://".concat(B,"/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),_e=Xe(_e,"id",Jv[r].toString()),!l){_i.next=9;break}return _i.next=9,Kv(1e4);case 9:return _i.next=11,lh(_e,{body:f,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch(function(_a){return E(B,X+1)});case 11:case"end":return _i.stop()}},k)}));return function(k){return w.apply(this,arguments)}}(),v.prev=3,v.next=6,E((fa==null?void 0:fa.EVENT_REPORT_DOMAIN[0])||$f(null)||"webcollector-rtm.agora.io");case 6:v.next=12;break;case 8:return v.prev=8,v.t0=v.catch(3),v.next=12,E(fa&&On(1<(fa==null?void 0:fa.EVENT_REPORT_DOMAIN.length)?fa==null?void 0:fa.EVENT_REPORT_DOMAIN.slice(1):fa==null?void 0:fa.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 12:case"end":return v.stop()}},i,null,[[3,8]])}))).apply(this,arguments)}function Xa(i){return i===void 0?P.fromNumber(0):P.fromNumber(Date.now()-i)}function Ta(i){return typeof i=="string"&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(i)&&i!=="null"}function Pn(i){try{var r=i.split(".").map(function(u){return Number(u)})}catch{return!1}if(r.length!==4||r[0]===0)return!1;for(i=0;i<r.length;i++){var s=r[i];if(!Number.isInteger(s)||0>s||255<s)return!1}return!0}function Qn(i,r){if(!Array.isArray(r)||r.length===0||32<r.length||r.some(function(s){return s.length===0||32<s.length}))throw new ca("arguments is not valid",gb);if(!Ta(i))throw new ca("ID is invalid",gb)}function ag(i){var r=i.attributes,s=i.attrSizeMap,u=i.maxAttrsCount,l=i.maxAttrValueSize;if(i=i.maxTotalSize,!De(r))throw new ca("attributes must be an object",gb);if(Object.keys(r).length>u)throw new ic("Exceed the limit of ".concat(u," attributes"),Ye);if(Object.keys(r).length===0)throw new ca("The attributes is an empty object",gb);var f=0,E=0;for(r=Object.entries(r);E<r.length;E++){var T=$a(r[E],2),v=T[1];T=new Blob([T[0]]).size;var w=new Blob([v]).size;if(T===0||32<T)throw new ca("Invalid attribute key",gb);if(w>l)throw new ic("Invalid attribute value, over the limit of ".concat(l," bytes"),Ye);if(typeof v!="string"||v.length===0)throw new ca("Invalid attribute value",gb);f+=T,f+=w}if(f>i)throw new ic("The attributes size overflow",Ye);if(s!==void 0){if(Object.keys(s).length>u)throw new ic("Exceed the limit of ".concat(u," attributes"),Ye);for(f=u=0,s=Object.entries(s);f<s.length;f++){if(E=(r=$a(s[f],2))[1],(r=new Blob([r[0]]).size)===0)throw new ca("Invalid attribute key",gb);if(E>l)throw new ic("Invalid attribute value, over the limit of ".concat(l," bytes"),Ye);u+=r,u+=E}if(u>i)throw new ic("The attributes size overflow",Ye)}}function mh(i,r){return Math.floor(Math.random()*(Math.floor(r)-Math.ceil(i)+1))+i}function nh(){var i=mh(0,4294967295),r=mh(1,4294967295);return new P(i,r,!0)}function sb(i){return i.toString().padEnd(32,"0")}function Rn(i,r){return new TypeError("Unexpected ".concat(i,": ").concat(r))}function Sn(i,r){return i=i.split(".").map(function(s){return Number(s)}),r=r.split(".").map(function(s){return Number(s)}),Math.sqrt(1e3*Math.pow(i[0]-r[0],2)+100*Math.pow(i[1]-r[1],2)+10*Math.pow(i[2]-r[2],2)+1*Math.pow(i[3]-r[3],2))}function Tn(i){return i.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?i.toNumber():i.toString()}function uj(i,r){r="".concat(i).concat(r||"");var s=Un.get(r)||1;return Un.set(r,s+1),"".concat(i).concat(s)}function Vn(i,r){var s=typeof r=="number"?r:r!==void 0&&typeof r!="string"?r.code:void 0;return r=typeof r!="number"&&typeof r!="string"&&r!==void 0&&r.serverCode!==void 0?r.serverCode:void 0,s="".concat(s!==void 0?" Error Code ".concat(s):"").concat(r!==void 0?", server Code ".concat(r):""),i=typeof i=="string"&&i?oh(i):Array.isArray(i)&&typeof i[0]=="string"&&i[0]?oh(Wn.apply(void 0,[i[0]].concat(Z(i.slice(1))))):"","".concat(s===""?"":"".concat(s," - ")).concat(i)}function Kv(i,r){return vj.apply(this,arguments)}function vj(){return(vj=ma(N.mark(function i(r,s){return N.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!s||!s.aborted){u.next=2;break}return u.abrupt("return");case 2:return u.abrupt("return",new Promise(function(l){setTimeout(l,r),s==null||s.addEventListener("abort",l)}));case 3:case"end":return u.stop()}},i)}))).apply(this,arguments)}function lh(i,r,s){return wj.apply(this,arguments)}function wj(){return(wj=ma(N.mark(function i(r,s,u){var l,f,E,T,v,w,k,B,Q,X,_e,aa,_i,_a,ga,_d,d_,T_,P_,g_,j_,wS,_m,l_,a_,y_;return N.wrap(function(_c){for(;;)switch(_c.prev=_c.next){case 0:if(l=s.body,f=s.headers,E=f===void 0?{}:f,T=s.timeout,v=T===void 0?1e4:T,w=s.signal,k=s.withCredentials,B=k!==void 0&&k,Q=(u||{}).useBinaryResponse,X=Q!==void 0&&Q,(_e=new XMLHttpRequest).open("POST",r,!0),_e.responseType=X?"arraybuffer":"text",_e.withCredentials=B,_e.timeout=v,aa=l instanceof FormData,_i=l instanceof Uint8Array,!(1<(_a=Object.keys(E).filter(function(_f){return _f.toLowerCase()==="content-type"})).length)){_c.next=14;break}throw new RangeError("multiple content-type");case 14:_a.length===0&&(_i?E["Content-Type"]="application/octet-stream":aa||(E["Content-Type"]="application/json"));case 15:if("setRequestHeader"in _e){_c.next=46;break}return _e.abort(),_c.next=19,fetch(r,{body:aa||_i?l:JSON.stringify(l),cache:"no-cache",credentials:B?"include":"same-origin",headers:E,method:"POST",mode:"cors",referrer:"no-referrer",signal:w});case 19:if(ga=_c.sent,!(200<=(_d=ga.status)&&300>_d||_d===304)){_c.next=31;break}if(!X){_c.next=27;break}return _c.next=25,ga.arrayBuffer();case 25:return d_=_c.sent,_c.abrupt("return",{status:_d,responseData:d_});case 27:return _c.next=29,ga.text();case 29:return T_=_c.sent,_c.abrupt("return",{status:_d,responseText:T_});case 31:return P_=new Ja(["Post XHR failure, status %d",_d]),_c.prev=32,_c.next=35,ga.text();case 35:throw g_=_c.sent,P_.statusCode=_d,P_.message=g_||"Request failed, status ".concat(_d),P_;case 41:throw _c.prev=41,_c.t0=_c.catch(32),P_.statusCode=_d,P_.message="Request failed, status ".concat(_d),P_;case 46:if(Object.keys(E).length!==0)for(j_=0,wS=Object.entries(E);j_<wS.length;j_++)_m=$a(wS[j_],2),l_=_m[0],a_=_m[1],_e.setRequestHeader(l_,a_);return w!==void 0&&(y_=function _f(){_e.abort(),w.removeEventListener("abort",_f)},w.addEventListener("abort",y_)),aa||_i?_e.send(l):_e.send(JSON.stringify(l)),_c.abrupt("return",new Promise(function(_f,r_){_e.onload=function(){var v_=_e.status;if(200<=v_&&300>v_||v_===304)_f(X?{status:v_,responseData:_e.response}:{status:v_,responseText:_e.responseText});else{var S_=new Ja(["Post XHR failure, status %d",v_]);S_.statusCode=v_,S_.message=_e.response||"Request failed, status ".concat(_e.status),r_(S_)}},_e.ontimeout=function(v_){r_(new Ub(["XHR request timed out after %d ms",v],{originalError:v_}))},_e.onerror=function(){var v_=new Ja(["Post XHR failure, status %d",_e.status]);v_.statusCode=_e.status,v_.message=_e.response||"Request failed, status ".concat(_e.status),r_(v_)},_e.onabort=function(){try{r_(new DOMException("The request aborted.","AbortError"))}catch{var v_=Error("The request aborted.");v_.name="AbortError",r_(v_)}}}));case 50:case"end":return _c.stop()}},i,null,[[32,41]])}))).apply(this,arguments)}function Xn(i,r){if(!De(i))throw new ca("message object is not a plain object",r);if(i.messageType===void 0)if(i.rawMessage instanceof Uint8Array){if(i.messageType="RAW",i.text!==void 0)throw new ca("Raw messages cannot have text property. Use description instead",r)}else{if(typeof i.text!="string")throw new ca("messageType is undefined",r);if(i.messageType="TEXT",i.rawMessage!==void 0)throw new ca("Text messages cannot have rawMessage property",r)}}function ph(i){return xj.apply(this,arguments)}function xj(){return(xj=ma(N.mark(function i(r){var s,u,l,f,E,T,v,w,k,B,Q,X,_e,aa,_i,_a,ga,_d,d_,T_,P_;return N.wrap(function(g_){for(;;)switch(g_.prev=g_.next){case 0:if(s=r.message,u=r.peerId,l=r.toPeer,f=r.session,E=r.errorCodes,T=r.diff,v=r.logger,f!==void 0){g_.next=3;break}throw new da("The client is not logged in. Cannot do the operation",E.NOT_LOGGED_IN);case 3:if(w=!1,k=l?s.messageType==="TEXT"?Ka.P2pSMsgNoOfflineFlag:Ka.P2pRMsgNoOfflineFlag:s.messageType==="TEXT"?Ka.ChannelSMsg:Ka.ChannelRMsg,s.messageType!=="TEXT"||!s.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!l){g_.next=14;break}if(B=s.text.split("_"),Q=$a(B,3),X=Q[0],_e=Q[1],Q[2]!==void 0&&Ta(_e)&&X==="AgoraRTMLegacyEndcallCompatibleMessagePrefix"){g_.next=13;break}throw f.emit("messageCount",{messageCategory:k,type:"common",key:"sentcount"}),f.emit("messageCount",{messageCategory:k,type:"common",key:"invalidmessagecount"}),new ca("Message is not valid",bg);case 13:w=!0;case 14:if(aa=Date.now(),_i=f.messageSentTimes.length-1,!((_a=f.messageSentTimes[_i])&&_a+3e3<aa)){g_.next=21;break}f.messageSentTimes=[aa],g_.next=34;break;case 21:ga=_i;case 22:if(!(0<=ga)){g_.next=33;break}if(!(f.messageSentTimes[ga]+3e3<aa)){g_.next=26;break}return f.messageSentTimes=f.messageSentTimes.slice(ga+1,_i+1),g_.abrupt("break",33);case 26:if(!(180<=_i-ga+1)){g_.next=30;break}throw f.emit("messageCount",{messageCategory:k,type:"common",key:"sentcount"}),f.emit("messageCount",{messageCategory:k,type:"common",key:"toooftencount"}),new ic("Message sent failed, exceeded the 180 message in 3 seconds",E.TOO_OFTEN);case 30:ga--,g_.next=22;break;case 33:f.messageSentTimes.push(aa);case 34:g_.t0=s.messageType,g_.next=g_.t0==="TEXT"?37:g_.t0==="RAW"?42:44;break;case 37:if(!w){g_.next=41;break}return _d=s.text.split("_"),d_=$a(_d,3),T_=d_[1],P_=d_[2],v.info("[rtm-API] EndCall message send api is called"),g_.abrupt("return",f.sendInvitationMessage({peerId:u,type:"CallCancel",extra:P_,channelId:T_,callId:"0"}));case 41:return g_.abrupt("return",f.sendTextMessage(s.text,u,l,1e4-T));case 42:return s.description===void 0&&(s.description=""),g_.abrupt("return",f.sendRawMessage(s.rawMessage,s.description,u,l,1e4-T));case 44:throw f.emit("messageCount",{messageCategory:k,type:"common",key:"sentcount"}),f.emit("messageCount",{messageCategory:k,type:"common",key:"invalidmessagecount"}),new ca("Invalid message type",bg);case 47:case"end":return g_.stop()}},i)}))).apply(this,arguments)}function Lv(i){var r=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],s=i.replace(/(https?:\/\/)?(www.)?/i,"");return r||(s=s.split(".").slice(i.length-2).join(".")),s.indexOf("/")!==-1?s.split("/")[0]:s}function La(i){if(typeof i!="string")return"[Sensitive Info]";var r=Math.floor(.7*i.length),s=i.length;return Yn(i,r,s,"*".repeat(s-r))}function Zn(i,r,s){function u(l){if(i===void 0)return i;if(Mm(l))return l;if(Array.isArray(l))return l.map(u);var f={},E=0;for(l=qh(l);E<l.length;E++){var T=$a(l[E],2),v=T[0];if(typeof(T=T[1])=="string"&&s.includes(v)){f[v]=typeof T=="string"?La(T):"[Sensitive Info]";break}r.includes(v)?f[v]="[Hidden Info]":f[v]=T==null?T:s.includes(v)?"[Sensitive Info]":u(T)}return f}return Array.isArray(i)?i.map(u):u(i)}function $n(i){return Object.getOwnPropertyNames(i).forEach(function(r){qa(r=i[r])=="object"&&r!==null&&$n(r)}),Object.freeze(i)}function cg(i){return new TextDecoder("utf-8").decode(i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength))}function rh(i){return new TextEncoder().encode(i).length}function ao(){for(var i=0,r=arguments.length,s=Array(r),u=0;u<r;u++)s[u]=arguments[u];for(r=0;r<s.length;r++)i+=s[r].length;for(i=new Uint8Array(i),u=r=0;u<s.length;u++){var l=s[u];i.set(l,r),r+=l.length}return i}function Xe(i,r,s){var u=i.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(i=u==null?void 0:u[1],u=u==null?void 0:u[2]){var l;for(u=u.substr(1).split("&"),l=0;l<u.length;l++)if(u[l].split("=")[0]==r){u[l]=r+"="+encodeURIComponent(s);break}return l==u.length&&u.push(r+"="+encodeURIComponent(s)),i+"?"+u.join("&")}return i+"?"+r+"="+encodeURIComponent(s)}function Yn(i,r,s,u){return typeof i!="string"?"[Sensitive Info]":i.substring(0,r)+u+i.substring(s)}function $f(i){return typeof i=="string"}function Mv(i,r){var s="".concat(i,"Uri");if(typeof(s=yj[s])!="number"||s===0)throw new TypeError("Got Unknown URI Name");return r=new(i=bo[i])(r),r=i.encode(r).finish(),new Nv({uri:s,data:r})}function co(i,r){return"".concat(i.split(".").join("-"),".edge.").concat(r?"sd-rtn.com":"agora.io")}function sh(i,r){return P.fromValue(i).eq(r)}function th(i,r){var s=r===void 0?i.val:r,u=i.isBoolean;r=i.isNumber;var l=i.oneof,f=i.len;if([u,r,l].filter(function(E){return!E}).length!==2)throw new TypeError("invalid field type");if(s!==void 0&&(i=!1,l!==void 0&&(l=zj(l),Ov(l,sh).length===l.length&&Pv(l,function(E){return sh(s,E)})!==void 0&&(i=!0)),u=u!==void 0&&(s===0||s===1)&&f===1,r=r!==void 0&&s.toString(2).length<=f,!(i||u||r)))throw Error("invalid field value")}function eo(i){return i.reduce(function(r,s){return r.concat(s instanceof uh.UnsubscriptionError?s.errors:s)},[])}function Qv(i,r){do dg==2147483647?dg=0:dg++;while(Ze.hasOwnProperty(dg));var s=dg;return Ze[s]={callback:i,parameters:Array.prototype.slice.call(arguments,2)},Aj.postMessage({name:"setInterval",fakeId:s,time:r}),s}function fo(i){return function(){var r=i();if(!r)throw new da("Client is not logged in. Cannot do the operation");return r}}var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{},vh=function(i){return i&&i.Math==Math&&i},R=vh(typeof globalThis=="object"&&globalThis)||vh(typeof window=="object"&&window)||vh(typeof self=="object"&&self)||vh(typeof Ya=="object"&&Ya)||function(){return this}()||Function("return this")(),la=function(i){try{return!!i()}catch{return!0}},wa=!la(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),go={}.propertyIsEnumerable,ho=Object.getOwnPropertyDescriptor,eg=ho&&!go.call({1:2},1)?function(i){return!!(i=ho(this,i))&&i.enumerable}:go,Nc=function(i,r){return{enumerable:!(1&i),configurable:!(2&i),writable:!(4&i),value:r}},Rv={}.toString,xc=function(i){return Rv.call(i).slice(8,-1)},Sv="".split,fg=la(function(){return!Object("z").propertyIsEnumerable(0)})?function(i){return xc(i)=="String"?Sv.call(i,""):Object(i)}:Object,Eb=function(i){if(i==null)throw TypeError("Can't call method on "+i);return i},Mb=function(i){return fg(Eb(i))},xa=function(i){return typeof i=="object"?i!==null:typeof i=="function"},Oc=function(i,r){if(!xa(i))return i;var s,u;if(r&&typeof(s=i.toString)=="function"&&!xa(u=s.call(i))||typeof(s=i.valueOf)=="function"&&!xa(u=s.call(i))||!r&&typeof(s=i.toString)=="function"&&!xa(u=s.call(i)))return u;throw TypeError("Can't convert object to primitive value")},pb=function(i){return Object(Eb(i))},Tv={}.hasOwnProperty,ka=function(i,r){return Tv.call(pb(i),r)},$e=R.document,wh=xa($e)&&xa($e.createElement),io=!wa&&!la(function(){return Object.defineProperty(wh?$e.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),jo=Object.getOwnPropertyDescriptor,dc={f:wa?jo:function(i,r){if(i=Mb(i),r=Oc(r,!0),io)try{return jo(i,r)}catch{}if(ka(i,r))return Nc(!eg.call(i,r),i[r])}},Ia=function(i){if(!xa(i))throw TypeError(String(i)+" is not an object");return i},ko=Object.defineProperty,qb={f:wa?ko:function(i,r,s){if(Ia(i),r=Oc(r,!0),Ia(s),io)try{return ko(i,r,s)}catch{}if("get"in s||"set"in s)throw TypeError("Accessors not supported");return"value"in s&&(i[r]=s.value),i}},kb=wa?function(i,r,s){return qb.f(i,r,Nc(1,s))}:function(i,r,s){return i[r]=s,i},Bj=function(i,r){try{kb(R,i,r)}catch{R[i]=r}return r},zd=R["__core-js_shared__"]||Bj("__core-js_shared__",{}),Uv=Function.toString;typeof zd.inspectSource!="function"&&(zd.inspectSource=function(i){return Uv.call(i)});var Cj=zd.inspectSource,lo=R.WeakMap,Vv=typeof lo=="function"&&/native code/.test(Cj(lo)),Ad=xb(function(i){(i.exports=function(r,s){return zd[r]||(zd[r]=s!==void 0?s:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})}),Wv=0,Xv=Math.random(),af=function(i){return"Symbol("+String(i===void 0?"":i)+")_"+(++Wv+Xv).toString(36)},mo=Ad("keys"),xh=function(i){return mo[i]||(mo[i]=af(i))},bf={},Yv=R.WeakMap;if(Vv||zd.state)var ce=zd.state||(zd.state=new Yv),Zv=ce.get,no=ce.has,$v=ce.set,Dj=function(i,r){if(no.call(ce,i))throw new TypeError("Object already initialized");return r.facade=i,$v.call(ce,i,r),r},yh=function(i){return Zv.call(ce,i)||{}},Ej=function(i){return no.call(ce,i)};else{var cf=xh("state");bf[cf]=!0,Dj=function(i,r){if(ka(i,cf))throw new TypeError("Object already initialized");return r.facade=i,kb(i,cf,r),r},yh=function(i){return ka(i,cf)?i[cf]:{}},Ej=function(i){return ka(i,cf)}}var cb={set:Dj,get:yh,has:Ej,enforce:function(i){return Ej(i)?yh(i):Dj(i,{})},getterFor:function(i){return function(r){var s;if(!xa(r)||(s=yh(r)).type!==i)throw TypeError("Incompatible receiver, "+i+" required");return s}}},Za=xb(function(i){var r=cb.get,s=cb.enforce,u=String(String).split("String");(i.exports=function(l,f,E,T){var v=!!T&&!!T.unsafe,w=!!T&&!!T.enumerable;if(T=!!T&&!!T.noTargetGet,typeof E=="function"){typeof f!="string"||ka(E,"name")||kb(E,"name",f);var k=s(E);k.source||(k.source=u.join(typeof f=="string"?f:""))}l===R?w?l[f]=E:Bj(f,E):(v?!T&&l[f]&&(w=!0):delete l[f],w?l[f]=E:kb(l,f,E))})(Function.prototype,"toString",function(){return typeof this=="function"&&r(this).source||Cj(this)})}),oo=function(i){return typeof i=="function"?i:void 0},Pc=function(i,r){return 2>arguments.length?oo(R[i])||oo(R[i]):R[i]&&R[i][r]||R[i]&&R[i][r]},aw=Math.ceil,bw=Math.floor,yc=function(i){return isNaN(i=+i)?0:(0<i?bw:aw)(i)},cw=Math.min,Ma=function(i){return 0<i?cw(yc(i),9007199254740991):0},dw=Math.max,ew=Math.min,Vb=function(i,r){return 0>(i=yc(i))?dw(i+r,0):ew(i,r)},po=function(i){return function(r,s,u){r=Mb(r);var l=Ma(r.length);if(u=Vb(u,l),i&&s!=s){for(;l>u;)if((s=r[u++])!=s)return!0}else for(;l>u;u++)if((i||u in r)&&r[u]===s)return i||u||0;return!i&&-1}},qo=po(!0),Fj=po(!1),ro=function(i,r){i=Mb(i);var s,u=0,l=[];for(s in i)!ka(bf,s)&&ka(i,s)&&l.push(s);for(;r.length>u;)ka(i,s=r[u++])&&(~Fj(l,s)||l.push(s));return l},zh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),fw=zh.concat("length","prototype"),de={f:Object.getOwnPropertyNames||function(i){return ro(i,fw)}},gg={f:Object.getOwnPropertySymbols},so=Pc("Reflect","ownKeys")||function(i){var r=de.f(Ia(i)),s=gg.f;return s?r.concat(s(i)):r},to=function(i,r){for(var s=so(r),u=qb.f,l=dc.f,f=0;f<s.length;f++){var E=s[f];ka(i,E)||u(i,E,l(r,E))}},gw=/#|\.prototype\./,Qc=function(i,r){return(i=hw[iw(i)])==jw||i!=kw&&(typeof r=="function"?la(r):!!r)},iw=Qc.normalize=function(i){return String(i).replace(gw,".").toLowerCase()},hw=Qc.data={},kw=Qc.NATIVE="N",jw=Qc.POLYFILL="P",lw=dc.f,ea=function(i,r){var s,u,l,f=i.target,E=i.global,T=i.stat;if(u=E?R:T?R[f]||Bj(f,{}):(R[f]||{}).prototype)for(l in r){var v=r[l],w=i.noTargetGet?(s=lw(u,l))&&s.value:u[l];if(!(s=Qc(E?l:f+(T?".":"#")+l,i.forced))&&w!==void 0){if(typeof v==typeof w)continue;to(v,w)}(i.sham||w&&w.sham)&&kb(v,"sham",!0);try{Za(u,l,v,i)}catch{}}},Gj=function(){var i=Ia(this),r="";return i.global&&(r+="g"),i.ignoreCase&&(r+="i"),i.multiline&&(r+="m"),i.dotAll&&(r+="s"),i.unicode&&(r+="u"),i.sticky&&(r+="y"),r},Rc=la(function(){var i=/a/y;return i.lastIndex=2,i.exec("abcd")!=null}),mw=la(function(){var i=/^r/gy;return i.lastIndex=2,i.exec("str")!=null}),Ah=RegExp.prototype.exec,nw=Ad("native-string-replace",String.prototype.replace),uo=Ah,Hj=(c=/a/,b=/b*/g,Ah.call(c,"a"),Ah.call(b,"a"),c.lastIndex!==0||b.lastIndex!==0),vo=Rc||mw,Ij=/()??/.exec("")[1]!==void 0,c,b;(Hj||Ij||vo)&&(uo=function(i){var r,s=vo&&this.sticky,u=Gj.call(this),l=this.source,f=0,E=i;if(s){(u=u.replace("y","")).indexOf("g")===-1&&(u+="g"),E=String(i).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&i[this.lastIndex-1]!==`
`)&&(l="(?: "+l+")",E=" "+E,f++);var T=new RegExp("^(?:"+l+")",u)}if(Ij&&(T=new RegExp("^"+l+"$(?!\\s)",u)),Hj)var v=this.lastIndex;var w=Ah.call(s?T:this,E);return s?w?(w.input=w.input.slice(f),w[0]=w[0].slice(f),w.index=this.lastIndex,this.lastIndex+=w[0].length):this.lastIndex=0:Hj&&w&&(this.lastIndex=this.global?w.index+w[0].length:v),Ij&&w&&1<w.length&&nw.call(w[0],T,function(){for(r=1;r<arguments.length-2;r++)arguments[r]===void 0&&(w[r]=void 0)}),w});var hg=uo;ea({target:"RegExp",proto:!0,forced:/./.exec!==hg},{exec:hg});var df=Pc("navigator","userAgent")||"",wo=R.process,xo=wo&&wo.versions,yo=xo&&xo.v8;if(yo)var Bd=yo.split("."),Jj=4>Bd[0]?1:Bd[0]+Bd[1];else df&&(Bd=df.match(/Edge\/(\d+)/),(!Bd||74<=Bd[1])&&(Bd=df.match(/Chrome\/(\d+)/))&&(Jj=Bd[1]));var Cd=Jj&&+Jj,Sc=!!Object.getOwnPropertySymbols&&!la(function(){return!String(Symbol())||!Symbol.sham&&Cd&&41>Cd}),zo=Sc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",ig=Ad("wks"),jg=R.Symbol,ow=zo?jg:jg&&jg.withoutSetter||af,Fa=function(i){return ka(ig,i)&&(Sc||typeof ig[i]=="string")||(Sc&&ka(jg,i)?ig[i]=jg[i]:ig[i]=ow("Symbol."+i)),ig[i]},pw=Fa("species"),Kj=RegExp.prototype,qw=!la(function(){var i=/./;return i.exec=function(){var r=[];return r.groups={a:"7"},r},"".replace(i,"$<a>")!=="7"}),Ao="a".replace(/./,"$0")==="$0",Bo=Fa("replace"),Co=!!/./[Bo]&&/./[Bo]("a","$0")==="",rw=!la(function(){var i=/(?:)/,r=i.exec;return i.exec=function(){return r.apply(this,arguments)},(i="ab".split(i)).length!==2||i[0]!=="a"||i[1]!=="b"}),Bh=function(i,r,s,u){var l=Fa(i),f=!la(function(){var w={};return w[l]=function(){return 7},""[i](w)!=7}),E=f&&!la(function(){var w=!1,k=/a/;return i==="split"&&((k={constructor:{}}).constructor[pw]=function(){return k},k.flags="",k[l]=/./[l]),k.exec=function(){return w=!0,null},k[l](""),!w});if(!f||!E||i==="replace"&&(!qw||!Ao||Co)||i==="split"&&!rw){var T=/./[l],v=(s=s(l,""[i],function(w,k,B,Q,X){var _e=k.exec;return _e===hg||_e===Kj.exec?f&&!X?{done:!0,value:T.call(k,B,Q)}:{done:!0,value:w.call(B,k,Q)}:{done:!1}},{REPLACE_KEEPS_$0:Ao,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:Co}))[1];Za(String.prototype,i,s[0]),Za(Kj,l,r==2?function(w,k){return v.call(w,this,k)}:function(w){return v.call(w,this)})}u&&kb(Kj[l],"sham",!0)},sw=Fa("match"),Lj=function(i){var r;return xa(i)&&((r=i[sw])!==void 0?!!r:xc(i)=="RegExp")},Wb=function(i){if(typeof i!="function")throw TypeError(String(i)+" is not a function");return i},tw=Fa("species"),ee=function(i,r){var s;return(i=Ia(i).constructor)===void 0||(s=Ia(i)[tw])==null?r:Wb(s)},Do=function(i){return function(r,s){r=String(Eb(r)),s=yc(s);var u,l=r.length;if(0>s||s>=l)return i?"":void 0;var f=r.charCodeAt(s);return 55296>f||56319<f||s+1===l||56320>(u=r.charCodeAt(s+1))||57343<u?i?r.charAt(s):f:i?r.slice(s,s+2):u-56320+(f-55296<<10)+65536}},uw=Do(!1),Eo=Do(!0),Mj=function(i,r,s){return r+(s?Eo(i,r).length:1)},ef=function(i,r){var s=i.exec;if(typeof s=="function"){if(typeof(i=s.call(i,r))!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return i}if(xc(i)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return hg.call(i,r)},vw=[].push,ww=Math.min;Bh("split",2,function(i,r,s){var u="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||1<".".split(/()()/).length||"".split(/.?/).length?function(l,f){var E=String(Eb(this));if((f=f===void 0?4294967295:f>>>0)===0)return[];if(l===void 0)return[E];if(!Lj(l))return r.call(E,l,f);var T,v,w,k=[],B=0;for(l=new RegExp(l.source,(l.ignoreCase?"i":"")+(l.multiline?"m":"")+(l.unicode?"u":"")+(l.sticky?"y":"")+"g");(T=hg.call(l,E))&&!((v=l.lastIndex)>B&&(k.push(E.slice(B,T.index)),1<T.length&&T.index<E.length&&vw.apply(k,T.slice(1)),w=T[0].length,B=v,k.length>=f));)l.lastIndex===T.index&&l.lastIndex++;return B===E.length?(w||!l.test(""))&&k.push(""):k.push(E.slice(B)),k.length>f?k.slice(0,f):k}:"0".split(void 0,0).length?function(l,f){return l===void 0&&f===0?[]:r.call(this,l,f)}:r;return[function(l,f){var E=Eb(this),T=l==null?void 0:l[i];return T!==void 0?T.call(l,E,f):u.call(String(E),l,f)},function(l,f){var E=s(u,l,this,f,u!==r);if(E.done)return E.value;var T=Ia(l);l=String(this);var v=ee(T,RegExp);if(E=T.unicode,T=new v(Rc?"^(?:"+T.source+")":T,(T.ignoreCase?"i":"")+(T.multiline?"m":"")+(T.unicode?"u":"")+(Rc?"g":"y")),(f=f===void 0?4294967295:f>>>0)===0)return[];if(l.length===0)return ef(T,l)===null?[l]:[];var w=0,k=0;for(v=[];k<l.length;){T.lastIndex=Rc?0:k;var B,Q=ef(T,Rc?l.slice(k):l);if(Q===null||(B=ww(Ma(T.lastIndex+(Rc?k:0)),l.length))===w)k=Mj(l,k,E);else{if(v.push(l.slice(w,k)),v.length===f)return v;for(w=1;w<=Q.length-1;w++)if(v.push(Q[w]),v.length===f)return v;k=w=B}}return v.push(l.slice(w)),v}]},Rc);var xw=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,yw=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,Nj=function(i){return function(r){return r=String(Eb(r)),1&i&&(r=r.replace(xw,"")),2&i&&(r=r.replace(yw,"")),r}},Oj=Nj(3),Ch=R.parseInt,zw=/^[+-]?0[Xx]/,Fo=Ch(`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF08`)!==8||Ch(`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF0x16`)!==22?function(i,r){return i=Oj(String(i)),Ch(i,r>>>0||(zw.test(i)?16:10))}:Ch;ea({global:!0,forced:parseInt!=Fo},{parseInt:Fo});var Dd=function(i,r,s){if(Wb(i),r===void 0)return i;switch(s){case 0:return function(){return i.call(r)};case 1:return function(u){return i.call(r,u)};case 2:return function(u,l){return i.call(r,u,l)};case 3:return function(u,l,f){return i.call(r,u,l,f)}}return function(){return i.apply(r,arguments)}},Ed=Array.isArray||function(i){return xc(i)=="Array"},Aw=Fa("species"),Dh=function(i,r){if(Ed(i)){var s=i.constructor;typeof s!="function"||s!==Array&&!Ed(s.prototype)?xa(s)&&(s=s[Aw])===null&&(s=void 0):s=void 0}return new(s===void 0?Array:s)(r===0?0:r)},Go=[].push,Fd=function(i){var r=i==1,s=i==2,u=i==3,l=i==4,f=i==6,E=i==7,T=i==5||f;return function(v,w,k,B){var Q=pb(v),X=fg(Q);w=Dd(w,k,3),k=Ma(X.length);var _e,aa=0;for(B=B||Dh,v=r?B(v,k):s||E?B(v,0):void 0;k>aa;aa++)if((T||aa in X)&&(_e=w(B=X[aa],aa,Q),i))if(r)v[aa]=_e;else if(_e)switch(i){case 3:return!0;case 5:return B;case 6:return aa;case 2:Go.call(v,B)}else switch(i){case 4:return!1;case 7:Go.call(v,B)}return f?-1:u||l?l:v}},fe=Fd(0),Ho=Fd(1),Io=Fd(2),Bw=Fd(3),Cw=Fd(4),Jo=Fd(5),Dw=Fd(6),Ew=Fa("species"),kg=function(i){return 51<=Cd||!la(function(){var r=[];return(r.constructor={})[Ew]=function(){return{foo:1}},r[i](Boolean).foo!==1})},Fw=kg("filter");ea({target:"Array",proto:!0,forced:!Fw},{filter:function(i){return Io(this,i,1<arguments.length?arguments[1]:void 0)}});var ed=Object.keys||function(i){return ro(i,zh)},Gw=la(function(){ed(1)});ea({target:"Object",stat:!0,forced:Gw},{keys:function(i){return ed(pb(i))}});var ff=function(i,r){var s=[][i];return!!s&&la(function(){s.call(null,r||function(){throw 1},1)})},Hw=[].join,Iw=fg!=Object,Jw=ff("join",",");ea({target:"Array",proto:!0,forced:Iw||!Jw},{join:function(i){return Hw.call(Mb(this),i===void 0?",":i)}});var Kw=kg("map");ea({target:"Array",proto:!0,forced:!Kw},{map:function(i){return Ho(this,i,1<arguments.length?arguments[1]:void 0)}});var Pj=function(i){var r=i.return;if(r!==void 0)return Ia(r.call(i)).value},gf={},Lw=Fa("iterator"),Mw=Array.prototype,Qj=function(i){return i!==void 0&&(gf.Array===i||Mw[Lw]===i)},hf=function(i,r,s){(r=Oc(r))in i?qb.f(i,r,Nc(0,s)):i[r]=s},Nw=Fa("toStringTag"),Ko={};Ko[Nw]="z";var Rj=String(Ko)==="[object z]",Ow=Fa("toStringTag"),Pw=xc(function(){return arguments}())=="Arguments",jf=Rj?xc:function(i){var r;if(i===void 0)var s="Undefined";else{if(i===null)var u="Null";else{t:{var l=i=Object(i);try{u=l[Ow];break t}catch{}u=void 0}u=typeof(s=u)=="string"?s:Pw?xc(i):(r=xc(i))=="Object"&&typeof i.callee=="function"?"Arguments":r}s=u}return s},Qw=Fa("iterator"),lg=function(i){if(i!=null)return i[Qw]||i["@@iterator"]||gf[jf(i)]},ge=function(i){var r,s=pb(i),u=typeof this=="function"?this:Array,l=arguments.length,f=1<l?arguments[1]:void 0,E=f!==void 0,T=lg(s),v=0;if(E&&(f=Dd(f,2<l?arguments[2]:void 0,2)),T==null||u==Array&&Qj(T)){var w=Ma(s.length);for(u=new u(w);w>v;v++)T=E?f(s[v],v):s[v],hf(u,v,T)}else for(l=(s=T.call(s)).next,u=new u;!(r=l.call(s)).done;v++){if(E){T=s;var k=f;r=[r.value,v];try{w=k(Ia(r)[0],r[1])}catch(B){throw Pj(T),B}}else w=r.value;hf(u,v,T=w)}return u.length=v,u},Lo=Fa("iterator"),Mo=!1;try{var Rw=0,No={next:function(){return{done:!!Rw++}},return:function(){Mo=!0}};No[Lo]=function(){return this},Array.from(No,function(){throw 2})}catch(i){}var Eh=function(i,r){if(!r&&!Mo)return!1;var s=!1;try{(r={})[Lo]=function(){return{next:function(){return{done:s=!0}}}},i(r)}catch{}return s},Sw=!Eh(function(i){Array.from(i)});ea({target:"Array",stat:!0,forced:Sw},{from:ge});var Oo=!la(function(){function i(){}return i.prototype.constructor=null,Object.getPrototypeOf(new i)!==i.prototype}),Po=xh("IE_PROTO"),Tw=Object.prototype,uc=Oo?Object.getPrototypeOf:function(i){return i=pb(i),ka(i,Po)?i[Po]:typeof i.constructor=="function"&&i instanceof i.constructor?i.constructor.prototype:i instanceof Object?Tw:null},Sj=Fa("iterator"),Qo=!1,Uw=function(){return this},he;if([].keys){var Ro=[].keys();if("next"in Ro){var So=uc(uc(Ro));So!==Object.prototype&&(he=So)}else Qo=!0}(he==null||la(function(){var i={};return he[Sj].call(i)!==i}))&&(he={}),ka(he,Sj)||kb(he,Sj,Uw);var Fh=he,Gh=Qo,To=wa?Object.defineProperties:function(i,r){Ia(i);for(var s,u=ed(r),l=u.length,f=0;l>f;)qb.f(i,s=u[f++],r[s]);return i},Tj=Pc("document","documentElement"),Uo=xh("IE_PROTO"),Uj=function(){},Vj,Hh=function(){try{Vj=document.domain&&new ActiveXObject("htmlfile")}catch{}if(Vj){var i=Vj;i.write("<script><\/script>"),i.close(),i=i.parentWindow.Object}else(i=wh?$e.createElement("iframe"):{}).style.display="none",Tj.appendChild(i),i.src="javascript:",(i=i.contentWindow.document).open(),i.write("<script>document.F=Object<\/script>"),i.close(),i=i.F;for(Hh=i,i=zh.length;i--;)delete Hh.prototype[zh[i]];return Hh()};bf[Uo]=!0;var jc=Object.create||function(i,r){if(i!==null){Uj.prototype=Ia(i);var s=new Uj;Uj.prototype=null,s[Uo]=i}else s=Hh();return r===void 0?s:To(s,r)},Vw=qb.f,Vo=Fa("toStringTag"),zc=function(i,r,s){i&&!ka(i=s?i:i.prototype,Vo)&&Vw(i,Vo,{configurable:!0,value:r})},Ww=function(){return this},Wo=function(i,r,s){return r+=" Iterator",i.prototype=jc(Fh,{next:Nc(1,s)}),zc(i,r,!1),gf[r]=Ww,i},tb=Object.setPrototypeOf||("__proto__"in{}?function(){var i=!1,r={};try{var s=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;s.call(r,[]),i=r instanceof Array}catch{}return function(u,l){if(Ia(u),!xa(l)&&l!==null)throw TypeError("Can't set "+String(l)+" as a prototype");return i?s.call(u,l):u.__proto__=l,u}}():void 0),mg=Fa("iterator"),Xw=function(){return this},Wj=function(i,r,s,u,l,f,E){Wo(s,r,u),u=function(aa){if(aa===l&&Q)return Q;if(!Gh&&aa in k)return k[aa];switch(aa){case"keys":case"values":case"entries":return function(){return new s(this,aa)}}return function(){return new s(this)}};var T,v=r+" Iterator",w=!1,k=i.prototype,B=k[mg]||k["@@iterator"]||l&&k[l],Q=!Gh&&B||u(l),X=r=="Array"&&k.entries||B;if(X&&(i=uc(X.call(new i)),Fh!==Object.prototype&&i.next&&(uc(i)!==Fh&&(tb?tb(i,Fh):typeof i[mg]!="function"&&kb(i,mg,Xw)),zc(i,v,!0))),l=="values"&&B&&B.name!=="values"&&(w=!0,Q=function(){return B.call(this)}),k[mg]!==Q&&kb(k,mg,Q),gf[r]=Q,l){var _e={values:u("values"),keys:f?Q:u("keys"),entries:u("entries")};if(E)for(T in _e)!Gh&&!w&&T in k||Za(k,T,_e[T]);else ea({target:r,proto:!0,forced:Gh||w},_e)}return _e},Yw=cb.set,Zw=cb.getterFor("String Iterator");Wj(String,"String",function(i){Yw(this,{type:"String Iterator",string:String(i),index:0})},function(){var i=Zw(this),r=i.string,s=i.index;return s>=r.length?{value:void 0,done:!0}:(r=Eo(r,s),i.index+=r.length,{value:r,done:!1})});var Xj=Fa("unscopables"),Yj=Array.prototype;Yj[Xj]==null&&qb.f(Yj,Xj,{configurable:!0,value:jc(null)});var ng=function(i){Yj[Xj][i]=!0},Xo=!0;"find"in[]&&Array(1).find(function(){Xo=!1}),ea({target:"Array",proto:!0,forced:Xo},{find:function(i){return Jo(this,i,1<arguments.length?arguments[1]:void 0)}}),ng("find");var Yo=function(i){var r=String(Eb(this)),s="";if(0>(i=yc(i))||i==1/0)throw RangeError("Wrong number of repetitions");for(;0<i;(i>>>=1)&&(r+=r))1&i&&(s+=r);return s};ea({target:"String",proto:!0},{repeat:Yo});var Zo=[].indexOf,$o=!!Zo&&0>1/[1].indexOf(1,-0),$w=ff("indexOf");ea({target:"Array",proto:!0,forced:$o||!$w},{indexOf:function(i){return $o?Zo.apply(this,arguments)||0:Fj(this,i,1<arguments.length?arguments[1]:void 0)}});var Zt=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,$t=/CrOS/,au=/android|ipad|playbook|silk/i;Ce.isMobile=Ce,Ce.default=Ce,ea({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),ea({target:"Number",stat:!0},{isNaN:function(i){return i!=i}}),R.Number.isNaN;var ax=Rj?{}.toString:function(){return"[object "+jf(this)+"]"};Rj||Za(Object.prototype,"toString",ax,{unsafe:!0});var Ih=R.Promise,kf=function(i,r,s){for(var u in r)Za(i,u,r[u],s);return i},ap=Fa("species"),og=function(i){i=Pc(i);var r=qb.f;wa&&i&&!i[ap]&&r(i,ap,{configurable:!0,get:function(){return this}})},Ac=function(i,r,s){if(!(i instanceof r))throw TypeError("Incorrect "+(s?s+" ":"")+"invocation");return i},pg=function(i,r){this.stopped=i,this.result=r},Jh=function(i,r,s){var u,l=!(!s||!s.AS_ENTRIES),f=!(!s||!s.IS_ITERATOR),E=!(!s||!s.INTERRUPTED),T=Dd(r,s&&s.that,1+l+E),v=function(k){return w&&Pj(w),new pg(!0,k)};if(r=function(k){return l?(Ia(k),E?T(k[0],k[1],v):T(k[0],k[1])):E?T(k,v):T(k)},f)var w=i;else{if(typeof(f=lg(i))!="function")throw TypeError("Target is not iterable");if(Qj(f)){for(f=0,s=Ma(i.length);s>f;f++)if((u=r(i[f]))&&u instanceof pg)return u;return new pg(!1)}w=f.call(i)}for(i=w.next;!(f=i.call(w)).done;){try{u=r(f.value)}catch(k){throw Pj(w),k}if(typeof u=="object"&&u&&u instanceof pg)return u}return new pg(!1)},bp=/(?:iphone|ipod|ipad).*applewebkit/i.test(df),fd=xc(R.process)=="process",Kh=R.location,Zj=R.setImmediate,cp=R.clearImmediate,bx=R.process,dp=R.MessageChannel,ak=R.Dispatch,bk=0,qg={},ck=function(i){if(qg.hasOwnProperty(i)){var r=qg[i];delete qg[i],r()}},dk=function(i){return function(){ck(i)}},ep=function(i){ck(i.data)},fp=function(i){R.postMessage(i+"",Kh.protocol+"//"+Kh.host)};if(!Zj||!cp)if(Zj=function(i){for(var r=[],s=1;arguments.length>s;)r.push(arguments[s++]);return qg[++bk]=function(){(typeof i=="function"?i:Function(i)).apply(void 0,r)},rg(bk),bk},cp=function(i){delete qg[i]},fd)var rg=function(i){bx.nextTick(dk(i))};else if(ak&&ak.now)rg=function(i){ak.now(dk(i))};else if(dp&&!bp){var gp=new dp,hp=gp.port2;gp.port1.onmessage=ep,rg=Dd(hp.postMessage,hp,1)}else R.addEventListener&&typeof postMessage=="function"&&!R.importScripts&&Kh&&Kh.protocol!=="file:"&&!la(fp)?(rg=fp,R.addEventListener("message",ep,!1)):rg="onreadystatechange"in(wh?$e.createElement("script"):{})?function(i){Tj.appendChild(wh?$e.createElement("script"):{}).onreadystatechange=function(){Tj.removeChild(this),ck(i)}}:function(i){setTimeout(dk(i),0)};var ek=Zj,cx=/web0s(?!.*chrome)/i.test(df),dx=dc.f,ip=R.MutationObserver||R.WebKitMutationObserver,jp=R.document,kp=R.process,Lh=R.Promise,lp=dx(R,"queueMicrotask"),mp=lp&&lp.value,ie,sg;if(!mp){var Nh=function(){var i;for(fd&&(i=kp.domain)&&i.exit();ie;){var r=ie.fn;ie=ie.next;try{r()}catch(s){throw ie?Mh():sg=void 0,s}}sg=void 0,i&&i.enter()};if(bp||fd||cx||!ip||!jp)if(Lh&&Lh.resolve){var fk=Lh.resolve(void 0);fk.constructor=Lh;var ex=fk.then,Mh=function(){ex.call(fk,Nh)}}else Mh=fd?function(){kp.nextTick(Nh)}:function(){ek.call(R,Nh)};else{var np=!0,op=jp.createTextNode("");new ip(Nh).observe(op,{characterData:!0}),Mh=function(){op.data=np=!np}}}var pp=mp||function(i){i={fn:i,next:void 0},sg&&(sg.next=i),ie||(ie=i,Mh()),sg=i},fx=function(i){var r,s;this.promise=new i(function(u,l){if(r!==void 0||s!==void 0)throw TypeError("Bad Promise constructor");r=u,s=l}),this.resolve=Wb(r),this.reject=Wb(s)},gk={f:function(i){return new fx(i)}},gx=function(i,r){var s=R.console;s&&s.error&&(arguments.length===1?s.error(i):s.error(i,r))},hk=function(i){try{return{error:!1,value:i()}}catch(r){return{error:!0,value:r}}},hx=typeof window=="object",ix=Fa("species"),qp=cb.get,jx=cb.set,kx=cb.getterFor("Promise"),je=Ih&&Ih.prototype,Xb=Ih,Oh=je,rp=R.TypeError,ik=R.document,jk=R.process,lf=gk.f,lx=lf,mx=!!(ik&&ik.createEvent&&R.dispatchEvent),sp=typeof PromiseRejectionEvent=="function",tp=!1,tg=Qc("Promise",function(){var i=Cj(Xb)!==String(Xb);if(!i&&Cd===66)return!0;if(51<=Cd&&/native code/.test(Xb))return!1;var r=new Xb(function(u){u(1)}),s=function(u){u(function(){},function(){})};return(r.constructor={})[ix]=s,!(tp=r.then(function(){})instanceof s)||!i&&hx&&!sp}),nx=tg||!Eh(function(i){Xb.all(i).catch(function(){})}),up=function(i){var r;return!(!xa(i)||typeof(r=i.then)!="function")&&r},kk=function(i,r){if(!i.notified){i.notified=!0;var s=i.reactions;pp(function(){for(var u=i.value,l=i.state==1,f=0;s.length>f;){var E,T=s[f++],v=l?T.ok:T.fail,w=T.resolve,k=T.reject,B=T.domain;try{if(v){if(l||(i.rejection===2&&ox(i),i.rejection=1),v===!0)var Q=u;else if(B&&B.enter(),Q=v(u),B){B.exit();var X=!0}Q===T.promise?k(rp("Promise-chain cycle")):(E=up(Q))?E.call(Q,w,k):w(Q)}else k(u)}catch(_e){B&&!X&&B.exit(),k(_e)}}i.reactions=[],i.notified=!1,r&&!i.rejection&&px(i)})}},vp=function(i,r,s){var u;if(mx){var l=ik.createEvent("Event");l.promise=r,l.reason=s,l.initEvent(i,!1,!0),R.dispatchEvent(l)}else l={promise:r,reason:s};!sp&&(u=R["on"+i])?u(l):i==="unhandledrejection"&&gx("Unhandled promise rejection",s)},px=function(i){ek.call(R,function(){var r=i.facade,s=i.value;if(i.rejection!==1&&!i.parent){var u=hk(function(){fd?jk.emit("unhandledRejection",s,r):vp("unhandledrejection",r,s)});if(i.rejection=fd||i.rejection!==1&&!i.parent?2:1,u.error)throw u.value}})},ox=function(i){ek.call(R,function(){var r=i.facade;fd?jk.emit("rejectionHandled",r):vp("rejectionhandled",r,i.value)})},mf=function(i,r,s){return function(u){i(r,u,s)}},nf=function(i,r,s){i.done||(i.done=!0,s&&(i=s),i.value=r,i.state=2,kk(i,!0))},lk=function(i,r,s){if(!i.done){i.done=!0,s&&(i=s);try{if(i.facade===r)throw rp("Promise can't be resolved itself");var u=up(r);u?pp(function(){var l={done:!1};try{u.call(r,mf(lk,l,i),mf(nf,l,i))}catch(f){nf(l,f,i)}}):(i.value=r,i.state=1,kk(i,!1))}catch(l){nf({done:!1},l,i)}}};if(tg){Xb=function(i){Ac(this,Xb,"Promise"),Wb(i),mk.call(this);var r=qp(this);try{i(mf(lk,r),mf(nf,r))}catch(s){nf(r,s)}},Oh=Xb.prototype;var mk=function(i){jx(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};mk.prototype=kf(Oh,{then:function(i,r){var s=kx(this),u=lf(ee(this,Xb));return u.ok=typeof i!="function"||i,u.fail=typeof r=="function"&&r,u.domain=fd?jk.domain:void 0,s.parent=!0,s.reactions.push(u),s.state!=0&&kk(s,!1),u.promise},catch:function(i){return this.then(void 0,i)}});var qx=function(){var i=new mk,r=qp(i);this.promise=i,this.resolve=mf(lk,r),this.reject=mf(nf,r)};if(gk.f=lf=function(i){return i===Xb||i===rx?new qx(i):lx(i)},typeof Ih=="function"&&je!==Object.prototype){var sx=je.then;tp||(Za(je,"then",function(i,r){var s=this;return new Xb(function(u,l){sx.call(s,u,l)}).then(i,r)},{unsafe:!0}),Za(je,"catch",Oh.catch,{unsafe:!0}));try{delete je.constructor}catch{}tb&&tb(je,Oh)}}ea({global:!0,wrap:!0,forced:tg},{Promise:Xb}),zc(Xb,"Promise",!1),og("Promise");var rx=Pc("Promise");ea({target:"Promise",stat:!0,forced:tg},{reject:function(i){var r=lf(this);return r.reject.call(void 0,i),r.promise}}),ea({target:"Promise",stat:!0,forced:tg},{resolve:function(i){if(Ia(this),!xa(i)||i.constructor!==this){var r=gk.f(this);(0,r.resolve)(i),i=r.promise}return i}}),ea({target:"Promise",stat:!0,forced:nx},{all:function(i){var r=this,s=lf(r),u=s.resolve,l=s.reject,f=hk(function(){var E=Wb(r.resolve),T=[],v=0,w=1;Jh(i,function(k){var B=v++,Q=!1;T.push(void 0),w++,E.call(r,k).then(function(X){Q||(Q=!0,T[B]=X,--w||u(T))},l)}),--w||u(T)});return f.error&&l(f.value),s.promise},race:function(i){var r=this,s=lf(r),u=s.reject,l=hk(function(){var f=Wb(r.resolve);Jh(i,function(E){f.call(r,E).then(s.resolve,u)})});return l.error&&u(l.value),s.promise}});var tx=Math.floor,ux="".replace,vx=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,wx=/\$([$&'`]|\d{1,2})/g,xx=function(i,r,s,u,l,f){var E=s+i.length,T=u.length,v=wx;return l!==void 0&&(l=pb(l),v=vx),ux.call(f,v,function(w,k){switch(k.charAt(0)){case"$":return"$";case"&":return i;case"`":return r.slice(0,s);case"'":return r.slice(E);case"<":w=l[k.slice(1,-1)];break;default:var B=+k;if(B===0)return w;if(B>T)return(B=tx(B/10))===0?w:B<=T?u[B-1]===void 0?k.charAt(1):u[B-1]+k.charAt(1):w;w=u[B-1]}return w===void 0?"":w})},yx=Math.max,zx=Math.min;Bh("replace",2,function(i,r,s,u){var l=u.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,f=u.REPLACE_KEEPS_$0,E=l?"$":"$0";return[function(T,v){var w=Eb(this),k=T==null?void 0:T[i];return k!==void 0?k.call(T,w,v):r.call(String(w),T,v)},function(T,v){if(!l&&f||typeof v=="string"&&v.indexOf(E)===-1){var w=s(r,T,this,v);if(w.done)return w.value}var k=Ia(T);T=String(this),(w=typeof v=="function")||(v=String(v));var B=k.global;if(B){var Q=k.unicode;k.lastIndex=0}for(var X=[];;){var _e=ef(k,T);if(_e===null||(X.push(_e),!B))break;String(_e[0])===""&&(k.lastIndex=Mj(T,Ma(k.lastIndex),Q))}for(Q="",B=k=0;B<X.length;B++){_e=X[B];for(var aa=String(_e[0]),_i=yx(zx(yc(_e.index),T.length),0),_a=[],ga=1;ga<_e.length;ga++){var _d=_a,d_=_e[ga];_d.push.call(_d,d_===void 0?d_:String(d_))}_e=_e.groups,w?(_a=[aa].concat(_a,_i,T),_e!==void 0&&_a.push(_e),_e=String(v.apply(void 0,_a))):_e=xx(aa,T,_i,_a,_e,v),_i>=k&&(Q+=T.slice(k,_i)+_e,k=_i+aa.length)}return Q+T.slice(k)}]});var Ax=kg("slice"),Bx=Fa("species"),Cx=[].slice,Dx=Math.max;ea({target:"Array",proto:!0,forced:!Ax},{slice:function(i,r){var s=Mb(this),u=Ma(s.length);if(i=Vb(i,u),r=Vb(r===void 0?u:r,u),Ed(s)){var l=s.constructor;if(typeof l!="function"||l!==Array&&!Ed(l.prototype)?xa(l)&&(l=l[Bx])===null&&(l=void 0):l=void 0,l===Array||l===void 0)return Cx.call(s,i,r)}for(l=new(l===void 0?Array:l)(Dx(r-i,0)),u=0;i<r;i++,u++)i in s&&hf(l,u,s[i]);return l.length=u,l}});var Ex=cb.set,Fx=cb.getterFor("Array Iterator"),Gd=Wj(Array,"Array",function(i,r){Ex(this,{type:"Array Iterator",target:Mb(i),index:0,kind:r})},function(){var i=Fx(this),r=i.target,s=i.kind,u=i.index++;return!r||u>=r.length?(i.target=void 0,{value:void 0,done:!0}):s=="keys"?{value:u,done:!1}:s=="values"?{value:r[u],done:!1}:{value:[u,r[u]],done:!1}},"values");gf.Arguments=gf.Array,ng("keys"),ng("values"),ng("entries");var wp=typeof ArrayBuffer<"u"&&typeof DataView<"u",of=function(i){if(i===void 0)return 0;i=yc(i);var r=Ma(i);if(i!==r)throw RangeError("Wrong length or index");return r},Gx=Math.abs,gd=Math.pow,Hx=Math.floor,Ix=Math.log,Jx=Math.LN2,xp=function(i){var r=pb(this),s=Ma(r.length),u=arguments.length,l=Vb(1<u?arguments[1]:void 0,s);for(s=(u=2<u?arguments[2]:void 0)===void 0?s:Vb(u,s);s>l;)r[l++]=i;return r},Kx=de.f,Lx=qb.f,pf=cb.get,yp=cb.set,Bc=R.ArrayBuffer,Yb=Bc,Cc=R.DataView,Ph=Cc&&Cc.prototype,zp=Object.prototype,Qh=R.RangeError,Ap=function(i,r,s){var u,l=Array(s),f=(1<<(s=8*s-r-1))-1,E=f>>1,T=r===23?gd(2,-24)-gd(2,-77):0,v=0>i||i===0&&0>1/i?1:0,w=0;if((i=Gx(i))!=i||i===1/0){i=i!=i?1:0;var k=f}else k=Hx(Ix(i)/Jx),1>i*(u=gd(2,-k))&&(k--,u*=2),2<=(i=1<=k+E?i+T/u:i+T*gd(2,1-E))*u&&(k++,u/=2),k+E>=f?(i=0,k=f):1<=k+E?(i=(i*u-1)*gd(2,r),k+=E):(i=i*gd(2,E-1)*gd(2,r),k=0);for(;8<=r;l[w++]=255&i,i/=256,r-=8);for(k=k<<r|i,s+=r;0<s;l[w++]=255&k,k/=256,s-=8);return l[--w]|=128*v,l},Bp=function(i,r){var s=i.length,u=8*s-r-1,l=(1<<u)-1,f=l>>1;u-=7,--s;var E=i[s--],T=127&E;for(E>>=7;0<u;T=256*T+i[s],s--,u-=8);var v=T&(1<<-u)-1;for(T>>=-u,u+=r;0<u;v=256*v+i[s],s--,u-=8);if(T===0)T=1-f;else{if(T===l)return v?NaN:E?-1/0:1/0;v+=gd(2,r),T-=f}return(E?-1:1)*v*gd(2,T-r)},Cp=function(i){return[255&i]},Dp=function(i){return[255&i,i>>8&255]},Ep=function(i){return[255&i,i>>8&255,i>>16&255,i>>24&255]},Fp=function(i){return i[3]<<24|i[2]<<16|i[1]<<8|i[0]},Mx=function(i){return Ap(i,23,4)},Nx=function(i){return Ap(i,52,8)},Rh=function(i,r){Lx(i.prototype,r,{get:function(){return pf(this)[r]}})},Hd=function(i,r,s,u){s=of(s);var l=pf(i);if(s+r>l.byteLength)throw Qh("Wrong index");return i=pf(l.buffer).bytes,s+=l.byteOffset,r=i.slice(s,s+r),u?r:r.reverse()},Id=function(i,r,s,u,l,f){s=of(s);var E=pf(i);if(s+r>E.byteLength)throw Qh("Wrong index");for(i=pf(E.buffer).bytes,s+=E.byteOffset,u=u(+l),l=0;l<r;l++)i[s+l]=u[f?l:r-l-1]};if(wp){if(!la(function(){Bc(1)})||!la(function(){new Bc(-1)})||la(function(){return new Bc,new Bc(1.5),new Bc(NaN),Bc.name!="ArrayBuffer"})){Yb=function(i){return Ac(this,Yb),new Bc(of(i))};for(var Ox=Yb.prototype=Bc.prototype,Gp=Kx(Bc),Hp=0,nk;Gp.length>Hp;)(nk=Gp[Hp++])in Yb||kb(Yb,nk,Bc[nk]);Ox.constructor=Yb}tb&&uc(Ph)!==zp&&tb(Ph,zp);var Sh=new Cc(new Yb(2)),Ip=Ph.setInt8;Sh.setInt8(0,2147483648),Sh.setInt8(1,2147483649),!Sh.getInt8(0)&&Sh.getInt8(1)||kf(Ph,{setInt8:function(i,r){Ip.call(this,i,r<<24>>24)},setUint8:function(i,r){Ip.call(this,i,r<<24>>24)}},{unsafe:!0})}else Yb=function(i){Ac(this,Yb,"ArrayBuffer"),i=of(i),yp(this,{bytes:xp.call(Array(i),0),byteLength:i}),wa||(this.byteLength=i)},Cc=function(i,r,s){Ac(this,Cc,"DataView"),Ac(i,Yb,"DataView");var u=pf(i).byteLength;if(0>(r=yc(r))||r>u)throw Qh("Wrong offset");if(r+(s=s===void 0?u-r:Ma(s))>u)throw Qh("Wrong length");yp(this,{buffer:i,byteLength:s,byteOffset:r}),wa||(this.buffer=i,this.byteLength=s,this.byteOffset=r)},wa&&(Rh(Yb,"byteLength"),Rh(Cc,"buffer"),Rh(Cc,"byteLength"),Rh(Cc,"byteOffset")),kf(Cc.prototype,{getInt8:function(i){return Hd(this,1,i)[0]<<24>>24},getUint8:function(i){return Hd(this,1,i)[0]},getInt16:function(i){var r=Hd(this,2,i,1<arguments.length?arguments[1]:void 0);return(r[1]<<8|r[0])<<16>>16},getUint16:function(i){var r=Hd(this,2,i,1<arguments.length?arguments[1]:void 0);return r[1]<<8|r[0]},getInt32:function(i){return Fp(Hd(this,4,i,1<arguments.length?arguments[1]:void 0))},getUint32:function(i){return Fp(Hd(this,4,i,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(i){return Bp(Hd(this,4,i,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(i){return Bp(Hd(this,8,i,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(i,r){Id(this,1,i,Cp,r)},setUint8:function(i,r){Id(this,1,i,Cp,r)},setInt16:function(i,r){Id(this,2,i,Dp,r,2<arguments.length?arguments[2]:void 0)},setUint16:function(i,r){Id(this,2,i,Dp,r,2<arguments.length?arguments[2]:void 0)},setInt32:function(i,r){Id(this,4,i,Ep,r,2<arguments.length?arguments[2]:void 0)},setUint32:function(i,r){Id(this,4,i,Ep,r,2<arguments.length?arguments[2]:void 0)},setFloat32:function(i,r){Id(this,4,i,Mx,r,2<arguments.length?arguments[2]:void 0)},setFloat64:function(i,r){Id(this,8,i,Nx,r,2<arguments.length?arguments[2]:void 0)}});zc(Yb,"ArrayBuffer"),zc(Cc,"DataView");var ug={ArrayBuffer:Yb,DataView:Cc},ok=ug.ArrayBuffer,Jp=ug.DataView,Kp=ok.prototype.slice,Px=la(function(){return!new ok(2).slice(1,void 0).byteLength});ea({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Px},{slice:function(i,r){if(Kp!==void 0&&r===void 0)return Kp.call(Ia(this),i);var s=Ia(this).byteLength;i=Vb(i,s),r=Vb(r===void 0?s:r,s),s=new(ee(this,ok))(Ma(r-i));for(var u=new Jp(this),l=new Jp(s),f=0;i<r;)l.setUint8(f++,u.getUint8(i++));return s}});var Qx=qb.f,Th=R.Int8Array,pk=Th&&Th.prototype,Lp=R.Uint8ClampedArray,Mp=Lp&&Lp.prototype,Tc=Th&&uc(Th),Dc=pk&&uc(pk),Np=Object.prototype,Op=Np.isPrototypeOf,Pp=Fa("toStringTag"),qk=af("TYPED_ARRAY_TAG"),hd=wp&&!!tb&&jf(R.opera)!=="Opera",Qp=!1,Zb,Uc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Rx={BigInt64Array:8,BigUint64Array:8},Uh=function(i){return!!xa(i)&&(i=jf(i),ka(Uc,i)||ka(Rx,i))};for(Zb in Uc)R[Zb]||(hd=!1);if((!hd||typeof Tc!="function"||Tc===Function.prototype)&&(Tc=function(){throw TypeError("Incorrect invocation")},hd))for(Zb in Uc)R[Zb]&&tb(R[Zb],Tc);if((!hd||!Dc||Dc===Np)&&(Dc=Tc.prototype,hd))for(Zb in Uc)R[Zb]&&tb(R[Zb].prototype,Dc);if(hd&&uc(Mp)!==Dc&&tb(Mp,Dc),wa&&!ka(Dc,Pp))for(Zb in Qp=!0,Qx(Dc,Pp,{get:function(){return xa(this)?this[qk]:void 0}}),Uc)R[Zb]&&kb(R[Zb],qk,Zb);var vg=hd,Rp=Qp&&qk,Ua=function(i){if(Uh(i))return i;throw TypeError("Target is not a typed array")},qf=function(i){if(tb){if(Op.call(Tc,i))return i}else for(var r in Uc)if(ka(Uc,Zb)){var s=R[r];if(s&&(i===s||Op.call(s,i)))return i}throw TypeError("Target is not a typed array constructor")},Ra=function(i,r,s){if(wa){if(s)for(var u in Uc){var l=R[u];if(l&&ka(l.prototype,i))try{delete l.prototype[i]}catch{}}Dc[i]&&!s||Za(Dc,i,s?r:hd&&pk[i]||r)}},Sp=function(i,r,s){var u,l;if(wa){if(tb){if(s){for(u in Uc)if((l=R[u])&&ka(l,i))try{delete l[i]}catch{}}if(Tc[i]&&!s)return;try{return Za(Tc,i,s?r:hd&&Tc[i]||r)}catch{}}for(u in Uc)!(l=R[u])||l[i]&&!s||Za(l,i,r)}},Tp=Tc,wg=Dc,Sx=R.ArrayBuffer,ke=R.Int8Array,rk=!vg||!la(function(){ke(1)})||!la(function(){new ke(-1)})||!Eh(function(i){new ke,new ke(null),new ke(1.5),new ke(i)},!0)||la(function(){return new ke(new Sx(2),1,void 0).length!==1}),Vh=function(i,r){if(0>(i=yc(i)))throw RangeError("The argument can't be less than 0");if(i%r)throw RangeError("Wrong offset");return i},sk=function(i){var r=pb(i),s=arguments.length,u=1<s?arguments[1]:void 0,l=u!==void 0,f=lg(r);if(f!=null&&!Qj(f)){var E=f.call(r),T=E.next;for(r=[];!(f=T.call(E)).done;)r.push(f.value)}for(l&&2<s&&(u=Dd(u,arguments[2],2)),f=Ma(r.length),E=new(qf(this))(f),s=0;f>s;s++)E[s]=l?u(r[s],s):r[s];return E},Wh=function(i,r,s){var u,l;return tb&&typeof(u=r.constructor)=="function"&&u!==s&&xa(l=u.prototype)&&l!==s.prototype&&tb(i,l),i},xg=xb(function(i){var r=de.f,s=cb.get,u=cb.set,l=qb.f,f=dc.f,E=Math.round,T=R.RangeError,v=ug.ArrayBuffer,w=ug.DataView,k=function(_i,_a){var ga=0,_d=_a.length;for(_i=new(qf(_i))(_d);_d>ga;)_i[ga]=_a[ga++];return _i},B=function(_i,_a){l(_i,_a,{get:function(){return s(this)[_a]}})},Q=function(_i){var _a;return _i instanceof v||(_a=jf(_i))=="ArrayBuffer"||_a=="SharedArrayBuffer"},X=function(_i,_a){return Uh(_i)&&typeof _a!="symbol"&&_a in _i&&String(+_a)==String(_a)},_e=function(_i,_a){return X(_i,_a=Oc(_a,!0))?Nc(2,_i[_a]):f(_i,_a)},aa=function(_i,_a,ga){return!(X(_i,_a=Oc(_a,!0))&&xa(ga)&&ka(ga,"value"))||ka(ga,"get")||ka(ga,"set")||ga.configurable||ka(ga,"writable")&&!ga.writable||ka(ga,"enumerable")&&!ga.enumerable?l(_i,_a,ga):(_i[_a]=ga.value,_i)};wa?(vg||(dc.f=_e,qb.f=aa,B(wg,"buffer"),B(wg,"byteOffset"),B(wg,"byteLength"),B(wg,"length")),ea({target:"Object",stat:!0,forced:!vg},{getOwnPropertyDescriptor:_e,defineProperty:aa}),i.exports=function(_i,_a,ga){var _d=_i.match(/\d+$/)[0]/8,d_=_i+(ga?"Clamped":"")+"Array",T_="get"+_i,P_="set"+_i,g_=R[d_],j_=g_;_i=j_&&j_.prototype;var wS={},_m=function(l_,a_){l(l_,a_,{get:function(){var y_=s(this);return y_.view[T_](a_*_d+y_.byteOffset,!0)},set:function(y_){var _c=s(this);ga&&(y_=0>(y_=E(y_))?0:255<y_?255:255&y_),_c.view[P_](a_*_d+_c.byteOffset,y_,!0)},enumerable:!0})};vg?rk&&(j_=_a(function(l_,a_,y_,_c){return Ac(l_,j_,d_),Wh(xa(a_)?Q(a_)?_c!==void 0?new g_(a_,Vh(y_,_d),_c):y_!==void 0?new g_(a_,Vh(y_,_d)):new g_(a_):Uh(a_)?k(j_,a_):sk.call(j_,a_):new g_(of(a_)),l_,j_)}),tb&&tb(j_,Tp),fe(r(g_),function(l_){l_ in j_||kb(j_,l_,g_[l_])}),j_.prototype=_i):(j_=_a(function(l_,a_,y_,_c){Ac(l_,j_,d_);var _f=0,r_=0;if(xa(a_)){if(!Q(a_))return Uh(a_)?k(j_,a_):sk.call(j_,a_);var v_=a_;if(r_=Vh(y_,_d),a_=a_.byteLength,_c===void 0){if(a_%_d||0>(_c=a_-r_))throw T("Wrong length")}else if((_c=Ma(_c)*_d)+r_>a_)throw T("Wrong length");a_=_c/_d}else a_=of(a_),v_=new v(_c=a_*_d);for(u(l_,{buffer:v_,byteOffset:r_,byteLength:_c,length:a_,view:new w(v_)});_f<a_;)_m(l_,_f++)}),tb&&tb(j_,Tp),_i=j_.prototype=jc(wg)),_i.constructor!==j_&&kb(_i,"constructor",j_),Rp&&kb(_i,Rp,d_),wS[d_]=j_,ea({global:!0,forced:j_!=g_,sham:!vg},wS),"BYTES_PER_ELEMENT"in j_||kb(j_,"BYTES_PER_ELEMENT",_d),"BYTES_PER_ELEMENT"in _i||kb(_i,"BYTES_PER_ELEMENT",_d),og(d_)}):i.exports=function(){}});xg("Uint8",function(i){return function(r,s,u){return i(this,r,s,u)}});var Tx=Math.min,Ux=[].copyWithin||function(i,r){var s=pb(this),u=Ma(s.length),l=Vb(i,u),f=Vb(r,u),E=2<arguments.length?arguments[2]:void 0;for(u=Tx((E===void 0?u:Vb(E,u))-f,u-l),E=1,f<l&&l<f+u&&(E=-1,f+=u-1,l+=u-1);0<u--;)f in s?s[l]=s[f]:delete s[l],l+=E,f+=E;return s};Ra("copyWithin",function(i,r){return Ux.call(Ua(this),i,r,2<arguments.length?arguments[2]:void 0)}),Ra("every",function(i){return Cw(Ua(this),i,1<arguments.length?arguments[1]:void 0)}),Ra("fill",function(i){return xp.apply(Ua(this),arguments)}),Ra("filter",function(i){var r=Io(Ua(this),i,1<arguments.length?arguments[1]:void 0),s=ee(this,this.constructor),u=0,l=r.length;for(s=new(qf(s))(l);l>u;)s[u]=r[u++];return s}),Ra("find",function(i){return Jo(Ua(this),i,1<arguments.length?arguments[1]:void 0)}),Ra("findIndex",function(i){return Dw(Ua(this),i,1<arguments.length?arguments[1]:void 0)}),Ra("forEach",function(i){fe(Ua(this),i,1<arguments.length?arguments[1]:void 0)}),Ra("includes",function(i){return qo(Ua(this),i,1<arguments.length?arguments[1]:void 0)}),Ra("indexOf",function(i){return Fj(Ua(this),i,1<arguments.length?arguments[1]:void 0)});var Up=Fa("iterator"),Vp=R.Uint8Array,Vx=Gd.values,Wx=Gd.keys,Xx=Gd.entries,tk=Vp&&Vp.prototype[Up],Wp=!!tk&&(tk.name=="values"||tk.name==null),Xp=function(){return Vx.call(Ua(this))};Ra("entries",function(){return Xx.call(Ua(this))}),Ra("keys",function(){return Wx.call(Ua(this))}),Ra("values",Xp,!Wp),Ra(Up,Xp,!Wp);var Yx=[].join;Ra("join",function(i){return Yx.apply(Ua(this),arguments)});var Zx=Math.min,uk=[].lastIndexOf,Yp=!!uk&&0>1/[1].lastIndexOf(1,-0),$x=ff("lastIndexOf"),ay=Yp||!$x?function(i){if(Yp)return uk.apply(this,arguments)||0;var r=Mb(this),s=Ma(r.length),u=s-1;for(1<arguments.length&&(u=Zx(u,yc(arguments[1]))),0>u&&(u=s+u);0<=u;u--)if(u in r&&r[u]===i)return u||0;return-1}:uk;Ra("lastIndexOf",function(i){return ay.apply(Ua(this),arguments)}),Ra("map",function(i){return Ho(Ua(this),i,1<arguments.length?arguments[1]:void 0,function(r,s){return new(qf(ee(r,r.constructor)))(s)})});var Zp=function(i){return function(r,s,u,l){Wb(s),r=pb(r);var f=fg(r),E=Ma(r.length),T=i?E-1:0,v=i?-1:1;if(2>u)for(;;){if(T in f){l=f[T],T+=v;break}if(T+=v,i?0>T:E<=T)throw TypeError("Reduce of empty array with no initial value")}for(;i?0<=T:E>T;T+=v)T in f&&(l=s(l,f[T],T,r));return l}},$p=Zp(!1),by=Zp(!0);Ra("reduce",function(i){return $p(Ua(this),i,arguments.length,1<arguments.length?arguments[1]:void 0)}),Ra("reduceRight",function(i){return by(Ua(this),i,arguments.length,1<arguments.length?arguments[1]:void 0)});var cy=Math.floor;Ra("reverse",function(){for(var i,r=Ua(this).length,s=cy(r/2),u=0;u<s;)i=this[u],this[u++]=this[--r],this[r]=i;return this});var dy=la(function(){new Int8Array(1).set({})});Ra("set",function(i){Ua(this);var r=Vh(1<arguments.length?arguments[1]:void 0,1),s=this.length,u=pb(i),l=Ma(u.length),f=0;if(l+r>s)throw RangeError("Wrong length");for(;f<l;)this[r+f]=u[f++]},dy);var ey=[].slice,fy=la(function(){new Int8Array(1).slice()});Ra("slice",function(i,r){i=ey.call(Ua(this),i,r);var s=ee(this,this.constructor);r=0;var u=i.length;for(s=new(qf(s))(u);u>r;)s[r]=i[r++];return s},fy),Ra("some",function(i){return Bw(Ua(this),i,1<arguments.length?arguments[1]:void 0)});var gy=[].sort;Ra("sort",function(i){return gy.call(Ua(this),i)}),Ra("subarray",function(i,r){var s=Ua(this),u=s.length;return i=Vb(i,u),new(ee(s,s.constructor))(s.buffer,s.byteOffset+i*s.BYTES_PER_ELEMENT,Ma((r===void 0?u:Vb(r,u))-i))});var Xh=R.Int8Array,aq=[].toLocaleString,hy=[].slice,iy=!!Xh&&la(function(){aq.call(new Xh(1))}),jy=la(function(){return[1,2].toLocaleString()!=new Xh([1,2]).toLocaleString()})||!la(function(){Xh.prototype.toLocaleString.call([1,2])});Ra("toLocaleString",function(){return aq.apply(iy?hy.call(Ua(this)):Ua(this),arguments)},jy);var bq=R.Uint8Array,ky=bq&&bq.prototype||{},Yh=[].toString,ly=[].join;la(function(){Yh.call({})})&&(Yh=function(){return ly.call(this)}),Ra("toString",Yh,ky.toString!=Yh);var cq=ug.ArrayBuffer;ea({global:!0,forced:R.ArrayBuffer!==cq},{ArrayBuffer:cq}),og("ArrayBuffer");var my=qb.f,vk=Function.prototype,ny=vk.toString,oy=/^\s*function ([^ (]*)/;!wa||"name"in vk||my(vk,"name",{configurable:!0,get:function(){try{return ny.call(this).match(oy)[1]}catch{return""}}});var dq=RegExp.prototype,eq=dq.toString,py=la(function(){return eq.call({source:"a",flags:"b"})!="/a/b"}),qy=eq.name!="toString";(py||qy)&&Za(RegExp.prototype,"toString",function(){var i=Ia(this),r=String(i.source),s=i.flags;return"/"+r+"/"+(i=String(s===void 0&&i instanceof RegExp&&!("flags"in dq)?Gj.call(i):s))},{unsafe:!0});var ry=kg("splice"),sy=Math.max,ty=Math.min;ea({target:"Array",proto:!0,forced:!ry},{splice:function(i,r){var s,u,l=pb(this),f=Ma(l.length),E=Vb(i,f),T=arguments.length;if(T===0?T=s=0:T===1?(T=0,s=f-E):(T-=2,s=ty(sy(yc(r),0),f-E)),9007199254740991<f+T-s)throw TypeError("Maximum allowed length exceeded");var v=Dh(l,s);for(u=0;u<s;u++){var w=E+u;w in l&&hf(v,u,l[w])}if(v.length=s,T<s){for(u=E;u<f-s;u++){var k=u+T;(w=u+s)in l?l[k]=l[w]:delete l[k]}for(u=f;u>f-s+T;u--)delete l[u-1]}else if(T>s)for(u=f-s;u>E;u--)k=u+T-1,(w=u+s-1)in l?l[k]=l[w]:delete l[k];for(u=0;u<T;u++)l[u+E]=arguments[u+2];return l.length=f-s+T,v}});var wk={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},xk=Fa("iterator"),fq=Fa("toStringTag"),yk=Gd.values,Zh;for(Zh in wk){var gq=R[Zh],id=gq&&gq.prototype;if(id){if(id[xk]!==yk)try{kb(id,xk,yk)}catch{id[xk]=yk}if(id[fq]||kb(id,fq,Zh),wk[Zh]){for(var rf in Gd)if(id[rf]!==Gd[rf])try{kb(id,rf,Gd[rf])}catch{id[rf]=Gd[rf]}}}}var hq=Object.is||function(i,r){return i===r?i!==0||1/i==1/r:i!=i&&r!=r};Bh("search",1,function(i,r,s){return[function(u){var l=Eb(this),f=u==null?void 0:u[i];return f!==void 0?f.call(u,l):new RegExp(u)[i](String(l))},function(u){var l=s(r,u,this);if(l.done)return l.value;u=Ia(u);var f=String(this);return l=u.lastIndex,hq(l,0)||(u.lastIndex=0),f=ef(u,f),hq(u.lastIndex,l)||(u.lastIndex=l),f===null?-1:f.index}]}),xb(function(i){(function(r,s){i.exports?i.exports=s(r):s(r)})(typeof self<"u"?self:Ya,function(r){function s(_m){return btoa(_m).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function u(_m){return _m=(_m+="===").slice(0,-_m.length%4),atob(_m.replace(/-/g,"+").replace(/_/g,"/"))}function l(_m){for(var l_=new Uint8Array(_m.length),a_=0;a_<_m.length;a_++)l_[a_]=_m.charCodeAt(a_);return l_}function f(_m){return _m instanceof ArrayBuffer&&(_m=new Uint8Array(_m)),String.fromCharCode.apply(String,_m)}function E(_m){var l_={name:(_m.name||_m||"").toUpperCase().replace("V","v")};switch(l_.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":_m.length&&(l_.length=_m.length);break;case"HMAC":_m.hash&&(l_.hash=E(_m.hash)),_m.length&&(l_.length=_m.length);break;case"RSAES-PKCS1-v1_5":_m.publicExponent&&(l_.publicExponent=new Uint8Array(_m.publicExponent)),_m.modulusLength&&(l_.modulusLength=_m.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":_m.hash&&(l_.hash=E(_m.hash)),_m.publicExponent&&(l_.publicExponent=new Uint8Array(_m.publicExponent)),_m.modulusLength&&(l_.modulusLength=_m.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return l_}function T(_m){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[_m.name][(_m.hash||{}).name||_m.length||""]}function v(_m){(_m instanceof ArrayBuffer||_m instanceof Uint8Array)&&(_m=JSON.parse(decodeURIComponent(escape(f(_m)))));var l_={kty:_m.kty,alg:_m.alg,ext:_m.ext||_m.extractable};switch(l_.kty){case"oct":l_.k=_m.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach(function(a_){a_ in _m&&(l_[a_]=_m[a_])});break;default:throw new TypeError("Unsupported key type")}return l_}function w(_m){return _m=v(_m),T_&&(_m.extractable=_m.ext,delete _m.ext),l(unescape(encodeURIComponent(JSON.stringify(_m)))).buffer}function k(_m){var l_=B(_m),a_=!1;switch(2<l_.length&&(a_=!0,l_.shift()),_m={ext:!0},l_[0][0]){case"1.2.840.113549.1.1.1":var y_="n e d p q dp dq qi".split(" ");for(l_=B(l_[1]),a_&&l_.shift(),a_=0;a_<l_.length;a_++)l_[a_][0]||(l_[a_]=l_[a_].subarray(1)),_m[y_[a_]]=s(f(l_[a_]));_m.kty="RSA";break;default:throw new TypeError("Unsupported key type")}return _m}function B(_m,l_){if(_m instanceof ArrayBuffer&&(_m=new Uint8Array(_m)),l_||(l_={pos:0,end:_m.length}),2>l_.end-l_.pos||l_.end>_m.length)throw new RangeError("Malformed DER");var a_=_m[l_.pos++],y_=_m[l_.pos++];if(128<=y_){if(y_&=127,l_.end-l_.pos<y_)throw new RangeError("Malformed DER");for(var _c=0;y_--;)_c<<=8,_c|=_m[l_.pos++];y_=_c}if(l_.end-l_.pos<y_)throw new RangeError("Malformed DER");switch(a_){case 2:a_=_m.subarray(l_.pos,l_.pos+=y_);break;case 3:if(_m[l_.pos++])throw Error("Unsupported bit string");y_--;case 4:a_=new Uint8Array(_m.subarray(l_.pos,l_.pos+=y_)).buffer;break;case 5:a_=null;break;case 6:if(!((_m=btoa(f(_m.subarray(l_.pos,l_.pos+=y_))))in g_))throw Error("Unsupported OBJECT ID "+_m);a_=g_[_m];break;case 48:for(a_=[],y_=l_.pos+y_;l_.pos<y_;)a_.push(B(_m,l_));break;default:throw Error("Unsupported DER tag 0x"+a_.toString(16))}return a_}function Q(_m,l_){l_||(l_=[]);var a_=l_.length+2;if(l_.push(0,0),_m instanceof Uint8Array)for(var y_=2,_c=_m.length,_f=0;_f<_c;_f++)l_.push(_m[_f]);else if(_m instanceof ArrayBuffer)for(y_=4,_c=_m.byteLength,_m=new Uint8Array(_m),_f=0;_f<_c;_f++)l_.push(_m[_f]);else if(_m===null)y_=5,_c=0;else if(typeof _m=="string"&&_m in j_)for(y_=6,_c=(_m=l(atob(j_[_m]))).length,_f=0;_f<_c;_f++)l_.push(_m[_f]);else if(_m instanceof Array){for(_f=0;_f<_m.length;_f++)Q(_m[_f],l_);y_=48,_c=l_.length-a_}else{if(!(qa(_m)==="object"&&_m.tag===3&&_m.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+_m);for(y_=3,_c=(_m=new Uint8Array(_m.value)).byteLength,l_.push(0),_f=0;_f<_c;_f++)l_.push(_m[_f]);_c++}if(128<=_c){for(_f=_c,_c=4,l_.splice(a_,0,_f>>24&255,_f>>16&255,_f>>8&255,255&_f);1<_c&&!(_f>>24);)_f<<=8,_c--;4>_c&&l_.splice(a_,4-_c),_c|=128}return l_.splice(a_-2,2,y_,_c),l_}function X(_m,l_,a_,y_){Object.defineProperties(this,{_key:{value:_m},type:{value:_m.type,enumerable:!0},extractable:{value:a_===void 0?_m.extractable:a_,enumerable:!0},algorithm:{value:l_===void 0?_m.algorithm:l_,enumerable:!0},usages:{value:y_===void 0?_m.usages:y_,enumerable:!0}})}function _e(_m){return _m==="verify"||_m==="encrypt"||_m==="wrapKey"}function aa(_m){return _m==="sign"||_m==="decrypt"||_m==="unwrapKey"}if(typeof Promise!="function")throw"Promise support required";var _i=r.crypto||r.msCrypto;if(_i){var _a=_i.subtle||_i.webkitSubtle;if(_a){var ga=r.Crypto||_i.constructor||Object,_d=r.SubtleCrypto||_a.constructor||Object;r.CryptoKey||r.Key;var d_=-1<r.navigator.userAgent.indexOf("Edge/"),T_=!!r.msCrypto&&!d_,P_=!_i.subtle&&!!_i.webkitSubtle;if(T_||P_){var g_={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},j_={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach(function(_m){var l_=_a[_m];_a[_m]=function(a_,y_,_c){var _f=[].slice.call(arguments);switch(_m){case"generateKey":var r_=E(a_),v_=y_,S_=_c;break;case"importKey":r_=E(_c),v_=_f[3],S_=_f[4],a_==="jwk"&&((y_=v(y_)).alg||(y_.alg=T(r_)),y_.key_ops||(y_.key_ops=y_.kty!=="oct"?"d"in y_?S_.filter(aa):S_.filter(_e):S_.slice()),_f[1]=w(y_));break;case"unwrapKey":r_=_f[4],v_=_f[5],S_=_f[6],_f[2]=_c._key}if(_m==="generateKey"&&r_.name==="HMAC"&&r_.hash)return r_.length=r_.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[r_.hash.name],_a.importKey("raw",_i.getRandomValues(new Uint8Array(r_.length+7>>3)),r_,v_,S_);if(P_&&_m==="generateKey"&&r_.name==="RSASSA-PKCS1-v1_5"&&(!r_.modulusLength||2048<=r_.modulusLength))return(a_=E(a_)).name="RSAES-PKCS1-v1_5",delete a_.hash,_a.generateKey(a_,!0,["encrypt","decrypt"]).then(function(w_){return Promise.all([_a.exportKey("jwk",w_.publicKey),_a.exportKey("jwk",w_.privateKey)])}).then(function(w_){return w_[0].alg=w_[1].alg=T(r_),w_[0].key_ops=S_.filter(_e),w_[1].key_ops=S_.filter(aa),Promise.all([_a.importKey("jwk",w_[0],r_,!0,w_[0].key_ops),_a.importKey("jwk",w_[1],r_,v_,w_[1].key_ops)])}).then(function(w_){return{publicKey:w_[0],privateKey:w_[1]}});if((P_||T_&&(r_.hash||{}).name==="SHA-1")&&_m==="importKey"&&a_==="jwk"&&r_.name==="HMAC"&&y_.kty==="oct")return _a.importKey("raw",l(u(y_.k)),_c,_f[3],_f[4]);if(P_&&_m==="importKey"&&(a_==="spki"||a_==="pkcs8"))return _a.importKey("jwk",k(y_),_c,_f[3],_f[4]);if(T_&&_m==="unwrapKey")return _a.decrypt(_f[3],_c,y_).then(function(w_){return _a.importKey(a_,w_,_f[4],_f[5],_f[6])});try{var U_=l_.apply(_a,_f)}catch(w_){return Promise.reject(w_)}return T_&&(U_=new Promise(function(w_,RT){U_.onabort=U_.onerror=function(Q_){RT(Q_)},U_.oncomplete=function(Q_){w_(Q_.target.result)}})),U_=U_.then(function(w_){return r_.name!=="HMAC"||r_.length||(r_.length=8*w_.algorithm.length),r_.name.search("RSA")==0&&(r_.modulusLength||(r_.modulusLength=(w_.publicKey||w_).algorithm.modulusLength),r_.publicExponent||(r_.publicExponent=(w_.publicKey||w_).algorithm.publicExponent)),w_.publicKey&&w_.privateKey?{publicKey:new X(w_.publicKey,r_,v_,S_.filter(_e)),privateKey:new X(w_.privateKey,r_,v_,S_.filter(aa))}:new X(w_,r_,v_,S_)})}}),["exportKey","wrapKey"].forEach(function(_m){var l_=_a[_m];_a[_m]=function(a_,y_,_c){var _f=[].slice.call(arguments);switch(_m){case"exportKey":_f[1]=y_._key;break;case"wrapKey":_f[1]=y_._key,_f[2]=_c._key}if((P_||T_&&(y_.algorithm.hash||{}).name==="SHA-1")&&_m==="exportKey"&&a_==="jwk"&&y_.algorithm.name==="HMAC"&&(_f[0]="raw"),!P_||_m!=="exportKey"||a_!=="spki"&&a_!=="pkcs8"||(_f[0]="jwk"),T_&&_m==="wrapKey")return _a.exportKey(a_,y_).then(function(v_){return a_==="jwk"&&(v_=l(unescape(encodeURIComponent(JSON.stringify(v(v_)))))),_a.encrypt(_f[3],_c,v_)});try{var r_=l_.apply(_a,_f)}catch(v_){return Promise.reject(v_)}return T_&&(r_=new Promise(function(v_,S_){r_.onabort=r_.onerror=function(U_){S_(U_)},r_.oncomplete=function(U_){v_(U_.target.result)}})),_m==="exportKey"&&a_==="jwk"&&(r_=r_.then(function(v_){return(P_||T_&&(y_.algorithm.hash||{}).name==="SHA-1")&&y_.algorithm.name==="HMAC"?{kty:"oct",alg:T(y_.algorithm),key_ops:y_.usages.slice(),ext:!0,k:s(f(v_))}:((v_=v(v_)).alg||(v_.alg=T(y_.algorithm)),v_.key_ops||(v_.key_ops=y_.type==="public"?y_.usages.filter(_e):y_.type==="private"?y_.usages.filter(aa):y_.usages.slice()),v_)})),!P_||_m!=="exportKey"||a_!=="spki"&&a_!=="pkcs8"||(r_=r_.then(function(v_){var S_=[["",null]],U_=!1;switch((v_=v(v_)).kty){case"RSA":for(var w_="n e d p q dp dq qi".split(" "),RT=[],Q_=0;Q_<w_.length&&w_[Q_]in v_;Q_++){var aS=RT[Q_]=l(u(v_[w_[Q_]]));128&aS[0]&&(RT[Q_]=new Uint8Array(aS.length+1),RT[Q_].set(aS,1))}2<RT.length&&(U_=!0,RT.unshift(new Uint8Array([0]))),S_[0][0]="1.2.840.113549.1.1.1";break;default:throw new TypeError("Unsupported key type")}return S_.push(new Uint8Array(Q(RT)).buffer),U_?S_.unshift(new Uint8Array([0])):S_[1]={tag:3,value:S_[1]},new Uint8Array(Q(S_)).buffer})),r_}}),["encrypt","decrypt","sign","verify"].forEach(function(_m){var l_=_a[_m];_a[_m]=function(a_,y_,_c,_f){if(T_&&(!_c.byteLength||_f&&!_f.byteLength))throw Error("Empty input is not allowed");var r_=[].slice.call(arguments),v_=E(a_);if(!T_||_m!=="sign"&&_m!=="verify"||a_!=="RSASSA-PKCS1-v1_5"&&a_!=="HMAC"||(r_[0]={name:a_}),T_&&y_.algorithm.hash&&(r_[0].hash=r_[0].hash||y_.algorithm.hash),T_&&_m==="decrypt"&&v_.name==="AES-GCM"){var S_=a_.tagLength>>3;r_[2]=(_c.buffer||_c).slice(0,_c.byteLength-S_),a_.tag=(_c.buffer||_c).slice(_c.byteLength-S_)}T_&&v_.name==="AES-GCM"&&r_[0].tagLength===void 0&&(r_[0].tagLength=128),r_[1]=y_._key;try{var U_=l_.apply(_a,r_)}catch(w_){return Promise.reject(w_)}return T_&&(U_=new Promise(function(w_,RT){U_.onabort=U_.onerror=function(Q_){RT(Q_)},U_.oncomplete=function(Q_){if(Q_=Q_.target.result,_m==="encrypt"&&Q_ instanceof AesGcmEncryptResult){var aS=Q_.ciphertext,X0=Q_.tag;(Q_=new Uint8Array(aS.byteLength+X0.byteLength)).set(new Uint8Array(aS),0),Q_.set(new Uint8Array(X0),aS.byteLength),Q_=Q_.buffer}w_(Q_)}})),U_}}),T_){var wS=_a.digest;_a.digest=function(_m,l_){if(!l_.byteLength)throw Error("Empty input is not allowed");try{var a_=wS.call(_a,_m,l_)}catch(y_){return Promise.reject(y_)}return a_=new Promise(function(y_,_c){a_.onabort=a_.onerror=function(_f){_c(_f)},a_.oncomplete=function(_f){y_(_f.target.result)}})},r.crypto=Object.create(_i,{getRandomValues:{value:function(_m){return _i.getRandomValues(_m)}},subtle:{value:_a}}),r.CryptoKey=X}P_&&(_i.subtle=_a,r.Crypto=ga,r.SubtleCrypto=_d,r.CryptoKey=X)}}}})}),function(i){i.console||(i.console={}),i=i.console;for(var r,s=function(){},u=["memory"],l="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");r=u.pop();)i[r]||(i[r]={});for(;r=l.pop();)i[r]||(i[r]=s)}(typeof window>"u"?Ya:window),ea({target:"Object",stat:!0},{setPrototypeOf:tb});var uy=la(function(){uc(1)});ea({target:"Object",stat:!0,forced:uy,sham:!Oo},{getPrototypeOf:function(i){return uc(pb(i))}});var iq=[].slice,zk={},vy=Function.bind||function(i){var r=Wb(this),s=iq.call(arguments,1),u=function(){var l=s.concat(iq.call(arguments));if(this instanceof u){var f=l.length;if(!(f in zk)){for(var E=[],T=0;T<f;T++)E[T]="a["+T+"]";zk[f]=Function("C,a","return new C("+E.join(",")+")")}l=zk[f](r,l)}else l=r.apply(i,l);return l};return xa(r.prototype)&&(u.prototype=r.prototype),u},Ak=Pc("Reflect","construct"),jq=la(function(){function i(){}return!(Ak(function(){},[],i)instanceof i)}),kq=!la(function(){Ak(function(){})}),lq=jq||kq;ea({target:"Reflect",stat:!0,forced:lq,sham:lq},{construct:function(i,r){Wb(i),Ia(r);var s=3>arguments.length?i:Wb(arguments[2]);if(kq&&!jq)return Ak(i,r,s);if(i==s){switch(r.length){case 0:return new i;case 1:return new i(r[0]);case 2:return new i(r[0],r[1]);case 3:return new i(r[0],r[1],r[2]);case 4:return new i(r[0],r[1],r[2],r[3])}return(s=[null]).push.apply(s,r),new(vy.apply(i,s))}s=s.prototype,s=jc(xa(s)?s:Object.prototype);var u=Function.apply.call(i,s,r);return xa(u)?u:s}}),ea({target:"Reflect",stat:!0},{get:Am});var mq=dc.f,wy=la(function(){mq(1)});ea({target:"Object",stat:!0,forced:!wa||wy,sham:!wa},{getOwnPropertyDescriptor:function(i,r){return mq(Mb(i),r)}});var nq=de.f,xy={}.toString,oq=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Bk=function(i){if(oq&&xy.call(i)=="[object Window]")try{var r=nq(i)}catch{r=oq.slice()}else r=nq(Mb(i));return r},pq={f:Fa},yy=qb.f,$h=function(i){var r=R.Symbol||(R.Symbol={});ka(r,i)||yy(r,i,{value:pq.f(i)})},Nb=xh("hidden"),qq=Fa("toPrimitive"),zy=cb.set,rq=cb.getterFor("Symbol"),kc=Object.prototype,Ob=R.Symbol,yg=Pc("JSON","stringify"),sq=dc.f,Jd=qb.f,tq=Bk,Ay=eg,jd=Ad("symbols"),zg=Ad("op-symbols"),Ck=Ad("string-to-symbol-registry"),Dk=Ad("symbol-to-string-registry"),By=Ad("wks"),Ek=R.QObject,Fk=!Ek||!Ek.prototype||!Ek.prototype.findChild,Gk=wa&&la(function(){return jc(Jd({},"a",{get:function(){return Jd(this,"a",{value:7}).a}})).a!=7})?function(i,r,s){var u=sq(kc,r);u&&delete kc[r],Jd(i,r,s),u&&i!==kc&&Jd(kc,r,u)}:Jd,Hk=function(i,r){var s=jd[i]=jc(Ob.prototype);return zy(s,{type:"Symbol",tag:i,description:r}),wa||(s.description=r),s},Ik=zo?function(i){return typeof i=="symbol"}:function(i){return Object(i)instanceof Ob},ai=function(i,r,s){return i===kc&&ai(zg,r,s),Ia(i),r=Oc(r,!0),Ia(s),ka(jd,r)?(s.enumerable?(ka(i,Nb)&&i[Nb][r]&&(i[Nb][r]=!1),s=jc(s,{enumerable:Nc(0,!1)})):(ka(i,Nb)||Jd(i,Nb,Nc(1,{})),i[Nb][r]=!0),Gk(i,r,s)):Jd(i,r,s)},uq=function(i,r){Ia(i);var s=Mb(r);return r=ed(s).concat(Jk(s)),fe(r,function(u){wa&&!Kk.call(s,u)||ai(i,u,s[u])}),i},Kk=function(i){i=Oc(i,!0);var r=Ay.call(this,i);return!(this===kc&&ka(jd,i)&&!ka(zg,i))&&(!(r||!ka(this,i)||!ka(jd,i)||ka(this,Nb)&&this[Nb][i])||r)},vq=function(i,r){if(i=Mb(i),r=Oc(r,!0),i!==kc||!ka(jd,r)||ka(zg,r)){var s=sq(i,r);return!s||!ka(jd,r)||ka(i,Nb)&&i[Nb][r]||(s.enumerable=!0),s}},wq=function(i){i=tq(Mb(i));var r=[];return fe(i,function(s){ka(jd,s)||ka(bf,s)||r.push(s)}),r},Jk=function(i){var r=i===kc;i=tq(r?zg:Mb(i));var s=[];return fe(i,function(u){!ka(jd,u)||r&&!ka(kc,u)||s.push(jd[u])}),s};if(Sc||(Ob=function(){if(this instanceof Ob)throw TypeError("Symbol is not a constructor");var i=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,r=af(i),s=function(u){this===kc&&s.call(zg,u),ka(this,Nb)&&ka(this[Nb],r)&&(this[Nb][r]=!1),Gk(this,r,Nc(1,u))};return wa&&Fk&&Gk(kc,r,{configurable:!0,set:s}),Hk(r,i)},Za(Ob.prototype,"toString",function(){return rq(this).tag}),Za(Ob,"withoutSetter",function(i){return Hk(af(i),i)}),eg=Kk,qb.f=ai,dc.f=vq,de.f=Bk=wq,gg.f=Jk,pq.f=function(i){return Hk(Fa(i),i)},wa&&(Jd(Ob.prototype,"description",{configurable:!0,get:function(){return rq(this).description}}),Za(kc,"propertyIsEnumerable",Kk,{unsafe:!0}))),ea({global:!0,wrap:!0,forced:!Sc,sham:!Sc},{Symbol:Ob}),fe(ed(By),function(i){$h(i)}),ea({target:"Symbol",stat:!0,forced:!Sc},{for:function(i){if(i=String(i),ka(Ck,i))return Ck[i];var r=Ob(i);return Ck[i]=r,Dk[r]=i,r},keyFor:function(i){if(!Ik(i))throw TypeError(i+" is not a symbol");if(ka(Dk,i))return Dk[i]},useSetter:function(){Fk=!0},useSimple:function(){Fk=!1}}),ea({target:"Object",stat:!0,forced:!Sc,sham:!wa},{create:function(i,r){return r===void 0?jc(i):uq(jc(i),r)},defineProperty:ai,defineProperties:uq,getOwnPropertyDescriptor:vq}),ea({target:"Object",stat:!0,forced:!Sc},{getOwnPropertyNames:wq,getOwnPropertySymbols:Jk}),ea({target:"Object",stat:!0,forced:la(function(){gg.f(1)})},{getOwnPropertySymbols:function(i){return gg.f(pb(i))}}),yg){var Cy=!Sc||la(function(){var i=Ob();return yg([i])!="[null]"||yg({a:i})!="{}"||yg(Object(i))!="{}"});ea({target:"JSON",stat:!0,forced:Cy},{stringify:function(i,r,s){for(var u,l=[i],f=1;arguments.length>f;)l.push(arguments[f++]);if(u=r,(xa(r)||i!==void 0)&&!Ik(i))return Ed(r)||(r=function(E,T){if(typeof u=="function"&&(T=u.call(this,E,T)),!Ik(T))return T}),l[1]=r,yg.apply(null,l)}})}Ob.prototype[qq]||kb(Ob.prototype,qq,Ob.prototype.valueOf),zc(Ob,"Symbol"),bf[Nb]=!0;var Dy=qb.f,kd=R.Symbol;if(wa&&typeof kd=="function"&&(!("description"in kd.prototype)||kd().description!==void 0)){var xq={},Ag=function(){var i=1>arguments.length||arguments[0]===void 0?void 0:String(arguments[0]),r=this instanceof Ag?new kd(i):i===void 0?kd():kd(i);return i===""&&(xq[r]=!0),r};to(Ag,kd);var Lk=Ag.prototype=kd.prototype;Lk.constructor=Ag;var Ey=Lk.toString,Fy=String(kd("test"))=="Symbol(test)",Gy=/^Symbol\((.*)\)[^)]+$/;Dy(Lk,"description",{configurable:!0,get:function(){var i=xa(this)?this.valueOf():this,r=Ey.call(i);return ka(xq,i)?"":(i=Fy?r.slice(7,-1):r.replace(Gy,"$1"))===""?void 0:i}}),ea({global:!0,forced:!0},{Symbol:Ag})}$h("toStringTag"),zc(R.JSON,"JSON",!0),zc(Math,"Math",!0),function(){function i(B,Q){if(!(B instanceof Q))throw new TypeError("Cannot call a class as a function")}function r(B,Q){for(var X=0;X<Q.length;X++){var _e=Q[X];_e.enumerable=_e.enumerable||!1,_e.configurable=!0,"value"in _e&&(_e.writable=!0),Object.defineProperty(B,_e.key,_e)}}function s(B,Q,X){return Q&&r(B.prototype,Q),B}function u(B){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(Q){return Q.__proto__||Object.getPrototypeOf(Q)})(B)}function l(B,Q){return(l=Object.setPrototypeOf||function(X,_e){return X.__proto__=_e,X})(B,Q)}function f(B){if(B===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B}function E(B){var Q=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var X=u(B);if(Q){var _e=u(this).constructor;X=Reflect.construct(X,arguments,_e)}else X=X.apply(this,arguments);return X=!X||qa(X)!=="object"&&typeof X!="function"?f(this):X}}function T(B,Q,X){return(T=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(_e,aa,_i){for(;!Object.prototype.hasOwnProperty.call(_e,aa)&&(_e=u(_e))!==null;);if(_e)return(aa=Object.getOwnPropertyDescriptor(_e,aa)).get?aa.get.call(_i):aa.value})(B,Q,X||B)}var v=function(){function B(){i(this,B),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return s(B,[{key:"addEventListener",value:function(Q,X,_e){Q in this.listeners||(this.listeners[Q]=[]),this.listeners[Q].push({callback:X,options:_e})}},{key:"removeEventListener",value:function(Q,X){if(Q in this.listeners){for(var _e=0,aa=(Q=this.listeners[Q]).length;_e<aa;_e++)if(Q[_e].callback===X){Q.splice(_e,1);break}}}},{key:"dispatchEvent",value:function(Q){if(Q.type in this.listeners){for(var X=this.listeners[Q.type].slice(),_e=0,aa=X.length;_e<aa;_e++){var _i=X[_e];try{_i.callback.call(this,Q)}catch(_a){Promise.resolve().then(function(){throw _a})}_i.options&&_i.options.once&&this.removeEventListener(Q.type,_i.callback)}return!Q.defaultPrevented}}}]),B}(),w=function(B){function Q(){i(this,Q);var _e=X.call(this);return _e.listeners||v.call(f(_e)),Object.defineProperty(f(_e),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(f(_e),"onabort",{value:null,writable:!0,configurable:!0}),_e}(function(_e,aa){if(typeof aa!="function"&&aa!==null)throw new TypeError("Super expression must either be null or a function");_e.prototype=Object.create(aa&&aa.prototype,{constructor:{value:_e,writable:!0,configurable:!0}}),aa&&l(_e,aa)})(Q,B);var X=E(Q);return s(Q,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(_e){_e.type==="abort"&&(this.aborted=!0,typeof this.onabort=="function"&&this.onabort.call(this,_e)),T(u(Q.prototype),"dispatchEvent",this).call(this,_e)}}]),Q}(v),k=function(){function B(){i(this,B),Object.defineProperty(this,"signal",{value:new w,writable:!0,configurable:!0})}return s(B,[{key:"abort",value:function(){try{var Q=new Event("abort")}catch{typeof document<"u"?document.createEvent?(Q=document.createEvent("Event")).initEvent("abort",!1,!1):(Q=document.createEventObject()).type="abort":Q={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(Q)}},{key:"toString",value:function(){return"[object AbortController]"}}]),B}();typeof Symbol<"u"&&Symbol.toStringTag&&(k.prototype[Symbol.toStringTag]="AbortController",w.prototype[Symbol.toStringTag]="AbortSignal"),function(B){if(B.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var Q=!0}else Q=typeof B.Request=="function"&&!B.Request.prototype.hasOwnProperty("signal")||!B.AbortController;Q&&(B.AbortController=k,B.AbortSignal=w)}(typeof self<"u"?self:Ya)}();var Hy=Math.floor,Iy=Math.log,Jy=Math.LOG2E;ea({target:"Math",stat:!0},{clz32:function(i){return(i>>>=0)?31-Hy(Iy(i+.5)*Jy):32}});var Ky=Math.log,Ly=Math.LN2,cu=Math.clz32||function(i){return 31-Ky(i>>>0)/Ly|0},Ud=String.fromCharCode,yq={}.toString,Mk=window.Uint8Array,Nk=Mk||Array,My=yq.call((window.ArrayBuffer||Nk).prototype),Ok;Bm.prototype.decode=function(i){if(i=i&&i.buffer||i,yq.call(i)!==My)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var r="",s=0,u=0|(i=Mk?new Nk(i):i).length;s<u;s=s+32768|0)r+=Ud.apply(0,i[Mk?"slice":"subarray"](s,s+32768|0));return r.replace(/[\xc0-\xff][\x80-\xbf]*/g,bu)},window.TextDecoder||(window.TextDecoder=Bm),Cm.prototype.encode=function(i){for(var r=0|(i=i===void 0?"":(""+i).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,du)).length,s=new Nk(r),u=0;u<r;u=u+1|0)s[u]=i.charCodeAt(u);return s},window.TextEncoder||(window.TextEncoder=Cm),function(i){var r,s,u,l,f,E,T,v,w,k,B,Q;(s=r||(r={})).LOGIN="LOGIN",s.LOGIN_SUCCESS="LOGIN_SUCCESS",s.LOGIN_FAILURE="LOGIN_FAILURE",s.LOGIN_TIMEOUT="LOGIN_TIMEOUT",s.INTERRUPTED="INTERRUPTED",s.LOGOUT="LOGOUT",s.BANNED_BY_SERVER="BANNED_BY_SERVER",s.REMOTE_LOGIN="REMOTE_LOGIN",s.TOKEN_EXPIRED="TOKEN_EXPIRED",i.ConnectionChangeReason=r,function(X){X.DISCONNECTED="DISCONNECTED",X.CONNECTING="CONNECTING",X.CONNECTED="CONNECTED",X.RECONNECTING="RECONNECTING",X.ABORTED="ABORTED"}(u||(u={})),i.ConnectionState=u,function(X){X.IDLE="IDLE",X.SENT_TO_REMOTE="SENT_TO_REMOTE",X.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",X.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",X.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",X.CANCELED="CANCELED",X.FAILURE="FAILURE"}(l||(l={})),i.LocalInvitationState=l,function(X){X.INVITATION_RECEIVED="INVITATION_RECEIVED",X.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",X.REFUSED="REFUSED",X.ACCEPTED="ACCEPTED",X.CANCELED="CANCELED",X.FAILURE="FAILURE"}(f||(f={})),i.RemoteInvitationState=f,function(X){X.UNKNOWN="UNKNOWN",X.PEER_NO_RESPONSE="PEER_NO_RESPONSE",X.INVITATION_EXPIRE="INVITATION_EXPIRE",X.PEER_OFFLINE="PEER_OFFLINE",X.NOT_LOGGEDIN="NOT_LOGGEDIN"}(E||(E={})),i.LocalInvitationFailureReason=E,function(X){X.UNKNOWN="UNKNOWN",X.PEER_OFFLINE="PEER_OFFLINE",X.ACCEPT_FAILURE="ACCEPT_FAILURE",X.INVITATION_EXPIRE="INVITATION_EXPIRE"}(T||(T={})),i.RemoteInvitationFailureReason=T,function(X){X.ONLINE="ONLINE",X.UNREACHABLE="UNREACHABLE",X.OFFLINE="OFFLINE"}(v||(v={})),i.PeerOnlineState=v,(w||(w={})).ONLINE_STATUS="ONLINE_STATUS",i.PeerSubscriptionOption=w,function(X){X.TEXT="TEXT",X.RAW="RAW"}(k||(k={})),i.MessageType=k,function(X){X.CN="CN",X.NA="NA",X.EU="EU",X.AS="AS",X.JP="JP",X.IN="IN",X.GLOB="GLOB",X.OC="OC",X.SA="SA",X.AF="AF",X.OVS="OVS"}(B||(B={})),i.LegacyAreaCode=B,function(X){X.GLOBAL="GLOBAL",X.INDIA="INDIA",X.JAPAN="JAPAN",X.ASIA="ASIA",X.EUROPE="EUROPE",X.CHINA="CHINA",X.NORTH_AMERICA="NORTH_AMERICA"}(Q||(Q={})),i.AreaCode=Q}(Ok||(Ok={}));var ta=Ok;ea({target:"Array",proto:!0},{includes:function(i){return qo(this,i,1<arguments.length?arguments[1]:void 0)}}),ng("includes");var Pk=function(i){if(Lj(i))throw TypeError("The method doesn't accept regular expressions");return i},Ny=Fa("match"),Qk=function(i){var r=/./;try{"/./"[i](r)}catch{try{return r[Ny]=!1,"/./"[i](r)}catch{}}return!1};ea({target:"String",proto:!0,forced:!Qk("includes")},{includes:function(i){return!!~String(Eb(this)).indexOf(Pk(i),1<arguments.length?arguments[1]:void 0)}});var Ec={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0,ENABLE_EDGE_AUTO_FALLBACK:!0};$h("iterator"),$h("asyncIterator");var Rk=ff("forEach")?[].forEach:function(i){return fe(this,i,1<arguments.length?arguments[1]:void 0)},zq;for(zq in wk){var Aq=R[zq],bi=Aq&&Aq.prototype;if(bi&&bi.forEach!==Rk)try{kb(bi,"forEach",Rk)}catch{bi.forEach=Rk}}var Oy=[].reverse,Bq=[1,2];ea({target:"Array",proto:!0,forced:String(Bq)===String(Bq.reverse())},{reverse:function(){return Ed(this)&&(this.length=this.length),Oy.call(this)}});var N=xb(function(i){i=function(r){function s(_c,_f,r_){return Object.defineProperty(_c,_f,{value:r_,enumerable:!0,configurable:!0,writable:!0}),_c[_f]}function u(_c,_f,r_,v_){return _f=Object.create((_f&&_f.prototype instanceof f?_f:f).prototype),v_=new X(v_||[]),_f._invoke=function(S_,U_,w_){var RT=g_;return function(Q_,aS){if(RT===wS)throw Error("Generator is already running");if(RT===_m){if(Q_==="throw")throw aS;return aa()}for(w_.method=Q_,w_.arg=aS;;){if((Q_=w_.delegate)&&(Q_=k(Q_,w_))){if(Q_===l_)continue;return Q_}if(w_.method==="next")w_.sent=w_._sent=w_.arg;else if(w_.method==="throw"){if(RT===g_)throw RT=_m,w_.arg;w_.dispatchException(w_.arg)}else w_.method==="return"&&w_.abrupt("return",w_.arg);if(RT=wS,(Q_=l(S_,U_,w_)).type==="normal"){if(RT=w_.done?_m:j_,Q_.arg===l_)continue;return{value:Q_.arg,done:w_.done}}Q_.type==="throw"&&(RT=_m,w_.method="throw",w_.arg=Q_.arg)}}}(_c,r_,v_),_f}function l(_c,_f,r_){try{return{type:"normal",arg:_c.call(_f,r_)}}catch(v_){return{type:"throw",arg:v_}}}function f(){}function E(){}function T(){}function v(_c){["next","throw","return"].forEach(function(_f){s(_c,_f,function(r_){return this._invoke(_f,r_)})})}function w(_c,_f){function r_(S_,U_,w_,RT){if((S_=l(_c[S_],_c,U_)).type!=="throw"){var Q_=S_.arg;return(S_=Q_.value)&&qa(S_)==="object"&&ga.call(S_,"__await")?_f.resolve(S_.__await).then(function(aS){r_("next",aS,w_,RT)},function(aS){r_("throw",aS,w_,RT)}):_f.resolve(S_).then(function(aS){Q_.value=aS,w_(Q_)},function(aS){return r_("throw",aS,w_,RT)})}RT(S_.arg)}var v_;this._invoke=function(S_,U_){function w_(){return new _f(function(RT,Q_){r_(S_,U_,RT,Q_)})}return v_=v_?v_.then(w_,w_):w_()}}function k(_c,_f){var r_=_c.iterator[_f.method];if(r_===_i){if(_f.delegate=null,_f.method==="throw"){if(_c.iterator.return&&(_f.method="return",_f.arg=_i,k(_c,_f),_f.method==="throw"))return l_;_f.method="throw",_f.arg=new TypeError("The iterator does not provide a 'throw' method")}return l_}return(r_=l(r_,_c.iterator,_f.arg)).type==="throw"?(_f.method="throw",_f.arg=r_.arg,_f.delegate=null,l_):(r_=r_.arg)?r_.done?(_f[_c.resultName]=r_.value,_f.next=_c.nextLoc,_f.method!=="return"&&(_f.method="next",_f.arg=_i),_f.delegate=null,l_):r_:(_f.method="throw",_f.arg=new TypeError("iterator result is not an object"),_f.delegate=null,l_)}function B(_c){var _f={tryLoc:_c[0]};1 in _c&&(_f.catchLoc=_c[1]),2 in _c&&(_f.finallyLoc=_c[2],_f.afterLoc=_c[3]),this.tryEntries.push(_f)}function Q(_c){var _f=_c.completion||{};_f.type="normal",delete _f.arg,_c.completion=_f}function X(_c){this.tryEntries=[{tryLoc:"root"}],_c.forEach(B,this),this.reset(!0)}function _e(_c){if(_c){var _f=_c[d_];if(_f)return _f.call(_c);if(typeof _c.next=="function")return _c;if(!isNaN(_c.length)){var r_=-1;return(_f=function v_(){for(;++r_<_c.length;)if(ga.call(_c,r_))return v_.value=_c[r_],v_.done=!1,v_;return v_.value=_i,v_.done=!0,v_}).next=_f}}return{next:aa}}function aa(){return{value:_i,done:!0}}var _i,_a=Object.prototype,ga=_a.hasOwnProperty,_d=typeof Symbol=="function"?Symbol:{},d_=_d.iterator||"@@iterator",T_=_d.asyncIterator||"@@asyncIterator",P_=_d.toStringTag||"@@toStringTag";try{s({},"")}catch{s=function(_f,r_,v_){return _f[r_]=v_}}r.wrap=u;var g_="suspendedStart",j_="suspendedYield",wS="executing",_m="completed",l_={};s(_d={},d_,function(){return this});var a_=Object.getPrototypeOf;(a_=a_&&a_(a_(_e([]))))&&a_!==_a&&ga.call(a_,d_)&&(_d=a_);var y_=T.prototype=f.prototype=Object.create(_d);return E.prototype=T,s(y_,"constructor",T),s(T,"constructor",E),E.displayName=s(T,P_,"GeneratorFunction"),r.isGeneratorFunction=function(_c){return!!(_c=typeof _c=="function"&&_c.constructor)&&(_c===E||(_c.displayName||_c.name)==="GeneratorFunction")},r.mark=function(_c){return Object.setPrototypeOf?Object.setPrototypeOf(_c,T):(_c.__proto__=T,s(_c,P_,"GeneratorFunction")),_c.prototype=Object.create(y_),_c},r.awrap=function(_c){return{__await:_c}},v(w.prototype),s(w.prototype,T_,function(){return this}),r.AsyncIterator=w,r.async=function(_c,_f,r_,v_,S_){S_===void 0&&(S_=Promise);var U_=new w(u(_c,_f,r_,v_),S_);return r.isGeneratorFunction(_f)?U_:U_.next().then(function(w_){return w_.done?w_.value:U_.next()})},v(y_),s(y_,P_,"Generator"),s(y_,d_,function(){return this}),s(y_,"toString",function(){return"[object Generator]"}),r.keys=function(_c){var _f,r_=[];for(_f in _c)r_.push(_f);return r_.reverse(),function v_(){for(;r_.length;){var S_=r_.pop();if(S_ in _c)return v_.value=S_,v_.done=!1,v_}return v_.done=!0,v_}},r.values=_e,X.prototype={constructor:X,reset:function(_c){if(this.next=this.prev=0,this.sent=this._sent=_i,this.done=!1,this.delegate=null,this.method="next",this.arg=_i,this.tryEntries.forEach(Q),!_c)for(var _f in this)_f.charAt(0)==="t"&&ga.call(this,_f)&&!isNaN(+_f.slice(1))&&(this[_f]=_i)},stop:function(){this.done=!0;var _c=this.tryEntries[0].completion;if(_c.type==="throw")throw _c.arg;return this.rval},dispatchException:function(_c){function _f(Q_,aS){return U_.type="throw",U_.arg=_c,r_.next=Q_,aS&&(r_.method="next",r_.arg=_i),!!aS}if(this.done)throw _c;for(var r_=this,v_=this.tryEntries.length-1;0<=v_;--v_){var S_=this.tryEntries[v_],U_=S_.completion;if(S_.tryLoc==="root")return _f("end");if(S_.tryLoc<=this.prev){var w_=ga.call(S_,"catchLoc"),RT=ga.call(S_,"finallyLoc");if(w_&&RT){if(this.prev<S_.catchLoc)return _f(S_.catchLoc,!0);if(this.prev<S_.finallyLoc)return _f(S_.finallyLoc)}else if(w_){if(this.prev<S_.catchLoc)return _f(S_.catchLoc,!0)}else{if(!RT)throw Error("try statement without catch or finally");if(this.prev<S_.finallyLoc)return _f(S_.finallyLoc)}}}},abrupt:function(_c,_f){for(var r_=this.tryEntries.length-1;0<=r_;--r_){var v_=this.tryEntries[r_];if(v_.tryLoc<=this.prev&&ga.call(v_,"finallyLoc")&&this.prev<v_.finallyLoc){var S_=v_;break}}return S_&&(_c==="break"||_c==="continue")&&S_.tryLoc<=_f&&_f<=S_.finallyLoc&&(S_=null),(r_=S_?S_.completion:{}).type=_c,r_.arg=_f,S_?(this.method="next",this.next=S_.finallyLoc,l_):this.complete(r_)},complete:function(_c,_f){if(_c.type==="throw")throw _c.arg;return _c.type==="break"||_c.type==="continue"?this.next=_c.arg:_c.type==="return"?(this.rval=this.arg=_c.arg,this.method="return",this.next="end"):_c.type==="normal"&&_f&&(this.next=_f),l_},finish:function(_c){for(var _f=this.tryEntries.length-1;0<=_f;--_f){var r_=this.tryEntries[_f];if(r_.finallyLoc===_c)return this.complete(r_.completion,r_.afterLoc),Q(r_),l_}},catch:function(_c){for(var _f=this.tryEntries.length-1;0<=_f;--_f){var r_=this.tryEntries[_f];if(r_.tryLoc===_c){if((_c=r_.completion).type==="throw"){var v_=_c.arg;Q(r_)}return v_}}throw Error("illegal catch attempt")},delegateYield:function(_c,_f,r_){return this.delegate={iterator:_e(_c),resultName:_f,nextLoc:r_},this.method==="next"&&(this.arg=_i),l_}},r}(i.exports);try{regeneratorRuntime=i}catch{(typeof globalThis>"u"?"undefined":qa(globalThis))==="object"?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}}),Cq=!la(function(){return Object.isExtensible(Object.preventExtensions({}))}),Sk=xb(function(i){var r=qb.f,s=af("meta"),u=0,l=Object.isExtensible||function(){return!0},f=function(T){r(T,s,{value:{objectID:"O"+ ++u,weakData:{}}})},E=i.exports={REQUIRED:!1,fastKey:function(T,v){if(!xa(T))return typeof T=="symbol"?T:(typeof T=="string"?"S":"P")+T;if(!ka(T,s)){if(!l(T))return"F";if(!v)return"E";f(T)}return T[s].objectID},getWeakData:function(T,v){if(!ka(T,s)){if(!l(T))return!0;if(!v)return!1;f(T)}return T[s].weakData},onFreeze:function(T){return Cq&&E.REQUIRED&&l(T)&&!ka(T,s)&&f(T),T}};bf[s]=!0}),Dq=function(i,r,s){var u=i.indexOf("Map")!==-1,l=i.indexOf("Weak")!==-1,f=u?"set":"add",E=R[i],T=E&&E.prototype,v=E,w={},k=function(_i){var _a=T[_i];Za(T,_i,_i=="add"?function(ga){return _a.call(this,ga===0?0:ga),this}:_i=="delete"?function(ga){return!(l&&!xa(ga))&&_a.call(this,ga===0?0:ga)}:_i=="get"?function(ga){return l&&!xa(ga)?void 0:_a.call(this,ga===0?0:ga)}:_i=="has"?function(ga){return!(l&&!xa(ga))&&_a.call(this,ga===0?0:ga)}:function(ga,_d){return _a.call(this,ga===0?0:ga,_d),this})};if(Qc(i,typeof E!="function"||!(l||T.forEach&&!la(function(){new E().entries().next()}))))v=s.getConstructor(r,i,u,f),Sk.REQUIRED=!0;else if(Qc(i,!0)){var B=new v,Q=B[f](l?{}:-0,1)!=B,X=la(function(){B.has(1)}),_e=Eh(function(_i){new E(_i)}),aa=!l&&la(function(){for(var _i=new E,_a=5;_a--;)_i[f](_a,_a);return!_i.has(-0)});_e||((v=r(function(_i,_a){return Ac(_i,v,i),_i=Wh(new E,_i,v),_a!=null&&Jh(_a,_i[f],{that:_i,AS_ENTRIES:u}),_i})).prototype=T,T.constructor=v),(X||aa)&&(k("delete"),k("has"),u&&k("get")),(aa||Q)&&k(f),l&&T.clear&&delete T.clear}return w[i]=v,ea({global:!0,forced:v!=E},w),zc(v,i),l||s.setStrong(v,i,u),v},Py=qb.f,Eq=Sk.fastKey,Fq=cb.set,Tk=cb.getterFor,Gq={getConstructor:function(i,r,s,u){var l=i(function(v,w){Ac(v,l,r),Fq(v,{type:r,index:jc(null),first:void 0,last:void 0,size:0}),wa||(v.size=0),w!=null&&Jh(w,v[u],{that:v,AS_ENTRIES:s})}),f=Tk(r),E=function(v,w,k){var B,Q=f(v),X=T(v,w);return X?X.value=k:(Q.last=X={index:B=Eq(w,!0),key:w,value:k,previous:w=Q.last,next:void 0,removed:!1},Q.first||(Q.first=X),w&&(w.next=X),wa?Q.size++:v.size++,B!=="F"&&(Q.index[B]=X)),v},T=function(v,w){v=f(v);var k=Eq(w);if(k!=="F")return v.index[k];for(v=v.first;v;v=v.next)if(v.key==w)return v};return kf(l.prototype,{clear:function(){for(var v=f(this),w=v.index,k=v.first;k;)k.removed=!0,k.previous&&(k.previous=k.previous.next=void 0),delete w[k.index],k=k.next;v.first=v.last=void 0,wa?v.size=0:this.size=0},delete:function(v){var w=f(this);if(v=T(this,v)){var k=v.next,B=v.previous;delete w.index[v.index],v.removed=!0,B&&(B.next=k),k&&(k.previous=B),w.first==v&&(w.first=k),w.last==v&&(w.last=B),wa?w.size--:this.size--}return!!v},forEach:function(v){for(var w,k=f(this),B=Dd(v,1<arguments.length?arguments[1]:void 0,3);w=w?w.next:k.first;)for(B(w.value,w.key,this);w&&w.removed;)w=w.previous},has:function(v){return!!T(this,v)}}),kf(l.prototype,s?{get:function(v){return(v=T(this,v))&&v.value},set:function(v,w){return E(this,v===0?0:v,w)}}:{add:function(v){return E(this,v=v===0?0:v,v)}}),wa&&Py(l.prototype,"size",{get:function(){return f(this).size}}),l},setStrong:function(i,r,s){var u=r+" Iterator",l=Tk(r),f=Tk(u);Wj(i,r,function(E,T){Fq(this,{type:u,target:E,state:l(E),kind:T,last:void 0})},function(){for(var E=f(this),T=E.kind,v=E.last;v&&v.removed;)v=v.previous;return E.target&&(E.last=v=v?v.next:E.state.first)?T=="keys"?{value:v.key,done:!1}:T=="values"?{value:v.value,done:!1}:{value:[v.key,v.value],done:!1}:(E.target=void 0,{value:void 0,done:!0})},s?"entries":"values",!s,!0),og(r)}};Dq("Set",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},Gq);var Uk=Pc("Reflect","apply"),Qy=Function.apply,Ry=!la(function(){Uk(function(){})});ea({target:"Reflect",stat:!0,forced:Ry},{apply:function(i,r,s){return Wb(i),Ia(s),Uk?Uk(i,r,s):Qy.call(i,r,s)}}),ea({target:"Reflect",stat:!0},{ownKeys:so});var Hq=Fa("isConcatSpreadable"),Sy=51<=Cd||!la(function(){var i=[];return i[Hq]=!1,i.concat()[0]!==i}),Ty=kg("concat");ea({target:"Array",proto:!0,forced:!Sy||!Ty},{concat:function(i){var r,s=pb(this),u=Dh(s,0),l=0,f=-1;for(r=arguments.length;f<r;f++){var E=f===-1?s:arguments[f],T=E;if(xa(T)){var v=T[Hq];T=v!==void 0?!!v:Ed(T)}else T=!1;if(T){if(9007199254740991<l+(v=Ma(E.length)))throw TypeError("Maximum allowed index exceeded");for(T=0;T<v;T++,l++)T in E&&hf(u,l,E[T])}else{if(9007199254740991<=l)throw TypeError("Maximum allowed index exceeded");hf(u,l++,E)}}return u.length=l,u}});var Uy=Bk,Vy=la(function(){return!Object.getOwnPropertyNames(1)});ea({target:"Object",stat:!0,forced:Vy},{getOwnPropertyNames:Uy});var Wy=de.f,Xy=dc.f,Yy=qb.f,Kd=R.Number,ci=Kd.prototype,Zy=xc(jc(ci))=="Number",Iq=function(i){var r,s=Oc(i,!1);if(typeof s=="string"&&2<s.length){if((i=(s=Oj(s)).charCodeAt(0))===43||i===45){if((i=s.charCodeAt(2))===88||i===120)return NaN}else if(i===48){switch(s.charCodeAt(1)){case 66:case 98:i=2;var u=49;break;case 79:case 111:i=8,u=55;break;default:return+s}var l=(s=s.slice(2)).length;for(r=0;r<l;r++){var f=s.charCodeAt(r);if(48>f||f>u)return NaN}return parseInt(s,i)}}return+s};if(Qc("Number",!Kd(" 0o1")||!Kd("0b1")||Kd("+0x1"))){for(var le=function(i){var r=1>arguments.length?0:i,s=this;return s instanceof le&&(Zy?la(function(){ci.valueOf.call(s)}):xc(s)!="Number")?Wh(new Kd(Iq(r)),s,le):Iq(r)},Jq=wa?Wy(Kd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),Vk=0,di;Jq.length>Vk;Vk++)ka(Kd,di=Jq[Vk])&&!ka(le,di)&&Yy(le,di,Xy(Kd,di));le.prototype=ci,ci.constructor=le,Za(R,"Number",le)}var sf=(typeof Reflect>"u"?"undefined":qa(Reflect))==="object"?Reflect:null,Kq=sf&&typeof sf.apply=="function"?sf.apply:function(i,r,s){return Function.prototype.apply.call(i,r,s)},$y=sf&&typeof sf.ownKeys=="function"?sf.ownKeys:Object.getOwnPropertySymbols?function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:function(i){return Object.getOwnPropertyNames(i)},Lq=Number.isNaN||function(i){return i!=i};Ba.EventEmitter=Ba,Ba.prototype._events=void 0,Ba.prototype._eventsCount=0,Ba.prototype._maxListeners=void 0;var Mq=10;Object.defineProperty(Ba,"defaultMaxListeners",{enumerable:!0,get:function(){return Mq},set:function(i){if(typeof i!="number"||0>i||Lq(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");Mq=i}}),Ba.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ba.prototype.setMaxListeners=function(i){if(typeof i!="number"||0>i||Lq(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this},Ba.prototype.getMaxListeners=function(){return this._maxListeners===void 0?Ba.defaultMaxListeners:this._maxListeners},Ba.prototype.emit=function(i){for(var r=[],s=1;s<arguments.length;s++)r.push(arguments[s]);s=i==="error";var u=this._events;if(u!==void 0)s=s&&u.error===void 0;else if(!s)return!1;if(s){var l;throw 0<r.length&&(l=r[0]),l instanceof Error?l:((r=Error("Unhandled error."+(l?" ("+l.message+")":""))).context=l,r)}if((s=u[i])===void 0)return!1;if(typeof s=="function")Kq(s,this,r);else for(u=Gm(s,l=s.length),s=0;s<l;++s)Kq(u[s],this,r);return!0},Ba.prototype.addListener=function(i,r){return Dm(this,i,r,!1)},Ba.prototype.on=Ba.prototype.addListener,Ba.prototype.prependListener=function(i,r){return Dm(this,i,r,!0)},Ba.prototype.once=function(i,r){return Wg(r),this.on(i,Em(this,i,r)),this},Ba.prototype.prependOnceListener=function(i,r){return Wg(r),this.prependListener(i,Em(this,i,r)),this},Ba.prototype.removeListener=function(i,r){var s;Wg(r);var u=this._events;if(u===void 0)return this;var l=u[i];if(l===void 0)return this;if(l===r||l.listener===r)--this._eventsCount==0?this._events=Object.create(null):(delete u[i],u.removeListener&&this.emit("removeListener",i,l.listener||r));else if(typeof l!="function"){var f=-1;for(s=l.length-1;0<=s;s--)if(l[s]===r||l[s].listener===r){var E=l[s].listener;f=s;break}if(0>f)return this;if(f===0)l.shift();else{for(;f+1<l.length;f++)l[f]=l[f+1];l.pop()}l.length===1&&(u[i]=l[0]),u.removeListener!==void 0&&this.emit("removeListener",i,E||r)}return this},Ba.prototype.off=Ba.prototype.removeListener,Ba.prototype.removeAllListeners=function(i){var r=this._events;if(r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[i]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete r[i]),this;if(arguments.length===0){var s=Object.keys(r);for(r=0;r<s.length;++r){var u=s[r];u!=="removeListener"&&this.removeAllListeners(u)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(s=r[i])=="function")this.removeListener(i,s);else if(s!==void 0)for(r=s.length-1;0<=r;r--)this.removeListener(i,s[r]);return this},Ba.prototype.listeners=function(i){return Fm(this,i,!0)},Ba.prototype.rawListeners=function(i){return Fm(this,i,!1)},Ba.listenerCount=function(i,r){return typeof i.listenerCount=="function"?i.listenerCount(r):Hm.call(i,r)},Ba.prototype.listenerCount=Hm,Ba.prototype.eventNames=function(){return 0<this._eventsCount?$y(this._events):[]},Ba.once=function(i,r){return new Promise(function(s,u){function l(E){i.removeListener(r,f),u(E)}function f(){typeof i.removeListener=="function"&&i.removeListener("error",l),s([].slice.call(arguments))}Im(i,r,f,{once:!0}),r!=="error"&&fu(i,l,{once:!0})})};var tf=Object.assign,Nq=Object.defineProperty,Bg=!tf||la(function(){if(wa&&tf({b:1},tf(Nq({},"a",{enumerable:!0,get:function(){Nq(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var i={},r={},s=Symbol();return i[s]=7,"abcdefghijklmnopqrst".split("").forEach(function(u){r[u]=u}),tf({},i)[s]!=7||ed(tf({},r)).join("")!="abcdefghijklmnopqrst"})?function(i,r){for(var s=pb(i),u=arguments.length,l=1,f=gg.f,E=eg;u>l;)for(var T,v=fg(arguments[l++]),w=f?ed(v).concat(f(v)):ed(v),k=w.length,B=0;k>B;)T=w[B++],(!wa||E.call(v,T))&&(s[T]=v[T]);return s}:tf;ea({target:"Object",stat:!0,forced:Object.assign!==Bg},{assign:Bg}),Dq("Map",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},Gq);var az=Math.log,bz=Math.LN2;ea({target:"Math",stat:!0},{log2:function(i){return az(i)/bz}});var cz=qb.f,dz=de.f,ez=cb.enforce,fz=Fa("match"),Vc=R.RegExp,Wk=Vc.prototype,Cg=/a/g,Xk=/a/g,Yk=new Vc(Cg)!==Cg;if(wa&&Qc("RegExp",!Yk||Rc||la(function(){return Xk[fz]=!1,Vc(Cg)!=Cg||Vc(Xk)==Xk||Vc(Cg,"i")!="/a/i"}))){for(var ld=function(i,r){var s,u=this instanceof ld,l=Lj(i),f=r===void 0;return!u&&l&&i.constructor===ld&&f||(Yk?l&&!f&&(i=i.source):i instanceof ld&&(f&&(r=Gj.call(i)),i=i.source),Rc&&(s=!!r&&-1<r.indexOf("y"))&&(r=r.replace(/y/g,"")),i=Wh(Yk?new Vc(i,r):Vc(i,r),u?this:Wk,ld),Rc&&s&&(ez(i).sticky=!0)),i},gz=function(i){i in ld||cz(ld,i,{configurable:!0,get:function(){return Vc[i]},set:function(r){Vc[i]=r}})},Oq=dz(Vc),Pq=0;Oq.length>Pq;)gz(Oq[Pq++]);Wk.constructor=ld,ld.prototype=Wk,Za(R,"RegExp",ld)}og("RegExp"),xg("Float32",function(i){return function(r,s,u){return i(this,r,s,u)}}),xg("Float64",function(i){return function(r,s,u){return i(this,r,s,u)}}),xg("Uint32",function(i){return function(r,s,u){return i(this,r,s,u)}}),xg("Uint16",function(i){return function(r,s,u){return i(this,r,s,u)}});var Zk=function(i,r){return i===r?0:i==null?r==null?0:-1:r==null?i==null?0:1:typeof i.compare=="function"?i.compare(r):typeof r.compare=="function"?-r.compare(i):i<r?-1:i>r?1:0},$k=[],Qq=$k.sort,hz=la(function(){$k.sort(void 0)}),iz=la(function(){$k.sort(null)}),jz=ff("sort");ea({target:"Array",proto:!0,forced:hz||!iz||!jz},{sort:function(i){return i===void 0?Qq.call(pb(this)):Qq.call(pb(this),Wb(i))}});var Rq=Object.getPrototypeOf({}),Dg=function(i,r){var s;return i===r||(i==null?i==r:qa(i.equiv)==="function"?i.equiv(r):r==null?i==r:qa(r.equiv)==="function"?r.equiv(i):qa(i)!=="string"&&qa(r)!=="string"&&((s=Object.getPrototypeOf(i))!=null&&s!==Rq||(s=Object.getPrototypeOf(r))!=null&&s!==Rq?qa(i)!=="function"&&i.length!==void 0&&qa(r)!=="function"&&r.length!==void 0?lz(i,r):i instanceof Set&&r instanceof Set?mz(i,r):i instanceof Map&&r instanceof Map?nz(i,r):i instanceof Date&&r instanceof Date?i.getTime()===r.getTime():i instanceof RegExp&&r instanceof RegExp?i.toString()===r.toString():i!=i&&r!=r:kz(i,r)))},lz=function(i,r){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Dg,u=i.length;if(u===r.length)for(;0<=--u&&s(i[u],r[u]););return 0>u},mz=function(i,r){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Dg;return i.size===r.size&&s(Z(i.keys()).sort(),Z(r.keys()).sort())},nz=function(i,r){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Dg;return i.size===r.size&&s(Z(i).sort(),Z(r).sort())},kz=function(i,r){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Dg;if(Object.keys(i).length!==Object.keys(r).length)return!1;for(var u in i)if(!r.hasOwnProperty(u)||!s(i[u],r[u]))return!1;return!0},Sq=function(i){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(s){return s!==void 0?": "+s:""};return function(s){function u(f){return va(this,u),l.call(this,i(f)+r(f))}Ga(u,s);var l=Ha(u);return u}(Kf(Error))},oz=Sq(function(){return"illegal argument(s)"}),ei=function(i){throw new oz(i)},al=Sq(function(){return"index out of bounds"}),Tq=1/4294967295,pz=function(){function i(){va(this,i)}return eb(i,[{key:"float",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return this.int()*Tq*r}},{key:"norm",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(this.int()*Tq-.5)*r}},{key:"minmax",value:function(r,s){return this.float()*(s-r)+r}}]),i}(),bl=Math.random,qz=new(function(i){function r(){return va(this,r),s.apply(this,arguments)}Ga(r,i);var s=Ha(r);return eb(r,[{key:"int",value:function(){return 4294967296*bl()>>>0}},{key:"float",value:function(){var u=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return bl()*u}},{key:"norm",value:function(){var u=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(bl()-.5)*u}}]),r}(pz)),Ni=Symbol(),Lm=function(){},rz=Sk.onFreeze,cl=Object.freeze,sz=la(function(){cl(1)});ea({target:"Object",stat:!0,forced:sz,sham:!Cq},{freeze:function(i){return cl&&xa(i)?cl(rz(i)):i}});var tz=ff("reduce"),uz=!fd&&79<Cd&&83>Cd;ea({target:"Array",proto:!0,forced:!tz||uz},{reduce:function(i){return $p(this,i,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Km=function(i){return i!=null&&typeof i.xform=="function"?i.xform():i},Xg=function(){function i(r){va(this,i),this.value=r}return eb(i,[{key:"deref",value:function(){return this.value}}]),i}(),Oi=function(i){return i instanceof Xg?i.deref():i},hu=function(i,r){return[i,function(s){return s},r]},vz=N.mark(function(i,r){var s,u,l,f,E,T;return N.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:s=Km(i)(gu()),u=s[1],l=s[2],f=0;case 4:if(!(f<r.length)){v.next=15;break}if(E=r[f],!((T=l([],E))instanceof Xg)){v.next=10;break}return v.delegateYield(Oi(u(T.deref())),"t0",9);case 9:return v.abrupt("return");case 10:if(!T.length){v.next=12;break}return v.delegateYield(T,"t1",12);case 12:f++,v.next=4;break;case 15:return v.delegateYield(Oi(u([])),"t2",16);case 16:case"end":return v.stop()}},vz)}),iu=N.mark(Jm),ju=function(i,r){return[i[0],i[1],r]},wz=function(){function i(r){va(this,i),this._length=0,r&&this.into(r)}return eb(i,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new i(this)}},{key:"empty",value:function(){return new i}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var r,s=this.head;s;)r=s.next,delete s.value,delete s.prev,delete s.next,s=r;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(r){var s=this._length;if(s<r._length)return-1;if(s>r._length)return 1;if(s===0)return 0;s=this.head,r=r.head;for(var u=0;s&&u==0;)u=Zk(s.value,r.value),s=s.next,r=r.next;return u}},{key:"equiv",value:function(r){if(!(r instanceof i||r!=null&&typeof r!="function"&&r.length!==void 0)||this._length!==r.length)return!1;if(!this._length||this===r)return!0;for(var s=this.head,u=0;u<r.length;u++){if(!Dg(s.value,r[u]))return!1;s=s.next}return!0}},{key:Symbol.iterator,value:N.mark(function r(){var s;return N.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:s=this.head;case 1:if(!s){u.next=7;break}return u.next=4,s.value;case 4:s=s.next,u.next=1;break;case 7:case"end":return u.stop()}},r,this)})},{key:"seq",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;if(!(r>=s||0>r)){r=this.nthCell(r);var u=this.nthCell(s-1);return s=function l(f){return{first:function(){return f.value},next:function(){return f!==u&&f.next?l(f.next):void 0}}},r?s(r):void 0}}},{key:"cycle",value:N.mark(function r(){return N.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.delegateYield(this,"t0",2);case 2:s.next=0;break;case 4:case"end":return s.stop()}},r,this)})},{key:"$reduce",value:function(r,s){for(var u=this.head;u&&!(s instanceof Xg);)s=r(s,u.value),u=u.next;return s}},{key:"drop",value:function(){var r=this.head;if(r)return(this.head=r.next)?delete this.head.prev:delete this.tail,this._length--,r.value}},{key:"cons",value:function(r){return r={value:r,next:this.head},this.head?this.head.prev=r:this.tail=r,this.head=r,this._length++,this}},{key:"insertBefore",value:function(r,s){return r||ei("cell is undefined"),s={value:s,next:r,prev:r.prev},r.prev?r.prev.next=s:this.head=s,r.prev=s,this._length++,this}},{key:"insertAfter",value:function(r,s){return r||ei("cell is undefined"),s={value:s,next:r.next,prev:r},r.next?r.next.prev=s:this.tail=s,r.next=s,this._length++,this}},{key:"insertBeforeNth",value:function(r,s){if(0>r&&(r+=this._length),0>=r)return this.cons(s);if(0>r||r>=this._length)throw new al(r);return this.insertBefore(this.nthCellUnsafe(r),s)}},{key:"insertAfterNth",value:function(r,s){if(0>r&&(r+=this._length),r>=this._length-1)return this.push(s);if(0>r||r>=this._length)throw new al(r);return this.insertAfter(this.nthCellUnsafe(r),s)}},{key:"insertSorted",value:function(r,s){s=s||Zk;for(var u=this.head;u;){if(0>=s(r,u.value))return this.insertBefore(u,r);u=u.next}return this.push(r)}},{key:"find",value:function(r){for(var s=this.head;s;){if(s.value===r)return s;s=s.next}}},{key:"findWith",value:function(r){for(var s=this.head;s;){if(r(s.value))return s;s=s.next}}},{key:"concat",value:function(){for(var r=this.copy(),s=arguments.length,u=Array(s),l=0;l<s;l++)u[l]=arguments[l];for(s=0;s<u.length;s++)r.into(u[s]);return r}},{key:"into",value:function(r){for(var s=0;s<r.length;s++)this.push(r[s])}},{key:"slice",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;r=0>r?r+this._length:r,s=0>s?s+this._length:s,(0>r||0>s)&&ei("invalid indices: ${from} / ${to}");for(var u=new i,l=this.nthCell(r);l&&++r<=s;)u.push(l.value),l=l.next;return u}},{key:"splice",value:function(r){var s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,u=2<arguments.length?arguments[2]:void 0;if(typeof r=="number"){if(0>r&&(r+=this._length),0>r||r>=this._length)throw new al(r);var l=this.nthCellUnsafe(r)}else l=r;var f=new i;if(0<s)for(;l&&0<s--;)this.remove(l),f.push(l.value),l=l.next;else l&&(l=l.next);if(u)if(l)for(s=0;s<u.length;s++)this.insertBefore(l,u[s]);else for(l=0;l<u.length;l++)this.push(u[l]);return f}},{key:"remove",value:function(r){return r.prev?r.prev.next=r.next:this.head=r.next,r.next?r.next.prev=r.prev:this.tail=r.prev,this._length--,this}},{key:"swap",value:function(r,s){if(r!==s){var u=r.value;r.value=s.value,s.value=u}return this}},{key:"push",value:function(r){return this.tail?(r={value:r,prev:this.tail},this.tail=this.tail.next=r,this._length++,this):this.cons(r)}},{key:"pop",value:function(){var r=this.tail;if(r)return(this.tail=r.prev)?delete this.tail.next:delete this.head,this._length--,r.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(r){return this.head?(this.head.value=r,this):this.cons(r)}},{key:"setTail",value:function(r){return this.tail?(this.tail.value=r,this):this.push(r)}},{key:"setNth",value:function(r,s){var u=this.nthCell(r);return!u&&ei("index out of bounds: ".concat(r)),u.value=s,this}},{key:"nth",value:function(r,s){return(r=this.nthCell(r))?r.value:s}},{key:"nthCell",value:function(r){if(0>r&&(r+=this._length),!(0>r||r>=this._length))return this.nthCellUnsafe(r)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var r=this.peek();return this.pop(),this.cons(r)}}},{key:"map",value:function(r){for(var s=new i,u=this.head;u;)s.push(r(u.value)),u=u.next;return s}},{key:"filter",value:function(r){for(var s=new i,u=this.head;u;)r(u.value)&&s.push(u.value),u=u.next;return s}},{key:"reduce",value:function(r,s){for(var u=this.head;u;)s=r(s,u.value),u=u.next;return s}},{key:"shuffle",value:function(r){var s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:qz;if(2>this._length)return this;for(r=r??Math.ceil(1.5*Math.log2(this._length));0<r;r--)for(var u=this.head;u;){var l=u.next;.5>s.float()?this.asHead(u):this.asTail(u),u=l}return this}},{key:"sort",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:Zk;if(!this._length)return this;for(var s=1;;){var u=this.head;this.tail=this.head=void 0;for(var l=0;u;){l++;for(var f=u,E=0,T=0;T<s&&(E++,f=f.next);T++);for(T=s;0<E||0<T&&f;){if(E===0){var v=f;f=f.next,T--}else f&&T!==0?0>=r(u.value,f.value)?(v=u,u=u.next,E--):(v=f,f=f.next,T--):(v=u,u=u.next,E--);this.tail?this.tail.next=v:this.head=v,v.prev=this.tail,this.tail=v}u=f}if(this.tail.next=void 0,1>=l)return this;s*=2}}},{key:"reverse",value:function(){for(var r=this.head,s=this.tail,u=(this._length>>>1)+(1&this._length);r&&s&&0<u;){var l=r.value;r.value=s.value,s.value=l,r=r.next,s=s.prev,u--}return this}},{key:"asHead",value:function(r){return r===this.head||(this.remove(r),this.head.prev=r,r.next=this.head,r.prev=void 0,this.head=r,this._length++),this}},{key:"asTail",value:function(r){return r===this.tail||(this.remove(r),this.tail.next=r,r.prev=this.tail,r.next=void 0,this.tail=r,this._length++),this}},{key:"toString",value:function(){for(var r=[],s=this.head;s;)r.push(String(s.value)),s=s.next;return r.join(", ")}},{key:"toJSON",value:function(){return Z(this)}},{key:"nthCellUnsafe",value:function(r){if(r<=this._length>>1)var s=this.head,u="next";else s=this.tail,u="prev",r=this._length-r-1;for(;0<r--&&s;)s=s[u];return s}}]),i}(),Wc=function(){function i(r,s){va(this,i),s=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},s),this.map=s.map(),this.items=new wz,this._size=0,this.opts=s,r&&this.into(r)}return eb(i,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return Yg(function(r){return[r.k,r]},this.items)}},{key:"keys",value:function(){return Yg(function(r){return r.k},this.items)}},{key:"values",value:function(){return Yg(function(r){return r.v},this.items)}},{key:"copy",value:function(){var r=this.empty();r.items=this.items.copy();for(var s=r.items.head;s;)r.map.set(s.value.k,s),s=s.next;return r}},{key:"empty",value:function(){return new i(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var r=this.opts.release;if(r){for(var s;s=this.items.drop();)r(s.k,s.v);return!0}return this.items.release()}},{key:"has",value:function(r){return this.map.has(r)}},{key:"get",value:function(r,s){return(r=this.map.get(r))?this.resetEntry(r):s}},{key:"set",value:function(r,s){var u=this.opts.ksize(r)+this.opts.vsize(s),l=this.map.get(r);return this._size+=Math.max(0,u-(l?l.value.s:0)),this.ensureSize()&&this.doSetEntry(l,r,s,u),s}},{key:"into",value:function(r){for(var s=0;s<r.length;s++){var u=r[s];this.set(u[0],u[1])}return this}},{key:"getSet",value:function(r,s){var u=this,l=this.map.get(r);return l?Promise.resolve(this.resetEntry(l)):s().then(function(f){return u.set(r,f)})}},{key:"delete",value:function(r){return!!(r=this.map.get(r))&&(this.removeEntry(r),!0)}},{key:"resetEntry",value:function(r){return this.items.asTail(r),r.value.v}},{key:"ensureSize",value:function(){for(var r=this.opts.release,s=this.opts.maxsize,u=this.opts.maxlen;this._size>s||this.length>=u;){var l=this.items.drop();if(!l)return!1;this.map.delete(l.k),r&&r(l.k,l.v),this._size-=l.s}return!0}},{key:"removeEntry",value:function(r){var s=r.value;this.map.delete(s.k),this.items.remove(r),this.opts.release&&this.opts.release(s.k,s.v),this._size-=s.s}},{key:"doSetEntry",value:function(r,s,u,l){r?(r.value.v=u,r.value.s=l,this.items.asTail(r)):(this.items.push({k:s,v:u,s:l}),this.map.set(s,this.items.tail))}}]),i}(),xz=function(i){function r(u,l){return va(this,r),l=Object.assign({ttl:36e5},l),s.call(this,u,l)}Ga(r,i);var s=Ha(r);return eb(r,[{key:"empty",value:function(){return new r(null,this.opts)}},{key:"has",value:function(u){return this.get(u)!==void 0}},{key:"get",value:function(u,l){if(u=this.map.get(u)){if(u.value.t>=Date.now())return this.resetEntry(u);this.removeEntry(u)}return l}},{key:"set",value:function(u,l){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,E=this.opts.ksize(u)+this.opts.vsize(l),T=this.map.get(u);return this._size+=Math.max(0,E-(T?T.value.s:0)),this.ensureSize()&&(f=Date.now()+f,T?(T.value.v=l,T.value.s=E,T.value.t=f,this.items.asTail(T)):(this.items.push({k:u,v:l,s:E,t:f}),this.map.set(u,this.items.tail))),l}},{key:"getSet",value:function(u,l){var f=this,E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,T=this.get(u);return T?Promise.resolve(T):l().then(function(v){return f.set(u,v,E)})}},{key:"prune",value:function(){for(var u=Date.now(),l=this.items.head;l;)l.value.t<u&&this.removeEntry(l),l=l.next}},{key:"ensureSize",value:function(){for(var u=this.opts.maxsize,l=this.opts.maxlen,f=Date.now(),E=this.items.head;E&&(this._size>u||this.length>=l);)E.value.t<f&&this.removeEntry(E),E=E.next;return Li(Td(r.prototype),"ensureSize",this).call(this)}}]),r}(Wc),Uq=qa(Ya)=="object"&&Ya&&Ya.Object===Object&&Ya,yz=(typeof self>"u"?"undefined":qa(self))=="object"&&self&&self.Object===Object&&self,$b=Uq||yz||Function("return this")(),lc=$b.Symbol,Vq=Object.prototype,zz=Vq.hasOwnProperty,Az=Vq.toString,Eg=lc?lc.toStringTag:void 0,Bz=Object.prototype.toString,Wq=lc?lc.toStringTag:void 0,me=function(i){if(i==null)i=i===void 0?"[object Undefined]":"[object Null]";else if(Wq&&Wq in Object(i)){var r=zz.call(i,Eg),s=i[Eg];try{i[Eg]=void 0;var u=!0}catch{}var l=Az.call(i);u&&(r?i[Eg]=s:delete i[Eg]),i=l}else i=Bz.call(i);return i},Gb=function(i){var r=qa(i);return i!=null&&(r=="object"||r=="function")},jj=function(i){return!!Gb(i)&&((i=me(i))=="[object Function]"||i=="[object GeneratorFunction]"||i=="[object AsyncFunction]"||i=="[object Proxy]")},dl=$b["__core-js_shared__"],Xq=function(){var i=/[^.]+$/.exec(dl&&dl.keys&&dl.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),Cz=Function.prototype.toString,ne=function(i){if(i!=null){try{return Cz.call(i)}catch{}return i+""}return""},Dz=/^\[object .+?Constructor\]$/,Ez=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),oe=function(i,r){return i=i==null?void 0:i[r],!Gb(i)||Xq&&Xq in i||!(jj(i)?Ez:Dz).test(ne(i))?void 0:i},Fg=oe(Object,"create"),Fz=Object.prototype.hasOwnProperty,Gz=Object.prototype.hasOwnProperty;Vd.prototype.clear=function(){this.__data__=Fg?Fg(null):{},this.size=0},Vd.prototype.delete=function(i){return i=this.has(i)&&delete this.__data__[i],this.size-=i?1:0,i},Vd.prototype.get=function(i){var r=this.__data__;return Fg?(i=r[i])==="__lodash_hash_undefined__"?void 0:i:Fz.call(r,i)?r[i]:void 0},Vd.prototype.has=function(i){var r=this.__data__;return Fg?r[i]!==void 0:Gz.call(r,i)},Vd.prototype.set=function(i,r){var s=this.__data__;return this.size+=this.has(i)?0:1,s[i]=Fg&&r===void 0?"__lodash_hash_undefined__":r,this};var Gg=function(i,r){return i===r||i!=i&&r!=r},fi=function(i,r){for(var s=i.length;s--;)if(Gg(i[s][0],r))return s;return-1},Hz=Array.prototype.splice;Ee.prototype.clear=function(){this.__data__=[],this.size=0},Ee.prototype.delete=function(i){var r=this.__data__;return!(0>(i=fi(r,i)))&&(i==r.length-1?r.pop():Hz.call(r,i,1),--this.size,!0)},Ee.prototype.get=function(i){var r=this.__data__;return 0>(i=fi(r,i))?void 0:r[i][1]},Ee.prototype.has=function(i){return-1<fi(this.__data__,i)},Ee.prototype.set=function(i,r){var s=this.__data__,u=fi(s,i);return 0>u?(++this.size,s.push([i,r])):s[u][1]=r,this};var $g=Ee,Hg=oe($b,"Map"),gi=function(i,r){i=i.__data__;var s=qa(r);return(s=="string"||s=="number"||s=="symbol"||s=="boolean"?r!=="__proto__":r===null)?i[typeof r=="string"?"string":"hash"]:i.map};Fe.prototype.clear=function(){this.size=0,this.__data__={hash:new Vd,map:new(Hg||$g),string:new Vd}},Fe.prototype.delete=function(i){return i=gi(this,i).delete(i),this.size-=i?1:0,i},Fe.prototype.get=function(i){return gi(this,i).get(i)},Fe.prototype.has=function(i){return gi(this,i).has(i)},Fe.prototype.set=function(i,r){var s=gi(this,i),u=s.size;return s.set(i,r),this.size+=s.size==u?0:1,this};var Zg=Fe;Lf.prototype.add=Lf.prototype.push=function(i){return this.__data__.set(i,"__lodash_hash_undefined__"),this},Lf.prototype.has=function(i){return this.__data__.has(i)};var Yq=function(i,r,s,u){var l=i.length;for(s+=-1;++s<l;)if(r(i[s],s,i))return s;return-1},Iz=function(i){return i!=i},Jz=function(i,r){var s;if(s=!(i==null||!i.length)){if(r==r)t:{s=-1;for(var u=i.length;++s<u;)if(i[s]===r){i=s;break t}i=-1}else i=Yq(i,Iz,0);s=-1<i}return s},Kz=function(i,r,s){for(var u=-1,l=i==null?0:i.length;++u<l;)if(s(r,i[u]))return!0;return!1},Lz=function(i,r){return i.has(r)},uf=oe($b,"Set"),Mz=function(){},el=function(i){var r=-1,s=Array(i.size);return i.forEach(function(u){s[++r]=u}),s},Nz=1/0,Oz=uf&&1/el(new uf([,-0]))[1]==Nz?function(i){return new uf(i)}:Mz,fl=function(i,r,s){var u=-1,l=Jz,f=i.length,E=!0,T=[],v=T;if(s)E=!1,l=Kz;else if(200<=f){if(l=Oz(i))return el(l);E=!1,l=Lz,v=new Lf}else v=T;t:for(;++u<f;){var w=i[u],k=w;if(w=s||w!==0?w:0,E&&k==k){for(var B=v.length;B--;)if(v[B]===k)continue t;T.push(w)}else l(v,k,s)||(v!==T&&v.push(k),T.push(w))}return T},Zq=function(i){for(var r=-1,s=i==null?0:i.length,u={};++r<s;){var l=i[r];u[l[0]]=l[1]}return u},Je=function(i,r){for(var s=-1,u=i==null?0:i.length,l=Array(u);++s<u;)l[s]=r(i[s],s,i);return l};Ge.prototype.clear=function(){this.__data__=new $g,this.size=0},Ge.prototype.delete=function(i){var r=this.__data__;return i=r.delete(i),this.size=r.size,i},Ge.prototype.get=function(i){return this.__data__.get(i)},Ge.prototype.has=function(i){return this.__data__.has(i)},Ge.prototype.set=function(i,r){var s=this.__data__;if(s instanceof $g){var u=s.__data__;if(!Hg||199>u.length)return u.push([i,r]),this.size=++s.size,this;s=this.__data__=new Zg(u)}return s.set(i,r),this.size=s.size,this};var Ie=Ge,su=function(i,r){for(var s=-1,u=i==null?0:i.length;++s<u&&r(i[s],s,i)!==!1;);return i},hi=function(){try{var i=oe(Object,"defineProperty");return i({},"",{}),i}catch{}}(),Ig=function(i,r,s){r=="__proto__"&&hi?hi(i,r,{configurable:!0,enumerable:!0,value:s,writable:!0}):i[r]=s},Pz=Object.prototype.hasOwnProperty,Qm=function(i,r,s){var u=i[r];Pz.call(i,r)&&Gg(u,s)&&(s!==void 0||r in i)||Ig(i,r,s)},Ue=function(i,r,s,u){var l=!s;s||(s={});for(var f=-1,E=r.length;++f<E;){var T=r[f],v=void 0;v===void 0&&(v=i[T]),l?Ig(s,T,v):Qm(s,T,v)}return s},Hc=function(i){return i!=null&&qa(i)=="object"},$q=function(i){return Hc(i)&&me(i)=="[object Arguments]"},ar=Object.prototype,Qz=ar.hasOwnProperty,Rz=ar.propertyIsEnumerable,Vf=$q(function(){return arguments}())?$q:function(i){return Hc(i)&&Qz.call(i,"callee")&&!Rz.call(i,"callee")},ub=Array.isArray,Sz=function(){return!1},Nf=xb(function(i,r){var s=(r=r&&!r.nodeType&&r)&&i&&!i.nodeType&&i;r=s&&s.exports===r?$b.Buffer:void 0,i.exports=(r?r.isBuffer:void 0)||Sz}),Tz=/^(?:0|[1-9]\d*)$/,gl=function(i,r){var s=qa(i);return!!(r=r??9007199254740991)&&(s=="number"||s!="symbol"&&Tz.test(i))&&-1<i&&i%1==0&&i<r},hl=function(i){return typeof i=="number"&&-1<i&&i%1==0&&9007199254740991>=i},Va={};Va["[object Float32Array]"]=Va["[object Float64Array]"]=Va["[object Int8Array]"]=Va["[object Int16Array]"]=Va["[object Int32Array]"]=Va["[object Uint8Array]"]=Va["[object Uint8ClampedArray]"]=Va["[object Uint16Array]"]=Va["[object Uint32Array]"]=!0,Va["[object Arguments]"]=Va["[object Array]"]=Va["[object ArrayBuffer]"]=Va["[object Boolean]"]=Va["[object DataView]"]=Va["[object Date]"]=Va["[object Error]"]=Va["[object Function]"]=Va["[object Map]"]=Va["[object Number]"]=Va["[object Object]"]=Va["[object RegExp]"]=Va["[object Set]"]=Va["[object String]"]=Va["[object WeakMap]"]=!1;var Uz=function(i){return Hc(i)&&hl(i.length)&&!!Va[me(i)]},ii=function(i){return function(r){return i(r)}},vf=xb(function(i,r){var s=r&&!r.nodeType&&r;s=(r=s&&i&&!i.nodeType&&i)&&r.exports===s&&Uq.process;t:{try{var u=r&&r.require&&r.require("util").types;if(u){var l=u;break t}l=s&&s.binding&&s.binding("util");break t}catch{}l=void 0}i.exports=l}),br=vf&&vf.isTypedArray,Ui=br?ii(br):Uz,Vz=Object.prototype.hasOwnProperty,cr=function(i,r){var s=ub(i),u=!s&&Vf(i),l=!s&&!u&&Nf(i),f=!s&&!u&&!l&&Ui(i);if(s=s||u||l||f){u=i.length;for(var E=String,T=-1,v=Array(u);++T<u;)v[T]=E(T);u=v}else u=[];for(var w in E=u.length,i)!r&&!Vz.call(i,w)||s&&(w=="length"||l&&(w=="offset"||w=="parent")||f&&(w=="buffer"||w=="byteLength"||w=="byteOffset")||gl(w,E))||u.push(w);return u},Wz=Object.prototype,il=function(i){var r=i&&i.constructor;return i===(typeof r=="function"&&r.prototype||Wz)},dr=function(i,r){return function(s){return i(r(s))}},Xz=dr(Object.keys,Object),Yz=Object.prototype.hasOwnProperty,ae=function(i){return i!=null&&hl(i.length)&&!jj(i)},Wd=function(i){if(ae(i))i=cr(i);else if(il(i)){var r,s=[];for(r in Object(i))Yz.call(i,r)&&r!="constructor"&&s.push(r);i=s}else i=Xz(i);return i},ou=function(i,r){return i&&Ue(r,Wd(r),i)},Zz=Object.prototype.hasOwnProperty,Of=function(i){if(ae(i))i=cr(i,!0);else if(Gb(i)){var r=il(i),s=[];for(u in i)(u!="constructor"||!r&&Zz.call(i,u))&&s.push(u);i=s}else{var u=[];if(i!=null)for(r in Object(i))u.push(r);i=u}return i},mu=function(i,r){return i&&Ue(r,Of(r),i)},Nm=xb(function(i,r){var s=(r=r&&!r.nodeType&&r)&&i&&!i.nodeType&&i,u=(r=s&&s.exports===r?$b.Buffer:void 0)?r.allocUnsafe:void 0;i.exports=function(l,f){return f?l.slice():(f=l.length,f=u?u(f):new l.constructor(f),l.copy(f),f)}}),Pi=function(i,r){var s=-1,u=i.length;for(r||(r=Array(u));++s<u;)r[s]=i[s];return r},$z=function(i,r){for(var s=-1,u=i==null?0:i.length,l=0,f=[];++s<u;){var E=i[s];r(E,s,i)&&(f[l++]=E)}return f},er=function(){return[]},aA=Object.prototype.propertyIsEnumerable,fr=Object.getOwnPropertySymbols,jl=fr?function(i){return i==null?[]:(i=Object(i),$z(fr(i),function(r){return aA.call(i,r)}))}:er,nu=function(i,r){return Ue(i,jl(i),r)},Ti=function(i,r){for(var s=-1,u=r.length,l=i.length;++s<u;)i[l+s]=r[s];return i},kl=dr(Object.getPrototypeOf,Object),gr=Object.getOwnPropertySymbols?function(i){for(var r=[];i;)Ti(r,jl(i)),i=kl(i);return r}:er,lu=function(i,r){return Ue(i,gr(i),r)},hr=function(i,r,s){return r=r(i),ub(i)?r:Ti(r,s(i))},Qi=function(i){return hr(i,Wd,jl)},Pm=function(i){return hr(i,Of,gr)},ll=oe($b,"DataView"),ml=oe($b,"Promise"),nl=oe($b,"WeakMap"),bA=ne(ll),cA=ne(Hg),dA=ne(ml),eA=ne(uf),fA=ne(nl),pe=me;(ll&&pe(new ll(new ArrayBuffer(1)))!="[object DataView]"||Hg&&pe(new Hg)!="[object Map]"||ml&&pe(ml.resolve())!="[object Promise]"||uf&&pe(new uf)!="[object Set]"||nl&&pe(new nl)!="[object WeakMap]")&&(pe=function(i){var r=me(i);if(i=(i=r=="[object Object]"?i.constructor:void 0)?ne(i):"")switch(i){case bA:return"[object DataView]";case cA:return"[object Map]";case dA:return"[object Promise]";case eA:return"[object Set]";case fA:return"[object WeakMap]"}return r});var Mf=pe,gA=Object.prototype.hasOwnProperty,ku=function(i){var r=i.length,s=new i.constructor(r);return r&&typeof i[0]=="string"&&gA.call(i,"index")&&(s.index=i.index,s.input=i.input),s},ji=$b.Uint8Array,ol=function(i){var r=new i.constructor(i.byteLength);return new ji(r).set(new ji(i)),r},hA=/\w*$/,ir=lc?lc.prototype:void 0,jr=ir?ir.valueOf:void 0,Bn=function(i,r){return r=r?ol(i.buffer):i.buffer,new i.constructor(r,i.byteOffset,i.length)},pu=function(i,r,s){var u=i.constructor;switch(r){case"[object ArrayBuffer]":return ol(i);case"[object Boolean]":case"[object Date]":return new u(+i);case"[object DataView]":return r=s?ol(i.buffer):i.buffer,new i.constructor(r,i.byteOffset,i.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Bn(i,s);case"[object Map]":return new u;case"[object Number]":case"[object String]":return new u(i);case"[object RegExp]":return(r=new i.constructor(i.source,hA.exec(i))).lastIndex=i.lastIndex,r;case"[object Set]":return new u;case"[object Symbol]":return jr?Object(jr.call(i)):{}}},kr=Object.create,iA=function(){function i(){}return function(r){return Gb(r)?kr?kr(r):(i.prototype=r,r=new i,i.prototype=void 0,r):{}}}(),Om=function(i){return typeof i.constructor!="function"||il(i)?{}:iA(kl(i))},jA=function(i){return Hc(i)&&Mf(i)=="[object Map]"},lr=vf&&vf.isMap,ru=lr?ii(lr):jA,kA=function(i){return Hc(i)&&Mf(i)=="[object Set]"},mr=vf&&vf.isSet,qu=mr?ii(mr):kA,Oa={};Oa["[object Arguments]"]=Oa["[object Array]"]=Oa["[object ArrayBuffer]"]=Oa["[object DataView]"]=Oa["[object Boolean]"]=Oa["[object Date]"]=Oa["[object Float32Array]"]=Oa["[object Float64Array]"]=Oa["[object Int8Array]"]=Oa["[object Int16Array]"]=Oa["[object Int32Array]"]=Oa["[object Map]"]=Oa["[object Number]"]=Oa["[object Object]"]=Oa["[object RegExp]"]=Oa["[object Set]"]=Oa["[object String]"]=Oa["[object Symbol]"]=Oa["[object Uint8Array]"]=Oa["[object Uint8ClampedArray]"]=Oa["[object Uint16Array]"]=Oa["[object Uint32Array]"]=!0,Oa["[object Error]"]=Oa["[object Function]"]=Oa["[object WeakMap]"]=!1;var Ke=function(i){return qa(i)=="symbol"||Hc(i)&&me(i)=="[object Symbol]"},lA=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,mA=/^\w*$/,pl=function(i,r){if(ub(i))return!1;var s=qa(i);return!(s!="number"&&s!="symbol"&&s!="boolean"&&i!=null&&!Ke(i))||mA.test(i)||!lA.test(i)||r!=null&&i in Object(r)};Ri.Cache=Zg;var nA=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,oA=/\\(\\)?/g,pA=function(i){var r=(i=Ri(i,function(s){return r.size===500&&r.clear(),s})).cache;return i}(function(i){var r=[];return i.charCodeAt(0)===46&&r.push(""),i.replace(nA,function(s,u,l,f){r.push(l?f.replace(oA,"$1"):u||s)}),r}),tu=1/0,nr=lc?lc.prototype:void 0,Sm=nr?nr.toString:void 0,ki=function(i,r){return ub(i)?i:pl(i,r)?[i]:pA(i==null?"":Rm(i))},qA=1/0,Jg=function(i){if(typeof i=="string"||Ke(i))return i;var r=i+"";return r=="0"&&1/i==-qA?"-0":r},li=function(i,r){for(var s=0,u=(r=ki(r,i)).length;i!=null&&s<u;)i=i[Jg(r[s++])];return s&&s==u?i:void 0},rA=function(i,r){if(!(2>(r=ki(r,i)).length)){var s=r,u=0,l=-1,f=-1,E=s.length;for(0>u&&(u=-u>E?0:E+u),0>(l=l>E?E:l)&&(l+=E),E=u>l?0:l-u>>>0,u>>>=0,l=Array(E);++f<E;)l[f]=s[f+u];i=li(i,l)}return(s=i==null)||(s=r==null?0:r.length,s=delete i[Jg(s?r[s-1]:void 0)]),s},or=Function.prototype.toString,sA=Object.prototype.hasOwnProperty,tA=or.call(Object),Cn=function(i){return!(!Hc(i)||me(i)!="[object Object]")&&((i=kl(i))===null||typeof(i=sA.call(i,"constructor")&&i.constructor)=="function"&&i instanceof i&&or.call(i)==tA)},uA=function(i){return Cn(i)?void 0:i},pr=lc?lc.isConcatSpreadable:void 0,uu=function(i){return ub(i)||Vf(i)||!!(pr&&i&&i[pr])},vA=function(i){return i!=null&&i.length?Si(i):[]},wA=function(i,r,s){switch(s.length){case 0:return i.call(r);case 1:return i.call(r,s[0]);case 2:return i.call(r,s[0],s[1]);case 3:return i.call(r,s[0],s[1],s[2])}return i.apply(r,s)},qr=Math.max,rr=function(i,r,s){return r=qr(r===void 0?i.length-1:r,0),function(){for(var u=arguments,l=-1,f=qr(u.length-r,0),E=Array(f);++l<f;)E[l]=u[r+l];for(l=-1,f=Array(r+1);++l<r;)f[l]=u[l];return f[r]=s(E),wA(i,this,f)}},xA=function(i){return function(){return i}},mi=function(i){return i},yA=Date.now,sr=function(i){var r=0,s=0;return function(){var u=yA(),l=16-(u-s);if(s=u,0<l){if(800<=++r)return arguments[0]}else r=0;return i.apply(void 0,arguments)}}(hi?function(i,r){return hi(i,"toString",{configurable:!0,enumerable:!1,value:xA(r),writable:!0})}:mi),ql=function(i){return sr(rr(i,void 0,vA),i+"")}(function(i,r){var s={};if(i==null)return s;var u=!1;r=Je(r,function(f){return f=ki(f,i),u||(u=1<f.length),f}),Ue(i,Pm(i),s),u&&(s=He(s,7,uA));for(var l=r.length;l--;)rA(s,r[l]);return s}),zA=function(i,r,s,u){for(var l=-1,f=i==null?0:i.length;++l<f;){var E=i[l];r(u,E,s(E),i)}return u},An=function(i,r,s){for(var u=-1,l=Object(i),f=(s=s(i)).length;f--;){var E=s[++u];if(r(l[E],E,l)===!1)break}return i},tr=function(i,r){return i&&An(i,r,Wd)},rl=function(i,r){return function(s,u){if(s==null)return s;if(!ae(s))return i(s,u);for(var l=s.length,f=-1,E=Object(s);++f<l&&u(E[f],f,E)!==!1;);return s}}(tr),AA=function(i,r,s,u){return rl(i,function(l,f,E){r(u,l,s(l),E)}),u},ur=function(i,r){for(var s=-1,u=i==null?0:i.length;++s<u;)if(r(i[s],s,i))return!0;return!1},Tm=function(i,r,s,u,l,f){var E=1&s,T=i.length,v=r.length;if(T!=v&&!(E&&v>T))return!1;v=f.get(i);var w=f.get(r);if(v&&w)return v==r&&w==i;v=-1,w=!0;var k=2&s?new Lf:void 0;for(f.set(i,r),f.set(r,i);++v<T;){var B=i[v],Q=r[v];if(u)var X=E?u(Q,B,v,r,i,f):u(B,Q,v,i,r,f);if(X!==void 0){if(X)continue;w=!1;break}if(k){if(!ur(r,function(_e,aa){if(!k.has(aa)&&(B===_e||l(B,_e,s,u,f)))return k.push(aa)})){w=!1;break}}else if(B!==Q&&!l(B,Q,s,u,f)){w=!1;break}}return f.delete(i),f.delete(r),w},BA=function(i){var r=-1,s=Array(i.size);return i.forEach(function(u,l){s[++r]=[l,u]}),s},vr=lc?lc.prototype:void 0,sl=vr?vr.valueOf:void 0,vu=function(i,r,s,u,l,f,E){switch(s){case"[object DataView]":if(i.byteLength!=r.byteLength||i.byteOffset!=r.byteOffset)break;i=i.buffer,r=r.buffer;case"[object ArrayBuffer]":if(i.byteLength!=r.byteLength||!f(new ji(i),new ji(r)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return Gg(+i,+r);case"[object Error]":return i.name==r.name&&i.message==r.message;case"[object RegExp]":case"[object String]":return i==r+"";case"[object Map]":var T=BA;case"[object Set]":if(T||(T=el),i.size!=r.size&&!(1&u))break;return(s=E.get(i))?s==r:(u|=2,E.set(i,r),r=Tm(T(i),T(r),u,l,f,E),E.delete(i),r);case"[object Symbol]":if(sl)return sl.call(i)==sl.call(r)}return!1},wu=Object.prototype.hasOwnProperty,Um=Object.prototype.hasOwnProperty,CA=function(i,r,s,u){var l=s.length,f=l;if(i==null)return!f;for(i=Object(i);l--;){var E=s[l];if(E[2]?E[1]!==i[E[0]]:!(E[0]in i))return!1}for(;++l<f;){var T=(E=s[l])[0],v=i[T],w=E[1];if(E[2]){if(v===void 0&&!(T in i))return!1}else{var k;if(E=new Ie,k===void 0?!Le(w,v,3,u,E):!k)return!1}}return!0},DA=function(i){for(var r=Wd(i),s=r.length;s--;){var u=r[s],l=i[u];r[s]=[u,l,l==l&&!Gb(l)]}return r},wr=function(i,r){return function(s){return s!=null&&s[i]===r&&(r!==void 0||i in Object(s))}},EA=function(i){var r=DA(i);return r.length==1&&r[0][2]?wr(r[0][0],r[0][1]):function(s){return s===i||CA(s,i,r)}},FA=function(i,r){return pl(i)&&r==r&&!Gb(r)?wr(Jg(i),r):function(s){var u=s==null?void 0:li(s,i);if((u=u===void 0?void 0:u)===void 0&&u===r){if(u=s!=null){for(var l=-1,f=(u=ki(u=i,s)).length,E=!1;++l<f;){var T=Jg(u[l]);if(!(E=s!=null&&s!=null&&T in Object(s)))break;s=s[T]}E||++l!=f?u=E:u=!!(f=s==null?0:s.length)&&hl(f)&&gl(T,f)&&(ub(s)||Vf(s))}T=u}else T=Le(r,u,3);return T}},GA=function(i){return function(r){return r==null?void 0:r[i]}},HA=function(i){return function(r){return li(r,i)}},wf=function(i){return typeof i=="function"?i:i==null?mi:qa(i)=="object"?ub(i)?FA(i[0],i[1]):EA(i):pl(i)?GA(Jg(i)):HA(i)},tl=function(i,r){return function(s,u){var l={};return(ub(s)?zA:AA)(s,i,wf(u),l)}}(function(i,r,s){Ig(i,s,r)}),md=function(i,r){var s={};return r=wf(r),tr(i,function(u,l,f){Ig(s,l,r(u,l,f))}),s};ea({target:"String",proto:!0,forced:la(function(){var i="".sub('"');return i!==i.toLowerCase()||3<i.split('"').length})},{sub:function(){return"<sub>"+String(Eb(this))+"</sub>"}});var P=Pa,mc=null;try{mc=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(i){}Pa.prototype.__isLong__,Object.defineProperty(Pa.prototype,"__isLong__",{value:!0}),Pa.isLong=Hb;var Wm={},Vm={};Pa.fromInt=Xd,Pa.fromNumber=ec,Pa.fromBits=Qa;var ah=Math.pow;Pa.fromString=Vi,Pa.fromValue=vc;var Me=4294967296,Xm=Me*Me,Zm=Xm/2,xr=Xd(16777216),fc=Xd(0);Pa.ZERO=fc;var Yd=Xd(0,!0);Pa.UZERO=Yd;var xf=Xd(1);Pa.ONE=xf;var yr=Xd(1,!0);Pa.UONE=yr;var ul=Xd(-1);Pa.NEG_ONE=ul;var $m=Qa(-1,2147483647,!1);Pa.MAX_VALUE=$m;var Ym=Qa(-1,-1,!0);Pa.MAX_UNSIGNED_VALUE=Ym;var Ib=Qa(0,-2147483648,!1);Pa.MIN_VALUE=Ib;var V=Pa.prototype;V.toInt=function(){return this.unsigned?this.low>>>0:this.low},V.toNumber=function(){return this.unsigned?(this.high>>>0)*Me+(this.low>>>0):this.high*Me+(this.low>>>0)},V.toString=function(i){if(2>(i=i||10)||36<i)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Ib)){var r=ec(i),s=this.div(r);return r=s.mul(r).sub(this),s.toString(i)+r.toInt().toString(i)}return"-"+this.neg().toString(i)}s=ec(ah(i,6),this.unsigned),r=this;for(var u="";;){var l=r.div(s),f=(r.sub(l.mul(s)).toInt()>>>0).toString(i);if((r=l).isZero())return f+u;for(;6>f.length;)f="0"+f;u=""+f+u}},V.getHighBits=function(){return this.high},V.getHighBitsUnsigned=function(){return this.high>>>0},V.getLowBits=function(){return this.low},V.getLowBitsUnsigned=function(){return this.low>>>0},V.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ib)?64:this.neg().getNumBitsAbs();for(var i=this.high!=0?this.high:this.low,r=31;0<r&&!(i&1<<r);r--);return this.high!=0?r+33:r+1},V.isZero=function(){return this.high===0&&this.low===0},V.eqz=V.isZero,V.isNegative=function(){return!this.unsigned&&0>this.high},V.isPositive=function(){return this.unsigned||0<=this.high},V.isOdd=function(){return(1&this.low)==1},V.isEven=function(){return(1&this.low)==0},V.equals=function(i){return Hb(i)||(i=vc(i)),(this.unsigned===i.unsigned||this.high>>>31!=1||i.high>>>31!=1)&&this.high===i.high&&this.low===i.low},V.eq=V.equals,V.notEquals=function(i){return!this.eq(i)},V.neq=V.notEquals,V.ne=V.notEquals,V.lessThan=function(i){return 0>this.comp(i)},V.lt=V.lessThan,V.lessThanOrEqual=function(i){return 0>=this.comp(i)},V.lte=V.lessThanOrEqual,V.le=V.lessThanOrEqual,V.greaterThan=function(i){return 0<this.comp(i)},V.gt=V.greaterThan,V.greaterThanOrEqual=function(i){return 0<=this.comp(i)},V.gte=V.greaterThanOrEqual,V.ge=V.greaterThanOrEqual,V.compare=function(i){if(Hb(i)||(i=vc(i)),this.eq(i))return 0;var r=this.isNegative(),s=i.isNegative();return r&&!s?-1:!r&&s?1:this.unsigned?i.high>>>0>this.high>>>0||i.high===this.high&&i.low>>>0>this.low>>>0?-1:1:this.sub(i).isNegative()?-1:1},V.comp=V.compare,V.negate=function(){return!this.unsigned&&this.eq(Ib)?Ib:this.not().add(xf)},V.neg=V.negate,V.add=function(i){Hb(i)||(i=vc(i));var r=this.high>>>16,s=65535&this.high,u=this.low>>>16,l=i.high>>>16,f=65535&i.high,E=i.low>>>16;return u=(E=((i=(65535&this.low)+(65535&i.low))>>>16)+(u+E))>>>16,Qa((65535&E)<<16|65535&i,(r=((u+=s+f)>>>16)+(r+l)&65535)<<16|65535&u,this.unsigned)},V.subtract=function(i){return Hb(i)||(i=vc(i)),this.add(i.neg())},V.sub=V.subtract,V.multiply=function(i){if(this.isZero())return fc;if(Hb(i)||(i=vc(i)),mc){var r=mc.mul(this.low,this.high,i.low,i.high);return Qa(r,mc.get_high(),this.unsigned)}if(i.isZero())return fc;if(this.eq(Ib))return i.isOdd()?Ib:fc;if(i.eq(Ib))return this.isOdd()?Ib:fc;if(this.isNegative())return i.isNegative()?this.neg().mul(i.neg()):this.neg().mul(i).neg();if(i.isNegative())return this.mul(i.neg()).neg();if(this.lt(xr)&&i.lt(xr))return ec(this.toNumber()*i.toNumber(),this.unsigned);r=this.high>>>16;var s=65535&this.high,u=this.low>>>16,l=65535&this.low,f=i.high>>>16,E=65535&i.high,T=i.low>>>16,v=l*(i=65535&i.low),w=(v>>>16)+u*i,k=w>>>16;k+=(w=(65535&w)+l*T)>>>16;var B=(k+=s*i)>>>16;return Qa((65535&w)<<16|65535&v,(B=(B+=(k=(65535&k)+u*T)>>>16)+((k=(65535&k)+l*E)>>>16)+(r*i+s*T+u*E+l*f)&65535)<<16|65535&k,this.unsigned)},V.mul=V.multiply,V.divide=function(i){if(Hb(i)||(i=vc(i)),i.isZero())throw Error("division by zero");if(mc)return this.unsigned||this.high!==-2147483648||i.low!==-1||i.high!==-1?Qa(i=(this.unsigned?mc.div_u:mc.div_s)(this.low,this.high,i.low,i.high),mc.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Yd:fc;if(this.unsigned){if(i.unsigned||(i=i.toUnsigned()),i.gt(this))return Yd;if(i.gt(this.shru(1)))return yr;var r=Yd}else{if(this.eq(Ib)){if(i.eq(xf)||i.eq(ul))return Ib;if(i.eq(Ib))return xf;var s=this.shr(1).div(i).shl(1);if(s.eq(fc))return i.isNegative()?xf:ul;var u=this.sub(i.mul(s));return s.add(u.div(i))}if(i.eq(Ib))return this.unsigned?Yd:fc;if(this.isNegative())return i.isNegative()?this.neg().div(i.neg()):this.neg().div(i).neg();if(i.isNegative())return this.div(i.neg()).neg();r=fc}for(u=this;u.gte(i);){s=Math.max(1,Math.floor(u.toNumber()/i.toNumber()));var l=Math.ceil(Math.log(s)/Math.LN2);l=48>=l?1:ah(2,l-48);for(var f=ec(s),E=f.mul(i);E.isNegative()||E.gt(u);)E=(f=ec(s-=l,this.unsigned)).mul(i);f.isZero()&&(f=xf),r=r.add(f),u=u.sub(E)}return r},V.div=V.divide,V.modulo=function(i){return Hb(i)||(i=vc(i)),mc?Qa(i=(this.unsigned?mc.rem_u:mc.rem_s)(this.low,this.high,i.low,i.high),mc.get_high(),this.unsigned):this.sub(this.div(i).mul(i))},V.mod=V.modulo,V.rem=V.modulo,V.not=function(){return Qa(~this.low,~this.high,this.unsigned)},V.and=function(i){return Hb(i)||(i=vc(i)),Qa(this.low&i.low,this.high&i.high,this.unsigned)},V.or=function(i){return Hb(i)||(i=vc(i)),Qa(this.low|i.low,this.high|i.high,this.unsigned)},V.xor=function(i){return Hb(i)||(i=vc(i)),Qa(this.low^i.low,this.high^i.high,this.unsigned)},V.shiftLeft=function(i){return Hb(i)&&(i=i.toInt()),(i&=63)==0?this:32>i?Qa(this.low<<i,this.high<<i|this.low>>>32-i,this.unsigned):Qa(0,this.low<<i-32,this.unsigned)},V.shl=V.shiftLeft,V.shiftRight=function(i){return Hb(i)&&(i=i.toInt()),(i&=63)==0?this:32>i?Qa(this.low>>>i|this.high<<32-i,this.high>>i,this.unsigned):Qa(this.high>>i-32,0<=this.high?0:-1,this.unsigned)},V.shr=V.shiftRight,V.shiftRightUnsigned=function(i){if(Hb(i)&&(i=i.toInt()),(i&=63)===0)return this;var r=this.high;return 32>i?Qa(this.low>>>i|r<<32-i,r>>>i,this.unsigned):Qa(i===32?r:r>>>i-32,0,this.unsigned)},V.shru=V.shiftRightUnsigned,V.shr_u=V.shiftRightUnsigned,V.toSigned=function(){return this.unsigned?Qa(this.low,this.high,!1):this},V.toUnsigned=function(){return this.unsigned?this:Qa(this.low,this.high,!0)},V.toBytes=function(i){return i?this.toBytesLE():this.toBytesBE()},V.toBytesLE=function(){var i=this.high,r=this.low;return[255&r,r>>>8&255,r>>>16&255,r>>>24,255&i,i>>>8&255,i>>>16&255,i>>>24]},V.toBytesBE=function(){var i=this.high,r=this.low;return[i>>>24,i>>>16&255,i>>>8&255,255&i,r>>>24,r>>>16&255,r>>>8&255,255&r]},Pa.fromBytes=function(i,r,s){return s?Pa.fromBytesLE(i,r):Pa.fromBytesBE(i,r)},Pa.fromBytesLE=function(i,r){return new Pa(i[0]|i[1]<<8|i[2]<<16|i[3]<<24,i[4]|i[5]<<8|i[6]<<16|i[7]<<24,r)},Pa.fromBytesBE=function(i,r){return new Pa(i[4]<<24|i[5]<<16|i[6]<<8|i[7],i[0]<<24|i[1]<<16|i[2]<<8|i[3],r)};var Wi=function(i,r){return(Wi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,u){s.__proto__=u}||function(s,u){for(var l in u)u.hasOwnProperty(l)&&(s[l]=u[l])})(i,r)},vl=!1,gc={Promise:void 0,set useDeprecatedSynchronousErrorHandling(i){i?console.warn(`DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: 
`+Error().stack):vl&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),vl=i},get useDeprecatedSynchronousErrorHandling(){return vl}},ni={closed:!0,next:function(i){},error:function(i){if(gc.useDeprecatedSynchronousErrorHandling)throw i;Oe(i)},complete:function(){}},hc=Array.isArray||function(i){return i&&typeof i.length=="number"},Pf=function(){function i(r){return Error.call(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(s,u){return u+1+") "+s.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r,this}return i.prototype=Object.create(Error.prototype),i}(),nb=function(){function i(r){this.closed=!1,this._subscriptions=this._parentOrParents=null,r&&(this._ctorUnsubscribe=!0,this._unsubscribe=r)}return i.prototype.unsubscribe=function(){if(!this.closed){var r=this._parentOrParents,s=this._ctorUnsubscribe,u=this._unsubscribe,l=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,r instanceof i)r.remove(this);else if(r!==null)for(var f=0;f<r.length;++f)r[f].remove(this);if(Ne(u)){s&&(this._unsubscribe=void 0);try{u.call(this)}catch(T){var E=T instanceof Pf?an(T.errors):[T]}}if(hc(l)){for(f=-1,r=l.length;++f<r;)if(Xi(s=l[f]))try{s.unsubscribe()}catch(T){E=E||[],T instanceof Pf?E=E.concat(an(T.errors)):E.push(T)}}if(E)throw new Pf(E)}},i.prototype.add=function(r){var s=r;if(!r)return i.EMPTY;switch(qa(r)){case"function":s=new i(r);case"object":if(s===this||s.closed||typeof s.unsubscribe!="function")return s;if(this.closed)return s.unsubscribe(),s;s instanceof i||(r=s,(s=new i)._subscriptions=[r]);break;default:throw Error("unrecognized teardown "+r+" added to Subscription.")}if((r=s._parentOrParents)===null)s._parentOrParents=this;else if(r instanceof i){if(r===this)return s;s._parentOrParents=[r,this]}else{if(r.indexOf(this)!==-1)return s;r.push(this)}return(r=this._subscriptions)===null?this._subscriptions=[s]:r.push(s),s},i.prototype.remove=function(r){var s=this._subscriptions;s&&(r=s.indexOf(r))!==-1&&s.splice(r,1)},i.EMPTY=function(r){return r.closed=!0,r}(new i),i}(),oi=typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),za=function(i){function r(s,u,l){var f=i.call(this)||this;switch(f.syncErrorValue=null,f.syncErrorThrown=!1,f.syncErrorThrowable=!1,f.isStopped=!1,arguments.length){case 0:f.destination=ni;break;case 1:if(!s){f.destination=ni;break}if(qa(s)==="object"){s instanceof r?(f.syncErrorThrowable=s.syncErrorThrowable,f.destination=s,s.add(f)):(f.syncErrorThrowable=!0,f.destination=new zr(f,s));break}default:f.syncErrorThrowable=!0,f.destination=new zr(f,s,u,l)}return f}return ha(r,i),r.prototype[oi]=function(){return this},r.create=function(s,u,l){return(s=new r(s,u,l)).syncErrorThrowable=!1,s},r.prototype.next=function(s){this.isStopped||this._next(s)},r.prototype.error=function(s){this.isStopped||(this.isStopped=!0,this._error(s))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,i.prototype.unsubscribe.call(this))},r.prototype._next=function(s){this.destination.next(s)},r.prototype._error=function(s){this.destination.error(s),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var s=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=s,this},r}(nb),zr=function(i){function r(s,u,l,f){var E=i.call(this)||this;if(E._parentSubscriber=s,s=E,Ne(u))var T=u;else u&&(T=u.next,l=u.error,f=u.complete,u!==ni&&(Ne((s=Object.create(u)).unsubscribe)&&E.add(s.unsubscribe.bind(s)),s.unsubscribe=E.unsubscribe.bind(E)));return E._context=s,E._next=T,E._error=l,E._complete=f,E}return ha(r,i),r.prototype.next=function(s){if(!this.isStopped&&this._next){var u=this._parentSubscriber;gc.useDeprecatedSynchronousErrorHandling&&u.syncErrorThrowable?this.__tryOrSetError(u,this._next,s)&&this.unsubscribe():this.__tryOrUnsub(this._next,s)}},r.prototype.error=function(s){if(!this.isStopped){var u=this._parentSubscriber,l=gc.useDeprecatedSynchronousErrorHandling;if(this._error)l&&u.syncErrorThrowable?this.__tryOrSetError(u,this._error,s):this.__tryOrUnsub(this._error,s),this.unsubscribe();else if(u.syncErrorThrowable)l?(u.syncErrorValue=s,u.syncErrorThrown=!0):Oe(s),this.unsubscribe();else{if(this.unsubscribe(),l)throw s;Oe(s)}}},r.prototype.complete=function(){var s=this;if(!this.isStopped){var u=this._parentSubscriber;if(this._complete){var l=function(){return s._complete.call(s._context)};gc.useDeprecatedSynchronousErrorHandling&&u.syncErrorThrowable?this.__tryOrSetError(u,l):this.__tryOrUnsub(l)}this.unsubscribe()}},r.prototype.__tryOrUnsub=function(s,u){try{s.call(this._context,u)}catch(l){if(this.unsubscribe(),gc.useDeprecatedSynchronousErrorHandling)throw l;Oe(l)}},r.prototype.__tryOrSetError=function(s,u,l){if(!gc.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{u.call(this._context,l)}catch(f){return gc.useDeprecatedSynchronousErrorHandling?(s.syncErrorValue=f,s.syncErrorThrown=!0):Oe(f),!0}return!1},r.prototype._unsubscribe=function(){var s=this._parentSubscriber;this._parentSubscriber=this._context=null,s.unsubscribe()},r}(za),Pe=typeof Symbol=="function"&&Symbol.observable||"@@observable",ua=function(){function i(r){this._isScalar=!1,r&&(this._subscribe=r)}return i.prototype.lift=function(r){var s=new i;return s.source=this,s.operator=r,s},i.prototype.subscribe=function(r,s,u){var l=this.operator;t:{if(r){if(r instanceof za)break t;if(r[oi]){r=r[oi]();break t}}r=r||s||u?new za(r,s,u):new za(ni)}if(l?r.add(l.call(r,this.source)):r.add(this.source||gc.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),gc.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},i.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(s){gc.useDeprecatedSynchronousErrorHandling&&(r.syncErrorThrown=!0,r.syncErrorValue=s),Yi(r)?r.error(s):console.warn(s)}},i.prototype.forEach=function(r,s){var u=this;return new(s=cn(s))(function(l,f){var E=u.subscribe(function(T){try{r(T)}catch(v){f(v),E&&E.unsubscribe()}},f,l)})},i.prototype._subscribe=function(r){var s=this.source;return s&&s.subscribe(r)},i.prototype[Pe]=function(){return this},i.prototype.pipe=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];return r.length===0?this:bn(r)(this)},i.prototype.toPromise=function(r){var s=this;return new(r=cn(r))(function(u,l){var f;s.subscribe(function(E){return f=E},function(E){return l(E)},function(){return u(f)})})},i.create=function(r){return new i(r)},i}(),Ld=function(){function i(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return i.prototype=Object.create(Error.prototype),i}(),Ar=function(i){function r(s,u){var l=i.call(this)||this;return l.subject=s,l.subscriber=u,l.closed=!1,l}return ha(r,i),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var s=this.subject,u=s.observers;this.subject=null,!u||u.length===0||s.isStopped||s.closed||(s=u.indexOf(this.subscriber))!==-1&&u.splice(s,1)}},r}(nb),Br=function(i){function r(s){var u=i.call(this,s)||this;return u.destination=s,u}return ha(r,i),r}(za),rb=function(i){function r(){var s=i.call(this)||this;return s.observers=[],s.closed=!1,s.isStopped=!1,s.hasError=!1,s.thrownError=null,s}return ha(r,i),r.prototype[oi]=function(){return new Br(this)},r.prototype.lift=function(s){var u=new Cr(this,this);return u.operator=s,u},r.prototype.next=function(s){if(this.closed)throw new Ld;if(!this.isStopped){var u=this.observers,l=u.length;u=u.slice();for(var f=0;f<l;f++)u[f].next(s)}},r.prototype.error=function(s){if(this.closed)throw new Ld;this.hasError=!0,this.thrownError=s,this.isStopped=!0;var u=this.observers,l=u.length;u=u.slice();for(var f=0;f<l;f++)u[f].error(s);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new Ld;this.isStopped=!0;var s=this.observers,u=s.length;s=s.slice();for(var l=0;l<u;l++)s[l].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},r.prototype._trySubscribe=function(s){if(this.closed)throw new Ld;return i.prototype._trySubscribe.call(this,s)},r.prototype._subscribe=function(s){if(this.closed)throw new Ld;return this.hasError?(s.error(this.thrownError),nb.EMPTY):this.isStopped?(s.complete(),nb.EMPTY):(this.observers.push(s),new Ar(this,s))},r.prototype.asObservable=function(){var s=new ua;return s.source=this,s},r.create=function(s,u){return new Cr(s,u)},r}(ua),Cr=function(i){function r(s,u){var l=i.call(this)||this;return l.destination=s,l.source=u,l}return ha(r,i),r.prototype.next=function(s){var u=this.destination;u&&u.next&&u.next(s)},r.prototype.error=function(s){var u=this.destination;u&&u.error&&this.destination.error(s)},r.prototype.complete=function(){var s=this.destination;s&&s.complete&&this.destination.complete()},r.prototype._subscribe=function(s){return this.source?this.source.subscribe(s):nb.EMPTY},r}(rb),xu=function(){function i(r){this.connectable=r}return i.prototype.call=function(r,s){var u=this.connectable;return u._refCount++,r=new IA(r,u),s=s.subscribe(r),r.closed||(r.connection=u.connect()),s},i}(),IA=function(i){function r(s,u){return(s=i.call(this,s)||this).connectable=u,s}return ha(r,i),r.prototype._unsubscribe=function(){var s=this.connectable;if(s){this.connectable=null;var u=s._refCount;0>=u?this.connection=null:(s._refCount=u-1,1<u?this.connection=null:(u=this.connection,s=s._connection,this.connection=null,!s||u&&s!==u||s.unsubscribe()))}else this.connection=null},r}(za),Dr=function(i){function r(s,u){var l=i.call(this)||this;return l.source=s,l.subjectFactory=u,l._refCount=0,l._isComplete=!1,l}return ha(r,i),r.prototype._subscribe=function(s){return this.getSubject().subscribe(s)},r.prototype.getSubject=function(){var s=this._subject;return s&&!s.isStopped||(this._subject=this.subjectFactory()),this._subject},r.prototype.connect=function(){var s=this._connection;return s||(this._isComplete=!1,(s=this._connection=new nb).add(this.source.subscribe(new JA(this.getSubject(),this))),s.closed&&(this._connection=null,s=nb.EMPTY)),s},r.prototype.refCount=function(){return dn()(this)},r}(ua),lv=function(){var i=Dr.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:i._subscribe},_isComplete:{value:i._isComplete,writable:!0},getSubject:{value:i.getSubject},connect:{value:i.connect},refCount:{value:i.refCount}}}(),JA=function(i){function r(s,u){return(s=i.call(this,s)||this).connectable=u,s}return ha(r,i),r.prototype._error=function(s){this._unsubscribe(),i.prototype._error.call(this,s)},r.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),i.prototype._complete.call(this)},r.prototype._unsubscribe=function(){var s=this.connectable;if(s){this.connectable=null;var u=s._connection;s._refCount=0,s._subject=null,s._connection=null,u&&u.unsubscribe()}},r}(Br);(function(i){function r(s,u){return(s=i.call(this,s)||this).connectable=u,s}ha(r,i),r.prototype._unsubscribe=function(){var s=this.connectable;if(s){this.connectable=null;var u=s._refCount;0>=u?this.connection=null:(s._refCount=u-1,1<u?this.connection=null:(u=this.connection,s=s._connection,this.connection=null,!s||u&&s!==u||s.unsubscribe()))}else this.connection=null}})(za),function(i){function r(s,u,l,f,E){return(s=i.call(this,s)||this).keySelector=u,s.elementSelector=l,s.durationSelector=f,s.subjectSelector=E,s.groups=null,s.attemptedToUnsubscribe=!1,s.count=0,s}ha(r,i),r.prototype._next=function(s){try{var u=this.keySelector(s)}catch(l){return void this.error(l)}this._group(s,u)},r.prototype._group=function(s,u){var l=this.groups;l||(l=this.groups=new Map);var f=l.get(u);if(this.elementSelector)try{var E=this.elementSelector(s)}catch(T){this.error(T)}else E=s;if(!f&&(f=this.subjectSelector?this.subjectSelector():new rb,l.set(u,f),s=new wl(u,f,this),this.destination.next(s),this.durationSelector)){s=void 0;try{s=this.durationSelector(new wl(u,f))}catch(T){return void this.error(T)}this.add(s.subscribe(new KA(u,f,this)))}f.closed||f.next(E)},r.prototype._error=function(s){var u=this.groups;u&&(u.forEach(function(l,f){l.error(s)}),u.clear()),this.destination.error(s)},r.prototype._complete=function(){var s=this.groups;s&&(s.forEach(function(u,l){u.complete()}),s.clear()),this.destination.complete()},r.prototype.removeGroup=function(s){this.groups.delete(s)},r.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,this.count===0&&i.prototype.unsubscribe.call(this))}}(za);var KA=function(i){function r(s,u,l){var f=i.call(this,u)||this;return f.key=s,f.group=u,f.parent=l,f}return ha(r,i),r.prototype._next=function(s){this.complete()},r.prototype._unsubscribe=function(){var s=this.parent,u=this.key;this.key=this.parent=null,s&&s.removeGroup(u)},r}(za),wl=function(i){function r(s,u,l){var f=i.call(this)||this;return f.key=s,f.groupSubject=u,f.refCountSubscription=l,f}return ha(r,i),r.prototype._subscribe=function(s){var u=new nb,l=this.refCountSubscription,f=this.groupSubject;return l&&!l.closed&&u.add(new LA(l)),u.add(f.subscribe(s)),u},r}(ua),LA=function(i){function r(s){var u=i.call(this)||this;return u.parent=s,s.count++,u}return ha(r,i),r.prototype.unsubscribe=function(){var s=this.parent;s.closed||this.closed||(i.prototype.unsubscribe.call(this),--s.count,s.count===0&&s.attemptedToUnsubscribe&&s.unsubscribe())},r}(nb),MA=function(i){function r(s){var u=i.call(this)||this;return u._value=s,u}return ha(r,i),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(s){var u=i.prototype._subscribe.call(this,s);return u&&!u.closed&&s.next(this._value),u},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Ld;return this._value},r.prototype.next=function(s){i.prototype.next.call(this,this._value=s)},r}(rb),Kg=function(i){function r(s,u){var l=i.call(this,s,u)||this;return l.scheduler=s,l.work=u,l.pending=!1,l}return ha(r,i),r.prototype.schedule=function(s,u){if(u===void 0&&(u=0),this.closed)return this;this.state=s,s=this.id;var l=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(l,s,u)),this.pending=!0,this.delay=u,this.id=this.id||this.requestAsyncId(l,this.id,u),this},r.prototype.requestAsyncId=function(s,u,l){return l===void 0&&(l=0),setInterval(s.flush.bind(s,this),l)},r.prototype.recycleAsyncId=function(s,u,l){if(l===void 0&&(l=0),l!==null&&this.delay===l&&this.pending===!1)return u;clearInterval(u)},r.prototype.execute=function(s,u){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(s=this._execute(s,u))?s:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},r.prototype._execute=function(s,u){u=!1;var l=void 0;try{this.work(s)}catch(f){u=!0,l=!!f&&f||Error(f)}if(u)return this.unsubscribe(),l},r.prototype._unsubscribe=function(){var s=this.id,u=this.scheduler,l=u.actions,f=l.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,f!==-1&&l.splice(f,1),s!=null&&(this.id=this.recycleAsyncId(u,s,null)),this.delay=null},r}(function(i){function r(s,u){return i.call(this)||this}return ha(r,i),r.prototype.schedule=function(s,u){return this},r}(nb)),NA=function(i){function r(s,u){var l=i.call(this,s,u)||this;return l.scheduler=s,l.work=u,l}return ha(r,i),r.prototype.schedule=function(s,u){return u===void 0&&(u=0),0<u?i.prototype.schedule.call(this,s,u):(this.delay=u,this.state=s,this.scheduler.flush(this),this)},r.prototype.execute=function(s,u){return 0<u||this.closed?i.prototype.execute.call(this,s,u):this._execute(s,u)},r.prototype.requestAsyncId=function(s,u,l){return l===void 0&&(l=0),l!==null&&0<l||l===null&&0<this.delay?i.prototype.requestAsyncId.call(this,s,u,l):s.flush(this)},r}(Kg),xl=function(){function i(r,s){s===void 0&&(s=i.now),this.SchedulerAction=r,this.now=s}return i.prototype.schedule=function(r,s,u){return s===void 0&&(s=0),new this.SchedulerAction(this,r).schedule(u,s)},i.now=function(){return Date.now()},i}(),Lg=function(i){function r(s,u){u===void 0&&(u=xl.now);var l=i.call(this,s,function(){return r.delegate&&r.delegate!==l?r.delegate.now():u()})||this;return l.actions=[],l.active=!1,l.scheduled=void 0,l}return ha(r,i),r.prototype.schedule=function(s,u,l){return u===void 0&&(u=0),r.delegate&&r.delegate!==this?r.delegate.schedule(s,u,l):i.prototype.schedule.call(this,s,u,l)},r.prototype.flush=function(s){var u=this.actions;if(this.active)u.push(s);else{var l;this.active=!0;do if(l=s.execute(s.state,s.delay))break;while(s=u.shift());if(this.active=!1,l){for(;s=u.shift();)s.unsubscribe();throw l}}},r}(xl),Mg=new(function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return ha(r,i),r}(Lg))(NA),Sb=new ua(function(i){return i.complete()}),en=function(i){return function(r){for(var s=0,u=i.length;s<u&&!r.closed;s++)r.next(i[s]);r.complete()}},yl;(function(i){i.NEXT="N",i.ERROR="E",i.COMPLETE="C"})(yl||(yl={}));var yf=function(){function i(r,s,u){this.kind=r,this.value=s,this.error=u,this.hasValue=r==="N"}return i.prototype.observe=function(r){switch(this.kind){case"N":return r.next&&r.next(this.value);case"E":return r.error&&r.error(this.error);case"C":return r.complete&&r.complete()}},i.prototype.do=function(r,s,u){switch(this.kind){case"N":return r&&r(this.value);case"E":return s&&s(this.error);case"C":return u&&u()}},i.prototype.accept=function(r,s,u){return r&&typeof r.next=="function"?this.observe(r):this.do(r,s,u)},i.prototype.toObservable=function(){switch(this.kind){case"N":return ob(this.value);case"E":return ra(this.error);case"C":return Qf()}throw Error("unexpected notification kind value")},i.createNext=function(r){return r!==void 0?new i("N",r):i.undefinedValueNotification},i.createError=function(r){return new i("E",void 0,r)},i.createComplete=function(){return i.completeNotification},i.completeNotification=new i("C"),i.undefinedValueNotification=new i("N",void 0),i}(),Bu=function(){function i(r,s){s===void 0&&(s=0),this.scheduler=r,this.delay=s}return i.prototype.call=function(r,s){return s.subscribe(new Er(r,this.scheduler,this.delay))},i}(),Er=function(i){function r(s,u,l){return l===void 0&&(l=0),(s=i.call(this,s)||this).scheduler=u,s.delay=l,s}return ha(r,i),r.dispatch=function(s){s.notification.observe(s.destination),this.unsubscribe()},r.prototype.scheduleMessage=function(s){this.destination.add(this.scheduler.schedule(r.dispatch,this.delay,new OA(s,this.destination)))},r.prototype._next=function(s){this.scheduleMessage(yf.createNext(s))},r.prototype._error=function(s){this.scheduleMessage(yf.createError(s)),this.unsubscribe()},r.prototype._complete=function(){this.scheduleMessage(yf.createComplete()),this.unsubscribe()},r}(za),OA=function(i,r){this.notification=i,this.destination=r},Te=function(i){function r(s,u,l){s===void 0&&(s=Number.POSITIVE_INFINITY),u===void 0&&(u=Number.POSITIVE_INFINITY);var f=i.call(this)||this;return f.scheduler=l,f._events=[],f._infiniteTimeWindow=!1,f._bufferSize=1>s?1:s,f._windowTime=1>u?1:u,u===Number.POSITIVE_INFINITY?(f._infiniteTimeWindow=!0,f.next=f.nextInfiniteTimeWindow):f.next=f.nextTimeWindow,f}return ha(r,i),r.prototype.nextInfiniteTimeWindow=function(s){if(!this.isStopped){var u=this._events;u.push(s),u.length>this._bufferSize&&u.shift()}i.prototype.next.call(this,s)},r.prototype.nextTimeWindow=function(s){this.isStopped||(this._events.push(new PA(this._getNow(),s)),this._trimBufferThenGetEvents()),i.prototype.next.call(this,s)},r.prototype._subscribe=function(s){var u=this._infiniteTimeWindow,l=u?this._events:this._trimBufferThenGetEvents(),f=this.scheduler,E=l.length;if(this.closed)throw new Ld;if(this.isStopped||this.hasError)var T=nb.EMPTY;else this.observers.push(s),T=new Ar(this,s);if(f&&s.add(s=new Er(s,f)),u)for(u=0;u<E&&!s.closed;u++)s.next(l[u]);else for(u=0;u<E&&!s.closed;u++)s.next(l[u].value);return this.hasError?s.error(this.thrownError):this.isStopped&&s.complete(),T},r.prototype._getNow=function(){return(this.scheduler||Mg).now()},r.prototype._trimBufferThenGetEvents=function(){for(var s=this._getNow(),u=this._bufferSize,l=this._windowTime,f=this._events,E=f.length,T=0;T<E&&!(s-f[T].time<l);)T++;return E>u&&(T=Math.max(T,E-u)),0<T&&f.splice(0,T),f},r}(rb),PA=function(i,r){this.time=i,this.value=r},Sf=function(i){function r(){var s=i!==null&&i.apply(this,arguments)||this;return s.value=null,s.hasNext=!1,s.hasCompleted=!1,s}return ha(r,i),r.prototype._subscribe=function(s){return this.hasError?(s.error(this.thrownError),nb.EMPTY):this.hasCompleted&&this.hasNext?(s.next(this.value),s.complete(),nb.EMPTY):i.prototype._subscribe.call(this,s)},r.prototype.next=function(s){this.hasCompleted||(this.value=s,this.hasNext=!0)},r.prototype.error=function(s){this.hasCompleted||i.prototype.error.call(this,s)},r.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&i.prototype.next.call(this,this.value),i.prototype.complete.call(this)},r}(rb),QA=1,RA=Promise.resolve(),aj={},Fr={setImmediate:function(i){var r=QA++;return aj[r]=!0,RA.then(function(){return fn(r)&&i()}),r},clearImmediate:function(i){fn(i)}},SA=function(i){function r(s,u){var l=i.call(this,s,u)||this;return l.scheduler=s,l.work=u,l}return ha(r,i),r.prototype.requestAsyncId=function(s,u,l){return l===void 0&&(l=0),l!==null&&0<l?i.prototype.requestAsyncId.call(this,s,u,l):(s.actions.push(this),s.scheduled||(s.scheduled=Fr.setImmediate(s.flush.bind(s,null))))},r.prototype.recycleAsyncId=function(s,u,l){if(l===void 0&&(l=0),l!==null&&0<l||l===null&&0<this.delay)return i.prototype.recycleAsyncId.call(this,s,u,l);s.actions.length===0&&(Fr.clearImmediate(u),s.scheduled=void 0)},r}(Kg),kj=new(function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return ha(r,i),r.prototype.flush=function(s){this.active=!0,this.scheduled=void 0;var u,l=this.actions,f=-1,E=l.length;s=s||l.shift();do if(u=s.execute(s.state,s.delay))break;while(++f<E&&(s=l.shift()));if(this.active=!1,u){for(;++f<E&&(s=l.shift());)s.unsubscribe();throw u}},r}(Lg))(SA),TA=kj,zl=new Lg(Kg),cd=zl,UA=function(i){function r(s,u){var l=i.call(this,s,u)||this;return l.scheduler=s,l.work=u,l}return ha(r,i),r.prototype.requestAsyncId=function(s,u,l){return l===void 0&&(l=0),l!==null&&0<l?i.prototype.requestAsyncId.call(this,s,u,l):(s.actions.push(this),s.scheduled||(s.scheduled=requestAnimationFrame(function(){return s.flush(null)})))},r.prototype.recycleAsyncId=function(s,u,l){if(l===void 0&&(l=0),l!==null&&0<l||l===null&&0<this.delay)return i.prototype.recycleAsyncId.call(this,s,u,l);s.actions.length===0&&(cancelAnimationFrame(u),s.scheduled=void 0)},r}(Kg),Gr=new(function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return ha(r,i),r.prototype.flush=function(s){this.active=!0,this.scheduled=void 0;var u,l=this.actions,f=-1,E=l.length;s=s||l.shift();do if(u=s.execute(s.state,s.delay))break;while(++f<E&&(s=l.shift()));if(this.active=!1,u){for(;++f<E&&(s=l.shift());)s.unsubscribe();throw u}},r}(Lg))(UA),VA=function(i){function r(s,u){s===void 0&&(s=Hr),u===void 0&&(u=Number.POSITIVE_INFINITY);var l=i.call(this,s,function(){return l.frame})||this;return l.maxFrames=u,l.frame=0,l.index=-1,l}return ha(r,i),r.prototype.flush=function(){for(var s,u,l=this.actions,f=this.maxFrames;(u=l[0])&&u.delay<=f&&(l.shift(),this.frame=u.delay,!(s=u.execute(u.state,u.delay))););if(s){for(;u=l.shift();)u.unsubscribe();throw s}},r.frameTimeFactor=10,r}(Lg),Hr=function(i){function r(s,u,l){l===void 0&&(l=s.index+=1);var f=i.call(this,s,u)||this;return f.scheduler=s,f.work=u,f.index=l,f.active=!0,f.index=s.index=l,f}return ha(r,i),r.prototype.schedule=function(s,u){if(u===void 0&&(u=0),!this.id)return i.prototype.schedule.call(this,s,u);this.active=!1;var l=new r(this.scheduler,this.work);return this.add(l),l.schedule(s,u)},r.prototype.requestAsyncId=function(s,u,l){return l===void 0&&(l=0),this.delay=s.frame+l,(s=s.actions).push(this),s.sort(r.sortActions),!0},r.prototype.recycleAsyncId=function(s,u,l){},r.prototype._execute=function(s,u){if(this.active===!0)return i.prototype._execute.call(this,s,u)},r.sortActions=function(s,u){return s.delay===u.delay?s.index===u.index?0:s.index>u.index?1:-1:s.delay>u.delay?1:-1},r}(Kg),Al=function(){function i(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return i.prototype=Object.create(Error.prototype),i}(),eh=function(){function i(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return i.prototype=Object.create(Error.prototype),i}(),Tb=function(){function i(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return i.prototype=Object.create(Error.prototype),i}(),Cu=function(){function i(r,s){this.project=r,this.thisArg=s}return i.prototype.call=function(r,s){return s.subscribe(new WA(r,this.project,this.thisArg))},i}(),WA=function(i){function r(s,u,l){return(s=i.call(this,s)||this).project=u,s.count=0,s.thisArg=l||s,s}return ha(r,i),r.prototype._next=function(s){try{var u=this.project.call(this.thisArg,s,this.count++)}catch(l){return void this.destination.error(l)}this.destination.next(u)},r}(za),Bl=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return ha(r,i),r.prototype.notifyNext=function(s,u,l,f,E){this.destination.next(u)},r.prototype.notifyError=function(s,u){this.destination.error(s)},r.prototype.notifyComplete=function(s){this.destination.complete()},r}(za),Hu=function(i){function r(s,u,l){var f=i.call(this)||this;return f.parent=s,f.outerValue=u,f.outerIndex=l,f.index=0,f}return ha(r,i),r.prototype._next=function(s){this.parent.notifyNext(this.outerValue,s,this.outerIndex,this.index++,this)},r.prototype._error=function(s){this.parent.notifyError(s,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(za),XA=function(i){return function(r){return i.then(function(s){r.closed||(r.next(s),r.complete())},function(s){return r.error(s)}).then(null,Oe),r}},xd=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator",YA=function(i){return function(r){for(var s=i[xd]();;){var u=void 0;try{u=s.next()}catch(l){return r.error(l),r}if(u.done){r.complete();break}if(r.next(u.value),r.closed)break}return typeof s.return=="function"&&r.add(function(){s.return&&s.return()}),r}},ZA=function(i){return function(r){var s=i[Pe]();if(typeof s.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return s.subscribe(r)}},mn=function(i){return i&&typeof i.length=="number"&&typeof i!="function"},Tf=function(i){if(i&&typeof i[Pe]=="function")return ZA(i);if(mn(i))return en(i);if(kn(i))return XA(i);if(i&&typeof i[xd]=="function")return YA(i);throw i=Xi(i)?"an invalid object":"'"+i+"'",new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Ir={},aB=function(){function i(r){this.resultSelector=r}return i.prototype.call=function(r,s){return s.subscribe(new $A(r,this.resultSelector))},i}(),$A=function(i){function r(s,u){return(s=i.call(this,s)||this).resultSelector=u,s.active=0,s.values=[],s.observables=[],s}return ha(r,i),r.prototype._next=function(s){this.values.push(Ir),this.observables.push(s)},r.prototype._complete=function(){var s=this.observables,u=s.length;if(u===0)this.destination.complete();else{this.toRespond=this.active=u;for(var l=0;l<u;l++)this.add(bj(this,s[l],void 0,l))}},r.prototype.notifyComplete=function(s){--this.active==0&&this.destination.complete()},r.prototype.notifyNext=function(s,u,l){var f=(s=this.values)[l];f=this.toRespond?f===Ir?--this.toRespond:this.toRespond:0,s[l]=u,f===0&&(this.resultSelector?this._tryResultSelector(s):this.destination.next(s.slice()))},r.prototype._tryResultSelector=function(s){try{var u=this.resultSelector.apply(this,s)}catch(l){return void this.destination.error(l)}this.destination.next(u)},r}(Bl),nd=function(i){function r(s){var u=i.call(this)||this;return u.parent=s,u}return ha(r,i),r.prototype._next=function(s){this.parent.notifyNext(s)},r.prototype._error=function(s){this.parent.notifyError(s),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},r}(za);(function(i){function r(s,u,l){var f=i.call(this)||this;return f.parent=s,f.outerValue=u,f.outerIndex=l,f}ha(r,i),r.prototype._next=function(s){this.parent.notifyNext(this.outerValue,s,this.outerIndex,this)},r.prototype._error=function(s){this.parent.notifyError(s),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}})(za);var od=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return ha(r,i),r.prototype.notifyNext=function(s){this.destination.next(s)},r.prototype.notifyError=function(s){this.destination.error(s)},r.prototype.notifyComplete=function(){this.destination.complete()},r}(za);(function(i){function r(){return i!==null&&i.apply(this,arguments)||this}ha(r,i),r.prototype.notifyNext=function(s,u,l,f){this.destination.next(u)},r.prototype.notifyError=function(s){this.destination.error(s)},r.prototype.notifyComplete=function(s){this.destination.complete()}})(za);var Lu=function(){function i(r,s){s===void 0&&(s=Number.POSITIVE_INFINITY),this.project=r,this.concurrent=s}return i.prototype.call=function(r,s){return s.subscribe(new bB(r,this.project,this.concurrent))},i}(),bB=function(i){function r(s,u,l){return l===void 0&&(l=Number.POSITIVE_INFINITY),(s=i.call(this,s)||this).project=u,s.concurrent=l,s.hasCompleted=!1,s.buffer=[],s.active=0,s.index=0,s}return ha(r,i),r.prototype._next=function(s){this.active<this.concurrent?this._tryNext(s):this.buffer.push(s)},r.prototype._tryNext=function(s){var u=this.index++;try{var l=this.project(s,u)}catch(f){return void this.destination.error(f)}this.active++,this._innerSub(l)},r.prototype._innerSub=function(s){var u=new nd(this),l=this.destination;l.add(u),(s=bd(s,u))!==u&&l.add(s)},r.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},r.prototype.notifyNext=function(s){this.destination.next(s)},r.prototype.notifyComplete=function(){var s=this.buffer;this.active--,0<s.length?this._next(s.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},r}(od),Cl=R.parseFloat,Jr=1/Cl(`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF-0`)!=-1/0?function(i){i=Oj(String(i));var r=Cl(i);return r===0&&i.charAt(0)=="-"?-0:r}:Cl;ea({global:!0,forced:parseFloat!=Jr},{parseFloat:Jr});var Dl=new ua(Ic),Qu=function(){function i(r,s){this.predicate=r,this.thisArg=s}return i.prototype.call=function(r,s){return s.subscribe(new cB(r,this.predicate,this.thisArg))},i}(),cB=function(i){function r(s,u,l){return(s=i.call(this,s)||this).predicate=u,s.thisArg=l,s.count=0,s}return ha(r,i),r.prototype._next=function(s){try{var u=this.predicate.call(this.thisArg,s,this.count++)}catch(l){return void this.destination.error(l)}u&&this.destination.next(s)},r}(za),Ru=function(){function i(){}return i.prototype.call=function(r,s){return s.subscribe(new dB(r))},i}(),dB=function(i){function r(s){return(s=i.call(this,s)||this).hasFirst=!1,s.observables=[],s.subscriptions=[],s}return ha(r,i),r.prototype._next=function(s){this.observables.push(s)},r.prototype._complete=function(){var s=this.observables,u=s.length;if(u===0)this.destination.complete();else{for(var l=0;l<u&&!this.hasFirst;l++){var f=bj(this,s[l],void 0,l);this.subscriptions&&this.subscriptions.push(f),this.add(f)}this.observables=null}},r.prototype.notifyNext=function(s,u,l){if(!this.hasFirst){for(this.hasFirst=!0,s=0;s<this.subscriptions.length;s++)if(s!==l){var f=this.subscriptions[s];f.unsubscribe(),this.remove(f)}this.subscriptions=null}this.destination.next(u)},r}(Bl),Uu=function(){function i(r){this.resultSelector=r}return i.prototype.call=function(r,s){return s.subscribe(new eB(r,this.resultSelector))},i}(),eB=function(i){function r(s,u,l){return(s=i.call(this,s)||this).resultSelector=u,s.iterators=[],s.active=0,s.resultSelector=typeof u=="function"?u:void 0,s}return ha(r,i),r.prototype._next=function(s){var u=this.iterators;hc(s)?u.push(new fB(s)):typeof s[xd]=="function"?u.push(new gB(s[xd]())):u.push(new hB(this.destination,this,s))},r.prototype._complete=function(){var s=this.iterators,u=s.length;if(this.unsubscribe(),u===0)this.destination.complete();else{this.active=u;for(var l=0;l<u;l++){var f=s[l];f.stillUnsubscribed?this.destination.add(f.subscribe()):this.active--}}},r.prototype.notifyInactive=function(){this.active--,this.active===0&&this.destination.complete()},r.prototype.checkIterators=function(){for(var s=this.iterators,u=s.length,l=this.destination,f=0;f<u;f++){var E=s[f];if(typeof E.hasValue=="function"&&!E.hasValue())return}var T=!1,v=[];for(f=0;f<u;f++){var w=(E=s[f]).next();if(E.hasCompleted()&&(T=!0),w.done)return void l.complete();v.push(w.value)}this.resultSelector?this._tryresultSelector(v):l.next(v),T&&l.complete()},r.prototype._tryresultSelector=function(s){try{var u=this.resultSelector.apply(this,s)}catch(l){return void this.destination.error(l)}this.destination.next(u)},r}(za),gB=function(){function i(r){this.iterator=r,this.nextResult=r.next()}return i.prototype.hasValue=function(){return!0},i.prototype.next=function(){var r=this.nextResult;return this.nextResult=this.iterator.next(),r},i.prototype.hasCompleted=function(){var r=this.nextResult;return!(!r||!r.done)},i}(),fB=function(){function i(r){this.array=r,this.length=this.index=0,this.length=r.length}return i.prototype[xd]=function(){return this},i.prototype.next=function(r){r=this.index++;var s=this.array;return r<this.length?{value:s[r],done:!1}:{value:null,done:!0}},i.prototype.hasValue=function(){return this.array.length>this.index},i.prototype.hasCompleted=function(){return this.array.length===this.index},i}(),hB=function(i){function r(s,u,l){return(s=i.call(this,s)||this).parent=u,s.observable=l,s.stillUnsubscribed=!0,s.buffer=[],s.isComplete=!1,s}return ha(r,i),r.prototype[xd]=function(){return this},r.prototype.next=function(){var s=this.buffer;return s.length===0&&this.isComplete?{value:null,done:!0}:{value:s.shift(),done:!1}},r.prototype.hasValue=function(){return 0<this.buffer.length},r.prototype.hasCompleted=function(){return this.buffer.length===0&&this.isComplete},r.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},r.prototype.notifyNext=function(s){this.buffer.push(s),this.parent.checkIterators()},r.prototype.subscribe=function(){return bd(this.observable,new nd(this))},r}(od),iB=Object.freeze({__proto__:null,Observable:ua,ConnectableObservable:Dr,GroupedObservable:wl,observable:Pe,Subject:rb,BehaviorSubject:MA,ReplaySubject:Te,AsyncSubject:Sf,asap:TA,asapScheduler:kj,async:cd,asyncScheduler:zl,queue:Mg,queueScheduler:Mg,animationFrame:Gr,animationFrameScheduler:Gr,VirtualTimeScheduler:VA,VirtualAction:Hr,Scheduler:xl,Subscription:nb,Subscriber:za,Notification:yf,get NotificationKind(){return yl},pipe:Zi,noop:Ic,identity:wd,isObservable:function(i){return!!i&&(i instanceof ua||typeof i.lift=="function"&&typeof i.subscribe=="function")},ArgumentOutOfRangeError:Al,EmptyError:eh,ObjectUnsubscribedError:Ld,UnsubscriptionError:Pf,TimeoutError:Tb,bindCallback:gn,bindNodeCallback:hn,combineLatest:function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];var s=r=void 0;return ad(i[i.length-1])&&(s=i.pop()),typeof i[i.length-1]=="function"&&(r=i.pop()),i.length===1&&hc(i[0])&&(i=i[0]),Rf(i,s).lift(new aB(r))},concat:nn,defer:yd,empty:Qf,forkJoin:function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];if(i.length===1){var s=i[0];if(hc(s))return ch(s,null);if(Xi(s)&&Object.getPrototypeOf(s)===Object.prototype)return ch((i=Object.keys(s)).map(function(l){return s[l]}),i)}if(typeof i[i.length-1]=="function"){var u=i.pop();return ch(i=i.length===1&&hc(i[0])?i[0]:i,null).pipe(Ea(function(l){return u.apply(void 0,l)}))}return ch(i,null)},from:Jc,fromEvent:Db,fromEventPattern:pn,generate:function(i,r,s,u,l){if(arguments.length==1){var f=i.initialState;r=i.condition,s=i.iterate;var E=i.resultSelector||wd;l=i.scheduler}else u===void 0||ad(u)?(f=i,E=wd,l=u):(f=i,E=u);return new ua(function(T){var v=f;if(l)return l.schedule(Mu,0,{subscriber:T,iterate:s,condition:r,resultSelector:E,state:v});for(;;){if(r){var w=void 0;try{w=r(v)}catch(k){T.error(k);break}if(!w){T.complete();break}}w=void 0;try{w=E(v)}catch(k){T.error(k);break}if(T.next(w),T.closed)break;try{v=s(v)}catch(k){T.error(k);break}}})},iif:function(i,r,s){return r===void 0&&(r=Sb),s===void 0&&(s=Sb),yd(function(){return i()?r:s})},interval:Qe,merge:Jb,never:function(){return Dl},of:ob,onErrorResumeNext:dj,pairs:function(i,r){return new ua(r?function(s){var u=Object.keys(i),l=new nb;return l.add(r.schedule(Ou,0,{keys:u,index:0,subscriber:s,subscription:l,obj:i})),l}:function(s){for(var u=Object.keys(i),l=0;l<u.length&&!s.closed;l++){var f=u[l];i.hasOwnProperty(f)&&s.next([f,i[f]])}s.complete()})},partition:function(i,r,s){return[yb(r,s)(new ua(Tf(i))),yb(Pu(r,s))(new ua(Tf(i)))]},race:fb,range:function(i,r,s){return i===void 0&&(i=0),new ua(function(u){r===void 0&&(r=i,i=0);var l=0,f=i;if(s)return s.schedule(Su,0,{index:l,count:r,start:i,subscriber:u});for(;;){if(l++>=r){u.complete();break}if(u.next(f++),u.closed)break}})},throwError:ra,timer:dd,using:function(i,r){return new ua(function(s){try{var u=i()}catch(E){return void s.error(E)}try{var l=r(u)}catch(E){return void s.error(E)}var f=(l?Jc(l):Sb).subscribe(s);return function(){f.unsubscribe(),u&&u.unsubscribe()}})},zip:ej,scheduled:ln,EMPTY:Sb,NEVER:Dl,config:gc}),Vu=function(){function i(r,s,u,l){this.bufferTimeSpan=r,this.bufferCreationInterval=s,this.maxBufferSize=u,this.scheduler=l}return i.prototype.call=function(r,s){return s.subscribe(new jB(r,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},i}(),kB=function(){this.buffer=[]},jB=function(i){function r(s,u,l,f,E){if((s=i.call(this,s)||this).bufferTimeSpan=u,s.bufferCreationInterval=l,s.maxBufferSize=f,s.scheduler=E,s.contexts=[],f=s.openContext(),s.timespanOnly=l==null||0>l,s.timespanOnly)s.add(f.closeAction=E.schedule(qn,u,{subscriber:s,context:f,bufferTimeSpan:u}));else{var T={bufferTimeSpan:u,bufferCreationInterval:l,subscriber:s,scheduler:E};s.add(f.closeAction=E.schedule(rn,u,{subscriber:s,context:f})),s.add(E.schedule(Wu,l,T))}return s}return ha(r,i),r.prototype._next=function(s){for(var u,l=this.contexts,f=l.length,E=0;E<f;E++){var T=l[E],v=T.buffer;v.push(s),v.length==this.maxBufferSize&&(u=T)}u&&this.onBufferFull(u)},r.prototype._error=function(s){this.contexts.length=0,i.prototype._error.call(this,s)},r.prototype._complete=function(){for(var s=this.contexts,u=this.destination;0<s.length;){var l=s.shift();u.next(l.buffer)}i.prototype._complete.call(this)},r.prototype._unsubscribe=function(){this.contexts=null},r.prototype.onBufferFull=function(s){if(this.closeContext(s),(s=s.closeAction).unsubscribe(),this.remove(s),!this.closed&&this.timespanOnly){s=this.openContext();var u=this.bufferTimeSpan;this.add(s.closeAction=this.scheduler.schedule(qn,u,{subscriber:this,context:s,bufferTimeSpan:u}))}},r.prototype.openContext=function(){var s=new kB;return this.contexts.push(s),s},r.prototype.closeContext=function(s){this.destination.next(s.buffer);var u=this.contexts;0<=(u?u.indexOf(s):-1)&&u.splice(u.indexOf(s),1)},r}(za),Xu=function(){function i(r){this.selector=r}return i.prototype.call=function(r,s){return s.subscribe(new lB(r,this.selector,this.caught))},i}(),lB=function(i){function r(s,u,l){return(s=i.call(this,s)||this).selector=u,s.caught=l,s}return ha(r,i),r.prototype.error=function(s){if(!this.isStopped){var u=void 0;try{u=this.selector(s,this.caught)}catch(l){return void i.prototype.error.call(this,l)}this._unsubscribeAndRecycle(),s=new nd(this),this.add(s),(u=bd(u,s))!==s&&this.add(u)}},r}(od),Yu=function(){function i(r){this.defaultValue=r}return i.prototype.call=function(r,s){return s.subscribe(new mB(r,this.defaultValue))},i}(),mB=function(i){function r(s,u){return(s=i.call(this,s)||this).defaultValue=u,s.isEmpty=!0,s}return ha(r,i),r.prototype._next=function(s){this.isEmpty=!1,this.destination.next(s)},r.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},r}(za),Zu=function(){function i(r,s){this.delay=r,this.scheduler=s}return i.prototype.call=function(r,s){return s.subscribe(new nB(r,this.delay,this.scheduler))},i}(),nB=function(i){function r(s,u,l){return(s=i.call(this,s)||this).delay=u,s.scheduler=l,s.queue=[],s.active=!1,s.errored=!1,s}return ha(r,i),r.dispatch=function(s){for(var u=s.source,l=u.queue,f=s.scheduler,E=s.destination;0<l.length&&0>=l[0].time-f.now();)l.shift().notification.observe(E);0<l.length?(u=Math.max(0,l[0].time-f.now()),this.schedule(s,u)):(this.unsubscribe(),u.active=!1)},r.prototype._schedule=function(s){this.active=!0,this.destination.add(s.schedule(r.dispatch,this.delay,{source:this,destination:this.destination,scheduler:s}))},r.prototype.scheduleNotification=function(s){if(this.errored!==!0){var u=this.scheduler;s=new oB(u.now()+this.delay,s),this.queue.push(s),this.active===!1&&this._schedule(u)}},r.prototype._next=function(s){this.scheduleNotification(yf.createNext(s))},r.prototype._error=function(s){this.errored=!0,this.queue=[],this.destination.error(s),this.unsubscribe()},r.prototype._complete=function(){this.scheduleNotification(yf.createComplete()),this.unsubscribe()},r}(za),oB=function(i,r){this.time=i,this.notification=r},$u=function(){function i(r,s){this.keySelector=r,this.flushes=s}return i.prototype.call=function(r,s){return s.subscribe(new pB(r,this.keySelector,this.flushes))},i}(),pB=function(i){function r(s,u,l){return(s=i.call(this,s)||this).keySelector=u,s.values=new Set,l&&s.add(bd(l,new nd(s))),s}return ha(r,i),r.prototype.notifyNext=function(){this.values.clear()},r.prototype.notifyError=function(s){this._error(s)},r.prototype._next=function(s){this.keySelector?this._useKeySelector(s):this._finalizeNext(s,s)},r.prototype._useKeySelector=function(s){var u=this.destination;try{var l=this.keySelector(s)}catch(f){return void u.error(f)}this._finalizeNext(l,s)},r.prototype._finalizeNext=function(s,u){var l=this.values;l.has(s)||(l.add(s),this.destination.next(u))},r}(od),bv=function(){function i(r){this.errorFactory=r}return i.prototype.call=function(r,s){return s.subscribe(new qB(r,this.errorFactory))},i}(),qB=function(i){function r(s,u){return(s=i.call(this,s)||this).errorFactory=u,s.hasValue=!1,s}return ha(r,i),r.prototype._next=function(s){this.hasValue=!0,this.destination.next(s)},r.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var s=void 0;try{s=this.errorFactory()}catch(u){s=u}this.destination.error(s)},r}(za),cv=function(){function i(r){if(this.total=r,0>this.total)throw new Al}return i.prototype.call=function(r,s){return s.subscribe(new rB(r,this.total))},i}(),rB=function(i){function r(s,u){return(s=i.call(this,s)||this).total=u,s.count=0,s}return ha(r,i),r.prototype._next=function(s){var u=this.total,l=++this.count;l<=u&&(this.destination.next(s),l===u&&(this.destination.complete(),this.unsubscribe()))},r}(za),dv=function(){function i(r){this.callback=r}return i.prototype.call=function(r,s){return s.subscribe(new sB(r,this.callback))},i}(),sB=function(i){function r(s,u){return(s=i.call(this,s)||this).add(new nb(u)),s}return ha(r,i),r}(za),fv=function(){function i(){}return i.prototype.call=function(r,s){return s.subscribe(new tB(r))},i}(),tB=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return ha(r,i),r.prototype._next=function(s){},r}(za),gv=function(){function i(r){if(this.total=r,0>this.total)throw new Al}return i.prototype.call=function(r,s){return s.subscribe(new uB(r,this.total))},i}(),uB=function(i){function r(s,u){return(s=i.call(this,s)||this).total=u,s.ring=[],s.count=0,s}return ha(r,i),r.prototype._next=function(s){var u=this.ring,l=this.total,f=this.count++;u.length<l?u.push(s):u[f%l]=s},r.prototype._complete=function(){var s=this.destination,u=this.count;if(0<u)for(var l=this.count>=this.total?this.total:this.count,f=this.ring,E=0;E<l;E++){var T=u++%l;s.next(f[T])}s.complete()},r}(za),hv=function(){function i(r){this.value=r}return i.prototype.call=function(r,s){return s.subscribe(new vB(r,this.value))},i}(),vB=function(i){function r(s,u){return(s=i.call(this,s)||this).value=u,s}return ha(r,i),r.prototype._next=function(s){this.destination.next(this.value)},r}(za),iv=function(){function i(r,s,u){u===void 0&&(u=!1),this.accumulator=r,this.seed=s,this.hasSeed=u}return i.prototype.call=function(r,s){return s.subscribe(new wB(r,this.accumulator,this.seed,this.hasSeed))},i}(),wB=function(i){function r(s,u,l,f){return(s=i.call(this,s)||this).accumulator=u,s._seed=l,s.hasSeed=f,s.index=0,s}return ha(r,i),Object.defineProperty(r.prototype,"seed",{get:function(){return this._seed},set:function(s){this.hasSeed=!0,this._seed=s},enumerable:!0,configurable:!0}),r.prototype._next=function(s){if(this.hasSeed)return this._tryNext(s);this.seed=s,this.destination.next(s)},r.prototype._tryNext=function(s){var u=this.index++;try{var l=this.accumulator(this.seed,s,u)}catch(f){this.destination.error(f)}this.seed=l,this.destination.next(l)},r}(za),mv=function(){function i(r,s){this.notifier=r,this.source=s}return i.prototype.call=function(r,s){return s.subscribe(new xB(r,this.notifier,this.source))},i}(),xB=function(i){function r(s,u,l){return(s=i.call(this,s)||this).notifier=u,s.source=l,s}return ha(r,i),r.prototype.error=function(s){if(!this.isStopped){var u=this.errors,l=this.retries,f=this.retriesSubscription;if(l)this.retriesSubscription=this.errors=void 0;else{u=new rb;try{l=(0,this.notifier)(u)}catch(E){return i.prototype.error.call(this,E)}f=bd(l,new nd(this))}this._unsubscribeAndRecycle(),this.errors=u,this.retries=l,this.retriesSubscription=f,u.next(s)}},r.prototype._unsubscribe=function(){var s=this.errors,u=this.retriesSubscription;s&&(s.unsubscribe(),this.errors=void 0),u&&(u.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},r.prototype.notifyNext=function(){var s=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=s,this.source.subscribe(this)},r}(od),pv=function(){function i(r){this.project=r}return i.prototype.call=function(r,s){return s.subscribe(new yB(r,this.project))},i}(),yB=function(i){function r(s,u){return(s=i.call(this,s)||this).project=u,s.index=0,s}return ha(r,i),r.prototype._next=function(s){var u=this.index++;try{var l=this.project(s,u)}catch(f){return void this.destination.error(f)}this._innerSub(l)},r.prototype._innerSub=function(s){var u=this.innerSubscription;u&&u.unsubscribe(),u=new nd(this);var l=this.destination;l.add(u),this.innerSubscription=bd(s,u),this.innerSubscription!==u&&l.add(this.innerSubscription)},r.prototype._complete=function(){var s=this.innerSubscription;s&&!s.closed||i.prototype._complete.call(this),this.unsubscribe()},r.prototype._unsubscribe=function(){this.innerSubscription=void 0},r.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&i.prototype._complete.call(this)},r.prototype.notifyNext=function(s){this.destination.next(s)},r}(od),qv=function(){function i(r){this.notifier=r}return i.prototype.call=function(r,s){r=new zB(r);var u=bd(this.notifier,new nd(r));return u&&!r.seenValue?(r.add(u),s.subscribe(r)):r},i}(),zB=function(i){function r(s){return(s=i.call(this,s)||this).seenValue=!1,s}return ha(r,i),r.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},r.prototype.notifyComplete=function(){},r}(od),rv=function(){function i(r,s,u){this.nextOrObserver=r,this.error=s,this.complete=u}return i.prototype.call=function(r,s){return s.subscribe(new AB(r,this.nextOrObserver,this.error,this.complete))},i}(),AB=function(i){function r(s,u,l,f){return(s=i.call(this,s)||this)._tapNext=Ic,s._tapError=Ic,s._tapComplete=Ic,s._tapError=l||Ic,s._tapComplete=f||Ic,Ne(u)?(s._context=s,s._tapNext=u):u&&(s._context=u,s._tapNext=u.next||Ic,s._tapError=u.error||Ic,s._tapComplete=u.complete||Ic),s}return ha(r,i),r.prototype._next=function(s){try{this._tapNext.call(this._context,s)}catch(u){return void this.destination.error(u)}this.destination.next(s)},r.prototype._error=function(s){try{this._tapError.call(this._context,s)}catch(u){return void this.destination.error(u)}this.destination.error(s)},r.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(s){return void this.destination.error(s)}return this.destination.complete()},r}(za),tv={leading:!0,trailing:!1};(function(i){function r(s,u,l,f){var E=i.call(this,s)||this;return E.destination=s,E.durationSelector=u,E._leading=l,E._trailing=f,E._hasValue=!1,E}ha(r,i),r.prototype._next=function(s){this._hasValue=!0,this._sendValue=s,this._throttled||(this._leading?this.send():this.throttle(s))},r.prototype.send=function(){var s=this._sendValue;this._hasValue&&(this.destination.next(s),this.throttle(s)),this._hasValue=!1,this._sendValue=void 0},r.prototype.throttle=function(s){(s=this.tryDurationSelector(s))&&this.add(this._throttled=bd(s,new nd(this)))},r.prototype.tryDurationSelector=function(s){try{return this.durationSelector(s)}catch(u){return this.destination.error(u),null}},r.prototype.throttlingDone=function(){var s=this._throttled,u=this._trailing;s&&s.unsubscribe(),this._throttled=void 0,u&&this.send()},r.prototype.notifyNext=function(){this.throttlingDone()},r.prototype.notifyComplete=function(){this.throttlingDone()}})(od);for(var uv=function(){function i(r,s,u,l){this.duration=r,this.scheduler=s,this.leading=u,this.trailing=l}return i.prototype.call=function(r,s){return s.subscribe(new BB(r,this.duration,this.scheduler,this.leading,this.trailing))},i}(),BB=function(i){function r(s,u,l,f,E){return(s=i.call(this,s)||this).duration=u,s.scheduler=l,s.leading=f,s.trailing=E,s._hasTrailingValue=!1,s._trailingValue=null,s}return ha(r,i),r.prototype._next=function(s){this.throttled?this.trailing&&(this._trailingValue=s,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(vv,this.duration,{subscriber:this})),this.leading?this.destination.next(s):this.trailing&&(this._trailingValue=s,this._hasTrailingValue=!0))},r.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},r.prototype.clearThrottle=function(){var s=this.throttled;s&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),s.unsubscribe(),this.remove(s),this.throttled=null)},r}(za),xv=function(){function i(r,s,u,l){this.waitFor=r,this.absoluteTimeout=s,this.withObservable=u,this.scheduler=l}return i.prototype.call=function(r,s){return s.subscribe(new CB(r,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},i}(),CB=function(i){function r(s,u,l,f,E){return(s=i.call(this,s)||this).absoluteTimeout=u,s.waitFor=l,s.withObservable=f,s.scheduler=E,s.scheduleTimeout(),s}return ha(r,i),r.dispatchTimeout=function(s){var u=s.withObservable;s._unsubscribeAndRecycle(),s.add(bd(u,new nd(s)))},r.prototype.scheduleTimeout=function(){var s=this.action;s?this.action=s.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(r.dispatchTimeout,this.waitFor,this))},r.prototype._next=function(s){this.absoluteTimeout||this.scheduleTimeout(),i.prototype._next.call(this,s)},r.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},r}(od),zv=function(){function i(r,s){this.observables=r,this.project=s}return i.prototype.call=function(r,s){return s.subscribe(new DB(r,this.observables,this.project))},i}(),DB=function(i){function r(s,u,l){(s=i.call(this,s)||this).observables=u,s.project=l,s.toRespond=[],l=u.length,s.values=Array(l);for(var f=0;f<l;f++)s.toRespond.push(f);for(f=0;f<l;f++)s.add(bj(s,u[f],void 0,f));return s}return ha(r,i),r.prototype.notifyNext=function(s,u,l){this.values[l]=u,0<(s=this.toRespond).length&&(l=s.indexOf(l))!==-1&&s.splice(l,1)},r.prototype.notifyComplete=function(){},r.prototype._next=function(s){this.toRespond.length===0&&(s=[s].concat(this.values),this.project?this._tryProject(s):this.destination.next(s))},r.prototype._tryProject=function(s){try{var u=this.project.apply(this,s)}catch(l){return void this.destination.error(l)}this.destination.next(u)},r}(Bl),Kr=xb(function(i){var r=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(r){var s=new Uint8Array(16);i.exports=function(){return r(s),s}}else{var u=Array(16);i.exports=function(){for(var l,f=0;16>f;f++)!(3&f)&&(l=4294967296*Math.random()),u[f]=l>>>((3&f)<<3)&255;return u}}}),zb=[],pi=0;256>pi;++pi)zb[pi]=(pi+256).toString(16).substr(1);var Lr=function(i,r){return r=r||0,[zb[i[r++]],zb[i[r++]],zb[i[r++]],zb[i[r++]],"-",zb[i[r++]],zb[i[r++]],"-",zb[i[r++]],zb[i[r++]],"-",zb[i[r++]],zb[i[r++]],"-",zb[i[r++]],zb[i[r++]],zb[i[r++]],zb[i[r++]],zb[i[r++]],zb[i[r++]]].join("")},Ng=function(i,r,s){if(s=r&&s||0,typeof i=="string"&&(r=i==="binary"?Array(16):null,i=null),(i=(i=i||{}).random||(i.rng||Kr)())[6]=15&i[6]|64,i[8]=63&i[8]|128,r)for(var u=0;16>u;++u)r[s+u]=i[u];return r||Lr(i)},Og=Ng(),gj=!1,yn=new AbortController,pd,Md,El,Fl,Nd,qe,Fc,re,nc,Gl,qd,se,rd,sd,td,zf;(function(i){i[i.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",i[i.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",i[i.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",i[i.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",i[i.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",i[i.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",i[i.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"})(pd||(pd={})),function(i){i[i.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",i[i.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",i[i.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",i[i.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",i[i.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",i[i.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Md||(Md={})),function(i){i[i.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(El||(El={})),function(i){i[i.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Fl||(Fl={})),function(i){i[i.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",i[i.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",i[i.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",i[i.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",i[i.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",i[i.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(Nd||(Nd={})),function(i){i[i.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",i[i.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",i[i.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",i[i.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",i[i.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(qe||(qe={})),function(i){i[i.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",i[i.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",i[i.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",i[i.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",i[i.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",i[i.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",i[i.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",i[i.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",i[i.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",i[i.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",i[i.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(Fc||(Fc={})),function(i){i[i.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",i[i.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",i[i.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",i[i.LEAVE_CHANNEL_ERR_KICKED=4]="LEAVE_CHANNEL_ERR_KICKED",i[i.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(re||(re={})),function(i){i[i.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",i[i.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",i[i.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",i[i.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",i[i.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",i[i.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",i[i.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",i[i.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",i[i.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",i[i.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",i[i.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(nc||(nc={})),function(i){i[i.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Gl||(Gl={})),function(i){i[i.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",i[i.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",i[i.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",i[i.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",i[i.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",i[i.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",i[i.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(qd||(qd={})),function(i){i[i.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",i[i.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",i[i.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",i[i.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",i[i.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(se||(se={})),function(i){i[i.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",i[i.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",i[i.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",i[i.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",i[i.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",i[i.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",i[i.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",i[i.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(rd||(rd={})),function(i){i[i.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",i[i.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",i[i.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",i[i.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",i[i.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",i[i.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",i[i.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(i){i[i.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",i[i.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",i[i.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",i[i.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",i[i.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",i[i.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",i[i.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(td||(td={})),function(i){i[i.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",i[i.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",i[i.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",i[i.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(zf||(zf={}));var oc=pd.ATTRIBUTE_OPERATION_ERR_FAILURE,gb=pd.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,Ye=pd.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;pd.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Mr=pd.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,pc=pd.ATTRIBUTE_OPERATION_ERR_TIMEOUT,qc=pd.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,qi=Md.CHANNEL_MESSAGE_ERR_FAILURE,Hl=Md.CHANNEL_MESSAGE_ERR_TIMEOUT,Nr=Md.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Il=Md.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE,EB=Md.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL,Jl=Md.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,FB=El.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Or=Fl.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;sd.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Pr=sd.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;sd.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Qr=sd.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,GB=sd.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;sd.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var HB=sd.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,IB=Nd.GET_MEMBERS_ERR_FAILURE,JB=Nd.GET_MEMBERS_ERR_REJECTED;Nd.GET_MEMBERS_ERR_TIMEOUT,Nd.GET_MEMBERS_ERR_TOO_OFTEN;var KB=Nd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,LB=Nd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,Xc=qe.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,MB=qe.INVITATION_API_CALL_ERR_NOT_STARTED,ri=qe.INVITATION_API_CALL_ERR_ALREADY_END,Rr=qe.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,NB=qe.INVITATION_API_CALL_ERR_ALREADY_SENT,Sr=Fc.JOIN_CHANNEL_ERR_FAILURE;Fc.JOIN_CHANNEL_ERR_REJECTED;var OB=Fc.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Tr=Fc.JOIN_CHANNEL_TIMEOUT,Ur=Fc.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Vr=Fc.JOIN_CHANNEL_ERR_ALREADY_JOINED;Fc.JOIN_CHANNEL_ERR_TOO_OFTEN;var Wr=Fc.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Xr=Fc.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Yr=re.LEAVE_CHANNEL_ERR_FAILURE,Zr=re.LEAVE_CHANNEL_ERR_REJECTED,PB=re.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,QB=re.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,RB=re.LEAVE_CHANNEL_ERR_KICKED,$r=nc.LOGIN_ERR_UNKNOWN,Pg=nc.LOGIN_ERR_REJECTED,si=nc.LOGIN_ERR_INVALID_ARGUMENT,as=nc.LOGIN_ERR_INVALID_APP_ID,bs=nc.LOGIN_ERR_INVALID_TOKEN,ti=nc.LOGIN_ERR_TOKEN_EXPIRED;nc.LOGIN_ERR_NOT_AUTHORIZED;var SB=nc.LOGIN_ERR_ALREADY_LOGIN,TB=nc.LOGIN_ERR_TIMEOUT,UB=nc.LOGIN_ERR_TOO_OFTEN,cs=Gl.LOGOUT_ERR_USER_NOT_LOGGED_IN,ds=qd.PEER_MESSAGE_ERR_FAILURE,Kl=qd.PEER_MESSAGE_ERR_TIMEOUT,es=qd.PEER_MESSAGE_ERR_TOO_OFTEN,fs=qd.PEER_MESSAGE_ERR_INVALID_USERID,bg=qd.PEER_MESSAGE_ERR_INVALID_MESSAGE,Ll=qd.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN;qd.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE;var gs=se.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;se.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var VB=se.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;se.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var WB=se.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,Ml=rd.RENEW_TOKEN_ERR_FAILURE,XB=rd.RENEW_TOKEN_ERR_INVALID_ARGUMENT;rd.RENEW_TOKEN_ERR_REJECTED,rd.RENEW_TOKEN_ERR_TOO_OFTEN;var YB=rd.RENEW_TOKEN_ERR_TOKEN_EXPIRED,ZB=rd.RENEW_TOKEN_ERR_INVALID_TOKEN,hs=rd.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,is=td.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,Qg=td.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;td.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var $B=td.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;td.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var js=td.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,Nl=td.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var aC=function(i,r){var s;return rl(i,function(u,l,f){return!(s=r(u,l,f))}),!!s},ui=function(i,r,s){if(!Gb(s))return!1;var u=qa(r);return!!(u=="number"?ae(s)&&gl(r,s.length):u=="string"&&r in s)&&Gg(s[r],i)},Ol=function(i,r,s){var u=ub(i)?ur:aC;return u(i,wf(r))},bC=function(i,r){var s=-1,u=ae(i)?Array(i.length):[];return rl(i,function(l,f,E){u[++s]=r(l,f,E)}),u},cC=function(i,r){var s=i.length;for(i.sort(r);s--;)i[s]=i[s].value;return i},dC=function(i,r,s){r=r.length?Je(r,function(l){return ub(l)?function(f){return li(f,l.length===1?l[0]:l)}:l}):[mi];var u=-1;return r=Je(r,ii(wf)),i=bC(i,function(l,f,E){return{criteria:Je(r,function(T){return T(l)}),index:++u,value:l}}),cC(i,function(l,f){t:{for(var E=-1,T=l.criteria,v=f.criteria,w=T.length,k=s.length;++E<w;){e:{var B=T[E],Q=v[E];if(B!==Q){var X=B!==void 0,_e=B===null,aa=B==B,_i=Ke(B),_a=Q!==void 0,ga=Q===null,_d=Q==Q,d_=Ke(Q);if(!ga&&!d_&&!_i&&B>Q||_i&&_a&&_d&&!ga&&!d_||_e&&_a&&_d||!X&&_d||!aa){B=1;break e}if(!_e&&!_i&&!d_&&B<Q||d_&&X&&aa&&!_e&&!_i||ga&&X&&aa||!_a&&aa||!_d){B=-1;break e}}B=0}if(B){l=E>=k?B:B*(s[E]=="desc"?-1:1);break t}}l=l.index-f.index}return l})},ks=function(i,r){return sr(rr(i,r,mi),i+"")},ls=ks(function(i,r){if(i==null)return[];var s=r.length;return 1<s&&ui(i,r[0],r[1])?r=[]:2<s&&ui(r[0],r[1],r[2])&&(r=[r[0]]),dC(i,Si(r),[])}),ms=function(i){if(i.__esModule)return i;var r=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(i).forEach(function(s){var u=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(r,s,u.get?u:{enumerable:!0,get:function(){return i[s]}})}),r}(iB),ns=xb(function(i,r){Object.defineProperty(r,"__esModule",{value:!0});var s=[],u=function(l,f){return new WebSocket(l,f)};r.normalClosureMessage="Normal closure",r.default=function(l,f){var E=(f=f===void 0?{protocols:s,makeWebSocket:u}:f).protocols,T=E===void 0?s:E,v=(f=f.makeWebSocket)===void 0?u:f;return new ms.Observable(function(w){var k,B=new ms.Subject,Q=v(l,T),X=!1,_e=!1,aa=function(_i){if(k)throw X=!0,_i=Error("Web socket message factory function called more than once"),w.error(_i),_i;return k=_i.subscribe(function(_a){Q.send(_a)}),B};return Q.onopen=function(){_e?(X=!0,Q.close()):w.next(aa)},Q.onmessage=function(_i){B.next(_i.data)},Q.onerror=function(_i){X=!0,w.error(Error(_i.message))},Q.onclose=function(_i){X||(X=!0,_e?(w.complete(),B.complete()):w.error(Error(_i.code===1e3?r.normalClosureMessage:_i.reason)))},function(){_e=!0,k&&k.unsubscribe(),X||(X=!0,Q.close())}})}});(function(i){i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")&&i.default})(ns);var ij=function(i,r,s){(s===void 0||Gg(i[r],s))&&(s!==void 0||r in i)||Ig(i,r,s)},hj=function(i,r){if((r!=="constructor"||typeof i[r]!="function")&&r!="__proto__")return i[r]},eC=function(i){return ks(function(r,s){var u=-1,l=s.length,f=1<l?s[l-1]:void 0,E=2<l?s[2]:void 0;for(f=3<i.length&&typeof f=="function"?(l--,f):void 0,E&&ui(s[0],s[1],E)&&(f=3>l?void 0:f,l=1),r=Object(r);++u<l;)(E=s[u])&&i(r,E,u,f);return r})}(function(i,r,s,u){zn(i,r,s,u)}),fC=Math.floor,gC=Math.random,os=function(i,r){return i+fC(gC()*(r-i+1))},ps=function(i){var r=i.length;return r?i[os(0,r-1)]:void 0},hC=function(i,r){return Je(r,function(s){return i[s]})},zj=function(i){return i==null?[]:hC(i,Wd(i))},iC=function(i){return ps(zj(i))},On=function(i){return(ub(i)?ps:iC)(i)},Dn=[],En=function(i,r){return new WebSocket(i,r)},jC=Math.floor;ea({target:"Number",stat:!0},{isInteger:function(i){return!xa(i)&&isFinite(i)&&jC(i)===i}}),Sp("from",sk,rk);var kC=function(i,r){for(var s=Array(arguments.length-1),u=0,l=2,f=!0;l<arguments.length;)s[u++]=arguments[l++];return new Promise(function(E,T){s[u]=function(v){if(f)if(f=!1,v)T(v);else{for(var w=Array(arguments.length-1),k=0;k<w.length;)w[k++]=arguments[k];E.apply(null,w)}};try{i.apply(r||null,s)}catch(v){f&&(f=!1,T(v))}})},lC=xb(function(i,r){r.length=function(l){var f=l.length;if(!f)return 0;for(var E=0;1<--f%4&&l.charAt(f)==="=";)++E;return Math.ceil(3*l.length)/4-E};var s=Array(64),u=Array(123);for(i=0;64>i;)u[s[i]=26>i?i+65:52>i?i+71:62>i?i-4:i-59|43]=i++;r.encode=function(l,f,E){for(var T,v=null,w=[],k=0,B=0;f<E;){var Q=l[f++];switch(B){case 0:w[k++]=s[Q>>2],T=(3&Q)<<4,B=1;break;case 1:w[k++]=s[T|Q>>4],T=(15&Q)<<2,B=2;break;case 2:w[k++]=s[T|Q>>6],w[k++]=s[63&Q],B=0}8191<k&&((v||(v=[])).push(String.fromCharCode.apply(String,w)),k=0)}return B&&(w[k++]=s[T],w[k++]=61,B===1&&(w[k++]=61)),v?(k&&v.push(String.fromCharCode.apply(String,w.slice(0,k))),v.join("")):String.fromCharCode.apply(String,w.slice(0,k))},r.decode=function(l,f,E){for(var T,v=E,w=0,k=0;k<l.length;){var B=l.charCodeAt(k++);if(B===61&&1<w)break;if((B=u[B])===void 0)throw Error("invalid encoding");switch(w){case 0:T=B,w=1;break;case 1:f[E++]=T<<2|(48&B)>>4,T=B,w=2;break;case 2:f[E++]=(15&T)<<4|(60&B)>>2,T=B,w=3;break;case 3:f[E++]=(3&T)<<6|B,w=0}}if(w===1)throw Error("invalid encoding");return E-v},r.test=function(l){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(l)}});hh.prototype.on=function(i,r,s){return(this._listeners[i]||(this._listeners[i]=[])).push({fn:r,ctx:s||this}),this},hh.prototype.off=function(i,r){if(i===void 0)this._listeners={};else if(r===void 0)this._listeners[i]=[];else{i=this._listeners[i];for(var s=0;s<i.length;)i[s].fn===r?i.splice(s,1):++s}return this},hh.prototype.emit=function(i){var r=this._listeners[i];if(r){for(var s=[],u=1;u<arguments.length;)s.push(arguments[u++]);for(u=0;u<r.length;)r[u].fn.apply(r[u++].ctx,s)}return this};var mC=Fn(Fn),nC=function(c){try{var b=eval("quire".replace(/^/,"re"))(c);if(b&&(b.length||Object.keys(b).length))return b}catch(i){}return null},oC=xb(function(i,r){r.length=function(s){for(var u,l=0,f=0;f<s.length;++f)128>(u=s.charCodeAt(f))?l+=1:2048>u?l+=2:(64512&u)==55296&&(64512&s.charCodeAt(f+1))==56320?(++f,l+=4):l+=3;return l},r.read=function(s,u,l){if(1>l-u)return"";for(var f,E=null,T=[],v=0;u<l;)128>(f=s[u++])?T[v++]=f:191<f&&224>f?T[v++]=(31&f)<<6|63&s[u++]:239<f&&365>f?(f=((7&f)<<18|(63&s[u++])<<12|(63&s[u++])<<6|63&s[u++])-65536,T[v++]=55296+(f>>10),T[v++]=56320+(1023&f)):T[v++]=(15&f)<<12|(63&s[u++])<<6|63&s[u++],8191<v&&((E||(E=[])).push(String.fromCharCode.apply(String,T)),v=0);return E?(v&&E.push(String.fromCharCode.apply(String,T.slice(0,v))),E.join("")):String.fromCharCode.apply(String,T.slice(0,v))},r.write=function(s,u,l){for(var f,E,T=l,v=0;v<s.length;++v)128>(f=s.charCodeAt(v))?u[l++]=f:(2048>f?u[l++]=f>>6|192:((64512&f)==55296&&(64512&(E=s.charCodeAt(v+1)))==56320?(f=65536+((1023&f)<<10)+(1023&E),++v,u[l++]=f>>18|240,u[l++]=f>>12&63|128):u[l++]=f>>12|224,u[l++]=f>>6&63|128),u[l++]=63&f|128);return l-T}}),pC=function(i,r,s){var u=s||8192,l=u>>>1,f=null,E=u;return function(T){return 1>T||T>l?i(T):(E+T>u&&(f=i(u),E=0),T=r.call(f,E,E+=T),7&E&&(E=1+(7|E)),T)}},te=vb.zero=new vb(0,0);te.toNumber=function(){return 0},te.zzEncode=te.zzDecode=function(){return this},te.length=function(){return 1};var qC=vb.zeroHash="\0\0\0\0\0\0\0\0";vb.fromNumber=function(i){if(i===0)return te;var r=0>i;r&&(i=-i);var s=i>>>0;return i=(i-s)/4294967296>>>0,r&&(i=~i>>>0,s=~s>>>0,4294967295<++s&&(s=0,4294967295<++i&&(i=0))),new vb(s,i)},vb.from=function(i){if(typeof i=="number")return vb.fromNumber(i);if(pa.isString(i)){if(!pa.Long)return vb.fromNumber(parseInt(i,10));i=pa.Long.fromString(i)}return i.low||i.high?new vb(i.low>>>0,i.high>>>0):te},vb.prototype.toNumber=function(i){if(!i&&this.hi>>>31){i=1+~this.lo>>>0;var r=~this.hi>>>0;return i||(r=r+1>>>0),-(i+4294967296*r)}return this.lo+4294967296*this.hi},vb.prototype.toLong=function(i){return pa.Long?new pa.Long(0|this.lo,0|this.hi,!!i):{low:0|this.lo,high:0|this.hi,unsigned:!!i}};var Od=String.prototype.charCodeAt;vb.fromHash=function(i){return i===qC?te:new vb((Od.call(i,0)|Od.call(i,1)<<8|Od.call(i,2)<<16|Od.call(i,3)<<24)>>>0,(Od.call(i,4)|Od.call(i,5)<<8|Od.call(i,6)<<16|Od.call(i,7)<<24)>>>0)},vb.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},vb.prototype.zzEncode=function(){var i=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^i)>>>0,this.lo=(this.lo<<1^i)>>>0,this},vb.prototype.zzDecode=function(){var i=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^i)>>>0,this.hi=(this.hi>>>1^i)>>>0,this},vb.prototype.length=function(){var i=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,s=this.hi>>>24;return s===0?r===0?16384>i?128>i?1:2:2097152>i?3:4:16384>r?128>r?5:6:2097152>r?7:8:128>s?9:10};var pa=xb(function(i,r){function s(l,f,E){for(var T=Object.keys(f),v=0;v<T.length;++v)l[T[v]]!==void 0&&E||(l[T[v]]=f[T[v]]);return l}function u(l){function f(E,T){if(!(this instanceof f))return new f(E,T);Object.defineProperty(this,"message",{get:function(){return E}}),Error.captureStackTrace?Error.captureStackTrace(this,f):Object.defineProperty(this,"stack",{value:Error().stack||""}),T&&s(this,T)}return(f.prototype=Object.create(Error.prototype)).constructor=f,Object.defineProperty(f.prototype,"name",{get:function(){return l}}),f.prototype.toString=function(){return this.name+": "+this.message},f}r.asPromise=kC,r.base64=lC,r.EventEmitter=hh,r.float=mC,r.inquire=nC,r.utf8=oC,r.pool=pC,r.LongBits=vb,r.isNode=!!(Ya!==void 0&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),r.global=r.isNode&&Ya||typeof window<"u"&&window||typeof self<"u"&&self||Ya,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(l){return typeof l=="number"&&isFinite(l)&&Math.floor(l)===l},r.isString=function(l){return typeof l=="string"||l instanceof String},r.isObject=function(l){return l&&qa(l)==="object"},r.isset=r.isSet=function(l,f){var E=l[f];return!(E==null||!l.hasOwnProperty(f))&&(qa(E)!=="object"||0<(Array.isArray(E)?E.length:Object.keys(E).length))},r.Buffer=function(){try{var l=r.inquire("buffer").Buffer;return l.prototype.utf8Write?l:null}catch{return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(l){return typeof l=="number"?r.Buffer?r._Buffer_allocUnsafe(l):new r.Array(l):r.Buffer?r._Buffer_from(l):typeof Uint8Array>"u"?l:new Uint8Array(l)},r.Array=typeof Uint8Array<"u"?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(l){return l?r.LongBits.from(l).toHash():r.LongBits.zeroHash},r.longFromHash=function(l,f){return l=r.LongBits.fromHash(l),r.Long?r.Long.fromBits(l.lo,l.hi,f):l.toNumber(!!f)},r.merge=s,r.lcFirst=function(l){return l.charAt(0).toLowerCase()+l.substring(1)},r.newError=u,r.ProtocolError=u("ProtocolError"),r.oneOfGetter=function(l){for(var f={},E=0;E<l.length;++E)f[l[E]]=1;return function(){for(var T=Object.keys(this),v=T.length-1;-1<v;--v)if(f[T[v]]===1&&this[T[v]]!==void 0&&this[T[v]]!==null)return T[v]}},r.oneOfSetter=function(l){return function(f){for(var E=0;E<l.length;++E)l[E]!==f&&delete this[l[E]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var l=r.Buffer;l?(r._Buffer_from=l.from!==Uint8Array.from&&l.from||function(f,E){return new l(f,E)},r._Buffer_allocUnsafe=l.allocUnsafe||function(f){return new l(f)}):r._Buffer_from=r._Buffer_allocUnsafe=null}}),qj=Aa,Pl,vi=pa.LongBits,qs=pa.base64,rs=pa.utf8,ss=function(){return pa.Buffer?function(){return(Aa.create=function(){return new Pl})()}:function(){return new Aa}};Aa.create=ss(),Aa.alloc=function(i){return new pa.Array(i)},pa.Array!==Array&&(Aa.alloc=pa.pool(Aa.alloc,pa.Array.prototype.subarray)),Aa.prototype._push=function(i,r,s){return this.tail=this.tail.next=new Wf(i,r,s),this.len+=r,this},nj.prototype=Object.create(Wf.prototype),nj.prototype.fn=function(i,r,s){for(;127<i;)r[s++]=127&i|128,i>>>=7;r[s]=i},Aa.prototype.uint32=function(i){return this.len+=(this.tail=this.tail.next=new nj(128>(i>>>=0)?1:16384>i?2:2097152>i?3:268435456>i?4:5,i)).len,this},Aa.prototype.int32=function(i){return 0>i?this._push(oj,10,vi.fromNumber(i)):this.uint32(i)},Aa.prototype.sint32=function(i){return this.uint32((i<<1^i>>31)>>>0)},Aa.prototype.uint64=function(i){return i=vi.from(i),this._push(oj,i.length(),i)},Aa.prototype.int64=Aa.prototype.uint64,Aa.prototype.sint64=function(i){return i=vi.from(i).zzEncode(),this._push(oj,i.length(),i)},Aa.prototype.bool=function(i){return this._push(mj,1,i?1:0)},Aa.prototype.fixed32=function(i){return this._push(pj,4,i>>>0)},Aa.prototype.sfixed32=Aa.prototype.fixed32,Aa.prototype.fixed64=function(i){return i=vi.from(i),this._push(pj,4,i.lo)._push(pj,4,i.hi)},Aa.prototype.sfixed64=Aa.prototype.fixed64,Aa.prototype.float=function(i){return this._push(pa.float.writeFloatLE,4,i)},Aa.prototype.double=function(i){return this._push(pa.float.writeDoubleLE,8,i)};var rC=pa.Array.prototype.set?function(i,r,s){r.set(i,s)}:function(i,r,s){for(var u=0;u<i.length;++u)r[s+u]=i[u]};Aa.prototype.bytes=function(i){var r=i.length>>>0;if(!r)return this._push(mj,1,0);if(pa.isString(i)){var s=Aa.alloc(r=qs.length(i));qs.decode(i,s,0),i=s}return this.uint32(r)._push(rC,r,i)},Aa.prototype.string=function(i){var r=rs.length(i);return r?this.uint32(r)._push(rs.write,r,i):this._push(mj,1,0)},Aa.prototype.fork=function(){return this.states=new Cv(this),this.head=this.tail=new Wf(lj,0,0),this.len=0,this},Aa.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Wf(lj,0,0),this.len=0),this},Aa.prototype.ldelim=function(){var i=this.head,r=this.tail,s=this.len;return this.reset().uint32(s),s&&(this.tail.next=i.next,this.tail=r,this.len+=s),this},Aa.prototype.finish=function(){for(var i=this.head.next,r=this.constructor.alloc(this.len),s=0;i;)i.fn(i.val,r,s),s+=i.len,i=i.next;return r},Aa._configure=function(i){Pl=i,Aa.create=ss(),Pl._configure()},(Lc.prototype=Object.create(qj.prototype)).constructor=Lc,Lc._configure=function(){Lc.alloc=pa._Buffer_allocUnsafe,Lc.writeBytesBuffer=pa.Buffer&&pa.Buffer.prototype instanceof Uint8Array&&pa.Buffer.prototype.set.name==="set"?function(i,r,s){r.set(i,s)}:function(i,r,s){if(i.copy)i.copy(r,s,0,i.length);else for(var u=0;u<i.length;)r[s++]=i[u++]}},Lc.prototype.bytes=function(i){pa.isString(i)&&(i=pa._Buffer_from(i,"base64"));var r=i.length>>>0;return this.uint32(r),r&&this._push(Lc.writeBytesBuffer,r,i),this},Lc.prototype.string=function(i){var r=pa.Buffer.byteLength(i);return this.uint32(r),r&&this._push(Dv,r,i),this},Lc._configure();var sj=ib,Ql,Kn=pa.LongBits,sC=pa.utf8,ts=typeof Uint8Array<"u"?function(i){if(i instanceof Uint8Array||Array.isArray(i))return new ib(i);throw Error("illegal buffer")}:function(i){if(Array.isArray(i))return new ib(i);throw Error("illegal buffer")},us=function(){return pa.Buffer?function(i){return(ib.create=function(r){return pa.Buffer.isBuffer(r)?new Ql(r):ts(r)})(i)}:ts};ib.create=us(),ib.prototype._slice=pa.Array.prototype.subarray||pa.Array.prototype.slice,ib.prototype.uint32=function(){var i=4294967295;return function(){if(i=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++]||(i=(i|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])||(i=(i|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])||(i=(i|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])||(i=(i|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++]))return i;if((this.pos+=5)>this.len)throw this.pos=this.len,wc(this,10);return i}}(),ib.prototype.int32=function(){return 0|this.uint32()},ib.prototype.sint32=function(){var i=this.uint32();return i>>>1^-(1&i)|0},ib.prototype.bool=function(){return this.uint32()!==0},ib.prototype.fixed32=function(){if(this.pos+4>this.len)throw wc(this,4);return ih(this.buf,this.pos+=4)},ib.prototype.sfixed32=function(){if(this.pos+4>this.len)throw wc(this,4);return 0|ih(this.buf,this.pos+=4)},ib.prototype.float=function(){if(this.pos+4>this.len)throw wc(this,4);var i=pa.float.readFloatLE(this.buf,this.pos);return this.pos+=4,i},ib.prototype.double=function(){if(this.pos+8>this.len)throw wc(this,4);var i=pa.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,i},ib.prototype.bytes=function(){var i=this.uint32(),r=this.pos,s=this.pos+i;if(s>this.len)throw wc(this,i);return this.pos+=i,Array.isArray(this.buf)?this.buf.slice(r,s):r===s?new this.buf.constructor(0):this._slice.call(this.buf,r,s)},ib.prototype.string=function(){var i=this.bytes();return sC.read(i,0,i.length)},ib.prototype.skip=function(i){if(typeof i=="number"){if(this.pos+i>this.len)throw wc(this,i);this.pos+=i}else do if(this.pos>=this.len)throw wc(this);while(128&this.buf[this.pos++]);return this},ib.prototype.skipType=function(i){switch(i){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(i=7&this.uint32())!=4;)this.skipType(i);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+i+" at offset "+this.pos)}return this},ib._configure=function(i){Ql=i,ib.create=us(),Ql._configure();var r=pa.Long?"toLong":"toNumber";pa.merge(ib.prototype,{int64:function(){return rj.call(this)[r](!1)},uint64:function(){return rj.call(this)[r](!0)},sint64:function(){return rj.call(this).zzDecode()[r](!1)},fixed64:function(){return Ln.call(this)[r](!0)},sfixed64:function(){return Ln.call(this)[r](!1)}})},(be.prototype=Object.create(sj.prototype)).constructor=be,be._configure=function(){pa.Buffer&&(be.prototype._slice=pa.Buffer.prototype.slice)},be.prototype.string=function(){var i=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+i,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+i,this.len))},be._configure(),(Xf.prototype=Object.create(pa.EventEmitter.prototype)).constructor=Xf,Xf.prototype.rpcCall=function i(r,s,u,l,f){if(!l)throw TypeError("request must be specified");var E=this;if(!f)return pa.asPromise(i,E,r,s,u,l);if(E.rpcImpl)try{return E.rpcImpl(r,s[E.requestDelimited?"encodeDelimited":"encode"](l).finish(),function(T,v){if(T)return E.emit("error",T,r),f(T);if(v!==null){if(!(v instanceof u))try{v=u[E.responseDelimited?"decodeDelimited":"decode"](v)}catch(w){return E.emit("error",w,r),f(w)}return E.emit("data",v,r),f(null,v)}E.end(!0)})}catch(T){E.emit("error",T,r),setTimeout(function(){f(T)},0)}else setTimeout(function(){f(Error("already ended"))},0)},Xf.prototype.end=function(i){return this.rpcImpl&&(i||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var tC=xb(function(i,r){r.Service=Xf}),uC={},Gc=xb(function(i,r){function s(){u.util._configure(),u.Writer._configure(u.BufferWriter),u.Reader._configure(u.BufferReader)}var u=r;u.build="minimal",u.Writer=qj,u.BufferWriter=Lc,u.Reader=sj,u.BufferReader=be,u.util=pa,u.rpc=tC,u.roots=uC,u.configure=s,s()});Gc.util.Long=P,Gc.configure();var M=Gc.Reader,ia=Gc.Writer,D=Gc.util,I=Gc.roots.default||(Gc.roots.default={}),vC=I.URI=function(){var i={},r=Object.create(i);return r[i[0]="Unknown"]=0,r[i[1]="PingUri"]=1,r[i[2]="PongUri"]=2,r[i[11]="UserJoinUri"]=11,r[i[12]="UserRespUri"]=12,r[i[15]="UserTicketNearlyExpireUri"]=15,r[i[16]="UserRenewTokenReqUri"]=16,r[i[17]="UserRenewTokenRespUri"]=17,r[i[21]="UserQuitUri"]=21,r[i[22]="UserDropUri"]=22,r[i[31]="GroupEnterUri"]=31,r[i[32]="GroupLeaveUri"]=32,r[i[33]="GroupReplyUri"]=33,r[i[35]="GroupDropUri"]=35,r[i[36]="GroupEnterNoticeUri"]=36,r[i[37]="GroupLeaveNoticeUri"]=37,r[i[38]="GroupEventNoticeUri"]=38,r[i[39]="GroupCountNoticeUri"]=39,r[i[41]="UserStatusListUri"]=41,r[i[42]="UserStatusResultUri"]=42,r[i[51]="GroupStatusListUri"]=51,r[i[52]="GroupStatusResultUri"]=52,r[i[55]="GroupAllUsersListUri"]=55,r[i[56]="GroupAllUsersResultUri"]=56,r[i[100]="MessageUri"]=100,r[i[101]="AckUri"]=101,r[i[201]="UserJoinNoticeUri"]=201,r[i[202]="UserQuitNoticeUri"]=202,r[i[203]="UserWaitNoticeUri"]=203,r[i[301]="UserAttributeGetUri"]=301,r[i[302]="UserAttributeRetUri"]=302,r[i[303]="UserAttributeSetUri"]=303,r[i[304]="UserAttributeModUri"]=304,r[i[305]="UserAttributeDelUri"]=305,r[i[307]="UserAttributeRspUri"]=307,r[i[308]="UserAttributeErrUri"]=308,r[i[311]="UserAttributeKeysGetUri"]=311,r[i[312]="UserAttributeKeysRetUri"]=312,r[i[351]="GroupAttributeGetUri"]=351,r[i[352]="GroupAttributeRetUri"]=352,r[i[353]="GroupAttributeSetUri"]=353,r[i[354]="GroupAttributeModUri"]=354,r[i[355]="GroupAttributeDelUri"]=355,r[i[356]="GroupAttributeAltUri"]=356,r[i[357]="GroupAttributeRspUri"]=357,r[i[358]="GroupAttributeErrUri"]=358,r[i[361]="GroupAttributeKeysGetUri"]=361,r[i[362]="GroupAttributeKeysRetUri"]=362,r[i[401]="SubscribeUserStatusUri"]=401,r[i[402]="UnsubscribeUserStatusUri"]=402,r[i[499]="SubscribeResponseUri"]=499,r}(),wi=I.Wrapper=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.uri=0,i.prototype.data=D.newBuffer([]),i.encode=function(r,s){return s||(s=ia.create()),r.uri!=null&&Object.hasOwnProperty.call(r,"uri")&&s.uint32(8).int32(r.uri),r.data!=null&&Object.hasOwnProperty.call(r,"data")&&s.uint32(18).bytes(r.data),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.Wrapper;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.uri=r.int32();break;case 2:u.data=r.bytes();break;default:r.skipType(7&l)}}return u},i}(),wC=I.Ping=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&s.uint32(16).uint64(r.ms),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.Ping;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.ms=r.uint64();break;default:r.skipType(7&l)}}return u},i}(),xC=I.Pong=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&s.uint32(16).uint64(r.ms),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.Pong;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.ms=r.uint64();break;default:r.skipType(7&l)}}return u},i}(),yC=I.UserJoin=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.opt=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.ticket="",i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.opt!=null&&Object.hasOwnProperty.call(r,"opt")&&s.uint32(16).uint64(r.opt),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(24).uint64(r.instance),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(34).string(r.account),r.ticket!=null&&Object.hasOwnProperty.call(r,"ticket")&&s.uint32(42).string(r.ticket),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserJoin;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.opt=r.uint64();break;case 3:u.instance=r.uint64();break;case 4:u.account=r.string();break;case 5:u.ticket=r.string();break;default:r.skipType(7&l)}}return u},i}(),zC=I.UserResp=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.code=0,i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(24).uint32(r.code),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserResp;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;case 3:u.code=r.uint32();break;default:r.skipType(7&l)}}return u},i}(),AC=I.UserQuit=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.encode=function(r,s){return s||(s=ia.create()),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserQuit;r.pos<s;){var l=r.uint32();r.skipType(7&l)}return u},i}(),BC=I.UserDrop=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.code=0,i.encode=function(r,s){return s||(s=ia.create()),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(8).uint32(r.code),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserDrop;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.code=r.uint32();break;default:r.skipType(7&l)}}return u},i}(),CC=I.UserTicketNearlyExpire=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.expireTs=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.ticket="",i.encode=function(r,s){return s||(s=ia.create()),r.expireTs!=null&&Object.hasOwnProperty.call(r,"expireTs")&&s.uint32(8).uint64(r.expireTs),r.ticket!=null&&Object.hasOwnProperty.call(r,"ticket")&&s.uint32(18).string(r.ticket),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserTicketNearlyExpire;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.expireTs=r.uint64();break;case 2:u.ticket=r.string();break;default:r.skipType(7&l)}}return u},i}(),DC=I.UserRenewTokenReq=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.ticket="",i.encode=function(r,s){return s||(s=ia.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(16).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(26).string(r.account),r.ticket!=null&&Object.hasOwnProperty.call(r,"ticket")&&s.uint32(34).string(r.ticket),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserRenewTokenReq;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.instance=r.uint64();break;case 2:u.seq=r.uint64();break;case 3:u.account=r.string();break;case 4:u.ticket=r.string();break;default:r.skipType(7&l)}}return u},i}(),EC=I.UserRenewTokenResp=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.code=0,i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(16).uint32(r.code),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserRenewTokenResp;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.code=r.uint32();break;default:r.skipType(7&l)}}return u},i}(),FC=I.GroupEnter=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupEnter;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;default:r.skipType(7&l)}}return u},i}(),GC=I.GroupLeave=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.account="",i.encode=function(r,s){return s||(s=ia.create()),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(10).string(r.account),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupLeave;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.account=r.string();break;default:r.skipType(7&l)}}return u},i}(),HC=I.GroupReply=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.code=0,i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(24).uint32(r.code),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupReply;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;case 3:u.code=r.uint32();break;default:r.skipType(7&l)}}return u},i}(),vs=I.GroupLeaveNotice=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.user="",i.prototype.group="",i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.size=0,i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&s.uint32(18).string(r.user),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(26).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(32).uint64(r.instance),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&s.uint32(40).uint32(r.size),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupLeaveNotice;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.user=r.string();break;case 3:u.group=r.string();break;case 4:u.instance=r.uint64();break;case 5:u.size=r.uint32();break;default:r.skipType(7&l)}}return u},i}(),ws=I.GroupEnterNotice=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.user="",i.prototype.group="",i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.size=0,i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&s.uint32(18).string(r.user),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(26).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(32).uint64(r.instance),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&s.uint32(40).uint32(r.size),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupEnterNotice;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.user=r.string();break;case 3:u.group=r.string();break;case 4:u.instance=r.uint64();break;case 5:u.size=r.uint32();break;default:r.skipType(7&l)}}return u},i}(),xs=I.Message=function(){function i(r){if(this.MiscMap={},r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.dialogue=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.sequence=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.options=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.src="",i.prototype.dst="",i.prototype.payload=D.newBuffer([]),i.prototype.MiscMap=D.emptyObject,i.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,i.encode=function(r,s){if(s||(s=ia.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(8).uint64(r.instance),r.dialogue!=null&&Object.hasOwnProperty.call(r,"dialogue")&&s.uint32(16).uint64(r.dialogue),r.sequence!=null&&Object.hasOwnProperty.call(r,"sequence")&&s.uint32(24).uint64(r.sequence),r.options!=null&&Object.hasOwnProperty.call(r,"options")&&s.uint32(32).uint64(r.options),r.src!=null&&Object.hasOwnProperty.call(r,"src")&&s.uint32(42).string(r.src),r.dst!=null&&Object.hasOwnProperty.call(r,"dst")&&s.uint32(50).string(r.dst),r.payload!=null&&Object.hasOwnProperty.call(r,"payload")&&s.uint32(58).bytes(r.payload),r.MiscMap!=null&&Object.hasOwnProperty.call(r,"MiscMap"))for(var u=Object.keys(r.MiscMap),l=0;l<u.length;++l)s.uint32(66).fork().uint32(10).string(u[l]).uint32(18).bytes(r.MiscMap[u[l]]).ldelim();return r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&s.uint32(72).uint64(r.ms),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u,l,f=new I.Message;r.pos<s;)switch(u=r.uint32(),u>>>3){case 1:f.instance=r.uint64();break;case 2:f.dialogue=r.uint64();break;case 3:f.sequence=r.uint64();break;case 4:f.options=r.uint64();break;case 5:f.src=r.string();break;case 6:f.dst=r.string();break;case 7:f.payload=r.bytes();break;case 8:f.MiscMap===D.emptyObject&&(f.MiscMap={});var E=r.uint32()+r.pos;for(u="",l=[];r.pos<E;){var T=r.uint32();switch(T>>>3){case 1:u=r.string();break;case 2:l=r.bytes();break;default:r.skipType(7&T)}}f.MiscMap[u]=l;break;case 9:f.ms=r.uint64();break;default:r.skipType(7&u)}return f},i}(),ys=I.Ack=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.dialogue=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.sequence=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.code=0,i.encode=function(r,s){return s||(s=ia.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(8).uint64(r.instance),r.dialogue!=null&&Object.hasOwnProperty.call(r,"dialogue")&&s.uint32(16).uint64(r.dialogue),r.sequence!=null&&Object.hasOwnProperty.call(r,"sequence")&&s.uint32(24).uint64(r.sequence),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(32).uint32(r.code),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.Ack;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.instance=r.uint64();break;case 2:u.dialogue=r.uint64();break;case 3:u.sequence=r.uint64();break;case 4:u.code=r.uint32();break;default:r.skipType(7&l)}}return u},i}(),IC=I.GroupDrop=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.account="",i.prototype.code=0,i.encode=function(r,s){return s||(s=ia.create()),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(10).string(r.account),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(16).uint32(r.code),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupDrop;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.account=r.string();break;case 2:u.code=r.uint32();break;default:r.skipType(7&l)}}return u},i}(),JC=I.GroupAllUsersList=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.pageSize=0,i.prototype.pageNumber=0,i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),r.pageSize!=null&&Object.hasOwnProperty.call(r,"pageSize")&&s.uint32(24).uint32(r.pageSize),r.pageNumber!=null&&Object.hasOwnProperty.call(r,"pageNumber")&&s.uint32(32).uint32(r.pageNumber),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupAllUsersList;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;case 3:u.pageSize=r.uint32();break;case 4:u.pageNumber=r.uint32();break;default:r.skipType(7&l)}}return u},i}(),KC=I.GroupAllUsersResult=function(){function i(r){if(this.memberInfos=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.totalSize=0,i.prototype.pageSize=0,i.prototype.pageNumber=0,i.prototype.memberInfos=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),r.totalSize!=null&&Object.hasOwnProperty.call(r,"totalSize")&&s.uint32(24).uint32(r.totalSize),r.pageSize!=null&&Object.hasOwnProperty.call(r,"pageSize")&&s.uint32(32).uint32(r.pageSize),r.pageNumber!=null&&Object.hasOwnProperty.call(r,"pageNumber")&&s.uint32(40).uint32(r.pageNumber),r.memberInfos!=null&&r.memberInfos.length)for(var u=0;u<r.memberInfos.length;++u)I.GroupAllUsersResult.MemberInfo.encode(r.memberInfos[u],s.uint32(50).fork()).ldelim();return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupAllUsersResult;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;case 3:u.totalSize=r.uint32();break;case 4:u.pageSize=r.uint32();break;case 5:u.pageNumber=r.uint32();break;case 6:u.memberInfos&&u.memberInfos.length||(u.memberInfos=[]),u.memberInfos.push(I.GroupAllUsersResult.MemberInfo.decode(r,r.uint32()));break;default:r.skipType(7&l)}}return u},i.MemberInfo=function(){function r(s){if(s)for(var u=Object.keys(s),l=0;l<u.length;++l)s[u[l]]!=null&&(this[u[l]]=s[u[l]])}return r.prototype.account="",r.prototype.ts=0,r.encode=function(s,u){return u||(u=ia.create()),s.account!=null&&Object.hasOwnProperty.call(s,"account")&&u.uint32(10).string(s.account),s.ts!=null&&Object.hasOwnProperty.call(s,"ts")&&u.uint32(16).uint32(s.ts),u},r.decode=function(s,u){s instanceof M||(s=M.create(s)),u=u===void 0?s.len:s.pos+u;for(var l=new I.GroupAllUsersResult.MemberInfo;s.pos<u;){var f=s.uint32();switch(f>>>3){case 1:l.account=s.string();break;case 2:l.ts=s.uint32();break;default:s.skipType(7&f)}}return l},r}(),i}(),LC=I.UserStatusList=function(){function i(r){if(this.users=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.users=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var u=0;u<r.users.length;++u)s.uint32(18).string(r.users[u]);return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserStatusList;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.users&&u.users.length||(u.users=[]),u.users.push(r.string());break;default:r.skipType(7&l)}}return u},i}(),MC=I.UserStatusResult=function(){function i(r){if(this.userInfos=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.userInfos=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.userInfos!=null&&r.userInfos.length)for(var u=0;u<r.userInfos.length;++u)I.UserStatusResult.UserStatusInfo.encode(r.userInfos[u],s.uint32(18).fork()).ldelim();return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserStatusResult;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.userInfos&&u.userInfos.length||(u.userInfos=[]),u.userInfos.push(I.UserStatusResult.UserStatusInfo.decode(r,r.uint32()));break;default:r.skipType(7&l)}}return u},i.UserStatusInfo=function(){function r(s){if(s)for(var u=Object.keys(s),l=0;l<u.length;++l)s[u[l]]!=null&&(this[u[l]]=s[u[l]])}return r.prototype.account="",r.prototype.ts=0,r.encode=function(s,u){return u||(u=ia.create()),s.account!=null&&Object.hasOwnProperty.call(s,"account")&&u.uint32(10).string(s.account),s.ts!=null&&Object.hasOwnProperty.call(s,"ts")&&u.uint32(16).uint32(s.ts),u},r.decode=function(s,u){s instanceof M||(s=M.create(s)),u=u===void 0?s.len:s.pos+u;for(var l=new I.UserStatusResult.UserStatusInfo;s.pos<u;){var f=s.uint32();switch(f>>>3){case 1:l.account=s.string();break;case 2:l.ts=s.uint32();break;default:s.skipType(7&f)}}return l},r}(),i}(),NC=I.UserAttributeGet=function(){function i(r){if(this.attributes=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.attributes=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),r.attributes!=null&&r.attributes.length)for(var u=0;u<r.attributes.length;++u)s.uint32(26).string(r.attributes[u]);return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserAttributeGet;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;case 3:u.attributes&&u.attributes.length||(u.attributes=[]),u.attributes.push(r.string());break;default:r.skipType(7&l)}}return u},i}(),OC=I.UserAttributeRet=function(){function i(r){if(this.attributeInfos=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.attributeInfos=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.attributeInfos!=null&&r.attributeInfos.length)for(var u=0;u<r.attributeInfos.length;++u)I.UserAttributeRet.AttributeInfo.encode(r.attributeInfos[u],s.uint32(18).fork()).ldelim();return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserAttributeRet;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.attributeInfos&&u.attributeInfos.length||(u.attributeInfos=[]),u.attributeInfos.push(I.UserAttributeRet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&l)}}return u},i.AttributeInfo=function(){function r(s){if(s)for(var u=Object.keys(s),l=0;l<u.length;++l)s[u[l]]!=null&&(this[u[l]]=s[u[l]])}return r.prototype.key="",r.prototype.value="",r.encode=function(s,u){return u||(u=ia.create()),s.key!=null&&Object.hasOwnProperty.call(s,"key")&&u.uint32(10).string(s.key),s.value!=null&&Object.hasOwnProperty.call(s,"value")&&u.uint32(18).string(s.value),u},r.decode=function(s,u){s instanceof M||(s=M.create(s)),u=u===void 0?s.len:s.pos+u;for(var l=new I.UserAttributeRet.AttributeInfo;s.pos<u;){var f=s.uint32();switch(f>>>3){case 1:l.key=s.string();break;case 2:l.value=s.string();break;default:s.skipType(7&f)}}return l},r}(),i}(),PC=I.UserAttributeSet=function(){function i(r){if(this.attributeInfos=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.attributeInfos=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),r.attributeInfos!=null&&r.attributeInfos.length)for(var u=0;u<r.attributeInfos.length;++u)I.UserAttributeSet.AttributeInfo.encode(r.attributeInfos[u],s.uint32(26).fork()).ldelim();return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserAttributeSet;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;case 3:u.attributeInfos&&u.attributeInfos.length||(u.attributeInfos=[]),u.attributeInfos.push(I.UserAttributeSet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&l)}}return u},i.AttributeInfo=function(){function r(s){if(s)for(var u=Object.keys(s),l=0;l<u.length;++l)s[u[l]]!=null&&(this[u[l]]=s[u[l]])}return r.prototype.key="",r.prototype.value="",r.encode=function(s,u){return u||(u=ia.create()),s.key!=null&&Object.hasOwnProperty.call(s,"key")&&u.uint32(10).string(s.key),s.value!=null&&Object.hasOwnProperty.call(s,"value")&&u.uint32(18).string(s.value),u},r.decode=function(s,u){s instanceof M||(s=M.create(s)),u=u===void 0?s.len:s.pos+u;for(var l=new I.UserAttributeSet.AttributeInfo;s.pos<u;){var f=s.uint32();switch(f>>>3){case 1:l.key=s.string();break;case 2:l.value=s.string();break;default:s.skipType(7&f)}}return l},r}(),i}(),QC=I.UserAttributeMod=function(){function i(r){if(this.attributeInfos=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.attributeInfos=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),r.attributeInfos!=null&&r.attributeInfos.length)for(var u=0;u<r.attributeInfos.length;++u)I.UserAttributeMod.AttributeInfo.encode(r.attributeInfos[u],s.uint32(26).fork()).ldelim();return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserAttributeMod;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;case 3:u.attributeInfos&&u.attributeInfos.length||(u.attributeInfos=[]),u.attributeInfos.push(I.UserAttributeMod.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&l)}}return u},i.AttributeInfo=function(){function r(s){if(s)for(var u=Object.keys(s),l=0;l<u.length;++l)s[u[l]]!=null&&(this[u[l]]=s[u[l]])}return r.prototype.key="",r.prototype.value="",r.encode=function(s,u){return u||(u=ia.create()),s.key!=null&&Object.hasOwnProperty.call(s,"key")&&u.uint32(10).string(s.key),s.value!=null&&Object.hasOwnProperty.call(s,"value")&&u.uint32(18).string(s.value),u},r.decode=function(s,u){s instanceof M||(s=M.create(s)),u=u===void 0?s.len:s.pos+u;for(var l=new I.UserAttributeMod.AttributeInfo;s.pos<u;){var f=s.uint32();switch(f>>>3){case 1:l.key=s.string();break;case 2:l.value=s.string();break;default:s.skipType(7&f)}}return l},r}(),i}(),RC=I.UserAttributeDel=function(){function i(r){if(this.attributes=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.attributes=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),r.attributes!=null&&r.attributes.length)for(var u=0;u<r.attributes.length;++u)s.uint32(26).string(r.attributes[u]);return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserAttributeDel;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;case 3:u.attributes&&u.attributes.length||(u.attributes=[]),u.attributes.push(r.string());break;default:r.skipType(7&l)}}return u},i}(),SC=I.UserAttributeErr=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.code=0,i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(16).uint32(r.code),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserAttributeErr;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.code=r.uint32();break;default:r.skipType(7&l)}}return u},i}(),TC=I.UserAttributeKeysGet=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserAttributeKeysGet;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;default:r.skipType(7&l)}}return u},i}(),UC=I.UserAttributeKeysRet=function(){function i(r){if(this.keys=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.keys=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.keys!=null&&r.keys.length)for(var u=0;u<r.keys.length;++u)s.uint32(18).string(r.keys[u]);return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserAttributeKeysRet;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.keys&&u.keys.length||(u.keys=[]),u.keys.push(r.string());break;default:r.skipType(7&l)}}return u},i}(),VC=I.UserAttributeRsp=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserAttributeRsp;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;default:r.skipType(7&l)}}return u},i}(),WC=I.GroupStatusList=function(){function i(r){if(this.groups=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.groups=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.groups!=null&&r.groups.length)for(var u=0;u<r.groups.length;++u)s.uint32(18).string(r.groups[u]);return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupStatusList;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.groups&&u.groups.length||(u.groups=[]),u.groups.push(r.string());break;default:r.skipType(7&l)}}return u},i}(),XC=I.GroupStatusResult=function(){function i(r){if(this.groupInfos=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.groupInfos=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.groupInfos!=null&&r.groupInfos.length)for(var u=0;u<r.groupInfos.length;++u)I.GroupStatusResult.GroupInfo.encode(r.groupInfos[u],s.uint32(18).fork()).ldelim();return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupStatusResult;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.groupInfos&&u.groupInfos.length||(u.groupInfos=[]),u.groupInfos.push(I.GroupStatusResult.GroupInfo.decode(r,r.uint32()));break;default:r.skipType(7&l)}}return u},i.GroupInfo=function(){function r(s){if(s)for(var u=Object.keys(s),l=0;l<u.length;++l)s[u[l]]!=null&&(this[u[l]]=s[u[l]])}return r.prototype.group="",r.prototype.memberCount=0,r.encode=function(s,u){return u||(u=ia.create()),s.group!=null&&Object.hasOwnProperty.call(s,"group")&&u.uint32(10).string(s.group),s.memberCount!=null&&Object.hasOwnProperty.call(s,"memberCount")&&u.uint32(16).uint32(s.memberCount),u},r.decode=function(s,u){s instanceof M||(s=M.create(s)),u=u===void 0?s.len:s.pos+u;for(var l=new I.GroupStatusResult.GroupInfo;s.pos<u;){var f=s.uint32();switch(f>>>3){case 1:l.group=s.string();break;case 2:l.memberCount=s.uint32();break;default:s.skipType(7&f)}}return l},r}(),i}(),YC=I.GroupCountNotice=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.size=0,i.encode=function(r,s){return s||(s=ia.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(16).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(26).string(r.group),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&s.uint32(32).uint32(r.size),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupCountNotice;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.instance=r.uint64();break;case 2:u.seq=r.uint64();break;case 3:u.group=r.string();break;case 4:u.size=r.uint32();break;default:r.skipType(7&l)}}return u},i}(),ZC=I.GroupAttributeGet=function(){function i(r){if(this.attributes=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.attributes=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),r.attributes!=null&&r.attributes.length)for(var u=0;u<r.attributes.length;++u)s.uint32(26).string(r.attributes[u]);return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupAttributeGet;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;case 3:u.attributes&&u.attributes.length||(u.attributes=[]),u.attributes.push(r.string());break;default:r.skipType(7&l)}}return u},i}(),$C=I.GroupAttributeRet=function(){function i(r){if(this.attributeMaps=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.attributeMaps=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.attributeMaps!=null&&r.attributeMaps.length)for(var u=0;u<r.attributeMaps.length;++u)I.GroupAttributeRet.AttributeMap.encode(r.attributeMaps[u],s.uint32(18).fork()).ldelim();return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupAttributeRet;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.attributeMaps&&u.attributeMaps.length||(u.attributeMaps=[]),u.attributeMaps.push(I.GroupAttributeRet.AttributeMap.decode(r,r.uint32()));break;default:r.skipType(7&l)}}return u},i.AttributeMap=function(){function r(s){if(s)for(var u=Object.keys(s),l=0;l<u.length;++l)s[u[l]]!=null&&(this[u[l]]=s[u[l]])}return r.prototype.key="",r.prototype.value="",r.prototype.origin="",r.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,r.encode=function(s,u){return u||(u=ia.create()),s.key!=null&&Object.hasOwnProperty.call(s,"key")&&u.uint32(10).string(s.key),s.value!=null&&Object.hasOwnProperty.call(s,"value")&&u.uint32(18).string(s.value),s.origin!=null&&Object.hasOwnProperty.call(s,"origin")&&u.uint32(26).string(s.origin),s.ms!=null&&Object.hasOwnProperty.call(s,"ms")&&u.uint32(32).uint64(s.ms),u},r.decode=function(s,u){s instanceof M||(s=M.create(s)),u=u===void 0?s.len:s.pos+u;for(var l=new I.GroupAttributeRet.AttributeMap;s.pos<u;){var f=s.uint32();switch(f>>>3){case 1:l.key=s.string();break;case 2:l.value=s.string();break;case 3:l.origin=s.string();break;case 4:l.ms=s.uint64();break;default:s.skipType(7&f)}}return l},r}(),i}(),aD=I.GroupAttributeSet=function(){function i(r){if(this.attributeInfos=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.broadcast=!1,i.prototype.attributeInfos=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&s.uint32(24).bool(r.broadcast),r.attributeInfos!=null&&r.attributeInfos.length)for(var u=0;u<r.attributeInfos.length;++u)I.GroupAttributeSet.AttributeInfo.encode(r.attributeInfos[u],s.uint32(34).fork()).ldelim();return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupAttributeSet;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;case 3:u.broadcast=r.bool();break;case 4:u.attributeInfos&&u.attributeInfos.length||(u.attributeInfos=[]),u.attributeInfos.push(I.GroupAttributeSet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&l)}}return u},i.AttributeInfo=function(){function r(s){if(s)for(var u=Object.keys(s),l=0;l<u.length;++l)s[u[l]]!=null&&(this[u[l]]=s[u[l]])}return r.prototype.key="",r.prototype.value="",r.encode=function(s,u){return u||(u=ia.create()),s.key!=null&&Object.hasOwnProperty.call(s,"key")&&u.uint32(10).string(s.key),s.value!=null&&Object.hasOwnProperty.call(s,"value")&&u.uint32(18).string(s.value),u},r.decode=function(s,u){s instanceof M||(s=M.create(s)),u=u===void 0?s.len:s.pos+u;for(var l=new I.GroupAttributeSet.AttributeInfo;s.pos<u;){var f=s.uint32();switch(f>>>3){case 1:l.key=s.string();break;case 2:l.value=s.string();break;default:s.skipType(7&f)}}return l},r}(),i}(),bD=I.GroupAttributeMod=function(){function i(r){if(this.attributeInfos=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.broadcast=!1,i.prototype.attributeInfos=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&s.uint32(24).bool(r.broadcast),r.attributeInfos!=null&&r.attributeInfos.length)for(var u=0;u<r.attributeInfos.length;++u)I.GroupAttributeMod.AttributeInfo.encode(r.attributeInfos[u],s.uint32(34).fork()).ldelim();return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupAttributeMod;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;case 3:u.broadcast=r.bool();break;case 4:u.attributeInfos&&u.attributeInfos.length||(u.attributeInfos=[]),u.attributeInfos.push(I.GroupAttributeMod.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&l)}}return u},i.AttributeInfo=function(){function r(s){if(s)for(var u=Object.keys(s),l=0;l<u.length;++l)s[u[l]]!=null&&(this[u[l]]=s[u[l]])}return r.prototype.key="",r.prototype.value="",r.encode=function(s,u){return u||(u=ia.create()),s.key!=null&&Object.hasOwnProperty.call(s,"key")&&u.uint32(10).string(s.key),s.value!=null&&Object.hasOwnProperty.call(s,"value")&&u.uint32(18).string(s.value),u},r.decode=function(s,u){s instanceof M||(s=M.create(s)),u=u===void 0?s.len:s.pos+u;for(var l=new I.GroupAttributeMod.AttributeInfo;s.pos<u;){var f=s.uint32();switch(f>>>3){case 1:l.key=s.string();break;case 2:l.value=s.string();break;default:s.skipType(7&f)}}return l},r}(),i}(),cD=I.GroupAttributeDel=function(){function i(r){if(this.attributes=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.broadcast=!1,i.prototype.attributes=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&s.uint32(24).bool(r.broadcast),r.attributes!=null&&r.attributes.length)for(var u=0;u<r.attributes.length;++u)s.uint32(34).string(r.attributes[u]);return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupAttributeDel;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;case 3:u.broadcast=r.bool();break;case 4:u.attributes&&u.attributes.length||(u.attributes=[]),u.attributes.push(r.string());break;default:r.skipType(7&l)}}return u},i}(),dD=I.GroupAttributeAlt=function(){function i(r){if(this.attributeMaps=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.attributeMaps=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(24).uint64(r.instance),r.attributeMaps!=null&&r.attributeMaps.length)for(var u=0;u<r.attributeMaps.length;++u)I.GroupAttributeAlt.AttributeMap.encode(r.attributeMaps[u],s.uint32(34).fork()).ldelim();return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupAttributeAlt;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;case 3:u.instance=r.uint64();break;case 4:u.attributeMaps&&u.attributeMaps.length||(u.attributeMaps=[]),u.attributeMaps.push(I.GroupAttributeAlt.AttributeMap.decode(r,r.uint32()));break;default:r.skipType(7&l)}}return u},i.AttributeMap=function(){function r(s){if(s)for(var u=Object.keys(s),l=0;l<u.length;++l)s[u[l]]!=null&&(this[u[l]]=s[u[l]])}return r.prototype.key="",r.prototype.value="",r.prototype.origin="",r.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,r.encode=function(s,u){return u||(u=ia.create()),s.key!=null&&Object.hasOwnProperty.call(s,"key")&&u.uint32(10).string(s.key),s.value!=null&&Object.hasOwnProperty.call(s,"value")&&u.uint32(18).string(s.value),s.origin!=null&&Object.hasOwnProperty.call(s,"origin")&&u.uint32(26).string(s.origin),s.ms!=null&&Object.hasOwnProperty.call(s,"ms")&&u.uint32(32).uint64(s.ms),u},r.decode=function(s,u){s instanceof M||(s=M.create(s)),u=u===void 0?s.len:s.pos+u;for(var l=new I.GroupAttributeAlt.AttributeMap;s.pos<u;){var f=s.uint32();switch(f>>>3){case 1:l.key=s.string();break;case 2:l.value=s.string();break;case 3:l.origin=s.string();break;case 4:l.ms=s.uint64();break;default:s.skipType(7&f)}}return l},r}(),i}(),eD=I.GroupAttributeRsp=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupAttributeRsp;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;default:r.skipType(7&l)}}return u},i}(),fD=I.GroupAttributeErr=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.code=0,i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(16).uint32(r.code),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupAttributeErr;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.code=r.uint32();break;default:r.skipType(7&l)}}return u},i}(),gD=I.GroupAttributeKeysGet=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.encode=function(r,s){return s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupAttributeKeysGet;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;default:r.skipType(7&l)}}return u},i}(),hD=I.GroupAttributeKeysRet=function(){function i(r){if(this.keys=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.keys=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.keys!=null&&r.keys.length)for(var u=0;u<r.keys.length;++u)s.uint32(18).string(r.keys[u]);return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.GroupAttributeKeysRet;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.keys&&u.keys.length||(u.keys=[]),u.keys.push(r.string());break;default:r.skipType(7&l)}}return u},i}(),iD=I.SubscribeUserStatus=function(){function i(r){if(this.users=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.users=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var u=0;u<r.users.length;++u)s.uint32(18).string(r.users[u]);return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.SubscribeUserStatus;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.users&&u.users.length||(u.users=[]),u.users.push(r.string());break;default:r.skipType(7&l)}}return u},i}(),jD=I.UnsubscribeUserStatus=function(){function i(r){if(this.users=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.users=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var u=0;u<r.users.length;++u)s.uint32(18).string(r.users[u]);return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UnsubscribeUserStatus;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.users&&u.users.length||(u.users=[]),u.users.push(r.string());break;default:r.skipType(7&l)}}return u},i}(),kD=I.UserJoinNotice=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.user="",i.encode=function(r,s){return s||(s=ia.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&s.uint32(26).string(r.user),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserJoinNotice;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.instance=r.uint64();break;case 2:u.seq=r.uint64();break;case 3:u.user=r.string();break;default:r.skipType(7&l)}}return u},i}(),lD=I.UserQuitNotice=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.user="",i.encode=function(r,s){return s||(s=ia.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&s.uint32(26).string(r.user),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserQuitNotice;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.instance=r.uint64();break;case 2:u.seq=r.uint64();break;case 3:u.user=r.string();break;default:r.skipType(7&l)}}return u},i}(),mD=I.UserWaitNotice=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.user="",i.encode=function(r,s){return s||(s=ia.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&s.uint32(26).string(r.user),s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.UserWaitNotice;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.instance=r.uint64();break;case 2:u.seq=r.uint64();break;case 3:u.user=r.string();break;default:r.skipType(7&l)}}return u},i}(),nD=I.SubscribeResponse=function(){function i(r){if(this.errors=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.errors=D.emptyArray,i.encode=function(r,s){if(s||(s=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.errors!=null&&r.errors.length)for(var u=0;u<r.errors.length;++u)I.SubscribeResponse.SubscribeErrorsType.encode(r.errors[u],s.uint32(18).fork()).ldelim();return s},i.decode=function(r,s){r instanceof M||(r=M.create(r)),s=s===void 0?r.len:r.pos+s;for(var u=new I.SubscribeResponse;r.pos<s;){var l=r.uint32();switch(l>>>3){case 1:u.seq=r.uint64();break;case 2:u.errors&&u.errors.length||(u.errors=[]),u.errors.push(I.SubscribeResponse.SubscribeErrorsType.decode(r,r.uint32()));break;default:r.skipType(7&l)}}return u},i.SubscribeErrorsType=function(){function r(s){if(s)for(var u=Object.keys(s),l=0;l<u.length;++l)s[u[l]]!=null&&(this[u[l]]=s[u[l]])}return r.prototype.account="",r.prototype.code=0,r.encode=function(s,u){return u||(u=ia.create()),s.account!=null&&Object.hasOwnProperty.call(s,"account")&&u.uint32(10).string(s.account),s.code!=null&&Object.hasOwnProperty.call(s,"code")&&u.uint32(16).uint32(s.code),u},r.decode=function(s,u){s instanceof M||(s=M.create(s)),u=u===void 0?s.len:s.pos+u;for(var l=new I.SubscribeResponse.SubscribeErrorsType;s.pos<u;){var f=s.uint32();switch(f>>>3){case 1:l.account=s.string();break;case 2:l.code=s.uint32();break;default:s.skipType(7&f)}}return l},r}(),i}(),oD=Object.freeze({__proto__:null,URI:vC,Wrapper:wi,Ping:wC,Pong:xC,UserJoin:yC,UserResp:zC,UserQuit:AC,UserDrop:BC,UserTicketNearlyExpire:CC,UserRenewTokenReq:DC,UserRenewTokenResp:EC,GroupEnter:FC,GroupLeave:GC,GroupReply:HC,GroupLeaveNotice:vs,GroupEnterNotice:ws,Message:xs,Ack:ys,GroupDrop:IC,GroupAllUsersList:JC,GroupAllUsersResult:KC,UserStatusList:LC,UserStatusResult:MC,UserAttributeGet:NC,UserAttributeRet:OC,UserAttributeSet:PC,UserAttributeMod:QC,UserAttributeDel:RC,UserAttributeErr:SC,UserAttributeKeysGet:TC,UserAttributeKeysRet:UC,UserAttributeRsp:VC,GroupStatusList:WC,GroupStatusResult:XC,GroupCountNotice:YC,GroupAttributeGet:ZC,GroupAttributeRet:$C,GroupAttributeSet:aD,GroupAttributeMod:bD,GroupAttributeDel:cD,GroupAttributeAlt:dD,GroupAttributeRsp:eD,GroupAttributeErr:fD,GroupAttributeKeysGet:gD,GroupAttributeKeysRet:hD,SubscribeUserStatus:iD,UnsubscribeUserStatus:jD,UserJoinNotice:kD,UserQuitNotice:lD,UserWaitNotice:mD,SubscribeResponse:nD,default:I}),pD=Math.ceil,zs=function(i){return function(r,s,u){var l=(r=String(Eb(r))).length;return u=u===void 0?" ":String(u),(s=Ma(s))<=l||u==""?r:(s-=l,(l=Yo.call(u,pD(s/u.length))).length>s&&(l=l.slice(0,s)),i?r+l:l+r)}},qD=zs(!1),rD=zs(!0),As=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(df);ea({target:"String",proto:!0,forced:As},{padEnd:function(i){return rD(this,i,1<arguments.length?arguments[1]:void 0)}});var sD=eg,Bs=function(i){return function(r){r=Mb(r);for(var s,u=ed(r),l=u.length,f=0,E=[];l>f;)s=u[f++],wa&&!sD.call(r,s)||E.push(i?[s,r[s]]:r[s]);return E}},tD=Bs(!0),uD=Bs(!1);ea({target:"Object",stat:!0},{entries:function(i){return tD(i)}});var vD=dc.f,Cs="".endsWith,wD=Math.min,Ds=Qk("endsWith"),xD=!Ds&&!!function(){var i=vD(String.prototype,"endsWith");return i&&!i.writable}();ea({target:"String",proto:!0,forced:!xD&&!Ds},{endsWith:function(i){var r=String(Eb(this));Pk(i);var s=1<arguments.length?arguments[1]:void 0,u=Ma(r.length);return s=s===void 0?u:wD(Ma(s),u),u=String(i),Cs?Cs.call(r,u,s):r.slice(s-u.length,s)===u}}),Bh("match",1,function(i,r,s){return[function(u){var l=Eb(this),f=u==null?void 0:u[i];return f!==void 0?f.call(u,l):new RegExp(u)[i](String(l))},function(u){var l=s(r,u,this);if(l.done)return l.value;if(u=Ia(u),l=String(this),!u.global)return ef(u,l);var f=u.unicode;u.lastIndex=0;for(var E,T=[],v=0;(E=ef(u,l))!==null;)E=String(E[0]),T[v]=E,E===""&&(u.lastIndex=Mj(l,Ma(u.lastIndex),f)),v++;return v===0?null:T}]});var yD=dc.f,Es="".startsWith,zD=Math.min,Fs=Qk("startsWith"),AD=!Fs&&!!function(){var i=yD(String.prototype,"startsWith");return i&&!i.writable}();ea({target:"String",proto:!0,forced:!AD&&!Fs},{startsWith:function(i){var r=String(Eb(this));Pk(i);var s=Ma(zD(1<arguments.length?arguments[1]:void 0,r.length)),u=String(i);return Es?Es.call(r,u,s):r.slice(s,s+u.length)===u}});var Wn=function(i){var r=/(%?)(%([jds]))/g,s=Array.prototype.slice.call(arguments,1);return s.length&&(i=i.replace(r,function(u,l,f,E){switch(f=s.shift(),E){case"s":f=""+f;break;case"d":f=Number(f);break;case"j":f=JSON.stringify(f)}return l?(s.unshift(f),u):f})),s.length&&(i+=" "+s.join(" ")),""+(i=i.replace(/%{2,2}/g,"%"))},BD=/\s/,CD=/^\s+/,Gs=NaN,DD=/^[-+]0x[0-9a-f]+$/i,ED=/^0b[01]+$/i,FD=/^0o[0-7]+$/i,GD=parseInt,xi=function(i){if(typeof i=="number")return i;if(Ke(i))return Gs;if(Gb(i)&&(i=typeof i.valueOf=="function"?i.valueOf():i,i=Gb(i)?i+"":i),typeof i!="string")return i===0?i:+i;if(i){for(var r=i.slice,s=i.length;s--&&BD.test(i.charAt(s)););i=r.call(i,0,s+1).replace(CD,"")}return(r=ED.test(i))||FD.test(i)?GD(i.slice(2),r?2:8):DD.test(i)?Gs:+i},HD=Math.max,ID=Math.min,JD=function(i,r,s){function u(ga){var _d=v,d_=w;return v=w=void 0,X=ga,k=i.apply(d_,_d)}function l(ga){var _d=ga-Q;return ga-=X,Q===void 0||_d>=r||0>_d||aa&&ga>=_a}function f(){var ga=$b.Date.now();if(l(ga))return E(ga);var _d=setTimeout,d_=ga-X;ga=r-(ga-Q),d_=aa?ID(ga,_a-d_):ga,B=_d(f,d_)}function E(ga){return B=void 0,_i&&v?u(ga):(v=w=void 0,k)}function T(){var ga=$b.Date.now(),_d=l(ga);if(v=arguments,w=this,Q=ga,_d){if(B===void 0)return X=ga=Q,B=setTimeout(f,r),_e?u(ga):k;if(aa)return clearTimeout(B),B=setTimeout(f,r),u(Q)}return B===void 0&&(B=setTimeout(f,r)),k}var v,w,k,B,Q,X=0,_e=!1,aa=!1,_i=!0;if(typeof i!="function")throw new TypeError("Expected a function");if(r=xi(r)||0,Gb(s)){_e=!!s.leading;var _a=(aa="maxWait"in s)?HD(xi(s.maxWait)||0,r):_a;_i="trailing"in s?!!s.trailing:_i}return T.cancel=function(){B!==void 0&&clearTimeout(B),X=0,v=Q=w=B=void 0},T.flush=function(){return B===void 0?k:E($b.Date.now())},T},KD=Math.max,LD=Math.min,Hs=1/0,Rl=function(i){return i?(i=xi(i))===Hs||i===-Hs?17976931348623157e292*(0>i?-1:1):i==i?i:0:i===0?i:0},Is=function(i,r,s){return r=Rl(r),s===void 0?(s=r,r=0):s=Rl(s),(i=xi(i))>=LD(r,s)&&i<KD(r,s)},ac=Gc.Writer,H=Gc.util,Pb=Gc.roots.default||(Gc.roots.default={}),MD=Pb.Session=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.appId="",i.prototype.ver="",i.prototype.buildno=0,i.prototype.installId="",i.prototype.os=0,i.prototype.did="",i.prototype.index=null,i.prototype.token="",i.prototype.version=0,i.prototype.subVersion=0,i.encode=function(r,s){return s||(s=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.appId!=null&&Object.hasOwnProperty.call(r,"appId")&&s.uint32(42).string(r.appId),r.ver!=null&&Object.hasOwnProperty.call(r,"ver")&&s.uint32(50).string(r.ver),r.buildno!=null&&Object.hasOwnProperty.call(r,"buildno")&&s.uint32(56).int32(r.buildno),r.installId!=null&&Object.hasOwnProperty.call(r,"installId")&&s.uint32(66).string(r.installId),r.os!=null&&Object.hasOwnProperty.call(r,"os")&&s.uint32(128).int32(r.os),r.did!=null&&Object.hasOwnProperty.call(r,"did")&&s.uint32(138).string(r.did),r.index!=null&&Object.hasOwnProperty.call(r,"index")&&Pb.Session.CommonIndex.encode(r.index,s.uint32(162).fork()).ldelim(),r.token!=null&&Object.hasOwnProperty.call(r,"token")&&s.uint32(170).string(r.token),r.version!=null&&Object.hasOwnProperty.call(r,"version")&&s.uint32(176).int32(r.version),r.subVersion!=null&&Object.hasOwnProperty.call(r,"subVersion")&&s.uint32(184).int32(r.subVersion),s},i.CommonIndex=function(){function r(s){if(s)for(var u=Object.keys(s),l=0;l<u.length;++l)s[u[l]]!=null&&(this[u[l]]=s[u[l]])}return r.prototype.index1="",r.prototype.index2="",r.prototype.index3="",r.encode=function(s,u){return u||(u=ac.create()),s.index1!=null&&Object.hasOwnProperty.call(s,"index1")&&u.uint32(10).string(s.index1),s.index2!=null&&Object.hasOwnProperty.call(s,"index2")&&u.uint32(18).string(s.index2),s.index3!=null&&Object.hasOwnProperty.call(s,"index3")&&u.uint32(26).string(s.index3),u},r}(),i}(),ND=Pb.ApEvent=function(){function i(r){if(this.linkServerList=[],r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.apAddr="",i.prototype.linkServerList=H.emptyArray,i.prototype.errCode=0,i.prototype.serverErrCode=0,i.prototype.isp="",i.prototype.opId=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.envId=0,i.prototype.flag=0,i.prototype.area="",i.encode=function(r,s){if(s||(s=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.apAddr!=null&&Object.hasOwnProperty.call(r,"apAddr")&&s.uint32(50).string(r.apAddr),r.linkServerList!=null&&r.linkServerList.length)for(var u=0;u<r.linkServerList.length;++u)s.uint32(58).string(r.linkServerList[u]);return r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&s.uint32(72).int32(r.errCode),r.serverErrCode!=null&&Object.hasOwnProperty.call(r,"serverErrCode")&&s.uint32(80).int32(r.serverErrCode),r.isp!=null&&Object.hasOwnProperty.call(r,"isp")&&s.uint32(90).string(r.isp),r.opId!=null&&Object.hasOwnProperty.call(r,"opId")&&s.uint32(96).int64(r.opId),r.envId!=null&&Object.hasOwnProperty.call(r,"envId")&&s.uint32(104).int32(r.envId),r.flag!=null&&Object.hasOwnProperty.call(r,"flag")&&s.uint32(112).int32(r.flag),r.area!=null&&Object.hasOwnProperty.call(r,"area")&&s.uint32(122).string(r.area),s},i}(),OD=Pb.ApRequest=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.apAddr="",i.prototype.opId=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.envId=0,i.prototype.flag=0,i.encode=function(r,s){return s||(s=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.apAddr!=null&&Object.hasOwnProperty.call(r,"apAddr")&&s.uint32(42).string(r.apAddr),r.opId!=null&&Object.hasOwnProperty.call(r,"opId")&&s.uint32(48).int64(r.opId),r.envId!=null&&Object.hasOwnProperty.call(r,"envId")&&s.uint32(56).int32(r.envId),r.flag!=null&&Object.hasOwnProperty.call(r,"flag")&&s.uint32(64).int32(r.flag),s},i}(),PD=Pb.LinkLoginRequest=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.destServerIp="",i.prototype.linkId=0,i.encode=function(r,s){return s||(s=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.destServerIp!=null&&Object.hasOwnProperty.call(r,"destServerIp")&&s.uint32(42).string(r.destServerIp),r.linkId!=null&&Object.hasOwnProperty.call(r,"linkId")&&s.uint32(48).int32(r.linkId),s},i}(),QD=Pb.Link=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.ec=0,i.prototype.sc=0,i.prototype.destServerIp="",i.prototype.ackedServerIp="",i.prototype.responseTime=0,i.encode=function(r,s){return s||(s=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.ec!=null&&Object.hasOwnProperty.call(r,"ec")&&s.uint32(40).int32(r.ec),r.sc!=null&&Object.hasOwnProperty.call(r,"sc")&&s.uint32(48).int32(r.sc),r.destServerIp!=null&&Object.hasOwnProperty.call(r,"destServerIp")&&s.uint32(58).string(r.destServerIp),r.ackedServerIp!=null&&Object.hasOwnProperty.call(r,"ackedServerIp")&&s.uint32(66).string(r.ackedServerIp),r.responseTime!=null&&Object.hasOwnProperty.call(r,"responseTime")&&s.uint32(72).int32(r.responseTime),s},i}(),RD=Pb.Logout=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.encode=function(r,s){return s||(s=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),s},i}(),SD=Pb.KickedOff=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.linkId=0,i.prototype.code=0,i.prototype.server="",i.prototype.serverCode=0,i.encode=function(r,s){return s||(s=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.linkId!=null&&Object.hasOwnProperty.call(r,"linkId")&&s.uint32(48).int32(r.linkId),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(56).int32(r.code),r.server!=null&&Object.hasOwnProperty.call(r,"server")&&s.uint32(66).string(r.server),r.serverCode!=null&&Object.hasOwnProperty.call(r,"serverCode")&&s.uint32(72).int32(r.serverCode),s},i}(),TD=Pb.ChnJoin=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.cname="",i.prototype.errCode=0,i.encode=function(r,s){return s||(s=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&s.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&s.uint32(56).int32(r.errCode),s},i}(),UD=Pb.ChnJoinRes=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.cname="",i.prototype.errCode=0,i.prototype.serverErrCode=0,i.encode=function(r,s){return s||(s=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&s.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&s.uint32(56).int32(r.errCode),r.serverErrCode!=null&&Object.hasOwnProperty.call(r,"serverErrCode")&&s.uint32(64).int32(r.serverErrCode),s},i}(),VD=Pb.ChnLeave=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.cname="",i.prototype.errCode=0,i.encode=function(r,s){return s||(s=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&s.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&s.uint32(56).int32(r.errCode),s},i}(),WD=Pb.ConnectionStateChange=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.oldState=0,i.prototype.newState=0,i.prototype.reason=0,i.prototype.reconnId=0,i.encode=function(r,s){return s||(s=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.oldState!=null&&Object.hasOwnProperty.call(r,"oldState")&&s.uint32(40).int32(r.oldState),r.newState!=null&&Object.hasOwnProperty.call(r,"newState")&&s.uint32(48).int32(r.newState),r.reason!=null&&Object.hasOwnProperty.call(r,"reason")&&s.uint32(56).int32(r.reason),r.reconnId!=null&&Object.hasOwnProperty.call(r,"reconnId")&&s.uint32(64).int32(r.reconnId),s},i}(),Js=Pb.RtmSdkMessageCount=function(){function i(r){if(r)for(var s=Object.keys(r),u=0;u<s.length;++u)r[s[u]]!=null&&(this[s[u]]=r[s[u]])}return i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.vid=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.sid="",i.prototype.messagecategory=0,i.prototype.reportsequence=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.sentcount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.receivedcount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack10mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack25mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack50mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack75mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack100mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack150mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack200mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack250mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack300mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack400mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack500mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack600mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack800mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack1000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack2000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack3000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack5000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack7000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerackslowcount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack10mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack25mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack50mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack75mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack100mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack150mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack200mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack250mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack300mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack400mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack500mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack600mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack800mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack1000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack2000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack3000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack5000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack7000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientackslowcount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.acktimeoutcount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.apimajorversion=0,i.prototype.apiminorversion=0,i.prototype.os=0,i.prototype.toooftencount=0,i.prototype.receiverofflinecount=0,i.prototype.invalidmessagecount=0,i.prototype.unknowerrorcount=0,i.prototype.servercachedcount=0,i.prototype.timeoutcount=0,i.prototype.successcount=0,i.prototype.userid="",i.encode=function(r,s){return s||(s=ac.create()),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(8).int64(r.lts),r.vid!=null&&Object.hasOwnProperty.call(r,"vid")&&s.uint32(16).int64(r.vid),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(26).string(r.sid),r.messagecategory!=null&&Object.hasOwnProperty.call(r,"messagecategory")&&s.uint32(32).int32(r.messagecategory),r.reportsequence!=null&&Object.hasOwnProperty.call(r,"reportsequence")&&s.uint32(40).int64(r.reportsequence),r.sentcount!=null&&Object.hasOwnProperty.call(r,"sentcount")&&s.uint32(48).int64(r.sentcount),r.receivedcount!=null&&Object.hasOwnProperty.call(r,"receivedcount")&&s.uint32(56).int64(r.receivedcount),r.peerack10mscount!=null&&Object.hasOwnProperty.call(r,"peerack10mscount")&&s.uint32(64).int64(r.peerack10mscount),r.peerack25mscount!=null&&Object.hasOwnProperty.call(r,"peerack25mscount")&&s.uint32(72).int64(r.peerack25mscount),r.peerack50mscount!=null&&Object.hasOwnProperty.call(r,"peerack50mscount")&&s.uint32(80).int64(r.peerack50mscount),r.peerack75mscount!=null&&Object.hasOwnProperty.call(r,"peerack75mscount")&&s.uint32(88).int64(r.peerack75mscount),r.peerack100mscount!=null&&Object.hasOwnProperty.call(r,"peerack100mscount")&&s.uint32(96).int64(r.peerack100mscount),r.peerack150mscount!=null&&Object.hasOwnProperty.call(r,"peerack150mscount")&&s.uint32(104).int64(r.peerack150mscount),r.peerack200mscount!=null&&Object.hasOwnProperty.call(r,"peerack200mscount")&&s.uint32(112).int64(r.peerack200mscount),r.peerack250mscount!=null&&Object.hasOwnProperty.call(r,"peerack250mscount")&&s.uint32(120).int64(r.peerack250mscount),r.peerack300mscount!=null&&Object.hasOwnProperty.call(r,"peerack300mscount")&&s.uint32(128).int64(r.peerack300mscount),r.peerack400mscount!=null&&Object.hasOwnProperty.call(r,"peerack400mscount")&&s.uint32(136).int64(r.peerack400mscount),r.peerack500mscount!=null&&Object.hasOwnProperty.call(r,"peerack500mscount")&&s.uint32(144).int64(r.peerack500mscount),r.peerack600mscount!=null&&Object.hasOwnProperty.call(r,"peerack600mscount")&&s.uint32(152).int64(r.peerack600mscount),r.peerack800mscount!=null&&Object.hasOwnProperty.call(r,"peerack800mscount")&&s.uint32(160).int64(r.peerack800mscount),r.peerack1000mscount!=null&&Object.hasOwnProperty.call(r,"peerack1000mscount")&&s.uint32(168).int64(r.peerack1000mscount),r.peerack2000mscount!=null&&Object.hasOwnProperty.call(r,"peerack2000mscount")&&s.uint32(176).int64(r.peerack2000mscount),r.peerack3000mscount!=null&&Object.hasOwnProperty.call(r,"peerack3000mscount")&&s.uint32(184).int64(r.peerack3000mscount),r.peerack5000mscount!=null&&Object.hasOwnProperty.call(r,"peerack5000mscount")&&s.uint32(192).int64(r.peerack5000mscount),r.peerack7000mscount!=null&&Object.hasOwnProperty.call(r,"peerack7000mscount")&&s.uint32(200).int64(r.peerack7000mscount),r.peerackslowcount!=null&&Object.hasOwnProperty.call(r,"peerackslowcount")&&s.uint32(208).int64(r.peerackslowcount),r.norecipientack10mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack10mscount")&&s.uint32(216).int64(r.norecipientack10mscount),r.norecipientack25mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack25mscount")&&s.uint32(224).int64(r.norecipientack25mscount),r.norecipientack50mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack50mscount")&&s.uint32(232).int64(r.norecipientack50mscount),r.norecipientack75mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack75mscount")&&s.uint32(240).int64(r.norecipientack75mscount),r.norecipientack100mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack100mscount")&&s.uint32(248).int64(r.norecipientack100mscount),r.norecipientack150mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack150mscount")&&s.uint32(256).int64(r.norecipientack150mscount),r.norecipientack200mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack200mscount")&&s.uint32(264).int64(r.norecipientack200mscount),r.norecipientack250mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack250mscount")&&s.uint32(272).int64(r.norecipientack250mscount),r.norecipientack300mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack300mscount")&&s.uint32(280).int64(r.norecipientack300mscount),r.norecipientack400mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack400mscount")&&s.uint32(288).int64(r.norecipientack400mscount),r.norecipientack500mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack500mscount")&&s.uint32(296).int64(r.norecipientack500mscount),r.norecipientack600mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack600mscount")&&s.uint32(304).int64(r.norecipientack600mscount),r.norecipientack800mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack800mscount")&&s.uint32(312).int64(r.norecipientack800mscount),r.norecipientack1000mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack1000mscount")&&s.uint32(320).int64(r.norecipientack1000mscount),r.norecipientack2000mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack2000mscount")&&s.uint32(328).int64(r.norecipientack2000mscount),r.norecipientack3000mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack3000mscount")&&s.uint32(336).int64(r.norecipientack3000mscount),r.norecipientack5000mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack5000mscount")&&s.uint32(344).int64(r.norecipientack5000mscount),r.norecipientack7000mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack7000mscount")&&s.uint32(352).int64(r.norecipientack7000mscount),r.norecipientackslowcount!=null&&Object.hasOwnProperty.call(r,"norecipientackslowcount")&&s.uint32(360).int64(r.norecipientackslowcount),r.acktimeoutcount!=null&&Object.hasOwnProperty.call(r,"acktimeoutcount")&&s.uint32(368).int64(r.acktimeoutcount),r.apimajorversion!=null&&Object.hasOwnProperty.call(r,"apimajorversion")&&s.uint32(376).int32(r.apimajorversion),r.apiminorversion!=null&&Object.hasOwnProperty.call(r,"apiminorversion")&&s.uint32(384).int32(r.apiminorversion),r.os!=null&&Object.hasOwnProperty.call(r,"os")&&s.uint32(392).int32(r.os),r.toooftencount!=null&&Object.hasOwnProperty.call(r,"toooftencount")&&s.uint32(400).int32(r.toooftencount),r.receiverofflinecount!=null&&Object.hasOwnProperty.call(r,"receiverofflinecount")&&s.uint32(408).int32(r.receiverofflinecount),r.invalidmessagecount!=null&&Object.hasOwnProperty.call(r,"invalidmessagecount")&&s.uint32(416).int32(r.invalidmessagecount),r.unknowerrorcount!=null&&Object.hasOwnProperty.call(r,"unknowerrorcount")&&s.uint32(424).int32(r.unknowerrorcount),r.servercachedcount!=null&&Object.hasOwnProperty.call(r,"servercachedcount")&&s.uint32(432).int32(r.servercachedcount),r.timeoutcount!=null&&Object.hasOwnProperty.call(r,"timeoutcount")&&s.uint32(440).int32(r.timeoutcount),r.successcount!=null&&Object.hasOwnProperty.call(r,"successcount")&&s.uint32(448).int32(r.successcount),r.userid!=null&&Object.hasOwnProperty.call(r,"userid")&&s.uint32(458).string(r.userid),s},i}(),Iv=Object.freeze({__proto__:null,Session:MD,ApEvent:ND,ApRequest:OD,LinkLoginRequest:PD,Link:QD,Logout:RD,KickedOff:SD,ChnJoin:TD,ChnJoinRes:UD,ChnLeave:VD,ConnectionStateChange:WD,RtmSdkMessageCount:Js,default:Pb}),XD=la(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});ea({target:"Date",proto:!0,forced:XD},{toJSON:function(i){i=pb(this);var r=Oc(i);return typeof r!="number"||isFinite(r)?i.toISOString():null}}),ea({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var Ev=Object.prototype.hasOwnProperty,Ks=function(i,r,s){return JSON.stringify(Mn(i),r,s)};Ks.ensureProperties=Mn;var YD=function(i,r){r=r||{};var s=qa(i);if(s==="string"&&0<i.length)return Fv(i);if(s==="number"&&isFinite(i))return r.long?i=864e5<=(r=Math.abs(i))?jh(i,r,864e5,"day"):36e5<=r?jh(i,r,36e5,"hour"):6e4<=r?jh(i,r,6e4,"minute"):1e3<=r?jh(i,r,1e3,"second"):i+" ms":i=864e5<=(r=Math.abs(i))?Math.round(i/864e5)+"d":36e5<=r?Math.round(i/36e5)+"h":6e4<=r?Math.round(i/6e4)+"m":1e3<=r?Math.round(i/1e3)+"s":i+"ms",i;throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(i))},ZD=function(i){function r(l){function f(){for(var v=arguments.length,w=Array(v),k=0;k<v;k++)w[k]=arguments[k];if(f.enabled){v=Number(new Date),f.diff=v-(E||v),f.prev=E,E=f.curr=v,w[0]=r.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");var B=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,function(Q,X){return Q==="%%"?"%":(B++,typeof(X=r.formatters[X])=="function"&&(Q=X.call(f,w[B]),w.splice(B,1),B--),Q)}),r.formatArgs.call(f,w),(f.log||r.log).apply(f,w)}}var E,T=null;return f.namespace=l,f.useColors=r.useColors(),f.color=r.selectColor(l),f.extend=s,f.destroy=r.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:function(){return T===null?r.enabled(l):T},set:function(v){T=v}}),typeof r.init=="function"&&r.init(f),f}function s(l,f){return(l=r(this.namespace+(f===void 0?":":f)+l)).log=this.log,l}function u(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(l){return l instanceof Error?l.stack||l.message:l},r.disable=function(){var l=[].concat(Z(r.names.map(u)),Z(r.skips.map(u).map(function(f){return"-"+f}))).join(",");return r.enable(""),l},r.enable=function(l){r.save(l),r.names=[],r.skips=[];var f,E=(typeof l=="string"?l:"").split(/[\s,]+/),T=E.length;for(f=0;f<T;f++)E[f]&&((l=E[f].replace(/\*/g,".*?"))[0]==="-"?r.skips.push(new RegExp("^"+l.substr(1)+"$")):r.names.push(new RegExp("^"+l+"$")))},r.enabled=function(l){if(l[l.length-1]==="*")return!0;var f,E=0;for(f=r.skips.length;E<f;E++)if(r.skips[E].test(l))return!1;for(E=0,f=r.names.length;E<f;E++)if(r.names[E].test(l))return!0;return!1},r.humanize=YD,r.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(i).forEach(function(l){r[l]=i[l]}),r.names=[],r.skips=[],r.formatters={},r.selectColor=function(l){for(var f=0,E=0;E<l.length;E++)f=(f<<5)-f+l.charCodeAt(E),f|=0;return r.colors[Math.abs(f)%r.colors.length]},r.enable(r.load()),r},Ls=xb(function(i,r){r.formatArgs=function(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+i.exports.humanize(this.diff),this.useColors){var f="color: "+this.color;l.splice(1,0,f,"color: inherit");var E=0,T=0;l[0].replace(/%[a-zA-Z%]/g,function(v){v!=="%%"&&(E++,v==="%c"&&(T=E))}),l.splice(T,0,f)}},r.save=function(l){try{l?r.storage.setItem("debug",l):r.storage.removeItem("debug")}catch{}},r.load=function(){try{var l=r.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l=define_process_env_default.DEBUG),l},r.useColors=function(){return!(typeof window>"u"||!window.process||window.process.type!=="renderer"&&!window.process.__nwjs)||(typeof navigator>"u"||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};t:{try{var s=localStorage;break t}catch{}s=void 0}var u;r.storage=s,r.destroy=(u=!1,function(){u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),r.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),r.log=console.debug||console.log||function(){},i.exports=ZD(r),i.exports.formatters.j=function(l){try{return JSON.stringify(l)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}}),Ms=Ls("RTM:DEBUG"),Af;Ms.enabled=!1,function(i){i[i.Uploading=0]="Uploading",i[i.Free=1]="Free"}(Af||(Af={}));var $D=function(){function i(r){va(this,i),x(this,"uploadRequest",void 0),x(this,"uploadState",void 0),x(this,"uploadResendCount",void 0),x(this,"LogCache",void 0),x(this,"LogsToPost",void 0),x(this,"processId",void 0),x(this,"sdkVersion",void 0),x(this,"logId",void 0),x(this,"rtmConfig",void 0),this.processId=r.processId,this.sdkVersion=r.sdkVersion,this.rtmConfig=r.rtmConfig,this.uploadRequest=r.uploadRequest,this.uploadState=Af.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return eb(i,[{key:"upload",value:function(r){this.LogCache.push(r),this.uploadState===Af.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(r){var s=this;this.uploadState=Af.Uploading,setTimeout(ma(N.mark(function u(){var l,f,E;return N.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return l={sdk_version:s.sdkVersion,process_id:s.processId,payload:JSON.stringify(r)},T.prev=1,T.next=4,s.uploadRequest(l,(f=s.rtmConfig.enableCloudProxy)!==null&&f!==void 0&&f);case 4:if(!gj){T.next=6;break}throw Error("RTM is busy");case 6:T.next=13;break;case 8:return T.prev=8,T.t0=T.catch(1),E=2>s.uploadResendCount++?2e3:1e4,setTimeout(function(){return s.postLog(s.LogsToPost)},E),T.abrupt("return");case 13:if(Ms('The logs uploaded for "process-'.concat(Og,'"')),s.LogCache.length!==0){T.next=17;break}return s.uploadState=Af.Free,T.abrupt("return");case 17:s.uploadResendCount=0,s.LogsToPost=40>s.LogCache.length?s.LogCache.splice(0,s.LogCache.length):s.LogCache.splice(0,40),s.postLog(s.LogsToPost);case 20:case"end":return T.stop()}},u,null,[[1,8]])})),ue.getParameter("LOG_UPLOAD_INTERVAL"))}}]),i}(),Ns=function(i,r,s,u,l,f,E,T){var v=0;for(E=!!E&&Dd(E,T,3);v<u;){if(v in s){if(T=E?E(s[v],v,r):s[v],0<f&&Ed(T))l=Ns(i,r,T,Ma(T.length),l,f-1)-1;else{if(9007199254740991<=l)throw TypeError("Exceed the acceptable array length");i[l]=T}l++}v++}return l},aE=Ns;ea({target:"Array",proto:!0},{flat:function(){var i=arguments.length?arguments[0]:void 0,r=pb(this),s=Ma(r.length),u=Dh(r,0);return u.length=aE(u,r,r,s,0,i===void 0?1:yc(i)),u}}),ea({target:"Object",stat:!0},{values:function(i){return uD(i)}});var ud=function(i){function r(u,l){return va(this,r),x(z(u=s.call(this,Vn(u,l))),"originalError",void 0),x(z(u),"code",void 0),x(z(u),"serverCode",void 0),typeof l=="number"?u.code=l:typeof l=="string"?u.name=l:l!==void 0&&(l.originalError&&(u.originalError=l.originalError),l.code!==void 0&&(u.code=l.code),l.serverCode!==void 0&&(u.serverCode=l.serverCode)),u}Ga(r,i);var s=Ha(r);return r}(Kf(Error)),rc=function(i){function r(u,l){return va(this,r),x(z(u=s.call(this,Vn(u,l))),"name","RtmInternalError"),x(z(u),"code",void 0),u.code=l,u}Ga(r,i);var s=Ha(r);return r}(Kf(Error)),yi=function(){return function(i){function r(u){va(this,r);var l=Object.keys(u);return s.call(this,u[l[0]],l[0])}Ga(r,i);var s=Ha(r);return r}(rc)},mb=yi(),Ub=function(i){function r(){va(this,r);for(var u=arguments.length,l=Array(u),f=0;f<u;f++)l[f]=arguments[f];return x(z(u=s.call.apply(s,[this].concat(l))),"name","RtmTimeoutError"),u}Ga(r,i);var s=Ha(r);return r}(ud),ca=function(i){function r(){va(this,r);for(var u=arguments.length,l=Array(u),f=0;f<u;f++)l[f]=arguments[f];return x(z(u=s.call.apply(s,[this].concat(l))),"name","RtmInvalidArgumentError"),u}Ga(r,i);var s=Ha(r);return r}(ud),da=function(i){function r(){va(this,r);for(var u=arguments.length,l=Array(u),f=0;f<u;f++)l[f]=arguments[f];return x(z(u=s.call.apply(s,[this].concat(l))),"name","RtmInvalidStatusError"),u}Ga(r,i);var s=Ha(r);return r}(ud),ic=function(i){function r(){va(this,r);for(var u=arguments.length,l=Array(u),f=0;f<u;f++)l[f]=arguments[f];return x(z(u=s.call.apply(s,[this].concat(l))),"name","RtmLimitExceededError"),u}Ga(r,i);var s=Ha(r);return r}(ud),bE=function(i){function r(){va(this,r);for(var u=arguments.length,l=Array(u),f=0;f<u;f++)l[f]=arguments[f];return x(z(u=s.call.apply(s,[this].concat(l))),"name","RtmInvokeTooOftenError"),u}Ga(r,i);var s=Ha(r);return r}(ud),Ja=function(i){function r(){va(this,r);for(var u=arguments.length,l=Array(u),f=0;f<u;f++)l[f]=arguments[f];return x(z(u=s.call.apply(s,[this].concat(l))),"name","RtmUnavailableError"),x(z(u),"serverCode",void 0),x(z(u),"statusCode",void 0),u}Ga(r,i);var s=Ha(r);return r}(ud),Bf=function(i){function r(){va(this,r);for(var u=arguments.length,l=Array(u),f=0;f<u;f++)l[f]=arguments[f];return x(z(u=s.call.apply(s,[this].concat(l))),"name","RtmUnauthenticatedError"),x(z(u),"serverCode",void 0),u}Ga(r,i);var s=Ha(r);return r}(ud),ve=function(i){function r(){va(this,r);for(var u=arguments.length,l=Array(u),f=0;f<u;f++)l[f]=arguments[f];return x(z(u=s.call.apply(s,[this].concat(l))),"name","RtmUnknownError"),u}Ga(r,i);var s=Ha(r);return r}(ud),Ab=function(i){return i instanceof Ub||i instanceof Tb},Na=function(i){return i instanceof ud},we=function(i,r,s){return['Executing "%s.%s" timed out after %ds',i,r,s/1e3]},cE=["CODE"],bc,Pd,S;(function(i){i.CHINA="CN",i.ASIA="AS",i.NORTH_AMERICA="NA",i.EUROPE="EU",i.JAPAN="JP",i.INDIA="IN",i.OCEANIA="OC",i.SOUTH_AMERICA="SA",i.AFRICA="AF",i.OVERSEA="OVERSEA",i.GLOBAL="GLOBAL"})(S||(S={}));var dE={CN:S.CHINA,NA:S.NORTH_AMERICA,EU:S.EUROPE,AS:S.ASIA,JP:S.JAPAN,IN:S.INDIA,GLOB:S.GLOBAL,AF:S.AFRICA,OC:S.OVERSEA,OVS:S.OVERSEA,SA:S.SOUTH_AMERICA},kh=$n((bc={},x(bc,S.ASIA,{CODE:S.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.NORTH_AMERICA,{CODE:S.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.EUROPE,{CODE:S.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.JAPAN,{CODE:S.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.INDIA,{CODE:S.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.OVERSEA,{CODE:S.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),x(bc,S.GLOBAL,{CODE:S.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.OCEANIA,{CODE:S.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.SOUTH_AMERICA,{CODE:S.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.AFRICA,{CODE:S.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.CHINA,{CODE:S.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),bc)),Zf=(Pd={},x(Pd,S.ASIA,[S.CHINA,S.JAPAN,S.INDIA]),x(Pd,S.EUROPE,[]),x(Pd,S.NORTH_AMERICA,[]),x(Pd,S.SOUTH_AMERICA,[]),x(Pd,S.OCEANIA,[]),x(Pd,S.AFRICA,[]),Pd),Os=[S.OVERSEA,S.GLOBAL,S.CHINA,S.NORTH_AMERICA,S.EUROPE,S.ASIA,S.JAPAN,S.INDIA,S.OCEANIA,S.SOUTH_AMERICA,S.AFRICA],Nn=function(i){return Object.values(Zf).flat().includes(i)},Hv=function(i){var r;return(r=qh(Zf).find(function(s){return(s=$a(s,2))[0],s[1].includes(i)}))===null||r===void 0?void 0:r[0]},eE=function(i){return i.sort(function(r,s){return Os.indexOf(r)-Os.indexOf(s)})},Ve=function(i){var r=new Set;if((i=eE(i).slice(0,3).map(function(s){var u=kh[s];if(u===void 0)throw new rc("invalid area key");return s=u.CODE,u=Ki(u,cE),r.add(s),u})).length===0)throw new rc("areas cannot be empty");return Wa({CODES:r},i.reduce(function(s,u){for(var l=0,f=qh(s);l<f.length;l++){var E=$a(f[l],2),T=E[0];E=E[1],s[T]=Array.from(new Set([].concat(Z(u[T]),Z(E))))}return s}))},fa,Ps=function(){var i=ma(N.mark(function r(s,u){var l,f,E,T,v,w=arguments;return N.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(!(2<(f=2<w.length&&w[2]!==void 0?w[2]:0))){k.next=3;break}return k.abrupt("return");case 3:return E={withCredentials:!0,body:s,timeout:2e4},T=0<f?(fa==null?void 0:fa.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(fa==null?void 0:fa.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",v=u?"https://".concat((l=fa==null?void 0:fa.PROXY_NGINX[0])!==null&&l!==void 0?l:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(T,"&p=443&d=upload/v1"):"https://".concat(T,"/upload/v1"),k.next=8,lh(v,E).catch(function(B){return Ps(s,u,f+1)});case 8:case"end":return k.stop()}},r)}));return function(r,s){return i.apply(this,arguments)}}(),Qs=new $D({processId:"process-".concat(Og),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.5.1-0-g5bbbcd72"),uploadRequest:Ps,rtmConfig:{}}),Sl="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Rs="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Ss=["serverReceivedTs","hasPeerReceived","messageType","enableNotificationToChannelMembers","lastUpdateTs"],fE="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),We=function(i){if(typeof i=="string")return La(i);if(Array.isArray(i)&&i.every(function(f){return typeof f=="string"}))return i.map(function(f){return La(f)});if(!Mm(i)){for(var r={},s=0;s<Ss.length;s++){var u=Ss[s];u in i&&(r[u]=i[u])}if(0<Object.keys(r).length)return r;if(5>Object.keys(i).length){for(s=0,i=Object.entries(i);s<i.length;s++){var l=$a(i[s],2);u=l[0],l=l[1],Sl.includes(u)?r[u]="[Hidden Info]":r[La(u)]=typeof l=="string"?La(l):"[Sensitive Info]"}return r}return"[Sensitive Info]"}return i},Ts=function(i){return qa(i)==="object"?De(i)?Zn(He(i,5),Sl,Rs):i.constructor&&i.constructor.name:i},Us=function(i,r){return i instanceof Error?i.message:typeof i!="string"?JSON.stringify(Zn(He(i,5),Sl,Rs)):(r=r.map(function(s){return s instanceof Error?s.message:qa(s)==="object"?Ks(Array.isArray(s)?s.map(Ts):Ts(s)):s}),Wn.apply(void 0,[i.replace(/%[%Oo]/g,function(s){return s==="%%"?"%":s==="%o"||s==="%O"?"%s":s})].concat(Z(r))))},gE=1,Vs=function(i,r,s){var u=Ls(i);return u.enabled=!0,u.log=s,u.useColors=!1,function(l){for(var f=arguments.length,E=Array(1<f?f-1:0),T=1;T<f;T++)E[T-1]=arguments[T];if(r.enableLogUpload){f=oh(l);var v=Us(f,E);Qs.upload({log_item_id:"".concat(gE++),log_level:i,payload_str:"[".concat(hE(),"] ").concat(i," - ").concat(256<v.length?v.slice(0,256):v)})}switch(f=function(w){var k=v||Us(oh(l),E),B=Ec.LOG_HANDLER;typeof B=="function"&&B({level:w,message:k}),u(k)},i){case"RTM:INFO":r.logFilter.info&&f("log");break;case"RTM:WARN":r.logFilter.warn&&f("warning");break;case"RTM:ERROR":r.logFilter.error&&f("error");break;case"RTM:TRACK":r.logFilter.track&&f("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":r.logFilter.debug&&f("debug");break;case"RTM:DEBUG":r.logFilter.debug&&f("debug")}}},Tl,Ws=function(i){return function(r){var s=Tl===1||i===void 0?"":"Ins#".concat(i," ");return"".concat(s).concat(r)}},Ul=function(i,r,s){var u=Ws(Tl);return Vs("RTM:".concat(r),s,function(l){return i(u(l))})},sc=function(){return function(i){function r(u,l){var f=2<arguments.length&&arguments[2]!==void 0&&arguments[2];va(this,r);var E=s.call(this);if(x(z(E),"logError",void 0),x(z(E),"invokeTracker",void 0),x(z(E),"resultTracker",void 0),x(z(E),"errorTracker",void 0),x(z(E),"eventTracker",void 0),x(z(E),"info",void 0),x(z(E),"warn",void 0),x(z(E),"log",void 0),x(z(E),"genLogger",void 0),x(z(E),"loggerId",void 0),x(z(E),"logger",void 0),x(z(E),"name",void 0),E.logger=u,E.name=l,E.loggerId=u.loggerId,E.info=u.info,E.warn=u.warn,E.logError=u.logError,E.genLogger=u.genLogger,E.log=u.genLogger("RTM:DEBUG","<".concat(l,"> ")),E.invokeTracker=u.genTracker("Invoke"),E.eventTracker=u.genTracker("Event"),E.resultTracker=u.genTracker("Result"),E.errorTracker=u.genTracker("Error"),f){var T=E.emit.bind(z(E));E.emit=function(){for(var v=arguments.length,w=Array(v),k=0;k<v;k++)w[k]=arguments[k];v=w[0],k=w.slice(1);var B=fE.includes(v);E.eventTracker.apply(E,["%s: ".concat(0<k.length?"%s emitted with args: ".concat(k.map(function(){return"%o"})):"%s emitted"),l,v].concat(Z(B?k.map(We):k)));try{T.apply(void 0,w)}catch(Q){E.logError("Caught in the callback function of the event %s",v,Q)}}}return E}Ga(r,i);var s=Ha(r);return r}(Ba)},iE=function(i){return Ul(console.log.bind(console),"INFO",i)},jE=function(i){return Ul(console.warn.bind(console),"WARN",i)},kE=function(i){return Ul(console.error.bind(console),"ERROR",i)},Xs=function(i,r){return function(s){var u=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",l=Ws(i),f=console.debug.bind(console),E=Vs(s,r,function(T){return f(l(T))});return function(T){for(var v=arguments.length,w=Array(1<v?v-1:0),k=1;k<v;k++)w[k-1]=arguments[k];return E.apply(void 0,[u+T].concat(w))}}},lE=function(i,r){return function(s){return Xs(i,r)("RTM:TRACK","[".concat(s,"] "))}},Jv=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,RtmSdkMessageCount:510,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,RtmSdkMessageCount:510}}),Ka;(function(i){i[i.ChannelSMsg=1]="ChannelSMsg",i[i.ChannelRMsg=2]="ChannelRMsg",i[i.P2pSMsgOfflineFlag=3]="P2pSMsgOfflineFlag",i[i.P2pRMsgOfflineFlag=4]="P2pRMsgOfflineFlag",i[i.P2pSMsgNoOfflineFlag=5]="P2pSMsgNoOfflineFlag",i[i.P2pRMsgNoOfflineFlag=6]="P2pRMsgNoOfflineFlag",i[i.P2pCallInvitation=7]="P2pCallInvitation",i[i.P2pCallCancellation=8]="P2pCallCancellation",i[i.P2pCallAcceptance=9]="P2pCallAcceptance",i[i.P2pCallRefusal=10]="P2pCallRefusal"})(Ka||(Ka={}));var zi=function(i){function r(u,l,f){return va(this,r),x(z(l=s.call(this,l,"MessageReport")),"messagecount",l.getInitMessageCount()),x(z(l),"context",void 0),x(z(l),"rtmMessageCategory",void 0),x(z(l),"seq",P.fromNumber(1,!0)),l.context=u,l.rtmMessageCategory=f,l}Ga(r,i);var s=Ha(r);return eb(r,[{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1)}},{key:"getInitMessageCount",value:function(){return{peerack10mscount:P.fromNumber(0),peerack25mscount:P.fromNumber(0),peerack50mscount:P.fromNumber(0),peerack75mscount:P.fromNumber(0),peerack100mscount:P.fromNumber(0),peerack150mscount:P.fromNumber(0),peerack200mscount:P.fromNumber(0),peerack250mscount:P.fromNumber(0),peerack300mscount:P.fromNumber(0),peerack400mscount:P.fromNumber(0),peerack500mscount:P.fromNumber(0),peerack600mscount:P.fromNumber(0),peerack800mscount:P.fromNumber(0),peerack1000mscount:P.fromNumber(0),peerack2000mscount:P.fromNumber(0),peerack3000mscount:P.fromNumber(0),peerack5000mscount:P.fromNumber(0),peerack7000mscount:P.fromNumber(0),peerackslowcount:P.fromNumber(0),norecipientack10mscount:P.fromNumber(0),norecipientack25mscount:P.fromNumber(0),norecipientack50mscount:P.fromNumber(0),norecipientack75mscount:P.fromNumber(0),norecipientack100mscount:P.fromNumber(0),norecipientack150mscount:P.fromNumber(0),norecipientack200mscount:P.fromNumber(0),norecipientack250mscount:P.fromNumber(0),norecipientack300mscount:P.fromNumber(0),norecipientack400mscount:P.fromNumber(0),norecipientack500mscount:P.fromNumber(0),norecipientack600mscount:P.fromNumber(0),norecipientack800mscount:P.fromNumber(0),norecipientack1000mscount:P.fromNumber(0),norecipientack2000mscount:P.fromNumber(0),norecipientack3000mscount:P.fromNumber(0),norecipientack5000mscount:P.fromNumber(0),norecipientack7000mscount:P.fromNumber(0),norecipientackslowcount:P.fromNumber(0),sentcount:P.fromNumber(0),receivedcount:P.fromNumber(0),acktimeoutcount:P.fromNumber(0),toooftencount:0,receiverofflinecount:0,invalidmessagecount:0,unknowerrorcount:0,servercachedcount:0,timeoutcount:0,successcount:0}}},{key:"updatePeerAckCount",value:function(u){u/=2;for(var l=[[0,10],[10,25],[25,50],[50,75],[75,100],[100,150],[150,200],[200,250],[250,300],[300,400],[400,500],[500,600],[600,800],[800,1e3],[1e3,2e3],[2e3,3e3],[3e3,5e3],[5e3,7e3]],f=0;f<l.length;f++){var E,T=l[f];if(Is(u,T[0],T[1]))T="peerack".concat(T[1],"mscount"),this.messagecount[T]=(E=this.messagecount[T])===null||E===void 0?void 0:E.add(1);else if(7e3<u){var v;this.messagecount.peerackslowcount=(v=this.messagecount.peerackslowcount)===null||v===void 0?void 0:v.add(1)}}}},{key:"updateNorecipientackCount",value:function(u){u/=2;for(var l=[[0,10],[10,25],[25,50],[50,75],[75,100],[100,150],[150,200],[200,250],[250,300],[300,400],[400,500],[500,600],[600,800],[800,1e3],[1e3,2e3],[2e3,3e3],[3e3,5e3],[5e3,7e3]],f=0;f<l.length;f++){var E,T=l[f];if(Is(u,T[0],T[1]))T="norecipientack".concat(T[1],"mscount"),this.messagecount[T]=(E=this.messagecount[T])===null||E===void 0?void 0:E.add(1);else if(7e3<u){var v;this.messagecount.norecipientackslowcount=(v=this.messagecount.norecipientackslowcount)===null||v===void 0?void 0:v.add(1)}}}},{key:"updateCommonCount",value:function(u){var l=this.messagecount[u];P.isLong(l)?this.messagecount[u]=l.add(1):this.messagecount[u]=l+1}},{key:"report",value:function(){var u,l;bb("RtmSdkMessageCount",new Js(Wa(Wa({},this.messagecount),{},{vid:P.fromString((u=this.context.vid)!==null&&u!==void 0?u:"0"),os:7,lts:P.fromNumber(Date.now()),sid:this.context.sid,reportsequence:this.incGetSeq(),apimajorversion:4,apiminorversion:18,userid:this.context.uid,messagecategory:this.rtmMessageCategory})),(l=this.context.config.enableCloudProxy)!==null&&l!==void 0&&l),this.messagecount=Wa(Wa({},this.messagecount),{},{toooftencount:0,receiverofflinecount:0,invalidmessagecount:0,unknowerrorcount:0,servercachedcount:0,timeoutcount:0,successcount:0})}}]),r}(sc()),Un=new Map,hE=function(){var i=new Date;return"".concat(i.toISOString().split("T")[1].replace(/\..+/,""),".").concat(i.getMilliseconds())},Yf=Object.keys,qh=Object.entries.bind(Object),oh=function(i){return typeof i=="string"?i.endsWith(".")?i:"".concat(i,"."):i},yj=I.URI,Nv=wi,mE=Ki(oD,["Wrapper"]),bo=ql(mE,"URI"),Ys=function(i,r){var s=-1,u=i.length,l=u-1;for(r=r===void 0?u:r;++s<r;){var f=i[u=os(s,l)];i[u]=i[s],i[s]=f}return i.length=r,i},nE=function(i){return Ys(Pi(i))},oE=function(i){return Ys(zj(i))},Cf=function(i){return(ub(i)?nE:oE)(i)},Df={0:9591,1:9593},xe=function(i){return"https://".concat(i,"/api/v1")},pE=ob.apply(void 0,Z(Cf(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map(xe)))),qE=ob.apply(void 0,Z(Cf(["ap-web-1.agora.io","ap-web-2.agora.io"].map(xe)))),rE=ob.apply(void 0,Z(Cf(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map(xe)))),sE=ob.apply(void 0,Z(Cf(["ap-web-3.agora.io","ap-web-4.agora.io"].map(xe)))),Zs=yi(),Vl=function(i){function r(u,l,f,E,T,v){var w,k;va(this,r);var B=s.call(this,T,uj("Socket-",T.loggerId));if(x(z(B),"isActiveClose",!1),x(z(B),"loggedIn",!1),x(z(B),"useNewDomain",void 0),x(z(B),"receivedPacket",new rb),x(z(B),"open$",void 0),x(z(B),"input$",new rb),x(z(B),"userJoin$",new rb),x(z(B),"attemptsSinceLastError",0),x(z(B),"message$",new rb),x(z(B),"socket$",void 0),x(z(B),"toClose",new rb),x(z(B),"toReconnect",new rb),x(z(B),"sendLogger",void 0),x(z(B),"receiveLogger",void 0),x(z(B),"ip",void 0),x(z(B),"env",void 0),x(z(B),"ticket",void 0),x(z(B),"context",void 0),x(z(B),"getDomain",function(){return co(B.ip,B.useNewDomain)}),x(z(B),"socketReconnector",function(_e){var aa=function(_i){return B.attemptsSinceLastError+=1,B.warn("The %s of Env %d reconnecting %s",B.name,B.env,_i.message),dd(3e3)};return _e.pipe(ab(function(_i){return B.log("socket connection closed"),B.loggedIn=!1,2<=B.attemptsSinceLastError?(B.warn("socket connection failure"),B.emit("connectionFailure"),B.close(),ra(_i)):B.isActiveClose?Sb:(B.emit("reconnect"),B.useNewDomain=!B.useNewDomain,ra(_i))}),Re(function(_i){return _i.pipe(Kb(aa))}))}),B.ip=u,B.env=l,B.ticket=f,B.context=E,B.useNewDomain=v??.5<=Math.random(),B.sendLogger=B.genLogger("RTM:MSG:SEND"),B.receiveLogger=B.genLogger("RTM:MSG:RECV"),l!==0&&l!==1)throw new Zs({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});var Q=Df[l];B.log("Opening websocket address %s for the Env %d",B.ip,B.env),bb("LinkLoginRequest",{sid:B.context.sid,userId:B.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(B.context.startTime),destServerIp:B.ip,linkId:B.env},(w=B.context.config.enableCloudProxy||B.context.socketUseProxy)!==null&&w!==void 0&&w),bb("LinkLoginRequest",{sid:B.context.sid,userId:B.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(B.context.startTime),destServerIp:B.ip,linkId:B.env},(k=B.context.config.enableCloudProxy||B.context.socketUseProxy)!==null&&k!==void 0&&k);var X=Jb(B.input$,B.userJoin$.pipe(Av(2)),B.message$).pipe(Ea(function(_e){return wi.encode(_e).finish()}));return u=Jb(Bv("",{protocols:[],makeWebSocket:function(){if(B.context.config.enableCloudProxy||B.context.socketUseProxy){if(B.context.cloudProxyServers.length===0)throw B.logError("No cloud proxy server to connect"),new Ja;var _e=B.context.cloudProxyServers;_e=Xe(_e="wss://".concat(co(On(_e),!1),"/"),"sid",B.context.sid),_e=Xe(_e,"remote_port",Q.toString()),_e=Xe(_e,"remote_ip",B.ip),_e=Xe(_e,"token",B.context.key),_e=new WebSocket(_e)}else _e=new WebSocket("wss://".concat(B.getDomain(),":").concat(Q));return _e.binaryType="arraybuffer",_e}}),B.toReconnect),B.socket$=fb(u,Dl.pipe(Lb(7e3),ab(function(_e){return Ab(_e)&&B.warn("socket open timed out"),ra(_e)}))).pipe(Ea(function(_e){if(_e instanceof Error)throw B.warn("Env_%d: Force reconnect the socket",B.env),_e;return _e(X).pipe(Ea(function(aa){return wi.decode(new Uint8Array(aa))}))}),B.socketReconnector),B.open$=B.socket$.pipe(sa(function(_e){B.log("Websocket opened",B.name),_e.subscribe(function(aa){var _i=aa.data;aa=yj[aa.uri].slice(0,-3),_i=bo[aa].decode(_i);var _a=eC({},ql(_i,"toJSON"),function(T_,P_){return P_ instanceof P?Tn(P_):P_}),ga=!1;if((_i instanceof ws||_i instanceof vs)&&_i.instance.lessThanOrEqual(4294967295)&&(ga=!0),_i instanceof xs||_i instanceof ys){var _d=_i.instance,d_=_i.sequence;(_i.dialogue.lessThanOrEqual(4294967295)||_d.lessThanOrEqual(4294967295)||d_.lessThan(1))&&(ga=!0)}ga?B.warn("Env_%d: Illegal %s, abandoned %o",B.env,aa,_a):(aa!=="Pong"&&B.receiveLogger("Env_%d: %s %o",B.env,aa,_a),B.receivedPacket.next([aa,_i]))},function(){})}),Uf(void 0),Kc(B.toClose),Se()),B}Ga(r,i);var s=Ha(r);return eb(r,[{key:"address",get:function(){return"".concat(this.ip,":").concat(Df[this.env])}},{key:"sendPacket",value:function(u,l){if(u!=="Ping"){var f=md(l,function(E){return E instanceof P?Tn(E):E});this.sendLogger("Env_%d: %s %o",this.env,u,f)}l=Mv(u,l),u==="UserJoin"?this.userJoin$.next(l):u==="Message"?this.message$.next(l):this.input$.next(l)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(u){return this.receivedPacket.pipe(yb(function(l){return $a(l,1)[0]===u}),Ea(function(l){return $a(l,2)[1]}))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new Zs({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),r}(sc());ea({target:"String",proto:!0,forced:As},{padStart:function(i){return qD(this,i,1<arguments.length?arguments[1]:void 0)}});var tE=function(i){var r=Yf(kh);i=Lv(i);for(var s=0;s<r.length;s++){var u=kh[r[s]];if(u!=null&&u.AP_DOMAINS.includes(i)||u!=null&&u.AP_BACKUP_DOMAINS.includes(i)||u!=null&&u.PROXY_AP.includes(i))return[u.CODE]}return[S.CHINA,S.GLOBAL]},uE={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},$s={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},vE=[100,101,102],Ai=/web-(\d)/,at=function(i){function r(u,l){var f=2<arguments.length&&arguments[2]!==void 0&&arguments[2];va(this,r);var E=s.call(this,l,"AccessPoint");return x(z(E),"handleUniLbsError",function(T,v){var w=T;if(4<T.toString().length){var k=T.toString().padStart(8,"0"),B=parseInt(k.slice(0,4),10);if(k=parseInt(k.slice(4,8),10),B===201)w=k;else if(B===101&&!vE.includes(k))return ra(Error("service is currently unavailable"))}if(B=w.toString(),!Object.keys($s).includes(B))return(T=new Ja(["Login is rejected by the server. The response code is %d",T],Pg)).serverCode=w,ra(T);switch(B=$s[B],w=uE[B],B){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(v=new Bf(w,as)).serverCode=T,ra(v);case"INVALID_USER_ID":return(v=new Bf(w,si)).serverCode=T,ra(v);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(v=new Bf(w,ti)).serverCode=T,ra(v);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(v=new Bf(w,bs)).serverCode=T,ra(v);case"CANNOT_MEET_AREA_DEMAND":return(v=tE(v)).forEach(function(Q){return E.failedAreas.add(Q)}),E.failedAreas.size===(fa===void 0?2:fa.CODES.size)?((v=new ca(w,Pg)).serverCode=T,ra(v)):ra(Error("ap ".concat(v.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(v=new Ja(w,Pg)).serverCode=T,ra(v);default:return ra(Rn("ApResErrType",B))}}),x(z(E),"getApEdgeInfo$",void 0),x(z(E),"getApEdgeInfoEndFirst$",void 0),x(z(E),"apFinish$",new rb),x(z(E),"retryCount",0),x(z(E),"failedAreas",new Set),x(z(E),"usedUrl",[]),x(z(E),"newDomainUsed",!1),x(z(E),"backupNewDomainUsed",!1),x(z(E),"genUrl",function(){return fa===void 0?ej.apply(void 0,Z(Cf([pE,qE]))).pipe(fj(function(T){return ob.apply(void 0,Z(T))})):ob.apply(void 0,Z(fa.AP_DOMAINS.slice(0,3).map(xe)))}),x(z(E),"genBackupUrl",function(){return fa===void 0?ej.apply(void 0,Z(Cf([rE,sE]))).pipe(fj(function(T){return ob.apply(void 0,Z(T))})):ob.apply(void 0,Z(fa.AP_BACKUP_DOMAINS.slice(0,3).map(xe)))}),x(z(E),"getApUrl$",function(T){var v,w;return E.genUrl().pipe(yb(function(k){return(!E.newDomainUsed||!k.includes("sd-rtn.com"))&&(k.includes("sd-rtn.com")&&(E.newDomainUsed=!0),!Ol(E.usedUrl,function(B){var Q;return B===((Q=k.match(Ai))===null||Q===void 0?void 0:Q[1])}))}),sa(function(k){var B;fa===void 0&&typeof(k=(B=k.match(Ai))===null||B===void 0?void 0:B[1])=="string"&&E.usedUrl.push(k)}),hb(T?Math.max(Ec.RECONNECTING_AP_NUM,(v=fa==null?void 0:fa.CODES.size)!==null&&v!==void 0?v:0):(w=fa==null?void 0:fa.CODES.size)!==null&&w!==void 0?w:2),$d(function(){return r.runOutOfUrlSymbol}),ab(function(k,B){return E.newDomainUsed=!1,k===r.runOutOfUrlSymbol?(E.usedUrl=[],B):ra(k)}))}),x(z(E),"getBackupApUrl$",function(T){var v,w;return E.genBackupUrl().pipe(yb(function(k){return(!E.backupNewDomainUsed||!k.includes("sd-rtn.com"))&&(k.includes("sd-rtn.com")&&(E.backupNewDomainUsed=!0),!Ol(E.usedUrl,function(B){var Q;return B===((Q=k.match(Ai))===null||Q===void 0?void 0:Q[1])}))}),sa(function(k){var B;fa===void 0&&typeof(k=(B=k.match(Ai))===null||B===void 0?void 0:B[1])=="string"&&E.usedUrl.push(k)}),hb(T?Math.max(Ec.RECONNECTING_AP_NUM,(v=fa==null?void 0:fa.CODES.size)!==null&&v!==void 0?v:0):(w=fa==null?void 0:fa.CODES.size)!==null&&w!==void 0?w:2),$d(function(){return r.runOutOfUrlSymbol}),ab(function(k,B){return E.backupNewDomainUsed=!1,k===r.runOutOfUrlSymbol?(E.usedUrl=[],B):ra(k)}))}),x(z(E),"getProxyApUrl$",function(T){var v,w;return ob.apply(void 0,Z(((fa==null?void 0:fa.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map(xe))).pipe(hb(T?Math.max(Ec.RECONNECTING_AP_NUM,(v=fa==null?void 0:fa.CODES.size)!==null&&v!==void 0?v:0):(w=fa==null?void 0:fa.CODES.size)!==null&&w!==void 0?w:2))}),x(z(E),"context",void 0),x(z(E),"fetchCloudProxy",function(T,v){var w=uj("AP-",E.loggerId);E.log("The AccessPoint requests %s(%s)",T,w);var k,B=new AbortController;return E.apFinish$.pipe(hb(1)).subscribe(function(){return B.abort()}),yd(ma(N.mark(function Q(){var X,_e;return N.wrap(function(aa){for(;;)switch(aa.prev=aa.next){case 0:return _e=mh(0,Number.MAX_SAFE_INTEGER),E.log("%s request opid: %d",w,_e),bb("ApRequest",{sid:E.context.sid,userId:E.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(E.context.startTime),apAddr:T,opId:P.fromNumber(_e),envId:0,flag:128},(X=E.context.config.enableCloudProxy)!==null&&X!==void 0&&X),aa.abrupt("return",lh(T,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:E.context.sid,opid:_e,appid:E.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:v??E.context.key,cname:E.context.uid,uid:0,detail:Wa({},fa===void 0?{11:[S.CHINA,S.GLOBAL].join(),12:"1"}:{11:Array.from(fa.CODES).map(function(_i){return _i===S.OVERSEA?"".concat(S.ASIA,",").concat(S.EUROPE,",").concat(S.AFRICA,",").concat(S.NORTH_AMERICA,",").concat(S.SOUTH_AMERICA,",").concat(S.OCEANIA):_i}).join(","),12:"1"})}}]},signal:B.signal}));case 4:case"end":return aa.stop()}},Q)}))).pipe(ab(function(Q){return Q.name!=="AbortError"&&(E.logError(Q),E.warn("The AP server %s request failure",T,Q)),Sb}),Cb((k=ma(N.mark(function Q(X){var _e,aa,_i,_a,ga,_d,d_,T_,P_,g_,j_,wS,_m,l_,a_,y_,_c,_f,r_;return N.wrap(function(v_){for(;;)switch(v_.prev=v_.next){case 0:if(_e=X.responseText,aa=JSON.parse(_e),E.log("The %s response is %o",w,aa),((_i=aa.response_body)===void 0||_i.length===0||_i.some(function(S_){var U_;return((U_=S_.buffer)===null||U_===void 0?void 0:U_.code)===void 0||S_.uri!==23}))&&ra(new Ja("cloud proxy response_body not valid",Pg)),(_a=_i.filter(function(S_){return S_.buffer.code!==0})).length===0){v_.next=14;break}if((ga=_a.find(function(S_){return S_.buffer.flag===128}))===void 0){v_.next=12;break}return v_.abrupt("return",E.handleUniLbsError(ga.buffer.code,T));case 12:return E.logError("cloud proxy error response"),v_.abrupt("return",E.handleUniLbsError(_a[0].buffer.code,T));case 14:for(_d=[],d_=0;d_<_i.length;d_++)if(((g_=_i[d_])==null||(T_=g_.buffer)===null||T_===void 0?void 0:T_.flag)===262144)(j_=g_.buffer)===null||j_===void 0||(wS=j_.edges_services)===null||wS===void 0||(_m=wS.forEach)===null||_m===void 0||_m.call(wS,function(S_){Pn(S_=S_.ip)&&E.context.cloudProxyServers.indexOf(S_)===-1&&(E.log("got cloud proxy server: %s",S_),E.context.cloudProxyServers.push(S_))});else if((g_==null||(P_=g_.buffer)===null||P_===void 0?void 0:P_.flag)===128){for(_c=function(S_,U_){var w_=U_[S_];_d.some(function(RT){return RT.ip===w_.ip})||_d.push({ip:w_.ip,ticket:g_.buffer.cert})},_f=0,r_=g_.buffer.edges_services;_f<r_.length;_f++)_c(_f,r_);E.context.rtmArea=(l_=(a_=g_.buffer)===null||a_===void 0||(y_=a_.detail)===null||y_===void 0?void 0:y_[9])!==null&&l_!==void 0?l_:""}return v_.abrupt("return",ob.apply(void 0,Z(_d).concat([Mg])));case 19:case"end":return v_.stop()}},Q)})),function(Q){return k.apply(this,arguments)})),ab(function(Q){return Na(Q)?ra(Q):Sb}),bh(),yb(function(Q){return Q!==void 0&&typeof Q.ip=="string"&&typeof Q.ticket=="string"&&Pn(Q.ip)}))}),x(z(E),"fetchAp",function(T,v){var w=uj("AP-",E.loggerId);E.log("The AccessPoint requests %s(%s)",T,w);var k=new AbortController;E.apFinish$.pipe(hb(1)).subscribe(function(){return k.abort()});var B,Q=mh(0,Number.MAX_SAFE_INTEGER);return yd(ma(N.mark(function X(){var _e;return N.wrap(function(aa){for(;;)switch(aa.prev=aa.next){case 0:return E.log("%s request opid: %d",w,Q),bb("ApRequest",{sid:E.context.sid,userId:E.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(E.context.startTime),apAddr:T,opId:P.fromNumber(Q),envId:0,flag:128},(_e=E.context.config.enableCloudProxy)!==null&&_e!==void 0&&_e),aa.abrupt("return",lh(T,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:Q,key:v||E.context.key,cname:E.context.uid,detail:Wa({},fa===void 0?{11:[S.CHINA,S.GLOBAL].join(),12:"1"}:{11:Array.from(fa.CODES).map(function(_i){return _i===S.OVERSEA?"".concat(S.ASIA,",").concat(S.EUROPE,",").concat(S.AFRICA,",").concat(S.NORTH_AMERICA,",").concat(S.SOUTH_AMERICA,",").concat(S.OCEANIA):_i}).join(","),12:"1"}),uid:0,sid:E.context.sid},signal:k.signal}));case 3:case"end":return aa.stop()}},X)}))).pipe(ab(function(X){return X.name!=="AbortError"&&(E.logError(X),E.warn("The AP server %s request failure",T,X)),Sb}),Cb((B=ma(N.mark(function X(_e){var aa,_i,_a,ga,_d,d_,T_,P_;return N.wrap(function(g_){for(;;)switch(g_.prev=g_.next){case 0:if(_i=_e.responseText,_a=JSON.parse(_i),E.log("The %s response is %o",w,_a),_d=(ga=_a).code,d_=ga.addresses,T_=ga.detail,E.context.vid=T_[8],bb("ApEvent",{sid:E.context.sid,userId:E.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(E.context.startTime),apAddr:T,linkServerList:d_.map(function(j_){return j_.ip}),serverErrCode:_d,flag:128,envId:0,opId:P.fromNumber(Q),errCode:0,area:T_[9],isp:T_[2]},(aa=E.context.config.enableCloudProxy)!==null&&aa!==void 0&&aa),E.info(_a),_d===0){g_.next=9;break}return g_.abrupt("return",E.handleUniLbsError(_d,T));case 9:if(P_=d_,P_.length!==0){g_.next=14;break}return g_.abrupt("return",ra(Error("No available edge address to connect")));case 14:return E.context.rtmArea=T_==null?void 0:T_[9],g_.abrupt("return",ob.apply(void 0,Z(P_).concat([Mg])));case 16:case"end":return g_.stop()}},X)})),function(X){return B.apply(this,arguments)})),bh(),ab(function(X){return Na(X)?ra(X):Sb}),yb(function(X){return X!==void 0&&typeof X.ip=="string"&&typeof X.ticket=="string"}))}),E.context=u,E.getApEdgeInfoEndFirst$=function(){var T=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return dd(0,T||f?Ec.RECONNECTING_AP_INTERVAL:2e3).pipe(hb(1),sa(function(){E.retryCount+=1}),Cb(function(){return E.context.config.enableCloudProxy||E.context.socketUseProxy?E.getProxyApUrl$(T||f):(4<=E.retryCount&&(E.retryCount=0),3>=E.retryCount?E.getApUrl$(T||f):E.getBackupApUrl$(T||f))}),Cb(function(v){return E.context.config.enableCloudProxy||E.context.socketUseProxy?E.fetchCloudProxy(v):E.fetchAp(v)}),ab(function(v){return v instanceof Tb&&E.warn("AP request timeout"),ra(v)}),tn(function(v){return v.ip}),Kc(E.apFinish$))},E.getApEdgeInfo$=function(T){return dd(0,T||f?Ec.RECONNECTING_AP_INTERVAL:2e3).pipe(hb(8),sa(function(){E.retryCount+=1}),Cb(function(){return E.context.config.enableCloudProxy||E.context.socketUseProxy?E.getProxyApUrl$(T||f):3>=E.retryCount?E.getApUrl$(T||f):E.getBackupApUrl$(T||f)}),Cb(function(v){return(E.context.config.enableCloudProxy||E.context.socketUseProxy?E.fetchCloudProxy(v):E.fetchAp(v)).pipe()}),ab(function(v){return v instanceof Tb&&E.warn("AP request timeout"),ra(v)}),tn(function(v){return v.ip}),Kc(E.apFinish$))},E}Ga(r,i);var s=Ha(r);return eb(r,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),r}(sc());x(at,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var bt=yi(),ct=function(i){function r(u,l,f){va(this,r);var E=s.call(this,l,"Connection");x(z(E),"apClient",void 0),x(z(E),"lastOpenSockets",[new Te(1),new Te(1)]),x(z(E),"curOpenSockets",[void 0,void 0]),x(z(E),"ipIterator",0),x(z(E),"loginSocketOpenFailureCount",0),x(z(E),"firstEnv",.5<=Math.random()?1:0),x(z(E),"firstSocketOpener",void 0),x(z(E),"secondSocketOpener",void 0),x(z(E),"firstOpenKeeperSubject",new rb),x(z(E),"secondOpenKeeperSubject",new rb),x(z(E),"blacklistedIP",{}),x(z(E),"edgeInfoReplayed",void 0),x(z(E),"firstEnvOpenSocket",void 0),x(z(E),"firstOpenKeeperSub",void 0),x(z(E),"secondOpenKeeperSub",void 0),x(z(E),"context",void 0),x(z(E),"logger",void 0),E.context=u,E.logger=l,E.apClient=new at(E.context,l),E.apClient.apFinish$.subscribe(function(){E.log("Ap client fetch finished")});var T,v=[];return E.edgeInfoReplayed=E.apClient.getApEdgeInfo$(f).pipe(Re(function(w){return w.pipe(sa(function(k){if(Na(k))throw k}),Zd(f?ue.getParameter("RECONNECTING_AP_INTERVAL"):900),Kc(dd(2e4)))}),yb(function(w){var k;return!Ol(v,w)&&1>=((k=E.blacklistedIP[w.ip])!==null&&k!==void 0?k:0)}),$d(function(){return new bt({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),sa(function(w){v.push(w),E.log("An edge info got %o",w)}),sa({error:function(w){E.emit("connectionInitFailure",w)}}),fh(function(){E.apClient.clearUp()}),wn()),E.firstEnvOpenSocket=E.edgeInfoReplayed.pipe(Cb(function(w){if(w===void 0)return ra(Error("Invalid edge info"));var k=new Vl(w.ip,E.firstEnv,w.ticket,E.context,l,T);if(E.firstEnv=E.firstEnv===1?0:1,k.once("connectionFailure",function(){return E.onSocketConnectionFailure(k)}),!f&&Ec.ENABLE_EDGE_AUTO_FALLBACK&&!E.context.config.enableCloudProxy){var B,Q=Date.now();k.on("reconnect",function(){var X;E.loginSocketOpenFailureCount+=1,(X=B)!==null&&X!==void 0||(B=Date.now()-Q),500>B&&1<E.loginSocketOpenFailureCount&&(E.context.socketUseProxy=!0)})}return T=!k.useNewDomain,k.open$.pipe(Uf(k))}),sa(function(w){E.log("The websocket of ENV_%d opened to %s:%d",w.env,w.ip,Df[w.env]),E.curOpenSockets[w.env]=w,E.lastOpenSockets[w.env].next(w),E.firstEnv=w.env,E.openSecondSocket(w.env,w.ip,w.useNewDomain)}),hb(1),Se()),E.firstSocketOpener=E.firstEnvOpenSocket.pipe(Cb(function(w){return w.open$.pipe(sa(function(){E.log("The websocket of first ENV_%d re-opened to %s:%d",w.env,w.ip,Df[w.env]),E.curOpenSockets[w.env]=w,E.lastOpenSockets[w.env].next(w)}))})),u=E.firstOpenKeeperSubject.pipe(Kb(wd)),E.firstOpenKeeperSub=u.subscribe({error:E.logError}),E}Ga(r,i);var s=Ha(r);return eb(r,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(u,l){if(![0,1].includes(u))throw new mb({INVALID_ENV:"The env argument is not 0 or 1"});var f=u===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var E=this.curOpenSockets[u];this.curOpenSockets[u]=void 0,E&&(E.isActiveClose=!0,setTimeout(function(){E.close()},l)),f!==void 0&&setTimeout(function(){f==null||f.unsubscribe()},l)}},{key:"waitClosing",value:function(u){var l=this;return u.isActiveClose=!0,u.open$.pipe(ev(),ab(function(f){return f.message===ns.normalClosureMessage?Sb:ra(f)}),Lb(5e3),ab(function(f){return f instanceof Tb?(l.warn("Force closing the ENV_%d connection",u.env),Sb):ra(f)}))}},{key:"onSocketConnectionFailure",value:function(u){var l=[0,1].filter(function(f){return f!==u.env})[0];(l=this.curOpenSockets[l])&&l.loggedIn?this.reopenSocketWithApRequest(u.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(u,l,f){var E=this,T=u===1?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(vn(function(v,w){return[].concat(Z(v),[w])},[]),Ea(function(v){return ls(v,function(w){return Sn(l,w.ip)}).slice(-1)[0]}),hb(1),Cb(function(v){if(v===void 0)return ra(Error("Invalid edge info"));var w=new Vl(v.ip,T,v.ticket,E.context,E.logger,f);return w.on("connectionFailure",function(){return E.onSocketConnectionFailure(w)}),w.open$.pipe(sa(function(){E.lastOpenSockets[T].next(w),E.curOpenSockets[T]=w}))}),Se()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Kb(wd)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(u){var l=this,f=[0,1].filter(function(v){return v!==u})[0];if((f=this.curOpenSockets[f])!==void 0){var E,T=f.ip;f=this.apClient.getApEdgeInfoEndFirst$(!0).pipe($d(function(){return new bt({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),Re(function(v){return v.pipe(sa(function(w){if(w.code===ti)l.emit("tokenExpired"),l.apClient.apFinish$.next(void 0);else if(Na(w))throw w}),Zd(ue.getParameter("RECONNECTING_AP_INTERVAL")),Kc(dd(15e3)))}),sa(function(v){l.log("An edge info got %o",v)}),fh(function(){l.apClient.clearUp()})).pipe(vn(function(v,w){return[].concat(Z(v),[w])},[]),Ea(function(v){return(v=ls(v,function(w){return Sn(T,w.ip)})).length-1>=l.ipIterator?v.slice(-l.ipIterator++-1)[0]:(l.ipIterator=0,v.slice(-1)[0])}),$d(),Cb(function(v){if(v===void 0)return ra(Error("Invalid edge info"));var w=new Vl(v.ip,u,v.ticket,l.context,l.logger,E);return w.on("connectionFailure",function(){return l.onSocketConnectionFailure(w)}),E=!w.useNewDomain,w.open$.pipe(Uf(w))}),sa(function(v){l.log("The websocket of ENV_%d re-opened to %s:%d using ap",v.env,v.ip,Df[v.env]),l.curOpenSockets[u]=v,l.lastOpenSockets[u].next(v)}),Cb(function(v){return v.open$.pipe(sa(function(){l.log("The websocket of ENV_%d re-opened to %s:%d",v.env,v.ip,Df[v.env]),l.curOpenSockets[u]=v,l.lastOpenSockets[u].next(v)}))}),Se()),u===this.firstEnv?this.firstOpenKeeperSubject.next(f):this.secondOpenKeeperSubject.next(f)}}}]),r}(sc()),xE=function(i){function r(u,l,f){return va(this,r),x(z(f=s.call(this,f,"Context")),"_token",void 0),x(z(f),"config",void 0),x(z(f),"_uid",void 0),x(z(f),"_sid",void 0),x(z(f),"_vid",void 0),x(z(f),"_startTime",void 0),x(z(f),"_area","CN"),x(z(f),"_socketUseProxy",!1),x(z(f),"appId",void 0),x(z(f),"enableCloudProxy",!1),x(z(f),"cloudProxyServers",[]),f.appId=u,f.config=l,f}Ga(r,i);var s=Ha(r);return eb(r,[{key:"socketUseProxy",get:function(){return this._socketUseProxy&&Ec.ENABLE_EDGE_AUTO_FALLBACK},set:function(u){this.log("socketUseProxy is set to %s",u),this._socketUseProxy=u}},{key:"token",set:function(u){this._token=typeof u=="string"&&u?u:void 0}},{key:"uid",get:function(){if(typeof this._uid=="string"&&this._uid)return this._uid;throw new rc("Cannot get illegal uid")},set:function(u){if(this.log("The user ID is set to %s",La(u)),!Ta(u))throw new rc;this._uid=u}},{key:"vid",get:function(){if(typeof this._vid=="string"&&this._vid)return this._vid;throw new rc("Cannot get illegal vid")},set:function(u){this._vid=u}},{key:"key",get:function(){if(typeof this._token=="string"&&this._token)return this._token;if(typeof this.appId=="string"&&this.appId)return this.appId;throw new rc("Cannot get illegal key")}},{key:"sid",get:function(){if(typeof this._sid=="string"&&this._sid)return this._sid;throw new rc("Cannot get illegal sid")},set:function(u){if(this.log("sid is set to %s",u),typeof u!="string"||!u)throw new rc;this._sid=u}},{key:"startTime",get:function(){if(typeof this._startTime=="number"&&this._startTime)return this._startTime;throw new rc("Cannot get illegal startTime")},set:function(u){if(this.log("startTime is set to %s",u),typeof u!="number"||!u)throw new rc;this._startTime=u}},{key:"rtmArea",get:function(){if(typeof this._area=="string"&&this._area)return this._area;throw new rc("Cannot get illegal area")},set:function(u){this.log("area is set to %s",u),typeof u=="string"&&u?this._area=u:this.warn("set area failed")}}]),r}(sc());Sp("of",function(){for(var i=0,r=arguments.length,s=new(qf(this))(r);r>i;)s[i]=arguments[i++];return s},rk);var yE=Math.max,Pv=function(i,r,s){var u=Object(i);if(!ae(i)){var l=wf(r);i=Wd(i),r=function(f){return l(u[f],f,u)}}return-1<(r=function(f,E,T){var v=f==null?0:f.length;if(!v)return-1;if(T==null)T=0;else{var w=(T=Rl(T))%1;T=T==T?w?T-w:T:0}return 0>T&&(T=yE(v+T,0)),Yq(f,wf(E),T)}(i,r,s))?u[l?i[r]:r]:void 0},Ov=function(i,r){return i&&i.length?fl(i,void 0,typeof r=="function"?r:void 0):[]},dt=function(){function i(){va(this,i),x(this,"size",0),x(this,"fields",new Map)}return eb(i,[{key:"define",value:function(r,s,u){if(this.size+=u,64<this.size)throw new RangeError("the struct over 64 bits is not supported");th(s={val:0,isNumber:s==="number",isBoolean:s==="boolean",oneof:s==="number"||s==="boolean"?void 0:s,len:u}),this.fields.set(r,s)}},{key:"set",value:function(r,s){if(!(r=this.fields.get(r)))throw Error("field not found");var u=r.oneof;if(!P.isLong(s)&&typeof s!="number")if(typeof s=="boolean")s=s?1:0;else{if(u===void 0)throw Error("invalid field type");if((s=u[s])===void 0)throw Error("field type not found")}th(r,s),r.val=s}},{key:"toNumber",value:function(){for(var r=0,s=0,u=0,l=Array.from(this.fields);u<l.length;u++){var f=$a(l[u],2)[1],E=f.len;(f=f.val)!==void 0&&(r+=P.fromValue(f).shiftLeft(s).toNumber(),s+=E)}return r}},{key:"toLong",value:function(){for(var r=P.fromNumber(0,!0),s=0,u=0,l=Array.from(this.fields);u<l.length;u++){var f=$a(l[u],2)[1],E=f.len;(f=f.val)!==void 0&&(r=P.fromValue(f).shiftLeft(s).add(r),s+=E)}return r}},{key:"assert",value:function(r,s){function u(E){if(!P.isLong(E)&&typeof E!="number")if(typeof E=="boolean")E=E?1:0;else{if(f===void 0)throw Error("invalid field type");if((E=f[E])===void 0)throw Error("field type not found")}return th(l,E),sh(E,l.val)}var l=this.fields.get(r);if(!l)throw Error("field not found");var f=l.oneof;if(!Array.isArray(s))return u(s);if(s.length===1)return u(s[0]);if(s.every(function(E){return typeof E=="string"})&&f!==void 0)return s.some(function(E){return u(E)});throw Error("invalid valueTypes")}},{key:"from",value:function(r){r=P.fromValue(r);for(var s=0,u=0,l=Array.from(this.fields);u<l.length;u++){var f=$a(l[u],2)[1],E=f.len,T=P.fromNumber(Math.pow(2,E)-1,!0).shiftLeft(s);th(f,T=r.and(T).shiftRightUnsigned(s)),f.val=T,s+=E}}},{key:"typeOf",value:function(r){if((r=this.fields.get(r))!==void 0){var s=r.oneof;if(r=r.val,s!==void 0){var u=0;for(s=Object.entries(s);u<s.length;u++){var l=$a(s[u],2),f=l[0];if(sh(r,l[1]))return f}}}throw new TypeError("can only get type of oneof type")}}]),i}(),et=function(i){function r(u){va(this,r);var l=s.call(this);return l.define("Rejoin","boolean",1),l.define("Unused","number",31),l.define("Platform","number",8),l.define("Version","number",12),l.define("Subversion","number",12),l.set("Platform",7),l.set("Version",4),l.set("Subversion",18),l.set("Rejoin",u),l}Ga(r,i);var s=Ha(r);return r}(dt),zE=Wa(Wa({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),ft={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},AE=Wa(Wa({},zE),ft),BE={Uncompressed:0,Zlib:1},Ef=function(i){function r(u){va(this,r);var l=s.call(this);if(l.define("MessageType",AE,8),l.define("BroadcastJumps","number",2),l.define("ToCache","boolean",1),l.define("FromCache","boolean",1),l.define("CompressionMethod",BE,2),l.define("IterationNumber","number",4),l.define("BufferedMessage","boolean",1),l.define("ToArchive","boolean",1),l.define("FromArchive","boolean",1),typeof u=="number"||P.isLong(u))l.from(u);else if(u!==void 0){var f=0;for(u=qh(u);f<u.length;f++){var E=$a(u[f],2);l.set(E[0],E[1])}}return l}Ga(r,i);var s=Ha(r);return eb(r,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(u){var l=this;return u!==void 0?this.assert("MessageType",u):Yf(ft).some(function(f){return l.assert("MessageType",f)})}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),r}(dt),CE=function(i){function r(u){return va(this,r),x(z(u=s.call(this,u,"ChatManager")),"dialogueLru",new xz(void 0,{maxlen:1e4,ttl:1e4})),u}Ga(r,i);var s=Ha(r);return eb(r,[{key:"getChatInfo",value:function(u){var l=this.dialogueLru.get(u);if(this.dialogueLru.prune(),l){var f=l.dialogue,E={dialogue:f,sequence:l=l.sequence.add(1)};return this.dialogueLru.set(u,{dialogue:f,sequence:l}),E}return f={dialogue:nh(),sequence:P.fromNumber(1,!0)},this.dialogueLru.set(u,f),f}}]),r}(sc()),G={};qa(module)=="object"&&(module.exports=G),G.parse=function(i,r){var s,u=G.bin.readUshort,l=G.bin.readUint,f={};for(s=(i=new Uint8Array(i)).length-4;l(i,s)!=101010256;)s--;var E=u(i,s=s+4+4);u(i,s+=2),l(i,s+=2),s=l(i,s+=4);for(var T=0;T<E;T++){l(i,s),s+=4,s+=4,s+=4,l(i,s+=4);var v=l(i,s+=4),w=l(i,s+=4),k=u(i,s+=4),B=u(i,s+2),Q=u(i,s+4);s+=6;var X=l(i,s+=8);s+=4,s+=k+B+Q,G._readLocal(i,X,f,v,w,r)}return f},G._readLocal=function(i,r,s,u,l,f){var E=G.bin.readUshort,T=G.bin.readUint;T(i,r),E(i,r+=4),E(i,r+=2);var v=E(i,r+=2);T(i,r+=2),T(i,r+=4),T=E(i,r=r+4+8);var w=E(i,r+=2);if(r+=2,E=G.bin.readUTF8(i,r,T),r=r+T+w,f)s[E]={size:l,csize:u};else if(i=new Uint8Array(i.buffer,r),v==0)s[E]=new Uint8Array(i.buffer.slice(r,r+u));else{if(v!=8)throw"unknown compression method: "+v;r=new Uint8Array(l),G.inflateRaw(i,r),s[E]=r}},G.inflateRaw=function(i,r){return G.F.inflate(i,r)},G.inflate=function(i,r){return i[0],i[1],G.inflateRaw(new Uint8Array(i.buffer,i.byteOffset+2,i.length-2),r)},G.deflate=function(i,r){r==null&&(r={level:6});var s=0,u=new Uint8Array(50+Math.floor(1.1*i.length));return u[s]=120,u[s+1]=156,s=G.F.deflateRaw(i,u,s+2,r.level),i=G.adler(i,0,i.length),u[s+0]=i>>>24&255,u[s+1]=i>>>16&255,u[s+2]=i>>>8&255,u[s+3]=i>>>0&255,new Uint8Array(u.buffer,0,s+4)},G.deflateRaw=function(i,r){r==null&&(r={level:6});var s=new Uint8Array(50+Math.floor(1.1*i.length)),u=G.F.deflateRaw(i,s,u,r.level);return new Uint8Array(s.buffer,0,u)},G.encode=function(i,r){r==null&&(r=!1);var s,u=0,l=G.bin.writeUint,f=G.bin.writeUshort,E={};for(s in i){var T=!G._noNeed(s)&&!r,v=i[s],w=G.crc.crc(v,0,v.length);E[s]={cpr:T,usize:v.length,crc:w,file:T?G.deflateRaw(v):v}}for(s in E)u+=E[s].file.length+30+46+2*G.bin.sizeUTF8(s);for(s in i=new Uint8Array(u+22),r=0,v=[],E)w=E[s],v.push(r),r=G._writeHeader(i,r,s,w,0);for(s in u=0,T=r,E)w=E[s],v.push(r),r=G._writeHeader(i,r,s,w,1,v[u++]);return E=r-T,l(i,r,101010256),f(i,r=r+4+4,u),f(i,r+=2,u),l(i,r+=2,E),l(i,r+4,T),i.buffer},G._noNeed=function(i){return i=i.split(".").pop().toLowerCase(),"png,jpg,jpeg,zip".indexOf(i)!=-1},G._writeHeader=function(i,r,s,u,l,f){var E=G.bin.writeUint,T=G.bin.writeUshort,v=u.file;return E(i,r,l==0?67324752:33639248),r+=4,l==1&&(r+=2),T(i,r,20),T(i,r+=2,0),T(i,r+=2,u.cpr?8:0),E(i,r+=2,0),E(i,r+=4,u.crc),E(i,r+=4,v.length),E(i,r+=4,u.usize),T(i,r+=4,G.bin.sizeUTF8(s)),T(i,r+=2,0),r+=2,l==1&&(E(i,r=r+2+2+6,f),r+=4),r+=s=G.bin.writeUTF8(i,r,s),l==0&&(i.set(v,r),r+=v.length),r},G.crc={table:function(){for(var i=new Uint32Array(256),r=0;256>r;r++){for(var s=r,u=0;8>u;u++)s=1&s?3988292384^s>>>1:s>>>1;i[r]=s}return i}(),update:function(i,r,s,u){for(var l=0;l<u;l++)i=G.crc.table[255&(i^r[s+l])]^i>>>8;return i},crc:function(i,r,s){return 4294967295^G.crc.update(4294967295,i,r,s)}},G.adler=function(i,r,s){var u=1,l=0,f=r;for(r+=s;f<r;){for(s=Math.min(f+5552,r);f<s;)l+=u+=i[f++];u%=65521,l%=65521}return l<<16|u},G.bin={readUshort:function(i,r){return i[r]|i[r+1]<<8},writeUshort:function(i,r,s){i[r]=255&s,i[r+1]=s>>8&255},readUint:function(i,r){return 16777216*i[r+3]+(i[r+2]<<16|i[r+1]<<8|i[r])},writeUint:function(i,r,s){i[r]=255&s,i[r+1]=s>>8&255,i[r+2]=s>>16&255,i[r+3]=s>>24&255},readASCII:function(i,r,s){for(var u="",l=0;l<s;l++)u+=String.fromCharCode(i[r+l]);return u},writeASCII:function(i,r,s){for(var u=0;u<s.length;u++)i[r+u]=s.charCodeAt(u)},pad:function(i){return 2>i.length?"0"+i:i},readUTF8:function(i,r,s){for(var u,l="",f=0;f<s;f++)l+="%"+G.bin.pad(i[r+f].toString(16));try{u=decodeURIComponent(l)}catch{return G.bin.readASCII(i,r,s)}return u},writeUTF8:function(i,r,s){for(var u=s.length,l=0,f=0;f<u;f++){var E=s.charCodeAt(f);if(!(4294967168&E))i[r+l]=E,l++;else if(!(4294965248&E))i[r+l]=192|E>>6,i[r+l+1]=128|E>>0&63,l+=2;else if(!(4294901760&E))i[r+l]=224|E>>12,i[r+l+1]=128|E>>6&63,i[r+l+2]=128|E>>0&63,l+=3;else{if(4292870144&E)throw"e";i[r+l]=240|E>>18,i[r+l+1]=128|E>>12&63,i[r+l+2]=128|E>>6&63,i[r+l+3]=128|E>>0&63,l+=4}}return l},sizeUTF8:function(i){for(var r=i.length,s=0,u=0;u<r;u++){var l=i.charCodeAt(u);if(!(4294967168&l))s++;else if(!(4294965248&l))s+=2;else if(!(4294901760&l))s+=3;else{if(4292870144&l)throw"e";s+=4}}return s}},G.F={},G.F.deflateRaw=function(i,r,s,u){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][u],f=G.F.U,E=G.F._goodIndex;G.F._hash;var T=G.F._putsE,v=0;s<<=3;var w=0,k=i.length;if(u==0){for(;v<k;){var B=Math.min(65535,k-v);T(r,s,v+B==k?1:0),s=G.F._copyExact(i,v,B,r,s+8),v+=B}return s>>>3}T=f.lits,u=f.strt;var Q=f.prev,X=0,_e=0,aa=0,_i=0,_a=0;for(2<k&&(u[_a=G.F._hash(i,0)]=0),v=0;v<k;v++){if(B=_a,v+1<k-2){_a=G.F._hash(i,v+1);var ga=v+1&32767;Q[ga]=u[_a],u[_a]=ga}if(w<=v){if((14e3<X||26697<_e)&&100<k-v&&(w<v&&(T[X]=v-w,X+=2,w=v),s=G.F._writeBlock(v==k-1||w==k?1:0,T,X,_i,i,aa,v-aa,r,s),X=_e=_i=0,aa=v),ga=0,v<k-2&&(ga=G.F._bestMatch(i,v,Q,B,Math.min(l[2],k-v),l[3])),ga!=0){B=ga>>>16,ga&=65535;var _d=E(B,f.of0);f.lhst[257+_d]++;var d_=E(ga,f.df0);f.dhst[d_]++,_i+=f.exb[_d]+f.dxb[d_],T[X]=B<<23|v-w,T[X+1]=ga<<16|_d<<8|d_,X+=2,w=v+B}else f.lhst[i[v]]++;_e++}}for(aa==v&&i.length!=0||(w<v&&(T[X]=v-w,X+=2),s=G.F._writeBlock(1,T,X,_i,i,aa,v-aa,r,s));7&s;)s++;return s>>>3},G.F._bestMatch=function(i,r,s,u,l,f){var E=32767&r,T=s[E],v=E-T+32768&32767;if(T==E||u!=G.F._hash(i,r-v))return 0;for(var w=u=0,k=Math.min(32767,r);v<=k&&--f!=0&&T!=E;){if((u==0||i[r+u]==i[r+u-v])&&(E=G.F._howLong(i,r,v))>u){if(w=v,(u=E)>=l)break;v+2<E&&(E=v+2);for(var B=0,Q=0;Q<E-2;Q++){var X=r-v+Q+32768&32767,_e=X-s[X]+32768&32767;_e>B&&(B=_e,T=X)}}v+=(E=T)-(T=s[E])+32768&32767}return u<<16|w},G.F._howLong=function(i,r,s){if(i[r]!=i[r-s]||i[r+1]!=i[r+1-s]||i[r+2]!=i[r+2-s])return 0;var u=r,l=Math.min(i.length,r+258);for(r+=3;r<l&&i[r]==i[r-s];)r++;return r-u},G.F._hash=function(i,r){return(i[r]<<8|i[r+1])+(i[r+2]<<4)&65535},G.saved=0,G.F._writeBlock=function(i,r,s,u,l,f,E,T,v){var w=G.F.U,k=G.F._putsF,B=G.F._putsE;w.lhst[256]++;var Q=G.F.getTrees(),X=Q[0],_e=Q[1],aa=Q[2],_i=Q[3],_a=Q[4],ga=Q[5],_d=Q[6];Q=Q[7];var d_=32+(v+3&7?8-(v+3&7):0)+(E<<3),T_=u+G.F.contSize(w.fltree,w.lhst)+G.F.contSize(w.fdtree,w.dhst);u=u+G.F.contSize(w.ltree,w.lhst)+G.F.contSize(w.dtree,w.dhst),u+=14+3*ga+G.F.contSize(w.itree,w.ihst)+(2*w.ihst[16]+3*w.ihst[17]+7*w.ihst[18]);for(var P_=0;286>P_;P_++)w.lhst[P_]=0;for(P_=0;30>P_;P_++)w.dhst[P_]=0;for(P_=0;19>P_;P_++)w.ihst[P_]=0;if(d_=d_<T_&&d_<u?0:T_<u?1:2,k(T,v,i),k(T,v+1,d_),v+=3,d_==0){for(;7&v;)v++;v=G.F._copyExact(l,f,E,T,v)}else{if(d_==1)var g_=w.fltree,j_=w.fdtree;if(d_==2){for(G.F.makeCodes(w.ltree,X),G.F.revCodes(w.ltree,X),G.F.makeCodes(w.dtree,_e),G.F.revCodes(w.dtree,_e),G.F.makeCodes(w.itree,aa),G.F.revCodes(w.itree,aa),g_=w.ltree,j_=w.dtree,B(T,v,_i-257),B(T,v+=5,_a-1),B(T,v+=5,ga-4),v+=4,i=0;i<ga;i++)B(T,v+3*i,w.itree[1+(w.ordr[i]<<1)]);v=G.F._codeTiny(_d,w.itree,T,v+3*ga),v=G.F._codeTiny(Q,w.itree,T,v)}for(ga=0;ga<s;ga+=2){for(_d=(i=r[ga])>>>23,i=f+(8388607&i);f<i;)v=G.F._writeLit(l[f++],g_,T,v);_d!=0&&(i=(X=r[ga+1])>>16,E=X>>8&255,X&=255,B(T,v=G.F._writeLit(257+E,g_,T,v),_d-w.of0[E]),v+=w.exb[E],k(T,v=G.F._writeLit(X,j_,T,v),i-w.df0[X]),v+=w.dxb[X],f+=_d)}v=G.F._writeLit(256,g_,T,v)}return v},G.F._copyExact=function(i,r,s,u,l){var f=l>>>3;return u[f]=s,u[f+1]=s>>>8,u[f+2]=255-u[f],u[f+3]=255-u[f+1],f+=4,u.set(new Uint8Array(i.buffer,r,s),f),l+(s+4<<3)},G.F.getTrees=function(){for(var i=G.F.U,r=G.F._hufTree(i.lhst,i.ltree,15),s=G.F._hufTree(i.dhst,i.dtree,15),u=[],l=G.F._lenCodes(i.ltree,u),f=[],E=G.F._lenCodes(i.dtree,f),T=0;T<u.length;T+=2)i.ihst[u[T]]++;for(T=0;T<f.length;T+=2)i.ihst[f[T]]++;T=G.F._hufTree(i.ihst,i.itree,7);for(var v=19;4<v&&i.itree[1+(i.ordr[v-1]<<1)]==0;)v--;return[r,s,T,l,E,v,u,f]},G.F.getSecond=function(i){for(var r=[],s=0;s<i.length;s+=2)r.push(i[s+1]);return r},G.F.nonZero=function(i){for(var r="",s=0;s<i.length;s+=2)i[s+1]!=0&&(r+=(s>>1)+",");return r},G.F.contSize=function(i,r){for(var s=0,u=0;u<r.length;u++)s+=r[u]*i[1+(u<<1)];return s},G.F._codeTiny=function(i,r,s,u){for(var l=0;l<i.length;l+=2){var f=i[l],E=i[l+1];u=G.F._writeLit(f,r,s,u);var T=f==16?2:f==17?3:7;15<f&&(G.F._putsE(s,u,E,T),u+=T)}return u},G.F._lenCodes=function(i,r){for(var s=i.length;s!=2&&i[s-1]==0;)s-=2;for(var u=0;u<s;u+=2){var l=i[u+1],f=u+3<s?i[u+3]:-1,E=u+5<s?i[u+5]:-1,T=u==0?-1:i[u-1];if(l==0&&f==l&&E==l){for(f=u+5;f+2<s&&i[f+2]==l;)f+=2;11>(l=Math.min(f+1-u>>>1,138))?r.push(17,l-3):r.push(18,l-11),u+=2*l-2}else if(l==T&&f==l&&E==l){for(f=u+5;f+2<s&&i[f+2]==l;)f+=2;l=Math.min(f+1-u>>>1,6),r.push(16,l-3),u+=2*l-2}else r.push(l,0)}return s>>>1},G.F._hufTree=function(i,r,s){var u=[],l=i.length,f=r.length,E=0;for(E=0;E<f;E+=2)r[E]=0,r[E+1]=0;for(E=0;E<l;E++)i[E]!=0&&u.push({lit:E,f:i[E]});if(i=u.length,l=u.slice(0),i==0)return 0;if(i==1)return r[1+((s=u[0].lit)<<1)]=1,r[1+((s==0?1:0)<<1)]=1;u.sort(function(k,B){return k.f-B.f}),E=u[0],f=u[1];var T=0,v=1,w=2;for(u[0]={lit:-1,f:E.f+f.f,l:E,r:f,d:0};v!=i-1;)E=T!=v&&(w==i||u[T].f<u[w].f)?u[T++]:u[w++],f=T!=v&&(w==i||u[T].f<u[w].f)?u[T++]:u[w++],u[v++]={lit:-1,f:E.f+f.f,l:E,r:f};for((u=G.F.setDepth(u[v-1],0))>s&&(G.F.restrictDepth(l,s,u),u=s),E=0;E<i;E++)r[1+(l[E].lit<<1)]=l[E].d;return u},G.F.setDepth=function(i,r){return i.lit!=-1?i.d=r:Math.max(G.F.setDepth(i.l,r+1),G.F.setDepth(i.r,r+1))},G.F.restrictDepth=function(i,r,s){var u=0,l=1<<s-r,f=0;for(i.sort(function(T,v){return v.d==T.d?T.f-v.f:v.d-T.d}),u=0;u<i.length&&i[u].d>r;u++){var E=i[u].d;i[u].d=r,f+=l-(1<<s-E)}for(f>>>=s-r;0<f;)(E=i[u].d)<r?(i[u].d++,f-=1<<r-E-1):u++;for(;0<=u;u--)i[u].d==r&&0>f&&(i[u].d--,f++);f!=0&&console.log("debt left")},G.F._goodIndex=function(i,r){var s=0;return r[16|s]<=i&&(s|=16),r[8|s]<=i&&(s|=8),r[4|s]<=i&&(s|=4),r[2|s]<=i&&(s|=2),r[1|s]<=i&&(s|=1),s},G.F._writeLit=function(i,r,s,u){return G.F._putsF(s,u,r[i<<1]),u+r[1+(i<<1)]},G.F.inflate=function(i,r){var s=Uint8Array;if(i[0]==3&&i[1]==0)return r||new s(0);var u=G.F,l=u._bitsF,f=u._bitsE,E=u._decodeTiny,T=u.makeCodes,v=u.codes2map,w=u._get17,k=u.U,B=r==null;B&&(r=new s(i.length>>>2<<3));for(var Q,X,_e,aa,_i=0,_a=0,ga=X=0,_d=0;_i==0;)if(_i=l(i,_d,1),Q=l(i,_d+1,2),_d+=3,Q==0)7&_d&&(_d+=8-(7&_d)),Q=i[(_d=4+(_d>>>3))-4]|i[_d-3]<<8,B&&(r=G.F._check(r,ga+Q)),r.set(new s(i.buffer,i.byteOffset+_d,Q),ga),_d=_d+Q<<3,ga+=Q;else{if(B&&(r=G.F._check(r,ga+131072)),Q==1&&(_e=k.flmap,aa=k.fdmap,_a=511,X=31),Q==2){for(X=f(i,_d,5)+257,Q=f(i,_d+5,5)+1,_e=f(i,_d+10,4)+4,_d+=14,aa=0;38>aa;aa+=2)k.itree[aa]=0,k.itree[aa+1]=0;for(_a=1,aa=0;aa<_e;aa++){var d_=f(i,_d+3*aa,3);k.itree[1+(k.ordr[aa]<<1)]=d_,d_>_a&&(_a=d_)}_d+=3*_e,T(k.itree,_a),v(k.itree,_a,k.imap),_e=k.lmap,aa=k.dmap,_d=E(k.imap,(1<<_a)-1,X+Q,i,_d,k.ttree),_a=(1<<(d_=u._copyOut(k.ttree,0,X,k.ltree)))-1,X=(1<<(Q=u._copyOut(k.ttree,X,Q,k.dtree)))-1,T(k.ltree,d_),v(k.ltree,d_,_e),T(k.dtree,Q),v(k.dtree,Q,aa)}for(;;)if(_d+=15&(Q=_e[w(i,_d)&_a]),(d_=Q>>>4)>>>8==0)r[ga++]=d_;else{if(d_==256)break;Q=ga+d_-254,264<d_&&(Q=ga+((d_=k.ldef[d_-257])>>>3)+f(i,_d,7&d_),_d+=7&d_),_d+=15&(d_=aa[w(i,_d)&X]);var T_=((d_=k.ddef[d_>>>4])>>>4)+l(i,_d,15&d_);for(_d+=15&d_,B&&(r=G.F._check(r,ga+131072));ga<Q;)r[ga]=r[ga++-T_],r[ga]=r[ga++-T_],r[ga]=r[ga++-T_],r[ga]=r[ga++-T_];ga=Q}}return r.length==ga?r:r.slice(0,ga)},G.F._check=function(i,r){var s=i.length;return r<=s?i:((r=new Uint8Array(Math.max(s<<1,r))).set(i,0),r)},G.F._decodeTiny=function(i,r,s,u,l,f){for(var E=G.F._bitsE,T=G.F._get17,v=0;v<s;){var w=i[T(u,l)&r];l+=15&w;var k=w>>>4;if(15>=k)f[v]=k,v++;else{var B=w=0;for(k==16?(B=3+E(u,l,2),l+=2,w=f[v-1]):k==17?(B=3+E(u,l,3),l+=3):k==18&&(B=11+E(u,l,7),l+=7),k=v+B;v<k;)f[v]=w,v++}}return l},G.F._copyOut=function(i,r,s,u){for(var l=0,f=0,E=u.length>>>1;f<s;){var T=i[f+r];u[f<<1]=0,u[1+(f<<1)]=T,T>l&&(l=T),f++}for(;f<E;)u[f<<1]=0,u[1+(f<<1)]=0,f++;return l},G.F.makeCodes=function(i,r){var s,u,l=G.F.U,f=i.length,E=l.bl_count;for(s=0;s<=r;s++)E[s]=0;for(s=1;s<f;s+=2)E[i[s]]++;for(l=l.next_code,s=0,E[0]=0,u=1;u<=r;u++)s=s+E[u-1]<<1,l[u]=s;for(r=0;r<f;r+=2)(E=i[r+1])!=0&&(i[r]=l[E],l[E]++)},G.F.codes2map=function(i,r,s){for(var u=i.length,l=G.F.U.rev15,f=0;f<u;f+=2)if(i[f+1]!=0){var E=i[f+1],T=f>>1<<4|E,v=r-E;for(v=(E=i[f]<<v)+(1<<v);E!=v;)s[l[E]>>>15-r]=T,E++}},G.F.revCodes=function(i,r){for(var s=G.F.U.rev15,u=15-r,l=0;l<i.length;l+=2)i[l]=s[i[l]<<r-i[l+1]]>>>u},G.F._putsE=function(i,r,s){s<<=7&r,i[r>>>=3]|=s,i[r+1]|=s>>>8},G.F._putsF=function(i,r,s){s<<=7&r,i[r>>>=3]|=s,i[r+1]|=s>>>8,i[r+2]|=s>>>16},G.F._bitsE=function(i,r,s){return(i[r>>>3]|i[1+(r>>>3)]<<8)>>>(7&r)&(1<<s)-1},G.F._bitsF=function(i,r,s){return(i[r>>>3]|i[1+(r>>>3)]<<8|i[2+(r>>>3)]<<16)>>>(7&r)&(1<<s)-1},G.F._get17=function(i,r){return(i[r>>>3]|i[1+(r>>>3)]<<8|i[2+(r>>>3)]<<16)>>>(7&r)},G.F._get25=function(i,r){return(i[r>>>3]|i[1+(r>>>3)]<<8|i[2+(r>>>3)]<<16|i[3+(r>>>3)]<<24)>>>(7&r)},G.F.U=function(){var i=Uint16Array,r=Uint32Array;return{next_code:new i(16),bl_count:new i(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new i(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new r(32),flmap:new i(512),fltree:[],fdmap:new i(32),fdtree:[],lmap:new i(32768),ltree:[],ttree:[],dmap:new i(32768),dtree:[],imap:new i(512),itree:[],rev15:new i(32768),lhst:new r(286),dhst:new r(30),ihst:new r(19),lits:new r(15e3),strt:new i(65536),prev:new i(32768)}}(),function(){function i(l,f,E){for(;f--!=0;)l.push(0,E)}for(var r=G.F.U,s=0;32768>s;s++){var u=s;u=(4278255360&(u=(4042322160&(u=(3435973836&(u=(2863311530&u)>>>1|(1431655765&u)<<1))>>>2|(858993459&u)<<2))>>>4|(252645135&u)<<4))>>>8|(16711935&u)<<8,r.rev15[s]=(u>>>16|u<<16)>>>17}for(s=0;32>s;s++)r.ldef[s]=r.of0[s]<<3|r.exb[s],r.ddef[s]=r.df0[s]<<4|r.dxb[s];i(r.fltree,144,8),i(r.fltree,112,9),i(r.fltree,24,7),i(r.fltree,8,8),G.F.makeCodes(r.fltree,9),G.F.codes2map(r.fltree,9,r.flmap),G.F.revCodes(r.fltree,9),i(r.fdtree,32,5),G.F.makeCodes(r.fdtree,5),G.F.codes2map(r.fdtree,5,r.fdmap),G.F.revCodes(r.fdtree,5),i(r.itree,19,0),i(r.ltree,286,0),i(r.dtree,30,0),i(r.ttree,320,0)}();var DE=Array.isArray||function(i){return i&&typeof i.length=="number"},EE=Object.defineProperty({isArray:DE},"__esModule",{value:!0}),FE=Object.defineProperty({isObject:function(i){return i!==null&&qa(i)==="object"}},"__esModule",{value:!0}),GE=Object.defineProperty({isFunction:function(i){return typeof i=="function"}},"__esModule",{value:!0}),HE=function(){function i(r){return Error.call(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(s,u){return u+1+") "+s.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r,this}return i.prototype=Object.create(Error.prototype),i}(),uh=Object.defineProperty({UnsubscriptionError:HE},"__esModule",{value:!0}),IE=function(){function i(s){this.closed=!1,this._subscriptions=this._parentOrParents=null,s&&(this._ctorUnsubscribe=!0,this._unsubscribe=s)}var r;return i.prototype.unsubscribe=function(){if(!this.closed){var s=this._parentOrParents,u=this._ctorUnsubscribe,l=this._unsubscribe,f=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,s instanceof i)s.remove(this);else if(s!==null)for(var E=0;E<s.length;++E)s[E].remove(this);if(GE.isFunction(l)){u&&(this._unsubscribe=void 0);try{l.call(this)}catch(v){var T=v instanceof uh.UnsubscriptionError?eo(v.errors):[v]}}if(EE.isArray(f)){for(E=-1,s=f.length;++E<s;)if(u=f[E],FE.isObject(u))try{u.unsubscribe()}catch(v){T=T||[],v instanceof uh.UnsubscriptionError?T=T.concat(eo(v.errors)):T.push(v)}}if(T)throw new uh.UnsubscriptionError(T)}},i.prototype.add=function(s){var u=s;if(!s)return i.EMPTY;switch(qa(s)){case"function":u=new i(s);case"object":if(u===this||u.closed||typeof u.unsubscribe!="function")return u;if(this.closed)return u.unsubscribe(),u;u instanceof i||(s=u,(u=new i)._subscriptions=[s]);break;default:throw Error("unrecognized teardown "+s+" added to Subscription.")}if((s=u._parentOrParents)===null)u._parentOrParents=this;else if(s instanceof i){if(s===this)return u;u._parentOrParents=[s,this]}else{if(s.indexOf(this)!==-1)return u;s.push(this)}return(s=this._subscriptions)===null?this._subscriptions=[u]:s.push(u),u},i.prototype.remove=function(s){var u=this._subscriptions;u&&(s=u.indexOf(s))!==-1&&u.splice(s,1)},i.EMPTY=((r=new i).closed=!0,r),i}(),JE=Object.defineProperty({Subscription:IE},"__esModule",{value:!0}),KE=Ya&&Ya.__extends||function(){var i=function(r,s){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,l){u.__proto__=l}||function(u,l){for(var f in l)l.hasOwnProperty(f)&&(u[f]=l[f])})(r,s)};return function(r,s){function u(){this.constructor=r}i(r,s),r.prototype=s===null?Object.create(s):(u.prototype=s.prototype,new u)}}(),LE=function(i){function r(s,u){return i.call(this)||this}return KE(r,i),r.prototype.schedule=function(s,u){return this},r}(JE.Subscription),ME=Object.defineProperty({Action:LE},"__esModule",{value:!0}),NE=Ya&&Ya.__extends||function(){var i=function(r,s){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,l){u.__proto__=l}||function(u,l){for(var f in l)l.hasOwnProperty(f)&&(u[f]=l[f])})(r,s)};return function(r,s){function u(){this.constructor=r}i(r,s),r.prototype=s===null?Object.create(s):(u.prototype=s.prototype,new u)}}(),gt=function(i){function r(s,u){var l=i.call(this,s,u)||this;return l.scheduler=s,l.work=u,l.pending=!1,l}return NE(r,i),r.prototype.schedule=function(s,u){if(u===void 0&&(u=0),this.closed)return this;this.state=s,s=this.id;var l=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(l,s,u)),this.pending=!0,this.delay=u,this.id=this.id||this.requestAsyncId(l,this.id,u),this},r.prototype.requestAsyncId=function(s,u,l){return l===void 0&&(l=0),setInterval(s.flush.bind(s,this),l)},r.prototype.recycleAsyncId=function(s,u,l){if(l===void 0&&(l=0),l!==null&&this.delay===l&&this.pending===!1)return u;clearInterval(u)},r.prototype.execute=function(s,u){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(s=this._execute(s,u))?s:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},r.prototype._execute=function(s,u){u=!1;var l=void 0;try{this.work(s)}catch(f){u=!0,l=!!f&&f||Error(f)}if(u)return this.unsubscribe(),l},r.prototype._unsubscribe=function(){var s=this.id,u=this.scheduler,l=u.actions,f=l.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,f!==-1&&l.splice(f,1),s!=null&&(this.id=this.recycleAsyncId(u,s,null)),this.delay=null},r}(ME.Action),OE=function(){function i(r,s){s===void 0&&(s=i.now),this.SchedulerAction=r,this.now=s}return i.prototype.schedule=function(r,s,u){return s===void 0&&(s=0),new this.SchedulerAction(this,r).schedule(u,s)},i.now=function(){return Date.now()},i}(),ht=Object.defineProperty({Scheduler:OE},"__esModule",{value:!0}),PE=Ya&&Ya.__extends||function(){var i=function(r,s){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,l){u.__proto__=l}||function(u,l){for(var f in l)l.hasOwnProperty(f)&&(u[f]=l[f])})(r,s)};return function(r,s){function u(){this.constructor=r}i(r,s),r.prototype=s===null?Object.create(s):(u.prototype=s.prototype,new u)}}(),it=function(i){function r(s,u){u===void 0&&(u=ht.Scheduler.now);var l=i.call(this,s,function(){return r.delegate&&r.delegate!==l?r.delegate.now():u()})||this;return l.actions=[],l.active=!1,l.scheduled=void 0,l}return PE(r,i),r.prototype.schedule=function(s,u,l){return u===void 0&&(u=0),r.delegate&&r.delegate!==this?r.delegate.schedule(s,u,l):i.prototype.schedule.call(this,s,u,l)},r.prototype.flush=function(s){var u=this.actions;if(this.active)u.push(s);else{var l;this.active=!0;do if(l=s.execute(s.state,s.delay))break;while(s=u.shift());if(this.active=!1,l){for(;s=u.shift();)s.unsubscribe();throw l}}},r}(ht.Scheduler),QE=Fa("iterator"),Wl=!la(function(){var i=new URL("b?a=1&b=2&c=3","http://a"),r=i.searchParams,s="";return i.pathname="c%20d",r.forEach(function(u,l){r.delete("b"),s+=l+u}),!r.sort||i.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[QE]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://ÑÐµÑÑ").host!=="xn--e1aybc"||new URL("http://a#Ð±").hash!=="#%D0%B1"||s!=="a1c3"||new URL("http://x",void 0).host!=="x"}),RE=/[^\0-\u007E]/,SE=/[.\u3002\uFF0E\uFF61]/g,Ff=Math.floor,Xl=String.fromCharCode,jt=function(i){var r=lg(i);if(typeof r!="function")throw TypeError(String(i)+" is not iterable");return Ia(r.call(i))},kt=Pc("fetch"),Yl=Pc("Headers"),TE=Fa("iterator"),lt=cb.set,cc=cb.getterFor("URLSearchParams"),UE=cb.getterFor("URLSearchParamsIterator"),VE=/\+/g,mt=Array(4),WE=function(i){try{return decodeURIComponent(i)}catch{return i}},nt=function(i){var r=i.replace(VE," ");i=4;try{return decodeURIComponent(r)}catch{for(;i;){var s=r.replace,u=i--;u=mt[u-1]||(mt[u-1]=RegExp("((?:%[\\da-f]{2}){"+u+"})","gi")),r=s.call(r,u,WE)}return r}},ot=/[!'()~]|%20/g,XE={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},pt=function(i){return XE[i]},qt=function(i,r){if(r){r=r.split("&");for(var s,u=0;u<r.length;)(s=r[u++]).length&&(s=s.split("="),i.push({key:nt(s.shift()),value:nt(s.join("="))}))}},YE=function(i){this.entries.length=0,qt(this.entries,i)},Gf=function(i,r){if(i<r)throw TypeError("Not enough arguments")},Zl=Wo(function(i,r){lt(this,{type:"URLSearchParamsIterator",iterator:jt(cc(i).entries),kind:r})},"Iterator",function(){var i=UE(this),r=i.kind,s=(i=i.iterator.next()).value;return i.done||(i.value=r==="keys"?s.key:r==="values"?s.value:[s.key,s.value]),i}),Rg=function(){Ac(this,Rg,"URLSearchParams");var i,r,s,u=0<arguments.length?arguments[0]:void 0,l=[];if(lt(this,{type:"URLSearchParams",entries:l,updateURL:function(){},updateSearchParams:YE}),u!==void 0)if(xa(u)){var f=lg(u);if(typeof f=="function")for(u=f.call(u),f=u.next;!(i=f.call(u)).done;){var E=(i=jt(Ia(i.value))).next;if((r=E.call(i)).done||(s=E.call(i)).done||!E.call(i).done)throw TypeError("Expected sequence with length 2");l.push({key:r.value+"",value:s.value+""})}else for(i in u)ka(u,i)&&l.push({key:i,value:u[i]+""})}else qt(l,typeof u=="string"?u.charAt(0)==="?"?u.slice(1):u:u+"")},Bi=Rg.prototype;kf(Bi,{append:function(i,r){Gf(arguments.length,2);var s=cc(this);s.entries.push({key:i+"",value:r+""}),s.updateURL()},delete:function(i){Gf(arguments.length,1);for(var r=cc(this),s=r.entries,u=i+"",l=0;l<s.length;)s[l].key===u?s.splice(l,1):l++;r.updateURL()},get:function(i){Gf(arguments.length,1);for(var r=cc(this).entries,s=i+"",u=0;u<r.length;u++)if(r[u].key===s)return r[u].value;return null},getAll:function(i){Gf(arguments.length,1);for(var r=cc(this).entries,s=i+"",u=[],l=0;l<r.length;l++)r[l].key===s&&u.push(r[l].value);return u},has:function(i){Gf(arguments.length,1);for(var r=cc(this).entries,s=i+"",u=0;u<r.length;)if(r[u++].key===s)return!0;return!1},set:function(i,r){Gf(arguments.length,1);for(var s,u=cc(this),l=u.entries,f=!1,E=i+"",T=r+"",v=0;v<l.length;v++)(s=l[v]).key===E&&(f?l.splice(v--,1):(f=!0,s.value=T));f||l.push({key:E,value:T}),u.updateURL()},sort:function(){var i,r,s=cc(this),u=s.entries,l=u.slice();for(r=u.length=0;r<l.length;r++){var f=l[r];for(i=0;i<r;i++)if(u[i].key>f.key){u.splice(i,0,f);break}i===r&&u.push(f)}s.updateURL()},forEach:function(i){for(var r,s=cc(this).entries,u=Dd(i,1<arguments.length?arguments[1]:void 0,3),l=0;l<s.length;)u((r=s[l++]).value,r.key,this)},keys:function(){return new Zl(this,"keys")},values:function(){return new Zl(this,"values")},entries:function(){return new Zl(this,"entries")}},{enumerable:!0}),Za(Bi,TE,Bi.entries),Za(Bi,"toString",function(){for(var i,r=cc(this).entries,s=[],u=0;u<r.length;)i=r[u++],s.push(encodeURIComponent(i.key).replace(ot,pt)+"="+encodeURIComponent(i.value).replace(ot,pt));return s.join("&")},{enumerable:!0}),zc(Rg,"URLSearchParams"),ea({global:!0,forced:!Wl},{URLSearchParams:Rg}),Wl||typeof kt!="function"||typeof Yl!="function"||ea({global:!0,enumerable:!0,forced:!0},{fetch:function(i){var r=[i];if(1<arguments.length){var s=arguments[1];if(xa(s)){var u=s.body;if(jf(u)==="URLSearchParams"){var l=s.headers?new Yl(s.headers):new Yl;l.has("content-type")||l.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),s=jc(s,{body:Nc(0,String(u)),headers:Nc(0,l)})}}r.push(s)}return kt.apply(this,r)}});var Sg=R.URL,ZE=Rg,$E=cb.set,db=cb.getterFor("URL"),aF=Math.floor,rt=Math.pow,st=/[A-Za-z]/,bF=/[\d+-.A-Za-z]/,$l=/\d/,cF=/^(0x|0X)/,dF=/^[0-7]+$/,eF=/^\d+$/,tt=/^[\dA-Fa-f]+$/,fF=/[\0\t\n\r #%/:?@[\\]]/,gF=/[\0\t\n\r #/:?@[\\]]/,hF=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,iF=/[\t\n\r]/g,am=function(i,r){var s;if(r.charAt(0)=="["){if(r.charAt(r.length-1)!="]")return"Invalid host";var u=jF(r.slice(1,-1));if(!u)return"Invalid host"}else if(wb(i)){for(u=[],r=r.toLowerCase().replace(SE,".").split("."),s=0;s<r.length;s++){var l=r[s],f=u,E=f.push;if(RE.test(l)){var T=l;l=[];var v=T;T=[];for(var w=0,k=v.length;w<k;){var B=v.charCodeAt(w++);if(55296<=B&&56319>=B&&w<k){var Q=v.charCodeAt(w++);(64512&Q)==56320?T.push(((1023&B)<<10)+(1023&Q)+65536):(T.push(B),w--)}else T.push(B)}w=T.length,k=128;var X=0,_e=72;for(v=0;v<T.length;v++){var aa=T[v];128>aa&&l.push(Xl(aa))}for((Q=B=l.length)&&l.push("-");Q<w;){var _i=2147483647;for(v=0;v<T.length;v++)(aa=T[v])>=k&&aa<_i&&(_i=aa);var _a=Q+1;if(_i-k>Ff((2147483647-X)/_a))throw RangeError("Overflow: input needs wider integers to process");for(X+=(_i-k)*_a,k=_i,v=0;v<T.length;v++){if((aa=T[v])<k&&2147483647<++X)throw RangeError("Overflow: input needs wider integers to process");if(aa==k){var ga=X;for(aa=36;!(ga<(_i=aa<=_e?1:aa>=_e+26?26:aa-_e));aa+=36){var _d=36-_i,d_=l;_i+=(ga-=_i)%_d,d_.push.call(d_,Xl(_i+22+75*(26>_i))),ga=Ff(ga/_d)}for(l.push(Xl(ga+22+75*(26>ga))),_e=_a,aa=0,X=Q==B?Ff(X/700):X>>1,X+=Ff(X/_e);455<X;aa+=36)X=Ff(X/35);_e=Ff(aa+36*X/(X+38)),X=0,++Q}}++X,++k}l="xn--"+l.join("")}E.call(f,l)}if(r=u.join("."),fF.test(r)||(u=kF(r))===null)return"Invalid host"}else{if(gF.test(r))return"Invalid host";for(u="",r=ge(r),s=0;s<r.length;s++)u+=Qd(r[s],Ci)}i.host=u},kF=function(i){var r,s=i.split(".");s.length&&s[s.length-1]==""&&s.pop();var u=s.length;if(4<u)return i;var l=[];for(r=0;r<u;r++){var f=s[r];if(f=="")return i;var E=10;if(1<f.length&&f.charAt(0)=="0"&&(E=cF.test(f)?16:8,f=f.slice(E==8?1:2)),f==="")f=0;else{if(!(E==10?eF:E==8?dF:tt).test(f))return i;f=parseInt(f,E)}l.push(f)}for(r=0;r<u;r++)if(f=l[r],r==u-1){if(f>=rt(256,5-u))return null}else if(255<f)return null;for(i=l.pop(),r=0;r<l.length;r++)i+=l[r]*rt(256,3-r);return i},jF=function(i){var r,s,u=[0,0,0,0,0,0,0,0],l=0,f=null,E=0,T=function(){return i.charAt(E)};if(T()==":"){if(i.charAt(1)!=":")return;E+=2,f=++l}for(;T();){if(l==8)return;if(T()==":"){if(f!==null)return;E++,f=++l}else{for(r=s=0;4>s&&tt.test(T());)r=16*r+parseInt(T(),16),E++,s++;if(T()=="."){if(s==0||(E-=s,6<l))return;for(r=0;T();){if(s=null,0<r){if(!(T()=="."&&4>r))return;E++}if(!$l.test(T()))return;for(;$l.test(T());){var v=parseInt(T(),10);if(s===null)s=v;else{if(s==0)return;s=10*s+v}if(255<s)return;E++}u[l]=256*u[l]+s,++r!=2&&r!=4||l++}if(r!=4)return;break}if(T()==":"){if(E++,!T())return}else if(T())return;u[l++]=r}}if(f!==null)for(T=l-f,l=7;l!=0&&0<T;)r=u[l],u[l--]=u[f+T-1],u[f+--T]=r;else if(l!=8)return;return u},Tg=function(i){var r,s;if(typeof i=="number"){var u=[];for(r=0;4>r;r++)u.unshift(i%256),i=aF(i/256);return u.join(".")}if(typeof i=="object"){u="",r=null;for(var l=1,f=null,E=0,T=0;8>T;T++)i[T]!==0?(E>l&&(r=f,l=E),f=null,E=0):(f===null&&(f=T),++E);for(E>l&&(r=f),l=r,r=0;8>r;r++)s&&i[r]===0||(s&&(s=!1),l===r?(u+=r?":":"::",s=!0):(u+=i[r].toString(16),7>r&&(u+=":")));return"["+u+"]"}return i},Ci={},ut=Bg({},Ci,{" ":1,'"':1,"<":1,">":1,"`":1}),vt=Bg({},ut,{"#":1,"?":1,"{":1,"}":1}),bm=Bg({},vt,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Qd=function(i,r){var s=uw(i,0);return 32<s&&127>s&&!ka(r,i)?i:encodeURIComponent(i)},Di={ftp:21,file:null,http:80,https:443,ws:80,wss:443},wb=function(i){return ka(Di,i.scheme)},cm=function(i){return!i.host||i.cannotBeABaseURL||i.scheme=="file"},Ug=function(i,r){var s;return i.length==2&&st.test(i.charAt(0))&&((s=i.charAt(1))==":"||!r&&s=="|")},wt=function(i){var r;return 1<i.length&&Ug(i.slice(0,2))&&(i.length==2||(r=i.charAt(2))==="/"||r==="\\"||r==="?"||r==="#")},xt=function(i){var r=i.path,s=r.length;!s||i.scheme=="file"&&s==1&&Ug(r[0],!0)||r.pop()},dm={},yt={},em={},zt={},At={},fm={},Bt={},Ct={},Ei={},Fi={},gm={},hm={},im={},jm={},Dt={},km={},Vg={},Yc={},Et={},ye={},vd={},Zc=function(i,r,s,u){var l=s||dm,f=0,E="",T=!1,v=!1,w=!1;for(s||(i.scheme="",i.username="",i.password="",i.host=null,i.port=null,i.path=[],i.query=null,i.fragment=null,i.cannotBeABaseURL=!1,r=r.replace(hF,"")),r=r.replace(iF,""),r=ge(r);f<=r.length;){var k=r[f];switch(l){case dm:if(!k||!st.test(k)){if(s)return"Invalid scheme";l=em;continue}E+=k.toLowerCase(),l=yt;break;case yt:if(k&&(bF.test(k)||k=="+"||k=="-"||k=="."))E+=k.toLowerCase();else{if(k!=":"){if(s)return"Invalid scheme";E="",l=em,f=0;continue}if(s&&(wb(i)!=ka(Di,E)||E=="file"&&(i.username!=""||i.password!=""||i.port!==null)||i.scheme=="file"&&!i.host))return;if(i.scheme=E,s)return void(wb(i)&&Di[i.scheme]==i.port&&(i.port=null));E="",i.scheme=="file"?l=jm:wb(i)&&u&&u.scheme==i.scheme?l=zt:wb(i)?l=Ct:r[f+1]=="/"?(l=At,f++):(i.cannotBeABaseURL=!0,i.path.push(""),l=Et)}break;case em:if(!u||u.cannotBeABaseURL&&k!="#")return"Invalid scheme";if(u.cannotBeABaseURL&&k=="#"){i.scheme=u.scheme,i.path=u.path.slice(),i.query=u.query,i.fragment="",i.cannotBeABaseURL=!0,l=vd;break}l=u.scheme=="file"?jm:fm;continue;case zt:if(k!="/"||r[f+1]!="/"){l=fm;continue}l=Ei,f++;break;case At:if(k=="/"){l=Fi;break}l=Yc;continue;case fm:if(i.scheme=u.scheme,k==null)i.username=u.username,i.password=u.password,i.host=u.host,i.port=u.port,i.path=u.path.slice(),i.query=u.query;else if(k=="/"||k=="\\"&&wb(i))l=Bt;else if(k=="?")i.username=u.username,i.password=u.password,i.host=u.host,i.port=u.port,i.path=u.path.slice(),i.query="",l=ye;else{if(k!="#"){i.username=u.username,i.password=u.password,i.host=u.host,i.port=u.port,i.path=u.path.slice(),i.path.pop(),l=Yc;continue}i.username=u.username,i.password=u.password,i.host=u.host,i.port=u.port,i.path=u.path.slice(),i.query=u.query,i.fragment="",l=vd}break;case Bt:if(!wb(i)||k!="/"&&k!="\\"){if(k!="/"){i.username=u.username,i.password=u.password,i.host=u.host,i.port=u.port,l=Yc;continue}l=Fi}else l=Ei;break;case Ct:if(l=Ei,k!="/"||E.charAt(f+1)!="/")continue;f++;break;case Ei:if(k!="/"&&k!="\\"){l=Fi;continue}break;case Fi:if(k=="@"){for(T&&(E="%40"+E),T=!0,E=ge(E),k=0;k<E.length;k++){var B=E[k];B!=":"||w?(B=Qd(B,bm),w?i.password+=B:i.username+=B):w=!0}E=""}else if(k==null||k=="/"||k=="?"||k=="#"||k=="\\"&&wb(i)){if(T&&E=="")return"Invalid authority";f-=ge(E).length+1,E="",l=gm}else E+=k;break;case gm:case hm:if(s&&i.scheme=="file"){l=km;continue}if(k!=":"||v){if(k==null||k=="/"||k=="?"||k=="#"||k=="\\"&&wb(i)){if(wb(i)&&E=="")return"Invalid host";if(s&&E==""&&(i.username!=""||i.password!=""||i.port!==null))return;if(l=am(i,E))return l;if(E="",l=Vg,s)return;continue}k=="["?v=!0:k=="]"&&(v=!1),E+=k}else{if(E=="")return"Invalid host";if(l=am(i,E))return l;if(E="",l=im,s==hm)return}break;case im:if(!$l.test(k)){if(k==null||k=="/"||k=="?"||k=="#"||k=="\\"&&wb(i)||s){if(E!=""){if(65535<(l=parseInt(E,10)))return"Invalid port";i.port=wb(i)&&l===Di[i.scheme]?null:l,E=""}if(s)return;l=Vg;continue}return"Invalid port"}E+=k;break;case jm:if(i.scheme="file",k=="/"||k=="\\")l=Dt;else{if(!u||u.scheme!="file"){l=Yc;continue}if(k==null)i.host=u.host,i.path=u.path.slice(),i.query=u.query;else if(k=="?")i.host=u.host,i.path=u.path.slice(),i.query="",l=ye;else{if(k!="#"){wt(r.slice(f).join(""))||(i.host=u.host,i.path=u.path.slice(),xt(i)),l=Yc;continue}i.host=u.host,i.path=u.path.slice(),i.query=u.query,i.fragment="",l=vd}}break;case Dt:if(k=="/"||k=="\\"){l=km;break}u&&u.scheme=="file"&&!wt(r.slice(f).join(""))&&(Ug(u.path[0],!0)?i.path.push(u.path[0]):i.host=u.host),l=Yc;continue;case km:if(k==null||k=="/"||k=="\\"||k=="?"||k=="#"){if(!s&&Ug(E))l=Yc;else{if(E==""){if(i.host="",s)return}else{if(l=am(i,E))return l;if(i.host=="localhost"&&(i.host=""),s)return;E=""}l=Vg}continue}E+=k;break;case Vg:if(wb(i)){if(l=Yc,k!="/"&&k!="\\")continue}else if(s||k!="?")if(s||k!="#"){if(k!=null&&(l=Yc,k!="/"))continue}else i.fragment="",l=vd;else i.query="",l=ye;break;case Yc:if(k==null||k=="/"||k=="\\"&&wb(i)||!s&&(k=="?"||k=="#")){if((B=(B=E).toLowerCase())===".."||B==="%2e."||B===".%2e"||B==="%2e%2e"?(xt(i),k=="/"||k=="\\"&&wb(i)||i.path.push("")):E==="."||E.toLowerCase()==="%2e"?k=="/"||k=="\\"&&wb(i)||i.path.push(""):(i.scheme=="file"&&!i.path.length&&Ug(E)&&(i.host&&(i.host=""),E=E.charAt(0)+":"),i.path.push(E)),E="",i.scheme=="file"&&(k==null||k=="?"||k=="#"))for(;1<i.path.length&&i.path[0]==="";)i.path.shift();k=="?"?(i.query="",l=ye):k=="#"&&(i.fragment="",l=vd)}else E+=Qd(k,vt);break;case Et:k=="?"?(i.query="",l=ye):k=="#"?(i.fragment="",l=vd):k!=null&&(i.path[0]+=Qd(k,Ci));break;case ye:s||k!="#"?k!=null&&(k=="'"&&wb(i)?i.query+="%27":i.query=k=="#"?i.query+"%23":i.query+Qd(k,Ci)):(i.fragment="",l=vd);break;case vd:k!=null&&(i.fragment+=Qd(k,ut))}f++}},Rd=function(i){var r=Ac(this,Rd,"URL"),s=1<arguments.length?arguments[1]:void 0,u=String(i),l=$E(r,{type:"URL"});if(s!==void 0){if(s instanceof Rd)var f=db(s);else if(s=Zc(f={},String(s)))throw TypeError(s)}if(s=Zc(l,u,null,f))throw TypeError(s);var E=l.searchParams=new ZE;(u=cc(E)).updateSearchParams(l.query),u.updateURL=function(){l.query=String(E)||null},wa||(r.href=Gi.call(r),r.origin=Ft.call(r),r.protocol=Gt.call(r),r.username=Ht.call(r),r.password=It.call(r),r.host=Jt.call(r),r.hostname=Kt.call(r),r.port=Lt.call(r),r.pathname=Mt.call(r),r.search=Nt.call(r),r.searchParams=Ot.call(r),r.hash=Pt.call(r))},lm=Rd.prototype,Gi=function(){var i=db(this),r=i.scheme,s=i.username,u=i.password,l=i.host,f=i.port,E=i.path,T=i.query,v=i.fragment,w=r+":";return l!==null?(w+="//",i.username==""&&i.password==""||(w+=s+(u?":"+u:"")+"@"),w+=Tg(l),f!==null&&(w+=":"+f)):r=="file"&&(w+="//"),w+=i.cannotBeABaseURL?E[0]:E.length?"/"+E.join("/"):"",T!==null&&(w+="?"+T),v!==null&&(w+="#"+v),w},Ft=function(){var i=db(this),r=i.scheme,s=i.port;if(r=="blob")try{return new Rd(r.path[0]).origin}catch{return"null"}return r!="file"&&wb(i)?r+"://"+Tg(i.host)+(s!==null?":"+s:""):"null"},Gt=function(){return db(this).scheme+":"},Ht=function(){return db(this).username},It=function(){return db(this).password},Jt=function(){var i=db(this),r=i.host;return i=i.port,r===null?"":i===null?Tg(r):Tg(r)+":"+i},Kt=function(){var i=db(this).host;return i===null?"":Tg(i)},Lt=function(){var i=db(this).port;return i===null?"":String(i)},Mt=function(){var i=db(this),r=i.path;return i.cannotBeABaseURL?r[0]:r.length?"/"+r.join("/"):""},Nt=function(){var i=db(this).query;return i?"?"+i:""},Ot=function(){return db(this).searchParams},Pt=function(){var i=db(this).fragment;return i?"#"+i:""},tc=function(i,r){return{get:i,set:r,configurable:!0,enumerable:!0}};if(wa&&To(lm,{href:tc(Gi,function(i){var r=db(this);if(i=Zc(r,String(i)))throw TypeError(i);cc(r.searchParams).updateSearchParams(r.query)}),origin:tc(Ft),protocol:tc(Gt,function(i){var r=db(this);Zc(r,String(i)+":",dm)}),username:tc(Ht,function(i){var r=db(this);if(i=ge(String(i)),!cm(r)){r.username="";for(var s=0;s<i.length;s++)r.username+=Qd(i[s],bm)}}),password:tc(It,function(i){var r=db(this);if(i=ge(String(i)),!cm(r)){r.password="";for(var s=0;s<i.length;s++)r.password+=Qd(i[s],bm)}}),host:tc(Jt,function(i){var r=db(this);r.cannotBeABaseURL||Zc(r,String(i),gm)}),hostname:tc(Kt,function(i){var r=db(this);r.cannotBeABaseURL||Zc(r,String(i),hm)}),port:tc(Lt,function(i){var r=db(this);cm(r)||((i=String(i))==""?r.port=null:Zc(r,i,im))}),pathname:tc(Mt,function(i){var r=db(this);r.cannotBeABaseURL||(r.path=[],Zc(r,i+"",Vg))}),search:tc(Nt,function(i){var r=db(this);(i=String(i))==""?r.query=null:(i.charAt(0)=="?"&&(i=i.slice(1)),r.query="",Zc(r,i,ye)),cc(r.searchParams).updateSearchParams(r.query)}),searchParams:tc(Ot),hash:tc(Pt,function(i){var r=db(this);(i=String(i))==""?r.fragment=null:(i.charAt(0)=="#"&&(i=i.slice(1)),r.fragment="",Zc(r,i,vd))})}),Za(lm,"toJSON",function(){return Gi.call(this)},{enumerable:!0}),Za(lm,"toString",function(){return Gi.call(this)},{enumerable:!0}),Sg){var Qt=Sg.createObjectURL,Rt=Sg.revokeObjectURL;Qt&&Za(Rd,"createObjectURL",function(i){return Qt.apply(Sg,arguments)}),Rt&&Za(Rd,"revokeObjectURL",function(i){return Rt.apply(Sg,arguments)})}zc(Rd,"URL"),ea({global:!0,forced:!Wl,sham:!wa},{URL:Rd});var lF=new Blob(["var fakeIdToId = {};onmessage = function (event) {	var data = event.data,		name = data.name,		fakeId = data.fakeId,		time;	if(data.hasOwnProperty('time')) {		time = data.time;	}	switch (name) {		case 'setInterval':			fakeIdToId[fakeId] = setInterval(function () {				postMessage({fakeId: fakeId});			}, time);			break;		case 'clearInterval':			if (fakeIdToId.hasOwnProperty (fakeId)) {				clearInterval(fakeIdToId[fakeId]);				delete fakeIdToId[fakeId];			}			break;	}}"]),mF=window.URL.createObjectURL(lF),Ze={},dg=0,Aj=new Worker(mF);Aj.onmessage=function(i){if(i=i.data.fakeId,Ze.hasOwnProperty(i)){var r=Ze[i];i=r.callback,r=r.parameters,i.apply(window,r)}};var nF=function(i){function r(){return va(this,r),s.apply(this,arguments)}Ga(r,i);var s=Ha(r);return eb(r,[{key:"requestAsyncId",value:function(u,l){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;return Qv(u.flush.bind(u,this),f)}},{key:"recycleAsyncId",value:function(u,l){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;if(f!==null&&this.delay===f&&this.pending===!1)return l;Ze.hasOwnProperty(l)&&(delete Ze[l],Aj.postMessage({name:"clearInterval",fakeId:l}))}}]),r}(gt),oF=new it(nF),pF=["group"],mm=G.inflate,St=G.deflate,Tt=function(i){function r(l,f,E,T){va(this,r);var v=u.call(this,T,"Session");return x(z(v),"lastNoticeTicket",""),x(z(v),"chatManager",void 0),x(z(v),"usedChannelIds",[]),x(z(v),"msgDedupLru",new Wc(void 0,{maxlen:200})),x(z(v),"startTime",Date.now()),x(z(v),"seq",P.fromNumber(1,!0)),x(z(v),"userJoinOptions",new et(!1)),x(z(v),"seqSentStatuses",[!1,!1]),x(z(v),"dialogueSequenceLru",new Wc(void 0,{maxlen:1e4})),x(z(v),"loggedOut",!1),x(z(v),"messageSentTimes",[]),x(z(v),"curLoginSockets",[void 0,void 0]),x(z(v),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),x(z(v),"lastLoginSockets",[new Te(1),new Te(1)]),x(z(v),"dialPendingMsgSubjectMap",new Map),x(z(v),"context",void 0),x(z(v),"connection",void 0),x(z(v),"instanceId",void 0),x(z(v),"lastPingTime",void 0),x(z(v),"chanelStringMessageReport",void 0),x(z(v),"chanelRawMessageReport",void 0),x(z(v),"p2pSMsgNoOfflineReport",void 0),x(z(v),"p2pRMsgNoOfflineReport",void 0),x(z(v),"registerSocketsFailureListener",function(){v.connection.once("socketsFailure",function(){v.log("socketsFailure, creating a new connection"),yd(function(){return v.connection.removeAllListeners(),v.connection=new ct(v.context,v.logger,!0),v.loginHandler(15e3,!0)}).pipe(Re(function(w){return w.pipe(Zd(ue.getParameter("RECONNECTING_AP_INTERVAL")))}),Kc(v.connection.apClient.apFinish$)).subscribe(function(){v.log("new connection connected")})}),v.connection.listenerCount("tokenExpired")===0&&v.connection.on("tokenExpired",function(){v.emit("tokenExpired")})}),v.context=l,v.context.startTime=v.startTime,v.connection=f,v.instanceId=E,v.chatManager=new CE(T),v.lastPingTime=[0,0],v.setMaxListeners(512),v.log("The instanceId is %s",v.instanceId.toString()),v.chanelStringMessageReport=new zi(l,T,Ka.ChannelSMsg),v.chanelRawMessageReport=new zi(l,T,Ka.ChannelRMsg),v.p2pSMsgNoOfflineReport=new zi(l,T,Ka.P2pSMsgNoOfflineFlag),v.p2pRMsgNoOfflineReport=new zi(l,T,Ka.P2pRMsgNoOfflineFlag),v}Ga(r,i);var s,u=Ha(r);return eb(r,[{key:"loginHandler",value:function(){var l=this,f=0<arguments.length&&arguments[0]!==void 0?arguments[0]:12e3,E=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(this.loggedOut&&E)throw new da("Already logged out, request ignored");E&&this.registerSocketsFailureListener(),this.connection.initConnection();var T=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),v=Date.now();return T.forEach(function(w,k){var B=l.loginSocketSubs[k].login;B!==void 0&&B.unsubscribe(),l.loginSocketSubs[k].login=w.pipe(sa(function(Q){var X;l.curLoginSockets[k]=Q;var _e=Date.now();bb("Link",{ackedServerIp:Q.address,destServerIp:Q.ip,ec:0,sc:0,elapse:Xa(l.startTime),lts:P.fromNumber(_e),responseTime:_e-v,sid:sb(l.instanceId),userId:l.context.uid},(X=l.context.config.enableCloudProxy)!==null&&X!==void 0&&X),l.emit("userJoined",Q.env),E&&l.connection.apClient.apFinish$.next(void 0)})).subscribe(l.lastLoginSockets[k])}),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Jb.apply(void 0,Z(T).concat([Db(this.connection,"connectionInitFailure").pipe(sa(function(w){throw Na(w)||Ab(w)?w:new Ja("Login failure",{code:$r,originalError:w})}))])).pipe(hb(1),Lb(f),ab(function(w){return w instanceof Tb&&l.warn("Client login timeout"),w&&w.code===ti&&(l.connection.emit("tokenExpired"),l.connection.apClient.apFinish$.next(void 0)),l.clearSockets(0,E),ra(w)}),sa(function(){E||l.registerSocketsFailureListener()}),fh(function(){E||l.connection.apClient.apFinish$.next(void 0)}))}},{key:"logoutHandler",value:(s=ma(N.mark(function l(){var f,E,T,v=this;return N.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),f=this.getLoginSockets(),E=f.map(function(k){return k.sendPacket("UserQuit",{}),v.connection.waitClosing(k)}),this.clearSockets(5e3),T=f.map(function(k){return k.env}),[0,1].filter(function(k){return!T.includes(k)}).forEach(function(k){v.connection.closeSocket(k,0)}),w.abrupt("return",Jb.apply(void 0,Z(E)).toPromise());case 9:case"end":return w.stop()}},l,this)})),function(){return s.apply(this,arguments)})},{key:"requestChannelJoin",value:function(){var l=ma(N.mark(function f(E){var T,v,w,k=this;return N.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(this.getLoginSockets().length!==0){B.next=2;break}throw new da("Client is not logged in. Cannot join the channel",Wr);case 2:return T=Db(this,"channelLeft").pipe(yb(function(Q){return E===Q}),hb(1)),v=this.incGetSeq(),(w=this.lastLoginSockets.map(function(Q){return Q.pipe(Kb(function(X,_e){_e!==0&&k.incSeqIfNeeded(X.env);var aa=_e===0?v:k.seq;return X.sendPacket("GroupEnter",{account:E,seq:aa}),X.fromReceived("GroupReply").pipe(Ca(function(_i){return aa.eq(_i.seq)}),sa(function(_i){if((_i=_i.code)!==0)throw new Ja(["Channel join failure. The response code is %d",_i],Sr)}))}),Kc(T),Se())})).forEach(function(Q,X){var _e=function(){return k.loginSocketSubs[X].channels.delete(E)};k.loginSocketSubs[X].channels.set(E,Q.subscribe({error:_e,complete:_e}))}),B.next=8,Jb.apply(void 0,Z(w)).pipe(hb(1),Lb(1e4),ab(function(Q){return Q instanceof Tb&&k.warn("Channel join timeout"),ra(Q)})).toPromise();case 8:case"end":return B.stop()}},f,this)}));return function(f){return l.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(l){this.getLoginSockets().forEach(function(f){f.sendPacket("GroupLeave",{account:l})})}},{key:"requestUpdateEdgeTicket",value:function(l){var f=this,E=this.getLoginSockets();if(E.length===0)throw new da("Client is not logged in. Cannot renew token",hs);var T=this.incGetSeq();return E.forEach(function(v){v.sendPacket("UserRenewTokenReq",{instance:f.instanceId,seq:T,account:f.context.uid,ticket:l})}),fb.apply(void 0,[r.genTimeoutError(Ml)].concat(Z(E.map(function(v){return v.fromReceived("UserRenewTokenResp").pipe(Ca(function(w){var k=w.code;return T.eq(w.seq)&&k===0}))}))))}},{key:"requestChannelMemberList",value:function(l){var f=this.getLoginSockets();if(f.length===0)throw new da("Client is not logged in. Cannot get the channel members",JB);var E=this.incGetSeq();return f.forEach(function(T){T.sendPacket("GroupAllUsersList",{group:l,pageNumber:0,pageSize:200,seq:E})}),fb.apply(void 0,[r.genTimeoutError(Qr)].concat(Z(f.map(function(T){return T.fromReceived("GroupAllUsersResult").pipe(Ca(function(v){var w=v.seq;return v.group===l&&E.eq(w)}))}))))}},{key:"requestPeersOnlineStatus",value:function(l){var f=this.getLoginSockets();if(f.length===0)throw new da("Client is not logged in");var E=this.incGetSeq();return f.forEach(function(T){T.sendPacket("UserStatusList",{users:l,seq:E})}),fb.apply(void 0,[r.genTimeoutError(VB)].concat(Z(f.map(function(T){return T.fromReceived("UserStatusResult").pipe(Ca(function(v){return E.eq(v.seq)}))}))))}},{key:"requestSetLocalUserAttributes",value:function(l,f){var E=this,T=this.getLoginSockets();if(T.length===0)throw new da("Client is not logged in");var v=this.incGetSeq();return T.forEach(function(w,k){f!==void 0&&k!==f||w.sendPacket("UserAttributeSet",{account:E.context.uid,attributeInfos:Object.entries(l).map(function(B){return{key:(B=$a(B,2))[0],value:B[1]}}),seq:v})}),fb.apply(void 0,Z(T.map(function(w){return w.fromReceived("UserAttributeErr").pipe(Ca(function(k){return v.eq(k.seq)}),Ea(function(k){throw new Ja(["The user attributes set failure, code %d",k.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(T.map(function(w){return w.fromReceived("UserAttributeRsp").pipe(Ca(function(k){return v.eq(k.seq)}))}))))}},{key:"requestSetChannelAttributes",value:function(l,f,E){var T=this.getLoginSockets();if(T.length===0)throw new da("Client is not logged in");var v=this.incGetSeq();return T.forEach(function(w){w.sendPacket("GroupAttributeSet",{broadcast:E,group:l,attributeInfos:Object.entries(f).map(function(k){return{key:(k=$a(k,2))[0],value:k[1]}}),seq:v})}),fb.apply(void 0,Z(T.map(function(w){return w.fromReceived("GroupAttributeErr").pipe(Ca(function(k){return v.eq(k.seq)}),Ea(function(k){throw new Ja(["The group attributes set failure, code %d",k.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(T.map(function(w){return w.fromReceived("GroupAttributeRsp").pipe(Ca(function(k){return v.eq(k.seq)}))}))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(l){var f=this,E=this.getLoginSockets();if(E.length===0)throw new da("Client is not logged in");var T=this.incGetSeq();return E.forEach(function(v){v.sendPacket("UserAttributeMod",{account:f.context.uid,attributeInfos:Object.entries(l).map(function(w){return{key:(w=$a(w,2))[0],value:w[1]}}),seq:T})}),fb.apply(void 0,Z(E.map(function(v){return v.fromReceived("UserAttributeErr").pipe(Ca(function(w){return T.eq(w.seq)}),Ea(function(w){throw new Ja(["The user attributes add or update failure, code %d",w.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(E.map(function(v){return v.fromReceived("UserAttributeRsp").pipe(Ca(function(w){return T.eq(w.seq)}))}))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(l,f,E){var T=this.getLoginSockets();if(T.length===0)throw new da("Client is not logged in");var v=this.incGetSeq();return T.forEach(function(w){w.sendPacket("GroupAttributeMod",{broadcast:E,group:l,attributeInfos:Object.entries(f).map(function(k){return{key:(k=$a(k,2))[0],value:k[1]}}),seq:v})}),fb.apply(void 0,Z(T.map(function(w){return w.fromReceived("GroupAttributeErr").pipe(Ca(function(k){return v.eq(k.seq)}),Ea(function(k){throw new Ja(["The group attributes add or update failure, code %d",k.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(T.map(function(w){return w.fromReceived("GroupAttributeRsp").pipe(Ca(function(k){return v.eq(k.seq)}))}))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(l){var f=this,E=this.getLoginSockets();if(E.length===0)throw new da("Client is not logged in");var T=this.incGetSeq();return E.forEach(function(v){v.sendPacket("UserAttributeDel",{account:f.context.uid,attributes:l,seq:T})}),fb.apply(void 0,Z(E.map(function(v){return v.fromReceived("UserAttributeErr").pipe(Ca(function(w){return T.eq(w.seq)}),Ea(function(w){throw new Ja(["The user attributes delete failure, code %d",w.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(E.map(function(v){return v.fromReceived("UserAttributeRsp").pipe(Ca(function(w){return T.eq(w.seq)}))}))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(l,f,E){var T=this.getLoginSockets();if(T.length===0)throw new da("Client is not logged in");var v=this.incGetSeq();return T.forEach(function(w){w.sendPacket("GroupAttributeDel",{group:l,broadcast:E,attributes:f,seq:v})}),fb.apply(void 0,Z(T.map(function(w){return w.fromReceived("GroupAttributeErr").pipe(Ca(function(k){return v.eq(k.seq)}),Ea(function(k){throw new Ja(["The channel attributes delete failure, code %d",k.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(T.map(function(w){return w.fromReceived("GroupAttributeRsp").pipe(Ca(function(k){return v.eq(k.seq)}))}))))}},{key:"requestClearLocalUserAttributes",value:function(){var l=this,f=this.getLoginSockets();if(f.length===0)throw new da("Client is not logged in");var E=this.incGetSeq();return f.forEach(function(T){T.sendPacket("UserAttributeSet",{account:l.context.uid,seq:E,attributeInfos:[]})}),fb.apply(void 0,Z(f.map(function(T){return T.fromReceived("UserAttributeErr").pipe(Ca(function(v){return E.eq(v.seq)}),Ea(function(v){throw new Ja(["The user attributes clear failure, code %d",v.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(f.map(function(T){return T.fromReceived("UserAttributeRsp").pipe(Ca(function(v){return E.eq(v.seq)}))}))))}},{key:"requestClearChannelAttributes",value:function(l,f){var E=this.getLoginSockets();if(E.length===0)throw new da("Client is not logged in");var T=this.incGetSeq();return E.forEach(function(v){v.sendPacket("GroupAttributeSet",{group:l,seq:T,attributeInfos:[],broadcast:f})}),fb.apply(void 0,Z(E.map(function(v){return v.fromReceived("GroupAttributeErr").pipe(Ca(function(w){return T.eq(w.seq)}),Ea(function(w){throw new Ja(["The channel attributes clear failure, code %d",w.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(E.map(function(v){return v.fromReceived("GroupAttributeRsp").pipe(Ca(function(w){return T.eq(w.seq)}))}))))}},{key:"requestGetUserAttributesByKeys",value:function(l,f){var E=this.getLoginSockets();if(E.length===0)throw new da("Client is not logged in");var T=this.incGetSeq();return E.forEach(function(v){v.sendPacket("UserAttributeGet",{account:l,seq:T,attributes:f})}),fb.apply(void 0,[r.genTimeoutError(pc)].concat(Z(E.map(function(v){return v.fromReceived("UserAttributeErr").pipe(Ca(function(w){return T.eq(w.seq)}),Ea(function(w){throw(w=w.code)===10008?new Ja("The user requested is not online",Mr):new ve(["User attribute operation unknown error code: %d",w],oc)}))})),Z(E.map(function(v){return v.fromReceived("UserAttributeRet").pipe(Ca(function(w){return T.eq(w.seq)}))}))))}},{key:"requestGetChannelAttributesByKeys",value:function(l,f){var E=this.getLoginSockets();if(E.length===0)throw new da("Client is not logged in");var T=this.incGetSeq();return E.forEach(function(v){v.sendPacket("GroupAttributeGet",{group:l,seq:T,attributes:f})}),fb.apply(void 0,[r.genTimeoutError(pc)].concat(Z(E.map(function(v){return v.fromReceived("GroupAttributeErr").pipe(Ca(function(w){return T.eq(w.seq)}),Ea(function(w){throw new Ja(["The channel attributes get failure, code %d",w.code],oc)}))})),Z(E.map(function(v){return v.fromReceived("GroupAttributeRet").pipe(Ca(function(w){return T.eq(w.seq)}))}))))}},{key:"requestGetUserAttributeKeys",value:function(l){var f=this.getLoginSockets();if(f.length===0)throw new da("Client is not logged in");var E=this.incGetSeq();return f.forEach(function(T){T.sendPacket("UserAttributeKeysGet",{account:l,seq:E})}),fb.apply(void 0,[r.genTimeoutError(pc)].concat(Z(f.map(function(T){return T.fromReceived("UserAttributeErr").pipe(Ca(function(v){return E.eq(v.seq)}),Ea(function(v){throw(v=v.code)===10008?new Ja("The user requested is not online",Mr):new ve(["User attribute operation unknown error code: %d",v],oc)}))})),Z(f.map(function(T){return T.fromReceived("UserAttributeKeysRet").pipe(Ca(function(v){return E.eq(v.seq)}))}))))}},{key:"requestGetChannelAttributesKeys",value:function(l){var f=this.getLoginSockets();if(f.length===0)throw new da("Client is not logged in");var E=this.incGetSeq();return f.forEach(function(T){T.sendPacket("GroupAttributeKeysGet",{group:l,seq:E})}),fb.apply(void 0,[r.genTimeoutError(pc)].concat(Z(f.map(function(T){return T.fromReceived("GroupAttributeErr").pipe(Ca(function(v){return E.eq(v.seq)}),Ea(function(v){throw new ve(["Channel attribute operation unknown error code: %d",v.code],oc)}))})),Z(f.map(function(T){return T.fromReceived("GroupAttributeKeysRet").pipe(Ca(function(v){return E.eq(v.seq)}))}))))}},{key:"requestGetChannelMemberCount",value:function(l){var f=this.getLoginSockets();if(f.length===0)throw new da("Client is not logged in");var E=this.incGetSeq();return f.forEach(function(T){T.sendPacket("GroupStatusList",{groups:l,seq:E})}),fb.apply(void 0,[r.genTimeoutError(Qr)].concat(Z(f.map(function(T){return T.fromReceived("GroupStatusResult").pipe(Ca(function(v){return E.eq(v.seq)}))}))))}},{key:"requestSubscribePeersOnlineStatus",value:function(l){var f=this.getLoginSockets();if(f.length===0)throw new da("Client is not logged in");var E=this.incGetSeq();return f.forEach(function(T){T.sendPacket("SubscribeUserStatus",{seq:E,users:l})}),fb.apply(void 0,[r.genTimeoutError($B)].concat(Z(f.map(function(T){return T.fromReceived("SubscribeResponse").pipe(Ca(function(v){return E.eq(v.seq)}))}))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(l){var f=this.getLoginSockets();if(f.length===0)throw new da("Client is not logged in");var E=this.incGetSeq();f.forEach(function(T){T.sendPacket("UnsubscribeUserStatus",{seq:E,users:l})})}},{key:"sendInvitationMessage",value:function(){var l=ma(N.mark(function f(E){var T,v,w,k,B,Q,X,_e,aa,_i,_a,ga,_d=this;return N.wrap(function(d_){for(;;)switch(d_.prev=d_.next){case 0:if(T=E.peerId,v=E.callId,w=E.extra,k=E.isAcceptAck,B=E.channelId,Q=E.type,X={callId:v},k===void 0){d_.next=6;break}if(Q==="CallAccept"){d_.next=5;break}throw Error("invalid invitation type");case 5:X.type=k?"ack":"request";case 6:return X.channel=B,(Q==="CallInvite"||Q==="CallCancel"||Q==="CallReject"||Q==="CallAccept"&&k===!1)&&w!==void 0&&(X.extra=w),_e=nh(),this.log("The sent invitation body is %o",X),aa=function(T_){return{MiscMap:{},sequence:P.fromNumber(1),dialogue:_e,instance:_d.instanceId,dst:T,ms:P.fromNumber(Date.now(),!0),options:new Ef({IterationNumber:T_,MessageType:Q}).toLong(),payload:new TextEncoder().encode(JSON.stringify(X)),src:_d.context.uid}},d_.next=14,Jc(this.sendMessageToRetry(aa,!0)).pipe(Lb(1e4),ab(function(T_){return T_ instanceof Tb&&_d.warn("Send invitation timeout"),ra(T_)})).toPromise();case 14:return _i=d_.sent,_a=_i.code,ga=_i.retryTimes,d_.abrupt("return",{hasPeerReceived:_a===0,hasReSent:ga!==0});case 18:case"end":return d_.stop()}},f,this)}));return function(f){return l.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var l=ma(N.mark(function f(E,T,v,w,k){var B,Q,X,_e,aa,_i,_a,ga,_d,d_,T_,P_=this;return N.wrap(function(g_){for(;;)switch(g_.prev=g_.next){case 0:if(B=Date.now(),Q=w?Ka.P2pRMsgNoOfflineFlag:Ka.ChannelRMsg,Ta(v)&&E instanceof Uint8Array&&typeof T=="string"){g_.next=4;break}throw new ca("The send message arguments are not valid",w?fs:qi);case 4:if(!(32768<E.byteLength+new Blob([T]).size)){g_.next=8;break}throw this.emit("messageCount",{messageCategory:Q,type:"common",key:"sentcount"}),this.emit("messageCount",{messageCategory:Q,type:"common",key:"invalidmessagecount"}),new ic("The message size is over the 32KB limit",w?bg:Il);case 8:return X=!ue.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=E.byteLength,_e=this.chatManager.getChatInfo(v),aa=_e.dialogue,_i=_e.sequence,_a=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(_a,"-").concat(aa,"#").concat(_i,'"'),X?" compressed":"",w?"peer":"channel",La(v)),ga=function(j_){return{MiscMap:{description:new TextEncoder().encode(T)},sequence:_i,dialogue:aa,instance:_a,dst:v,ms:P.fromNumber(Date.now(),!0),options:new Ef({IterationNumber:j_,CompressionMethod:X?"Zlib":"Uncompressed",MessageType:w?"PeerRawMessage":"ChannelRawMessage",ToCache:!1,ToArchive:!1}).toLong(),payload:X?St(E):E,src:P_.context.uid}},g_.next=15,Jc(this.sendMessageToRetry(ga,!0)).pipe(Lb(k===void 0?1e4:k),ab(function(j_){return j_ instanceof Tb&&P_.warn("Send message timeout"),ra(j_)})).toPromise();case 15:return _d=g_.sent,d_=_d.code,T_=d_===0,this.emit("messageCount",{messageCategory:Q,type:"common",key:"sentcount"}),T_&&(this.emit("messageCount",{messageCategory:Q,type:"common",key:"successcount"}),this.emit("messageCount",{messageCategory:Q,type:w?"peer":"recipient",delay:Xa(B).toNumber()})),g_.abrupt("return",{hasPeerReceived:T_});case 21:case"end":return g_.stop()}},f,this)}));return function(f,E,T,v,w){return l.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var l=ma(N.mark(function f(E,T,v,w){var k,B,Q,X,_e,aa,_i,_a,ga,_d,d_,T_,P_=this;return N.wrap(function(g_){for(;;)switch(g_.prev=g_.next){case 0:if(k=Date.now(),B=v?Ka.P2pSMsgNoOfflineFlag:Ka.ChannelSMsg,Ta(T)){g_.next=4;break}throw new ca("The send message arguments are not valid",v?fs:qi);case 4:if(!(32768<new Blob([E]).size)){g_.next=8;break}throw this.emit("messageCount",{messageCategory:B,type:"common",key:"sentcount"}),this.emit("messageCount",{messageCategory:B,type:"common",key:"invalidmessagecount"}),new ic("The message size is over the 32KB limit",v?bg:Il);case 8:return Q=!ue.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([E]).size,X=this.chatManager.getChatInfo(T),_e=X.dialogue,aa=X.sequence,_i=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(_i,"-").concat(_e,"#").concat(aa,'"'),Q?" compressed":"",v?"peer":"channel",La(T)),_a=new TextEncoder().encode(E),ga=function(j_){return{MiscMap:{},sequence:aa,dialogue:_e,instance:_i,dst:T,ms:P.fromNumber(Date.now(),!0),options:new Ef({IterationNumber:j_,CompressionMethod:Q?"Zlib":"Uncompressed",MessageType:v?"PeerTextMessage":"ChannelTextMessage",ToCache:!1,ToArchive:!1}).toLong(),payload:Q?St(_a):_a,src:P_.context.uid}},g_.next=16,Jc(this.sendMessageToRetry(ga,!0)).pipe(Lb(w===void 0?1e4:w),ab(function(j_){return j_ instanceof Tb&&(P_.emit("messageCount",{messageCategory:B,type:"common",key:"sentcount"}),P_.emit("messageCount",{messageCategory:B,type:"common",key:"timeoutcount"}),P_.warn("Send message timeout")),ra(j_)})).toPromise();case 16:return _d=g_.sent,d_=_d.code,T_=d_===0,this.emit("messageCount",{messageCategory:B,type:"common",key:"sentcount"}),T_&&(this.emit("messageCount",{messageCategory:B,type:"common",key:"successcount"}),this.emit("messageCount",{messageCategory:B,type:v?"peer":"recipient",delay:Xa(k).toNumber()})),g_.abrupt("return",{hasPeerReceived:T_});case 22:case"end":return g_.stop()}},f,this)}));return function(f,E,T,v){return l.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(l,f){Object.entries(this.loginSocketSubs[l]).forEach(function(E){var T=(E=$a(E,2))[1];E[0]==="channels"&&f||(Array.isArray(T)||T instanceof Map?T.forEach(function(v){return v.unsubscribe()}):T&&T.unsubscribe())}),this.loginSocketSubs[l]={channels:f?this.loginSocketSubs[l].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var l=ma(N.mark(function f(E,T){var v,w,k,B,Q,X,_e,aa,_i,_a=this,ga=arguments;return N.wrap(function(_d){for(;;)switch(_d.prev=_d.next){case 0:if(v=2<ga.length&&ga[2]!==void 0?ga[2]:0,this.log("Attempt to send the message ".concat(T?" with retrying, %o":"without retrying"),{retryTimes:v}),(w=this.getLoginSockets()).length!==0){_d.next=5;break}throw Error("no logged-in sockets");case 5:return k=E(v),w.forEach(function(d_){d_.sendPacket("Message",k)}),B=k.dialogue,Q=k.sequence,X=k.instance,_e=w.map(function(d_){return d_.fromReceived("Ack").pipe(yb(function(T_){return B.eq(T_.dialogue)&&Q.eq(T_.sequence)&&X.eq(T_.instance)}))}),_d.prev=9,_d.next=12,Jb.apply(void 0,Z(_e)).pipe(Lb(6e3),ab(function(d_){return Ab(d_)&&_a.warn("Message send timeout, retry times %d",v),ra(d_)}),hb(1)).toPromise();case 12:return aa=_d.sent,_i=aa.code,this.log("The message has been acked, %o",{code:_i}),_d.abrupt("return",{code:_i,retryTimes:v});case 18:if(_d.prev=18,_d.t0=_d.catch(9),!(_d.t0 instanceof Tb&&T)){_d.next=22;break}return _d.abrupt("return",this.sendMessageToRetry(E,!1,v+1));case 22:throw _d.t0;case 23:case"end":return _d.stop()}},f,this,[[9,18]])}));return function(f,E){return l.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var l=this;this.lastLoginSockets.map(function(f){return f.pipe(Kb(function(E){return dd(0,2500,Ce()?void 0:oF).pipe(sa(function(){l.sendPing(E)}))}))}).forEach(function(f,E){var T=l.loginSocketSubs[E].keepAlive;T!==void 0&&T.unsubscribe(),l.loginSocketSubs[E].keepAlive=f.subscribe({error:function(){}})})}},{key:"initKeepAliveReconnector",value:function(){var l=this;this.lastLoginSockets.map(function(f){return f.pipe(Kb(function(E){var T,v=!1,w=E.userJoin$.pipe(sa(function(){v=!0})),k=E.input$.pipe(sa(function(B){yj[B.uri].slice(0,-3)!=="Ping"&&(v=!1)}));return Jb(dd(6e3,1e4).pipe(yv(E.receivedPacket),sa(function(B){B=$a(B,2),B=$a(B[1],2)[1],T!==B||v||E.forceReconnect(),T=B})),w,k)}))}).forEach(function(f,E){var T=l.loginSocketSubs[E].keepAliveReconnector;T!==void 0&&T.unsubscribe(),l.loginSocketSubs[E].keepAliveReconnector=f.subscribe({error:function(){}})})}},{key:"initLoginReceiver",value:function(){var l=this;fb.apply(void 0,Z(this.lastLoginSockets.map(function(T){return T.pipe(Kb(function(v){return v.fromReceived("UserTicketNearlyExpire").pipe(sv(5e3),sa(l.onUserTicketNearlyExpire(v)))}))}))).subscribe();var f=Db(this,"messageCount"),E=f.pipe(yb(function(T){return T.messageCategory===Ka.ChannelSMsg}));E.subscribe(function(T){return l.updateMessageCount(T)}),E.pipe(dh(6e3)).subscribe(function(T){T.length&&l.chanelStringMessageReport.report()}),Jb(ob(void 0),E).pipe(Kb(function(){return Qe(36e5)})).subscribe(function(){l.chanelStringMessageReport.report()}),(E=f.pipe(yb(function(T){return T.messageCategory===Ka.ChannelRMsg}))).subscribe(function(T){return l.updateMessageCount(T)}),E.pipe(dh(6e3)).subscribe(function(T){T.length&&l.chanelRawMessageReport.report()}),Jb(ob(void 0),E).pipe(Kb(function(){return Qe(36e5)})).subscribe(function(){l.chanelRawMessageReport.report()}),(E=f.pipe(yb(function(T){return T.messageCategory===Ka.P2pSMsgNoOfflineFlag}))).subscribe(function(T){return l.updateMessageCount(T)}),E.pipe(dh(6e3)).subscribe(function(T){T.length&&l.p2pSMsgNoOfflineReport.report()}),Jb(ob(void 0),E).pipe(Kb(function(){return Qe(36e5)})).subscribe(function(){l.p2pSMsgNoOfflineReport.report()}),(f=f.pipe(yb(function(T){return T.messageCategory===Ka.P2pRMsgNoOfflineFlag}))).subscribe(function(T){return l.updateMessageCount(T)}),f.pipe(dh(6e3)).subscribe(function(T){T.length&&l.p2pRMsgNoOfflineReport.report()}),Jb(ob(void 0),f).pipe(Kb(function(){return Qe(36e5)})).subscribe(function(){l.p2pSMsgNoOfflineReport.report()}),this.lastLoginSockets.map(function(T){return T.pipe(Kb(function(v){return Jb(Db(v,"reconnect").pipe(sa(l.onSocketReconnect(v))),v.fromReceived("Message").pipe(sa(l.onMessage(v))),v.fromReceived("GroupEnterNotice").pipe(sa(l.onGroupEnterNotice())),v.fromReceived("GroupLeaveNotice").pipe(sa(l.onGroupLeaveNotice())),v.fromReceived("GroupCountNotice").pipe(sa(l.onGroupCountNotice())),v.fromReceived("GroupAttributeAlt").pipe(sa(l.onGroupAttributeAlt())),v.fromReceived("UserJoinNotice").pipe(sa(l.onUserNotice(ta.PeerOnlineState.ONLINE))),v.fromReceived("UserQuitNotice").pipe(sa(l.onUserNotice(ta.PeerOnlineState.OFFLINE))),v.fromReceived("UserWaitNotice").pipe(sa(l.onUserNotice(ta.PeerOnlineState.UNREACHABLE))),v.fromReceived("Pong").pipe(sa(l.onPong())),v.fromReceived("UserDrop").pipe(sa(l.onUserDrop(v))),v.fromReceived("GroupDrop").pipe(sa(l.onGroupDrop()))).pipe(Uf(void 0))}))}).forEach(function(T,v){l.loginSocketSubs[v].receivers.push(T.subscribe({error:function(){}}))})}},{key:"requestSocketLogin",value:function(l,f,E){var T=this;return nn(yd(function(){T.userJoinOptions=new et(f),l.sendPacket("UserJoin",{account:T.context.uid,instance:T.instanceId,opt:T.userJoinOptions.toLong(),seq:E,ticket:l.ticket})}),l.fromReceived("UserResp").pipe(Ca(function(v){return E.eq(v.seq)}),sa(function(v){if((v=v.code)!==0)throw T.clearSockets(),T.logError("Connected to gateway success but the Rtm server rejected login"),new Ja(["Login failure. The response code from the RTM service is %d",v],Pg);l.attemptsSinceLastError=0,l.loggedIn=!0,T.log("ENV_%d logged in",l.env)}),Uf(l),Lb(6e3))).pipe(yb(function(v){return v!==void 0}),ab(function(v){return v instanceof Tb&&T.warn("Login response timeout, rejoin: %s",f),T.clearSockets(),v.name="loginRespTimeout",T.emit("banEdgeIP",l.ip),ra(v)}))}},{key:"getSocketLoginObservables",value:function(l,f){var E=this;return l.map(function(T){return T.pipe(Kb(function(v,w){return E.incSeqIfNeeded(v.env),E.requestSocketLogin(v,w!==0,w===0?f:E.seq)}),Se())})}},{key:"incSeqIfNeeded",value:function(l){if(![0,1].includes(l))throw new mb({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[l]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[l]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var l=this.curLoginSockets,f=-1,E=l==null?0:l.length,T=0,v=[];++f<E;){var w=l[f];w&&(v[T++]=w)}return v}},{key:"emitMessage",value:function(l,f){var E,T=l.options,v=l.payload,w=l.src,k=l.dst,B=l.instance,Q=l.dialogue,X=l.sequence,_e=l.ms,aa=l.MiscMap;this.dialogueSequenceLru.set(Q.toString(),X),B="".concat(B,"-").concat(Q,"#").concat(X),this.msgDedupLru.has(B)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",f,B):(this.msgDedupLru.set(B,void 0),T=new Ef(T),this.lastLoginSockets.forEach((E=ma(N.mark(function _i(_a){var ga;return N.wrap(function(_d){for(;;)switch(_d.prev=_d.next){case 0:return _d.next=2,_a.pipe(hb(1)).toPromise();case 2:ga=_d.sent,r.sendMessageAck(l,ga);case 4:case"end":return _d.stop()}},_i)})),function(_i){return E.apply(this,arguments)})),f=T.isZlibCompressed(),T.isInvitation()?(k=cg(f?mm(ao(v,Uint8Array.of(0,0,0,0))):v),k=JSON.parse(k),this.log("The received invitation body is %o",k),this.emit("invitationMessage",{body:k,type:T.getInvitationType(),peerId:w,serverReceivedTs:_e.toNumber()})):T.isTextMessage()?(aa=T.isPeerTextMessage(),v=cg(f?mm(ao(v,Uint8Array.of(0,0,0,0))):v),this.info("Received a %s %s text message from %s to %s, %s",f?" compressed":"",aa?"peer":"channel",La(w),La(k),B),aa?(w={text:v,peerId:w,properties:{serverReceivedTs:_e.toNumber()}},this.emit("peerTextMessage",w),this.emit("messageCount",{messageCategory:Ka.P2pSMsgNoOfflineFlag,type:"common",key:"receivedcount"})):(this.emit("channelTextMessage",{channelId:k,memberId:w,text:v,properties:{serverReceivedTs:_e.toNumber()}}),this.emit("messageCount",{messageCategory:Ka.ChannelSMsg,type:"common",key:"receivedcount"}))):T.isRawMessage()&&(T=T.isRawPeerMessage(),aa=(aa=aa.description)===void 0?"":cg(aa),v=f?mm(v):v,this.info("Received a %s %s raw message from %s to %s, %s",f?" compressed":"",T?"peer":"channel",La(w),La(k),B),T?(w={desc:aa,raw:v,peerId:w,properties:{serverReceivedTs:_e.toNumber()}},this.emit("peerRawMessage",w),this.emit("messageCount",{messageCategory:Ka.P2pRMsgNoOfflineFlag,type:"common",key:"receivedcount"})):(this.emit("channelRawMessage",{desc:aa,raw:v,channelId:k,memberId:w,properties:{serverReceivedTs:_e.toNumber()}}),this.emit("messageCount",{messageCategory:Ka.ChannelRMsg,type:"common",key:"receivedcount"}))))}},{key:"onSocketReconnect",value:function(l){var f=this;return function(){var E=[0,1].filter(function(T){return T!==l.env})[0];(E=f.connection.curOpenSockets[E])&&!E.loggedIn&&f.emit("connectionLost")}}},{key:"onUserTicketNearlyExpire",value:function(l){var f=this;return function(E){(E=E.ticket)!==f.lastNoticeTicket&&E===l.ticket?(f.lastNoticeTicket=E,f.emit("tokenPrivilegeWillExpire")):f.requestUpdateEdgeTicket(l.ticket).toPromise()}}},{key:"onGroupDrop",value:function(){var l=this;return function(f){var E,T=f.account;bb("ChnLeave",{cname:T,lts:P.fromNumber(Date.now()),elapse:Xa(l.startTime),errCode:RB,sid:sb(l.instanceId),userId:l.context.uid},(E=l.context.config.enableCloudProxy)!==null&&E!==void 0&&E),[0,1].forEach(function(v){return l.loginSocketSubs[v].channels.delete(T)}),l.logError("the user is kicked out of the current channel")}}},{key:"onUserDrop",value:function(l){var f=this;return function(E){var T;E=E.code,bb("KickedOff",{code:0,elapse:Xa(f.startTime),linkId:parseInt(l.name.split("-")[1],10),lts:P.fromNumber(Date.now()),server:l.address,serverCode:E,sid:sb(f.instanceId),userId:f.context.uid},(T=f.context.config.enableCloudProxy)!==null&&T!==void 0&&T),E===10006||E===10001?f.warn("Login too often and kicked off, reconnect and login"):E===10009?(f.warn("The instance ID conflicts, reconnecting"),f.instanceId=nh(),f.context.sid=sb(f.instanceId),f.emit("instanceChanged",f.instanceId)):[2,11,14,15,16].includes(E)&&(f.emit("userDrop",E),f.clearSockets())}}},{key:"clearSockets",value:function(){var l=this,f=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,E=1<arguments.length&&arguments[1]!==void 0&&arguments[1];[0,1].forEach(function(T){l.cleanLoginSubs(T,E),l.connection.closeSocket(T,f)})}},{key:"onMessage",value:function(l){var f=this;return function(E){var T=E.dialogue,v=E.instance,w=E.sequence,k=E.options;if(E.src===f.context.uid)f.log("The message is from the local account, ignored");else{var B=T.toString(),Q=f.dialPendingMsgSubjectMap.get(B);if(T="".concat(v,"-").concat(T,"#").concat(w),Q)Q.next(E),f.log("Env_%d: The dialogue has pending messages, next: %s",l.env,T);else{var X=f.dialogueSequenceLru.get(B);if(Q=!X&&w.eq(1),v=X!==void 0&&w.sub(X).eq(1),Q||v)f.emitMessage(E,l.env);else{if(X){if(w.lte(X))return;f.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",l.env,T)}else f.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",l.env,T);w=new rb,f.dialPendingMsgSubjectMap.set(B,w);var _e=w.pipe(Au(zl),gh(function(aa,_i){return[].concat(Z(aa),[_i])},[]),Ea(function(aa){return Z(aa).sort(function(_i,_a){return _i=_i.sequence,_a=_a.sequence,_i.eq(_a)?0:_i.gt(_a)?1:-1})}),wn(1));k=!(k=new Ef(k)).isFromCache()&&!k.isBufferedMessage(),_e.pipe(Kc(dd(k?750:1500)),Ca(function(aa){if(2>aa.length)return!1;for(var _i=X===void 0?P.fromNumber(1,!0):X.add(1),_a=0;_a<aa.length;_i=_i.add(1),_a++)if(!aa[_a].sequence.eq(_i))return!1;return!0}),fh(function(){f.dialPendingMsgSubjectMap.delete(B)})).subscribe(function(aa){aa.forEach(function(_i){f.emitMessage(_i,l.env),f.log("Env_%d: The message queue has fully ordered, emitting: %s",l.env,"".concat(_i.instance,"-").concat(_i.dialogue,"#").concat(_i.sequence))})},function(aa){aa instanceof eh&&_e.pipe(hb(1)).subscribe(function(_i){return _i.forEach(function(_a){f.log("Env_%d: The message pending queue expired, emitting: %s",l.env,"".concat(_a.instance,"-").concat(_a.dialogue,"#").concat(_a.sequence)),f.emitMessage(_a,l.env)})})}),w.next(E)}}}}}},{key:"onPong",value:function(){var l=this;return function(){document.hidden&&l.getLoginSockets().forEach(function(f){l.sendPing(f)})}}},{key:"onGroupEnterNotice",value:function(){var l=this;return function(f){l.emit("memberNotice",{channelId:f.group,seq:f.seq,instance:f.instance,memberId:f.user,type:"MemberJoined",size:f.size})}}},{key:"onGroupLeaveNotice",value:function(){var l=this;return function(f){l.emit("memberNotice",{channelId:f.group,seq:f.seq,instance:f.instance,memberId:f.user,type:"MemberLeft",size:f.size})}}},{key:"onGroupCountNotice",value:function(){var l=this;return function(f){l.emit("memberNotice",{channelId:f.group,seq:f.seq,instance:f.instance,type:"MemberCountUpdated",size:f.size})}}},{key:"onGroupAttributeAlt",value:function(){var l=this;return function(f){var E=f.group;f=Ki(f,pF),l.emit("channelAttributesUpdated",Wa({channelId:E},f))}}},{key:"onUserNotice",value:function(l){var f=this;return function(E){f.emit("peerOnlineStatusChanged",{peerId:E.user,instance:E.instance,seq:E.seq,state:l})}}},{key:"sendPing",value:function(l){2500>=Date.now()-this.lastPingTime[l.env]||(this.incSeqIfNeeded(l.env),l.sendPacket("Ping",{ms:P.fromNumber(Date.now(),!0),seq:this.seq}),this.lastPingTime[l.env]=Date.now())}},{key:"updateMessageCount",value:function(l){var f,E=(f={},x(f,Ka.ChannelRMsg,this.chanelRawMessageReport),x(f,Ka.ChannelSMsg,this.chanelStringMessageReport),x(f,Ka.P2pRMsgNoOfflineFlag,this.p2pRMsgNoOfflineReport),x(f,Ka.P2pSMsgNoOfflineFlag,this.p2pSMsgNoOfflineReport),x(f,3,void 0),x(f,4,void 0),x(f,7,void 0),x(f,8,void 0),x(f,9,void 0),x(f,10,void 0),f)[l.messageCategory];l.type==="common"?E==null||E.updateCommonCount(l.key):l.type==="peer"?E==null||E.updatePeerAckCount(l.delay):E==null||E.updateNorecipientackCount(l.delay)}}],[{key:"sendMessageAck",value:function(l,f){var E=new Ef(l.options);(E.isInvitation()||E.isPeerMessage())&&f.sendPacket("Ack",{code:0,dialogue:l.dialogue,instance:l.instance,sequence:l.sequence})}}]),r}(sc());x(Tt,"genTimeoutError",function(i,r){return ob(void 0).pipe(Zd(r===void 0?1e4:r),Ea(function(){throw new Ub(["Request timed out after %ds",(r===void 0?1e4:r)/1e3],i)}))});var Ut,nm,om=0,pm=0;Ng.v1=function(i,r,s){s=r&&s||0;var u=r||[],l=(i=i||{}).node||Ut,f=i.clockseq!==void 0?i.clockseq:nm;if(l==null||f==null){var E=Kr();l==null&&(l=Ut=[1|E[0],E[1],E[2],E[3],E[4],E[5]]),f==null&&(f=nm=16383&(E[6]<<8|E[7]))}E=i.msecs!==void 0?i.msecs:new Date().getTime();var T=i.nsecs!==void 0?i.nsecs:pm+1,v=E-om+(T-pm)/1e4;if(0>v&&i.clockseq===void 0&&(f=f+1&16383),(0>v||E>om)&&i.nsecs===void 0&&(T=0),1e4<=T)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(om=E,pm=T,nm=f,i=(1e4*(268435455&(E+=122192928e5))+T)%4294967296,u[s++]=i>>>24&255,u[s++]=i>>>16&255,u[s++]=i>>>8&255,u[s++]=255&i,i=E/4294967296*1e4&268435455,u[s++]=i>>>8&255,u[s++]=255&i,u[s++]=i>>>24&15|16,u[s++]=i>>>16&255,u[s++]=f>>>8|128,u[s++]=255&f,f=0;6>f;++f)u[s+f]=l[f];return r||Lr(u)},Ng.v4=Ng;var qm=yi(),Sd,Hf=ta.LocalInvitationFailureReason,Sa=ta.LocalInvitationState,qF=(Sd=function(i){function r(u,l,f){va(this,r);var E=s.call(this,f,"RtmLocalInvitation",!0);return x(z(E),"state",Sa.IDLE),x(z(E),"localInvitationEnd$",fb(Db(z(E),"LocalInvitationAccepted"),Db(z(E),"LocalInvitationRefused"),Db(z(E),"LocalInvitationFailure"),Db(z(E),"LocalInvitationCanceled")).pipe(hb(1))),x(z(E),"callId",Ng.v4()),x(z(E),"_content",""),x(z(E),"_channelId",""),x(z(E),"_response",""),x(z(E),"calleeId",void 0),x(z(E),"logger",void 0),x(z(E),"getSession",void 0),E.calleeId=u,E.getSession=l,E.logger=f,E}Ga(r,i);var s=Ha(r);return eb(r,[{key:"channelId",get:function(){return this._channelId},set:function(u){this.state!==Sa.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=u)}},{key:"content",get:function(){return this._content},set:function(u){this.log("set content for %s",this.callId),this._content=u}},{key:"response",get:function(){return this._response},set:function(u){throw new ca('Cannot set the "response" of the LocalInvitation instance.',Xc)}},{key:"send",value:function(){var u,l=this;if(this.state===Sa.SENT_TO_REMOTE||this.state===Sa.RECEIVED_BY_REMOTE)throw new da("The local invitation send failure. The call invitation has already been sent.",NB);if(this.isLocalInvitationEnd())throw new da("The local invitation send failure. The call invitation has ended.",ri);if(0<this._channelId.length&&!Ta(this._channelId))throw new ca("Illegal invitation channel ID",Xc);if(!Ta(this.calleeId))throw new ca("Illegal invitation callee user ID",Xc);if(8192<rh(this._content))throw new ca('The length of the "content" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',Xc);this.state=Sa.SENT_TO_REMOTE,yd(ma(N.mark(function f(){var E,T,v;return N.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,l.getSession().sendInvitationMessage({peerId:l.calleeId,callId:l.callId,extra:l._content,type:"CallInvite",channelId:l._channelId});case 2:if(E=w.sent,T=E.hasPeerReceived,v=E.hasReSent,!l.isLocalInvitationEnd()){w.next=7;break}throw new Ub("send invitation timeout");case 7:if(l.log("The local invitation has sent to the callee"),T||v){w.next=11;break}throw u=new qm({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(T){w.next=14;break}throw u=new qm({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return w.stop()}},f)}))).pipe(Re(function(f){return f.pipe(sa(function(E){if(!(E instanceof qm))throw E}),Zd(2e3))}),Lb(3e4),ab(function(f){return Ab(f)&&l.warn("local invitation ack timed out"),ra(f)}),Kc(this.localInvitationEnd$)).subscribe({next:function(){l.state===Sa.RECEIVED_BY_REMOTE?l.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):l.state!==Sa.SENT_TO_REMOTE?l.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(l.info("The peer received the local invitation %s.",l.callId),l.state=Sa.RECEIVED_BY_REMOTE,l.emit("LocalInvitationReceivedByPeer"),l.localInvitationEnd$.pipe(Lb(6e4),ab(function(f){return Ab(f)&&l.warn("local invitation expired"),ra(f)})).subscribe({error:function(){l.state=Sa.FAILURE,l.emit("LocalInvitationFailure",Hf.INVITATION_EXPIRE)}}))},error:function(f){l.isLocalInvitationEnd()?l.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(l.state=Sa.FAILURE,Ab(f)&&u?u.code==="PEER_NOT_ONLINE"?l.emit("LocalInvitationFailure",Hf.PEER_OFFLINE):u.code==="RESENT_AND_OFFLINE"&&l.emit("LocalInvitationFailure",Hf.PEER_NO_RESPONSE):Ab(f)?l.emit("LocalInvitationFailure",Hf.PEER_NO_RESPONSE):f.name==="RtmInvalidStatusError"?l.emit("LocalInvitationFailure",Hf.NOT_LOGGEDIN):l.emit("LocalInvitationFailure",Hf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new da("The local invitation cancel failure",ri);if(this.state===Sa.IDLE)throw new da("The local invitation has not been sent",MB);if(8192<rh(this._content))throw new ca('The length of the "content" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',Xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Sa.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(u){if(this.isLocalInvitationEnd()&&this.state!==Sa.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Sa.IDLE)throw new da("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Sa.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Sa.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Sa.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Sa.ACCEPTED_BY_REMOTE,this._response=u,this.emit("LocalInvitationAccepted",u))}}},{key:"onRefuseReceived",value:function(u){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Sa.IDLE)throw new da("the local have not sent the invitation, how can remote refuse it?");this.state===Sa.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Sa.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=u,this.state=Sa.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",u)}}},{key:"isLocalInvitationEnd",value:function(){return[Sa.CANCELED,Sa.FAILURE,Sa.ACCEPTED_BY_REMOTE,Sa.REFUSED_BY_REMOTE].includes(this.state)}}]),r}(sc()),Da(Sd.prototype,"send",[Mc],Object.getOwnPropertyDescriptor(Sd.prototype,"send"),Sd.prototype),Da(Sd.prototype,"cancel",[Mc],Object.getOwnPropertyDescriptor(Sd.prototype,"cancel"),Sd.prototype),Sd),Hi=ta.RemoteInvitationFailureReason,Fb=ta.RemoteInvitationState,rF=function(i){function r(u){var l=u.invitationChannel,f=u.extraContent,E=u.callId,T=u.callerId,v=u.logger;u=u.getSession,va(this,r);var w=s.call(this,v,"RtmRemoteInvitation",!0);return x(z(w),"state",Fb.INVITATION_RECEIVED),x(z(w),"remoteInvitationEnd$",fb(Db(z(w),"RemoteInvitationCanceled"),Db(z(w),"RemoteInvitationRefused"),Db(z(w),"RemoteInvitationAccepted"),Db(z(w),"RemoteInvitationFailure")).pipe(hb(1))),x(z(w),"callerId",void 0),x(z(w),"callId",void 0),x(z(w),"_getSession",void 0),x(z(w),"logger",void 0),x(z(w),"_content",void 0),x(z(w),"_channelId",void 0),x(z(w),"_response",""),w._channelId=l,w._content=f,w.callId=E,w.callerId=T,w._getSession=u,w.logger=v,w.remoteInvitationEnd$.pipe(Lb(6e4),ab(function(k){return Ab(k)&&w.warn("Remote invitation expired"),ra(k)})).subscribe({error:function(){w.state=Fb.FAILURE,w.emit("RemoteInvitationFailure",Hi.INVITATION_EXPIRE)}}),w}Ga(r,i);var s=Ha(r);return eb(r,[{key:"channelId",get:function(){return this._channelId},set:function(u){throw new ca('Cannot set the "response" of the RemoteInvitation instance.',Xc)}},{key:"content",get:function(){return this._content},set:function(u){throw new ca('Cannot set the "content" of the RemoteInvitation instance.',Xc)}},{key:"response",get:function(){return this._response},set:function(u){this._response=u}},{key:"accept",value:function(){var u,l=this;if(this.isRemoteInvitationEnd())throw new da("The local invitation has ended. Cannot accept.",ri);if(this.state===Fb.ACCEPT_SENT_TO_LOCAL)throw new da("The remote invitation is accepting. Cannot do the operation.",Rr);if(8192<rh(this._response))throw new ca('The length of the "response" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',Xc);this.state=Fb.ACCEPT_SENT_TO_LOCAL,Jb(Qe(1e3).pipe(Cb(function(){return yd(ma(N.mark(function f(){return N.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.abrupt("return",l._getSession().sendInvitationMessage({peerId:l.callerId,callId:l.callId,extra:l.response,type:"CallAccept",isAcceptAck:!1,channelId:l.channelId}));case 1:case"end":return E.stop()}},f)})))}),yb(function(f){return u=f.hasPeerReceived}),hb(1)),Db(this,"RemoteInvitationAccepted")).pipe(Lb(5e3),Kc(this.remoteInvitationEnd$)).subscribe({error:function(f){if(l.logError(f),l.state=Fb.FAILURE,Ab(f))switch(u){case void 0:case!0:return void l.emit("RemoteInvitationFailure",Hi.ACCEPT_FAILURE);case!1:return void l.emit("RemoteInvitationFailure",Hi.PEER_OFFLINE)}l.emit("RemoteInvitationFailure",Hi.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===Fb.ACCEPT_SENT_TO_LOCAL)throw new da("The remote invitation is accepting. Cannot do the operation.",Rr);if(this.isRemoteInvitationEnd())throw new da("The invitation is end. Cannot refuse",ri);if(8192<rh(this._response))throw new ca('The length of the "response" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',Xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=Fb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(u){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===Fb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=u,this.state=Fb.CANCELED,this.emit("RemoteInvitationCanceled",u))}},{key:"onAcceptAckReceived",value:function(){this.state!==Fb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=Fb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[Fb.ACCEPTED,Fb.REFUSED,Fb.CANCELED,Fb.FAILURE].includes(this.state)}}]),r}(sc()),sF=function(i){function r(u,l){va(this,r);var f=s.call(this,l,"InvitationManager");return x(z(f),"getSession",void 0),x(z(f),"invitationDispatcher",new Ba.EventEmitter),x(z(f),"outgoingLocalInvitations",new Map),x(z(f),"receivedRemoteInvitations",new Wc(void 0,{maxlen:1e4})),x(z(f),"logger",void 0),f.getSession=fo(u),f.logger=l,f.invitationDispatcher.on("remoteInvitationToManager",function(E){var T=E.callId,v=E.extra,w=E.callerId;E=E.channelId,f.receivedRemoteInvitations.has(T)||((v=new rF({callerId:w,callId:T,getSession:f.getSession,logger:l,extraContent:v,invitationChannel:E})).remoteInvitationEnd$.subscribe(function(){f.receivedRemoteInvitations.delete(T)}),f.receivedRemoteInvitations.set(T,v),f.emit("remoteInvitationInstance",v))}),f.invitationDispatcher.on("acceptAckToRemoteInvitation",function(E){(E=f.receivedRemoteInvitations.get(E.callId))&&E.onAcceptAckReceived()}),f.invitationDispatcher.on("cancelToRemoteInvitation",function(E){var T=E.extra;(E=f.receivedRemoteInvitations.get(E.callId))&&E.onCancelReceived(T)}),f.invitationDispatcher.on("acceptToLocalInvitation",function(E){var T=E.extra;(E=f.outgoingLocalInvitations.get(E.callId))&&E.onAcceptReceived(T)}),f.invitationDispatcher.on("refuseToLocalInvitation",function(E){var T=E.extra;(E=f.outgoingLocalInvitations.get(E.callId))&&E.onRefuseReceived(T)}),f}Ga(r,i);var s=Ha(r);return eb(r,[{key:"invitationMessageHandler",value:function(u){var l=u.body,f=l.callId,E=l.extra;E=E===void 0?"":E;var T=l.type,v=(l=l.channel)===void 0?"":l,w=u.type;switch(l=u.peerId,u=u.serverReceivedTs,w){case"CallAccept":T==="ack"?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:f}):T==="request"&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:f,extra:E});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:f,callerId:l,extra:E,channelId:v});break;case"CallCancel":if(f==="0"){f="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(v,"_").concat(E),this.getSession().emit("peerTextMessage",{peerId:l,properties:{serverReceivedTs:u},text:f});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:f,extra:E});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:f,extra:E});break;default:throw Rn("invitationType",w)}}},{key:"genLocalInvitation",value:function(u){var l=this,f=new qF(u,this.getSession,this.logger);return f.localInvitationEnd$.subscribe(function(){l.outgoingLocalInvitations.delete(f.callId)}),this.outgoingLocalInvitations.set(f.callId,f),f}}]),r}(sc()),tF=function(i,r,s){var u=!0,l=!0;if(typeof i!="function")throw new TypeError("Expected a function");return Gb(s)&&(u="leading"in s?!!s.leading:u,l="trailing"in s?!!s.trailing:l),JD(i,r,{leading:u,maxWait:r,trailing:l})},Qb,If;(function(i){i[i.JOINED=0]="JOINED",i[i.LEFT=1]="LEFT"})(If||(If={}));var Ii=ta.ConnectionState,uF=(Qb=function(i){function r(l,f,E,T){va(this,r);var v=u.call(this,T,"RtmChannel",!0);return x(z(v),"onMemberCountUpdated",tF(function(w){w!==v.memberCount&&(v.memberCount=w,v.emit("MemberCountUpdated",w))},1e3)),x(z(v),"getSession",void 0),x(z(v),"memberCount",0),x(z(v),"joinState","LEFT"),x(z(v),"joinPromise",void 0),x(z(v),"memberJoinedLru",new Wc(void 0,{maxlen:1e4})),x(z(v),"memberLeftLru",new Wc(void 0,{maxlen:1e4})),x(z(v),"memberJoinStateLru",new Wc(void 0,{maxlen:1e4})),x(z(v),"attributesSeqLru",new Wc(void 0,{maxlen:1e4})),x(z(v),"channelId",void 0),x(z(v),"client",void 0),x(z(v),"onChannelMemberCountUpdated",function(w,k){v.channelId===w&&v.onMemberCountUpdated(k)}),x(z(v),"onLogout",function(){try{v.clearChannel(v.getSession())}catch{}}),x(z(v),"onAttributesUpdated",function(w){var k=w.channelId,B=w.attributeMaps,Q=w.seq;w=w.instance.toString();var X=v.attributesSeqLru.get(w);if((!X||Q.greaterThan(X))&&(v.attributesSeqLru.set(w,Q),k===v.channelId)){for(k={},Q=0;Q<B.length;Q++){var _e=B[Q];w=_e.key,X=_e.ms;var aa=_e.value;if(_e=_e.origin,typeof w!="string"||!P.isLong(X)||typeof aa!="string"||!Ta(_e))break;k[w]={value:aa,lastUpdateUserId:_e,lastUpdateTs:X.toNumber()}}v.emit("AttributesUpdated",k)}}),x(z(v),"onChannelTextMessage",function(w){var k=w.memberId,B=w.text,Q=w.properties;w.channelId===v.channelId&&v.emit("ChannelMessage",{text:B,messageType:ta.MessageType.TEXT},k,Q)}),x(z(v),"onChannelRawMessage",function(w){var k=w.desc,B=w.raw,Q=w.memberId,X=w.properties;w.channelId===v.channelId&&v.emit("ChannelMessage",{messageType:ta.MessageType.RAW,rawMessage:B,description:k},Q,X)}),x(z(v),"onMemberNotice",function(w){var k=w.memberId,B=w.type,Q=w.size;if(w.channelId===v.channelId){var X=w.instance.toString();w=w.seq.toString();var _e={MemberLeft:v.memberLeftLru,MemberJoined:v.memberJoinedLru,MemberCountUpdated:void 0}[B];if(_e){if(_e.has(X+w))return void v.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",B,w,La(v.channelId),La(k||""));if(_e.set(X+w,void 0),typeof k!="string")return;if(k!==v.getSession().context.uid&&((X=v.memberJoinStateLru.get(k))===If.JOINED&&B==="MemberJoined"||X===If.LEFT&&B==="MemberLeft"))return void v.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",B,w,La(v.channelId),La(k||""));v.memberJoinStateLru.set(k,B==="MemberJoined"?If.JOINED:If.LEFT)}v.info("Channel %s - %s, memberId: %s",B,La(v.channelId),B==="MemberCountUpdated"?"[unknown]":La(k||"")),X=k===v.getSession().context.uid,B==="MemberLeft"&&Ta(k)||B==="MemberJoined"&&Ta(k)?(X||v.emit(B,k),v.onMemberCountUpdated(Q)):B==="MemberCountUpdated"&&typeof Q=="number"&&v.onMemberCountUpdated(Q)}}),v.getSession=fo(f),v.channelId=l,v.client=E,v.info("A channel created, id %s",La(l)),v}Ga(r,i);var s,u=Ha(r);return eb(r,[{key:"join",value:(s=ma(N.mark(function l(){var f,E,T,v,w,k,B,Q=this;return N.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:X.prev=0,f=this.getSession(),X.next=7;break;case 4:throw X.prev=4,X.t0=X.catch(0),new da("The client is not logged in. Cannot do the operation",Wr);case 7:if(X.prev=7,Ta(this.channelId)){X.next=10;break}throw new ca(["The %s in the arguments is invalid","channelId"],OB);case 10:if(this.joinState==="LEFT"){X.next=13;break}throw bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:f.context.uid,elapse:Xa(f.startTime),errCode:Vr,sid:sb(f.instanceId)},(v=this.client.context.config.enableCloudProxy)!==null&&v!==void 0&&v),new da("The channel has joined. Cannot rejoin",Vr);case 13:if(!f.usedChannelIds.includes(this.channelId)){X.next=16;break}throw bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:f.context.uid,elapse:Xa(f.startTime),errCode:Xr,sid:sb(f.instanceId)},(w=this.client.context.config.enableCloudProxy)!==null&&w!==void 0&&w),new da("A channel of the same channel ID has already joined. Cannot rejoin",Xr);case 16:if(!(20<=f.usedChannelIds.length)){X.next=19;break}throw bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:f.context.uid,elapse:Xa(f.startTime),errCode:Ur,sid:sb(f.instanceId)},(k=this.client.context.config.enableCloudProxy)!==null&&k!==void 0&&k),new ic("The joined channels has exceeded the limit of 20",Ur);case 19:return bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:f.context.uid,elapse:Xa(f.startTime),errCode:0,sid:sb(f.instanceId)},(E=this.client.context.config.enableCloudProxy)!==null&&E!==void 0&&E),this.log("Joining the channel %s",La(this.channelId)),this.joinState="JOINING",f.usedChannelIds.push(this.channelId),this.joinPromise=f.requestChannelJoin(this.channelId).then(function(){Q.joinState="JOINED"}),X.next=26,this.joinPromise;case 26:bb("ChnJoinRes",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(f.startTime),errCode:0,sid:sb(f.instanceId),serverErrCode:0,userId:f.context.uid},(T=this.client.context.config.enableCloudProxy)!==null&&T!==void 0&&T),this.info("The channel %s joined successfully",La(this.channelId)),f.on("channelTextMessage",this.onChannelTextMessage),f.on("channelRawMessage",this.onChannelRawMessage),f.on("memberNotice",this.onMemberNotice),f.on("channelAttributesUpdated",this.onAttributesUpdated),this.client.internalEmitter.on("channelMemberCountUpdated",this.onChannelMemberCountUpdated),this.client.internalEmitter.once("LOGOUT",this.onLogout),X.next=46;break;case 36:if(X.prev=36,X.t1=X.catch(7),this.joinState==="JOINING"&&(this.joinState="LEFT"),this.logError(X.t1),!Na(X.t1)){X.next=42;break}throw X.t1;case 42:if(!Ab(X.t1)){X.next=45;break}throw bb("ChnJoinRes",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(f.startTime),errCode:Tr,sid:sb(f.instanceId),serverErrCode:0,userId:f.context.uid},(B=this.client.context.config.enableCloudProxy)!==null&&B!==void 0&&B),new Ub(["Join channel %s timed out",La(this.channelId)],Tr);case 45:throw new ve(["The channel %s join failure",La(this.channelId)],{code:Sr,originalError:X.t1});case 46:case"end":return X.stop()}},l,this,[[0,4],[7,36]])})),function(){return s.apply(this,arguments)})},{key:"leave",value:function(){var l=ma(N.mark(function f(){var E,T,v,w;return N.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:k.prev=0,T=this.getSession(),k.next=7;break;case 4:throw k.prev=4,k.t0=k.catch(0),new da("The client is not logged in. Cannot do the operation",QB);case 7:if(this.joinState!=="LEFT"){k.next=9;break}throw new da("The channel does not join. Cannot do the operation",PB);case 9:return k.prev=9,T.requestChannelLeave(this.channelId),k.next=13,this.clearChannel(T);case 13:k.next=24;break;case 15:if(k.prev=15,k.t1=k.catch(9),this.logError(k.t1),!Na(k.t1)){k.next=22;break}throw k.t1.code===void 0&&(k.t1.code=Zr),bb("ChnLeave",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(T.startTime),errCode:Zr,sid:sb(T.instanceId),userId:T.context.uid},(w=this.client.context.config.enableCloudProxy)!==null&&w!==void 0&&w),k.t1;case 22:throw bb("ChnLeave",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(T.startTime),errCode:Yr,sid:sb(T.instanceId),userId:T.context.uid},(v=this.client.context.config.enableCloudProxy)!==null&&v!==void 0&&v),new ve("The channel leave failure",{code:Yr,originalError:k.t1});case 24:bb("ChnLeave",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(T.startTime),errCode:0,sid:sb(T.instanceId),userId:T.context.uid},(E=this.client.context.config.enableCloudProxy)!==null&&E!==void 0&&E);case 25:case"end":return k.stop()}},f,this,[[0,4],[9,15]])}));return function(){return l.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var l=ma(N.mark(function f(E){var T,v=this;return N.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(Xn(E,Il),this.client.connectionState!==Ii.CONNECTED||this.joinState==="JOINED"){w.next=3;break}throw new da("The channel does not join. Cannot do the operation",EB);case 3:if(this.client.connectionState!==Ii.RECONNECTING){w.next=8;break}return T=Date.now(),w.next=7,new Promise(function(k,B){var Q,X=(Q=ma(N.mark(function aa(){var _i;return N.wrap(function(_a){for(;;)switch(_a.prev=_a.next){case 0:return _i=Date.now()-T,_a.prev=1,_a.next=4,ph({message:E,peerId:v.channelId,toPeer:!1,session:v.getSession(),errorCodes:{NOT_LOGGED_IN:Jl,TOO_OFTEN:Nr},diff:_i,logger:v.logger});case 4:k(),_a.next=12;break;case 7:_a.prev=7,_a.t0=_a.catch(1),Ab(_a.t0)&&B(new Ub(we(v.name,"sendMessageToPeer",1e4),Hl)),Na(_a.t0)&&B(_a.t0),B(new Ja("Channel message send failure",{code:qi,originalError:_a.t0}));case 12:return _a.prev=12,clearTimeout(_e),_a.finish(12);case 15:case"end":return _a.stop()}},aa,null,[[1,7,12,15]])})),function(){return Q.apply(this,arguments)});v.client.internalEmitter.once("RECONNECTED",X);var _e=setTimeout(function(){v.client.internalEmitter.off("RECONNECTED",X),B(new Ub(we(v.name,"sendMessageToPeer",1e4),Hl))},9e3)});case 7:return w.abrupt("return");case 8:if(this.client.connectionState===Ii.CONNECTED){w.next=10;break}throw new da("The client is not logged in. Cannot do the operation",Jl);case 10:return w.prev=10,w.next=13,ph({message:E,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:Jl,TOO_OFTEN:Nr},diff:0,logger:this.logger});case 13:w.next=23;break;case 15:if(w.prev=15,w.t0=w.catch(10),!Ab(w.t0)){w.next=19;break}throw new Ub(we(this.name,"sendMessage",1e4),Hl);case 19:if(!Na(w.t0)){w.next=22;break}throw this.logError(w.t0),w.t0;case 22:throw new ve("The channel message send failure",qi);case 23:case"end":return w.stop()}},f,this,[[10,15]])}));return function(f){return l.apply(this,arguments)}}()},{key:"getMembers",value:function(){var l=ma(N.mark(function f(){var E,T;return N.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(v.prev=0,this.client.connectionState===Ii.CONNECTED){v.next=3;break}throw new da("The client is not logged in. Cannot do the operation",LB);case 3:if(this.joinState==="JOINED"){v.next=5;break}throw new da("The channel does not join. Cannot do the operation",KB);case 5:return E=this.getSession().requestChannelMemberList(this.channelId),v.next=8,E.pipe(Ea(function(w){return w.memberInfos.map(function(k){return k.account})})).toPromise();case 8:return T=v.sent,this.info("Channel %s - get members success, %o",La(this.channelId),T.map(La)),v.abrupt("return",T);case 13:if(v.prev=13,v.t0=v.catch(0),!Na(v.t0)){v.next=18;break}throw this.logError(v.t0),v.t0;case 18:throw new ve("The channel members get failure",IB);case 19:case"end":return v.stop()}},f,this,[[0,13]])}));return function(){return l.apply(this,arguments)}}()},{key:"clearChannel",value:function(){var l=ma(N.mark(function f(E){var T=this;return N.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(E.emit("channelLeft",this.channelId),this.joinState!=="JOINING"){v.next=4;break}return v.next=4,this.joinPromise;case 4:this.joinState="LEFT",this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,E.removeListener("channelTextMessage",this.onChannelTextMessage),E.removeListener("channelRawMessage",this.onChannelRawMessage),E.removeListener("memberNotice",this.onMemberNotice),E.removeListener("channelAttributesUpdated",this.onAttributesUpdated),this.client.internalEmitter.removeListener("channelMemberCountUpdated",this.onChannelMemberCountUpdated),this.client.internalEmitter.removeListener("LOGOUT",this.onLogout),E.usedChannelIds=E.usedChannelIds.filter(function(w){return w!==T.channelId});case 17:case"end":return v.stop()}},f,this)}));return function(f){return l.apply(this,arguments)}}()}]),r}(sc()),Da(Qb.prototype,"join",[Mc],Object.getOwnPropertyDescriptor(Qb.prototype,"join"),Qb.prototype),Da(Qb.prototype,"leave",[Mc],Object.getOwnPropertyDescriptor(Qb.prototype,"leave"),Qb.prototype),Da(Qb.prototype,"sendMessage",[Mc],Object.getOwnPropertyDescriptor(Qb.prototype,"sendMessage"),Qb.prototype),Da(Qb.prototype,"getMembers",[jb],Object.getOwnPropertyDescriptor(Qb.prototype,"getMembers"),Qb.prototype),Qb),W,Rb=ta.ConnectionChangeReason,oa=ta.ConnectionState,Vt={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},vF={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8,TOKEN_EXPIRED:9},wF=(W=function(i){function r(l,f,E,T){va(this,r);var v=u.call(this,f,"RtmClient",!0);return x(z(v),"connectionState",oa.DISCONNECTED),x(z(v),"internalEmitter",new Ba),x(z(v),"context",void 0),x(z(v),"attributes",{}),x(z(v),"loginPromise",void 0),x(z(v),"attributeDrafts",new Set),x(z(v),"session",void 0),x(z(v),"lastLoginTime",void 0),x(z(v),"reconnId",0),x(z(v),"channelAttributesCacheLru",new Wc(void 0,{maxlen:1e4})),x(z(v),"invitationManager",void 0),x(z(v),"subscribedPeerStatusCache",{}),x(z(v),"pendingPeerStatusSubCount",0),x(z(v),"peerStatusSeqLru",new Wc(void 0,{maxlen:1e4})),x(z(v),"peerUnreachableTimers",{}),x(z(v),"setParameters",void 0),x(z(v),"updateConfig",void 0),x(z(v),"blacklistedIP",{}),x(z(v),"TokenPrivilegeWillExpireHandler",function(){v.emit("TokenPrivilegeWillExpire")}),x(z(v),"userDropHandler",function(w){if(v.connectionState!==oa.ABORTED)switch(w){case 2:v.logError("Server banned because of token is expired"),v.onConnectionStateChanged(oa.ABORTED,Rb.TOKEN_EXPIRED),v.emit("TokenExpired");break;case 11:v.logError("Kicked off by remote session"),v.onConnectionStateChanged(oa.ABORTED,Rb.REMOTE_LOGIN);break;case 14:case 15:case 16:v.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[w])),v.onConnectionStateChanged(oa.ABORTED,Rb.BANNED_BY_SERVER);break;default:v.logError("User kicked off for unknown code: ".concat(w)),v.onConnectionStateChanged(oa.ABORTED,Rb.INTERRUPTED)}}),v.context=new xE(l,E,f),v.context.config=E,v.setParameters=T.bind(z(v)),v.updateConfig=T.bind(z(v)),v.invitationManager=new sF(function(){return v.session},f),v.invitationManager.on("remoteInvitationInstance",function(w){v.emit("RemoteInvitationReceived",w)}),v.setMaxListeners(512),v.internalEmitter.setMaxListeners(512),v}Ga(r,i);var s,u=Ha(r);return eb(r,[{key:"renewToken",value:(s=ma(N.mark(function l(f){var E,T,v,w,k=this;return N.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(typeof f=="string"&&f.length!==0){B.next=2;break}throw new ca("Invalid argument",XB);case 2:if(this.connectionState!==oa.ABORTED){B.next=5;break}return B.next=5,new Promise(function(){});case 5:if(this.connectionState===oa.CONNECTED||this.connectionState===oa.RECONNECTING){B.next=7;break}throw new da("The client is not logged in",hs);case 7:if(this.session!==void 0){B.next=9;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return B.prev=9,E=this.context.token,this.context.token=f,B.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe($d(function(){return Error("No available edge address to connect")}),Re(function(Q){return Q.pipe(sa(function(X){if(Na(X))throw X}),Zd(2500),hb(4))}),hb(1),Lb(2e4),ab(function(Q){return Ab(Q)&&k.warn("renewToken timed out"),ra(Q)})).toPromise();case 14:T=B.sent,v=T.ticket,B.next=27;break;case 18:if(B.prev=18,B.t0=B.catch(9),this.context.token=E,B.t0.code!==as&&B.t0.code!==bs){B.next=23;break}throw new Bf("Invalid token",ZB);case 23:if(B.t0.code!==ti){B.next=25;break}throw new Bf("The token expired",YB);case 25:if(!Ab(B.t0)){B.next=27;break}throw new Ub("Renew token timed out",Ml);case 27:w=this.session,this.session.requestUpdateEdgeTicket(v).toPromise().then(function(Q){if(Q.code!==0)throw new Ja(["RenewToken failure. The response code is %d",Q.code],Ml);w.curLoginSockets.filter(function(X){return X!==void 0}).forEach(function(X){return X.ticket=v})});case 29:case"end":return B.stop()}},l,this,[[9,18]])})),function(l){return s.apply(this,arguments)})},{key:"queryPeersOnlineStatus",value:function(){var l=ma(N.mark(function f(E){var T,v,w=this;return N.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(this.connectionState===oa.CONNECTED){k.next=2;break}throw new da("The client is not logged in",WB);case 2:if(this.session!==void 0){k.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(E)||E.length===0||E.some(function(B){return!Ta(B)})||256<E.length)){k.next=6;break}throw new ca("invalid arguments",gs);case 6:return k.next=8,this.session.requestPeersOnlineStatus(E).toPromise();case 8:return T=k.sent,v=md(tl(T.userInfos,"account"),function(B){return!!B.ts}),Object.keys(v).forEach(function(B){if(B in w.subscribedPeerStatusCache&&w.subscribedPeerStatusCache[B]!==ta.PeerOnlineState.UNREACHABLE){var Q=v[B]?ta.PeerOnlineState.ONLINE:ta.PeerOnlineState.OFFLINE;w.emit("PeersOnlineStatusChanged",x({},B,Q)),w.subscribedPeerStatusCache[B]=Q}}),k.abrupt("return",v);case 12:case"end":return k.stop()}},f,this)}));return function(f){return l.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var l=ma(N.mark(function f(E){var T,v,w,k,B,Q,X,_e,aa;return N.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(this.connectionState===oa.CONNECTED){_i.next=2;break}throw new da("The client is not logged in",HB);case 2:if(this.session!==void 0){_i.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(E)&&E.every(function(_a){return typeof _a=="string"})&&E.length!==0){_i.next=6;break}throw new ca("Invalid arguments: channelIds",Pr);case 6:if(!(32<E.length)){_i.next=8;break}throw new ca("getChannelMemberCount exceed limit of 32 channelIds",GB);case 8:T=0;case 9:if(!(T<E.length)){_i.next=16;break}if(Ta(v=E[T])){_i.next=13;break}throw new ca(["getChannelMemberCount channel id %s is invalid",v],Pr);case 13:T++,_i.next=9;break;case 16:return _i.next=18,this.session.requestGetChannelMemberCount(E).toPromise();case 18:for(w=_i.sent,k=w.groupInfos,B={},Q=0;Q<k.length;Q++)X=k[Q],_e=X.group,aa=X.memberCount,Ta(_e)&&typeof aa=="number"&&(this.internalEmitter.emit("channelMemberCountUpdated",_e,aa),B[_e]=aa);return _i.abrupt("return",B);case 23:case"end":return _i.stop()}},f,this)}));return function(f){return l.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var l=ma(N.mark(function f(E){var T,v;return N.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(ag({attributes:E,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===oa.CONNECTED){w.next=3;break}throw new da("The client is not logged in",qc);case 3:if(this.session!==void 0){w.next=5;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return T=this.session.requestSetLocalUserAttributes(E).toPromise(),v={attribute:E,promise:T},this.attributeDrafts.add(v),w.prev=8,w.next=11,T;case 11:this.attributes=E,w.next=19;break;case 14:if(w.prev=14,w.t0=w.catch(8),!Na(w.t0)){w.next=18;break}throw w.t0;case 18:throw new ca("arguments is not valid",gb);case 19:return w.prev=19,this.attributeDrafts.delete(v),w.finish(19);case 22:case"end":return w.stop()}},f,this,[[8,14,19,22]])}));return function(f){return l.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var l=ma(N.mark(function f(E,T){var v,w,k,B,Q,X=arguments;return N.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(v=2<X.length&&X[2]!==void 0?X[2]:{},w=v.enableNotificationToChannelMembers,k=w!==void 0&&w,ag({attributes:T,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===oa.CONNECTED){_e.next=4;break}throw new da("The client is not logged in",qc);case 4:if(this.session!==void 0){_e.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return B=this.session.requestSetChannelAttributes(E,T,k).toPromise(),_e.prev=7,_e.next=10,B;case 10:Q=md(T,function(aa){return new Blob([aa]).size}),this.channelAttributesCacheLru.set(E,Q),_e.next=19;break;case 14:if(_e.prev=14,_e.t0=_e.catch(7),!Na(_e.t0)){_e.next=18;break}throw _e.t0;case 18:throw new ca("arguments is not valid",gb);case 19:case"end":return _e.stop()}},f,this,[[7,14]])}));return function(f,E){return l.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var l=ma(N.mark(function f(E){var T,v,w;return N.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(T=Wa(Wa({},this.attributes),E),ag({attributes:E,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),ag({attributes:T,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===oa.CONNECTED){k.next=5;break}throw new da("The client is not logged in",qc);case 5:if(this.session!==void 0){k.next=7;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return v=this.session.requestAddOrUpdateLocalUserAttributes(E).toPromise(),w={attribute:T,promise:v},this.attributeDrafts.add(w),k.prev=10,k.next=13,v;case 13:this.attributes=T,k.next=21;break;case 16:if(k.prev=16,k.t0=k.catch(10),!Na(k.t0)){k.next=20;break}throw k.t0;case 20:throw new ca("arguments is not valid",gs);case 21:return k.prev=21,this.attributeDrafts.delete(w),k.finish(21);case 24:case"end":return k.stop()}},f,this,[[10,16,21,24]])}));return function(f){return l.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var l=ma(N.mark(function f(E,T){var v,w,k,B,Q,X,_e,aa=arguments;return N.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(v=2<aa.length&&aa[2]!==void 0?aa[2]:{},w=v.enableNotificationToChannelMembers,k=w!==void 0&&w,B=this.channelAttributesCacheLru.get(E,{}),Q=md(T,function(_a){return new Blob([_a]).size}),X=Wa(Wa({},B),Q),ag({attributes:T,attrSizeMap:X,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===oa.CONNECTED){_i.next=7;break}throw new da("The client is not logged in",qc);case 7:if(this.session!==void 0){_i.next=9;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return _e=this.session.requestAddOrUpdateChannelAttributes(E,T,k).toPromise(),_i.prev=10,_i.next=13,_e;case 13:this.channelAttributesCacheLru.set(E,X),_i.next=21;break;case 16:if(_i.prev=16,_i.t0=_i.catch(10),!Na(_i.t0)){_i.next=20;break}throw _i.t0;case 20:throw new ca("arguments is not valid",gb);case 21:case"end":return _i.stop()}},f,this,[[10,16]])}));return function(f,E){return l.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var l=ma(N.mark(function f(E){var T,v,w,k;return N.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(Array.isArray(E)&&E.length!==0&&!E.some(function(Q){return Q.length===0})){B.next=2;break}throw new da("arguments is not valid",gb);case 2:if(this.connectionState===oa.CONNECTED){B.next=4;break}throw new da("The client is not logged in",qc);case 4:if(this.session!==void 0){B.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return T=this.session.requestDeleteLocalUserAttributesByKeys(E).toPromise(),v={attribute:ql(this.attributes,E),promise:T},this.attributeDrafts.add(v),B.prev=9,B.next=12,T;case 12:for(w=0;w<E.length;w++)k=E[w],delete this.attributes[k];B.next=20;break;case 15:if(B.prev=15,B.t0=B.catch(9),!Na(B.t0)){B.next=19;break}throw B.t0;case 19:throw new ca("arguments is not valid",gb);case 20:return B.prev=20,this.attributeDrafts.delete(v),B.finish(20);case 23:case"end":return B.stop()}},f,this,[[9,15,20,23]])}));return function(f){return l.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var l=ma(N.mark(function f(E,T){var v,w,k,B,Q,X,_e,aa=arguments;return N.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(v=2<aa.length&&aa[2]!==void 0?aa[2]:{},w=v.enableNotificationToChannelMembers,k=w!==void 0&&w,Array.isArray(T)&&T.length!==0&&Ta(E)&&!T.some(function(_a){return _a.length===0||512<_a.length})){_i.next=3;break}throw new da("arguments is not valid",gb);case 3:if(this.connectionState===oa.CONNECTED){_i.next=5;break}throw new da("The client is not logged in",qc);case 5:if(this.session!==void 0){_i.next=7;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return B=this.session.requestDeleteChannelAttributesByKeys(E,T,k).toPromise(),_i.prev=8,_i.next=11,B;case 11:if(Q=this.channelAttributesCacheLru.get(E))for(X=0;X<T.length;X++)_e=T[X],delete Q[_e];_i.next=20;break;case 15:if(_i.prev=15,_i.t0=_i.catch(8),!Na(_i.t0)){_i.next=19;break}throw _i.t0;case 19:throw new ca("arguments is not valid",gb);case 20:case"end":return _i.stop()}},f,this,[[8,15]])}));return function(f,E){return l.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var l=ma(N.mark(function f(){var E,T;return N.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.connectionState===oa.CONNECTED){v.next=2;break}throw new da("The client is not logged in",qc);case 2:if(this.session!==void 0){v.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return E=this.session.requestClearLocalUserAttributes().toPromise(),T={attribute:{},promise:E},this.attributeDrafts.add(T),v.prev=7,v.next=10,E;case 10:this.attributes={},v.next=18;break;case 13:if(v.prev=13,v.t0=v.catch(7),!Na(v.t0)){v.next=17;break}throw v.t0;case 17:throw new ca("arguments is not valid",gb);case 18:return v.prev=18,this.attributeDrafts.delete(T),v.finish(18);case 21:case"end":return v.stop()}},f,this,[[7,13,18,21]])}));return function(){return l.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var l=ma(N.mark(function f(E){var T,v,w,k,B=arguments;return N.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(T=1<B.length&&B[1]!==void 0?B[1]:{},v=T.enableNotificationToChannelMembers,w=v!==void 0&&v,this.connectionState===oa.CONNECTED){Q.next=3;break}throw new da("The client is not logged in",qc);case 3:if(this.session!==void 0){Q.next=5;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return k=this.session.requestClearChannelAttributes(E,w).toPromise(),Q.prev=6,Q.next=9,k;case 9:this.channelAttributesCacheLru.delete(E),Q.next=17;break;case 12:if(Q.prev=12,Q.t0=Q.catch(6),!Na(Q.t0)){Q.next=16;break}throw Q.t0;case 16:throw new ca("arguments is not valid",gb);case 17:case"end":return Q.stop()}},f,this,[[6,12]])}));return function(f){return l.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var l=ma(N.mark(function f(E){var T,v,w;return N.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(Ta(E)){k.next=2;break}throw new ca("Not a valid user ID",gb);case 2:if(this.connectionState===oa.CONNECTED){k.next=4;break}throw new da("The client is not logged in",qc);case 4:if(this.session!==void 0){k.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return k.prev=6,k.next=9,this.session.requestGetUserAttributeKeys(E).toPromise();case 9:return T=k.sent,v=T.keys,k.next=13,this.session.requestGetUserAttributesByKeys(E,v.slice(0,512)).toPromise();case 13:w=k.sent,k.next=21;break;case 16:if(k.prev=16,k.t0=k.catch(6),!Na(k.t0)){k.next=20;break}throw k.t0;case 20:throw new ca("arguments is not valid",gb);case 21:return k.abrupt("return",Zq(w.attributeInfos.map(function(B){return[B.key,B.value]})));case 22:case"end":return k.stop()}},f,this,[[6,16]])}));return function(f){return l.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var l=ma(N.mark(function f(E){var T,v,w,k,B,Q,X,_e,aa,_i,_a;return N.wrap(function(ga){for(;;)switch(ga.prev=ga.next){case 0:if(Ta(E)){ga.next=2;break}throw new ca("Not a valid channel ID",gb);case 2:if(this.connectionState===oa.CONNECTED){ga.next=4;break}throw new da("The client is not logged in",qc);case 4:if(this.session!==void 0){ga.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return ga.prev=6,ga.next=9,this.session.requestGetChannelAttributesKeys(E).toPromise();case 9:return T=ga.sent,v=T.keys,ga.next=13,this.session.requestGetChannelAttributesByKeys(E,v).toPromise();case 13:w=ga.sent,k=w.attributeMaps,ga.next=22;break;case 17:if(ga.prev=17,ga.t0=ga.catch(6),!Na(ga.t0)){ga.next=21;break}throw ga.t0;case 21:throw new ca("arguments is not valid",gb);case 22:B={},Q=0;case 24:if(!(Q<k.length)){ga.next=32;break}if(X=k[Q],_e=X.key,aa=X.ms,_i=X.value,_a=X.origin,typeof _e=="string"&&P.isLong(aa)&&typeof _i=="string"&&Ta(_a)){ga.next=28;break}return ga.abrupt("break",32);case 28:B[_e]={value:_i,lastUpdateUserId:_a,lastUpdateTs:aa.toNumber()};case 29:Q++,ga.next=24;break;case 32:return this.channelAttributesCacheLru.set(E,md(B,function(_d){return new Blob([_d.value]).size})),ga.abrupt("return",B);case 34:case"end":return ga.stop()}},f,this,[[6,17]])}));return function(f){return l.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var l=ma(N.mark(function f(E,T){var v,w,k,B,Q,X,_e,aa,_i,_a;return N.wrap(function(ga){for(;;)switch(ga.prev=ga.next){case 0:if(this.connectionState===oa.CONNECTED){ga.next=2;break}throw new da("The client is not logged in",qc);case 2:if(this.session!==void 0){ga.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Qn(E,T),ga.prev=5,ga.next=8,this.session.requestGetChannelAttributesByKeys(E,T).toPromise();case 8:v=ga.sent,w=v.attributeMaps,ga.next=17;break;case 12:if(ga.prev=12,ga.t0=ga.catch(5),!Na(ga.t0)){ga.next=16;break}throw ga.t0;case 16:throw new ca("arguments is not valid",gb);case 17:k={},B=this.channelAttributesCacheLru.get(E,{}),Q=0;case 20:if(!(Q<w.length)){ga.next=29;break}if(X=w[Q],_e=X.key,aa=X.ms,_i=X.value,_a=X.origin,typeof _e=="string"&&P.isLong(aa)&&typeof _i=="string"&&Ta(_a)){ga.next=24;break}return ga.abrupt("break",29);case 24:B[_e]=new Blob([_i]).size,k[_e]={value:_i,lastUpdateUserId:_a,lastUpdateTs:aa.toNumber()};case 26:Q++,ga.next=20;break;case 29:return this.channelAttributesCacheLru.set(E,B),ga.abrupt("return",k);case 31:case"end":return ga.stop()}},f,this,[[5,12]])}));return function(f,E){return l.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var l=ma(N.mark(function f(E,T){var v;return N.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(this.connectionState===oa.CONNECTED){w.next=2;break}throw new da("The client is not logged in",qc);case 2:if(this.session!==void 0){w.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Qn(E,T),w.prev=5,w.next=8,this.session.requestGetUserAttributesByKeys(E,T).toPromise();case 8:v=w.sent,w.next=16;break;case 11:if(w.prev=11,w.t0=w.catch(5),!Na(w.t0)){w.next=15;break}throw w.t0;case 15:throw new ca("arguments is not valid",gb);case 16:return w.abrupt("return",Zq(v.attributeInfos.map(function(k){return[k.key,k.value]})));case 17:case"end":return w.stop()}},f,this,[[5,11]])}));return function(f,E){return l.apply(this,arguments)}}()},{key:"login",value:function(){var l=ma(N.mark(function f(E){var T,v,w,k,B;return N.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(xn(!0),v=nh(),w=E.token,E.token===this.context.appId&&(w=void 0),bb("Session",{appId:this.context.appId,did:navigator.userAgent,elapse:Xa(this.session&&this.session.startTime),index:{index1:E.uid,index2:this.context.appId,index3:"enableLogUpload=".concat(this.context.config.enableLogUpload)},installId:Og,lts:P.fromNumber(Date.now()),os:7,sid:sb(v),token:w||"",userId:E.uid,ver:"1.5.1",buildno:418,subVersion:18,version:4},(T=this.context.config.enableCloudProxy)!==null&&T!==void 0&&T,!0),De(E)&&Ta(E.uid)){Q.next=7;break}throw new ca("not a valid user id",si);case 7:if(typeof w!="string"||!w){Q.next=11;break}this.context.token=w,Q.next=13;break;case 11:if(typeof w=="string"||w==null){Q.next=13;break}throw new ca('The "token" is not a valid string.',si);case 13:return k=Date.now(),this.context.sid=sb(v),this.loginPromise=this.loginImpl({uid:E.uid,instanceId:v}),this.info("RTM Client logging in as ".concat(La(E.uid))),Q.prev=17,Q.next=20,this.loginPromise;case 20:Q.next=28;break;case 22:throw Q.prev=22,Q.t0=Q.catch(17),Na(Q.t0)&&bb("Link",{ackedServerIp:"",destServerIp:"",ec:Q.t0.code||1,sc:Q.t0.serverCode,elapse:Xa(this.session&&this.session.startTime),lts:P.fromNumber(Date.now()),responseTime:Date.now()-k,sid:sb(v),userId:E.uid},(B=this.context.config.enableCloudProxy)!==null&&B!==void 0&&B),this.context.token=void 0,this.context.socketUseProxy=!1,Q.t0;case 28:return Q.prev=28,this.loginPromise=void 0,Q.finish(28);case 31:this.context.socketUseProxy&&this.emit("FallbackProxyConnected"),xn(!1);case 33:case"end":return Q.stop()}},f,this,[[17,22,28,31]])}));return function(f){return l.apply(this,arguments)}}()},{key:"logout",value:function(){var l=ma(N.mark(function f(){var E;return N.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!this.loginPromise){T.next=3;break}return T.next=3,this.loginPromise;case 3:if(this.connectionState!==oa.DISCONNECTED){T.next=6;break}throw this.logError("Already in logout state"),new da("Logout failure. The client has already been logged out",cs);case 6:if(this.internalEmitter.emit("LOGOUT"),this.connectionState!==oa.ABORTED){T.next=11;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT),T.abrupt("return");case 11:if(this.session!==void 0){T.next=14;break}return this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT),T.abrupt("return");case 14:return bb("Logout",{elapse:Xa(this.session.startTime),lts:P.fromNumber(Date.now()),sid:sb(this.session.instanceId),userId:this.context.uid},(E=this.context.config.enableCloudProxy)!==null&&E!==void 0&&E),T.next=17,this.session.logoutHandler();case 17:this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT),this.log("Log out success");case 19:case"end":return T.stop()}},f,this)}));return function(){return l.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var l,f=this;if(this.connectionState===oa.DISCONNECTED)throw this.logError("Already in logout state"),new da("Logout failure. The client has already been logged out",cs);this.connectionState===oa.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):this.session!==void 0&&(bb("Logout",{elapse:Xa(this.session.startTime),lts:P.fromNumber(Date.now()),sid:sb(this.session.instanceId),userId:this.context.uid},(l=this.context.config.enableCloudProxy)!==null&&l!==void 0&&l),this.session.logoutHandler().then(function(){f.log("Log out success")})),this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var l=ma(N.mark(function f(E,T){var v,w,k=this;return N.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(Xn(E,bg),v=E.messageType==="TEXT"?Ka.P2pSMsgNoOfflineFlag:Ka.P2pRMsgNoOfflineFlag,this.connectionState!==oa.RECONNECTING){B.next=5;break}return w=Date.now(),B.abrupt("return",new Promise(function(Q,X){var _e,aa=(_e=ma(N.mark(function _a(){var ga;return N.wrap(function(_d){for(;;)switch(_d.prev=_d.next){case 0:if(k.session!==void 0){_d.next=2;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return ga=Date.now()-w,_d.prev=3,_d.t0=Q,_d.next=7,ph({message:E,peerId:T,toPeer:!0,session:k.session,errorCodes:{NOT_LOGGED_IN:Ll,TOO_OFTEN:es},diff:ga,logger:k.logger});case 7:_d.t1=_d.sent,(0,_d.t0)(_d.t1),_d.next=18;break;case 11:_d.prev=11,_d.t2=_d.catch(3),Ab(_d.t2)&&(k.session.emit("messageCount",{messageCategory:v,type:"common",key:"sentcount"}),k.session.emit("messageCount",{messageCategory:v,type:"common",key:"timeoutcount"}),X(new Ub(we(k.name,"sendMessageToPeer",1e4),Kl))),Na(_d.t2)&&X(_d.t2),k.session.emit("messageCount",{messageCategory:v,type:"common",key:"sentcount"}),k.session.emit("messageCount",{messageCategory:v,type:"common",key:"unknowerrorcount"}),X(new Ja("Peer-to-peer message send failure",{code:ds,originalError:_d.t2}));case 18:return _d.prev=18,clearTimeout(_i),_d.finish(18);case 21:case"end":return _d.stop()}},_a,null,[[3,11,18,21]])})),function(){return _e.apply(this,arguments)});k.internalEmitter.once("RECONNECTED",aa);var _i=setTimeout(function(){k.internalEmitter.off("RECONNECTED",aa),X(new Ub(we(k.name,"sendMessageToPeer",1e4),Kl))},9e3)}));case 5:if(this.connectionState===oa.CONNECTED){B.next=7;break}throw new da("Failed to send the peer-to-peer message. The client is not logged in",Ll);case 7:if(this.session!==void 0){B.next=9;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return B.prev=9,B.next=12,ph({message:E,peerId:T,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:Ll,TOO_OFTEN:es},diff:0,logger:this.logger});case 12:return B.abrupt("return",B.sent);case 15:if(B.prev=15,B.t0=B.catch(9),!Ab(B.t0)){B.next=21;break}throw this.session.emit("messageCount",{messageCategory:v,type:"common",key:"sentcount"}),this.session.emit("messageCount",{messageCategory:v,type:"common",key:"timeoutcount"}),new Ub(we(this.name,"sendMessageToPeer",1e4),Kl);case 21:if(!Na(B.t0)){B.next=23;break}throw B.t0;case 23:throw this.session.emit("messageCount",{messageCategory:v,type:"common",key:"sentcount"}),this.session.emit("messageCount",{messageCategory:v,type:"common",key:"unknowerrorcount"}),new Ja("Peer-to-peer message send failure",{code:ds,originalError:B.t0});case 26:case"end":return B.stop()}},f,this,[[9,15]])}));return function(f,E){return l.apply(this,arguments)}}()},{key:"createChannel",value:function(l){var f=this;if(!Ta(l))throw new ca(["The %s in the arguments is invalid",Object.keys({channelId:l})[0]],FB);return new uF(l,function(){return f.session},this,this.logger)}},{key:"createLocalInvitation",value:function(l){if(!Ta(l))throw new ca(["The %s in the arguments is invalid",Object.keys({calleeId:l})[0]],Xc);return this.invitationManager.genLocalInvitation(l)}},{key:"subscribePeersOnlineStatus",value:function(){var l=ma(N.mark(function f(E){var T,v,w,k,B,Q,X,_e,aa,_i,_a,ga,_d,d_=this;return N.wrap(function(T_){for(;;)switch(T_.prev=T_.next){case 0:if(this.connectionState===oa.CONNECTED){T_.next=2;break}throw new da("The client is not logged in",Nl);case 2:if(this.session!==void 0){T_.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(E)&&E.length!==0){T_.next=6;break}throw new ca("Invalid arguments: peerIds",Qg);case 6:T=0;case 7:if(!(T<E.length)){T_.next=14;break}if(Ta(v=E[T])){T_.next=11;break}throw new ca(["subscribePeersOnlineStatus peer id %s is invalid",v],Qg);case 11:T++,T_.next=7;break;case 14:if(!(512<(w=E&&E.length?fl(E):[]).length+Object.keys(this.subscribedPeerStatusCache).length+this.pendingPeerStatusSubCount)){T_.next=17;break}throw new ic("Subscribed peers overflows",js);case 17:return this.pendingPeerStatusSubCount+=w.length,T_.next=20,this.session.requestSubscribePeersOnlineStatus(w).toPromise();case 20:k=T_.sent,B=k.errors,this.pendingPeerStatusSubCount-=w.length,Q=[],X=[],_e=0;case 26:if(!(_e<B.length)){T_.next=34;break}if(aa=B[_e],_i=aa.code,typeof(_a=aa.account)=="string"){T_.next=30;break}throw new Ja("Returned account is invalid",is);case 30:_i!==0&&Q.push(_a);case 31:_e++,T_.next=26;break;case 34:for(ga=0;ga<w.length;ga++)_d=w[ga],Q.includes(_d)||(X.push(_d),this.subscribedPeerStatusCache[_d]=void 0);if(this.session.requestPeersOnlineStatus(X).pipe(Ea(function(P_){return md(tl(P_.userInfos,"account"),function(g_){return!!g_.ts})})).subscribe(function(P_){P_=md(P_,function(g_,j_){return g_=g_?ta.PeerOnlineState.ONLINE:ta.PeerOnlineState.OFFLINE,d_.subscribedPeerStatusCache[j_]=g_}),d_.emit("PeersOnlineStatusChanged",P_)}),Q.length===0){T_.next=38;break}throw new Ja("Subscription failed",is);case 38:case"end":return T_.stop()}},f,this)}));return function(f){return l.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var l=ma(N.mark(function f(E){var T,v,w,k,B;return N.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(this.connectionState===oa.CONNECTED){Q.next=2;break}throw new da("The client is not logged in",Nl);case 2:if(this.session!==void 0){Q.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(E)&&E.length!==0){Q.next=6;break}throw new ca("Invalid arguments: peerIds",Qg);case 6:T=0;case 7:if(!(T<E.length)){Q.next=14;break}if(Ta(v=E[T])){Q.next=11;break}throw new ca(["subscribePeersOnlineStatus peer id %s is invalid",v],Qg);case 11:T++,Q.next=7;break;case 14:if(!(512<E.length)){Q.next=16;break}throw new ic("Unsubscribed peers overflows",js);case 16:for(w=E&&E.length?fl(E):[],this.session.requestUnsubscribePeersOnlineStatus(w),k=0;k<w.length;k++)B=w[k],delete this.subscribedPeerStatusCache[B];case 19:case"end":return Q.stop()}},f,this)}));return function(f){return l.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var l=ma(N.mark(function f(E){return N.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(this.connectionState===oa.CONNECTED){T.next=2;break}throw new da("The client is not logged in",Nl);case 2:if(E!==ta.PeerSubscriptionOption.ONLINE_STATUS){T.next=4;break}return T.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new ca("Subscription option not supported",Qg);case 5:case"end":return T.stop()}},f,this)}));return function(f){return l.apply(this,arguments)}}()},{key:"createMessage",value:function(l){return l}},{key:"loginImpl",value:function(){var l=ma(N.mark(function f(E){var T,v,w,k,B,Q,X,_e,aa=this;return N.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(T=E.uid,v=E.instanceId,w=E.forceLoginTime,k=w===void 0?0:w,B=v,!(this.lastLoginTime!==void 0&&500>Date.now()-this.lastLoginTime)){_i.next=4;break}throw new bE(["The frequency of login exceeded the limit of %d queries per second",2],UB);case 4:if(this.connectionState===oa.DISCONNECTED||k!==0){_i.next=6;break}throw new da("The SDK is either logging in or has logged in the Agora RTM system",SB);case 6:_i.prev=6,this.context.uid=T,_i.next=13;break;case 10:throw _i.prev=10,_i.t0=_i.catch(6),new ca(["The %s in the arguments is invalid",Object.keys({uid:T})[0]],si);case 13:return k===0&&this.onConnectionStateChanged(oa.CONNECTING,Rb.LOGIN),(Q=new ct(this.context,this.logger,!1)).blacklistedIP=this.blacklistedIP,this.session=X=new Tt(this.context,Q,B,this.logger),_e=function(){aa.connectionState===oa.CONNECTED&&(aa.onConnectionStateChanged(oa.RECONNECTING,Rb.INTERRUPTED),aa.session)&&aa.session.once("userJoined",function(){aa.onConnectionStateChanged(oa.CONNECTED,Rb.LOGIN_SUCCESS)})},X.on("connectionLost",_e),X.on("tokenExpired",function(){aa.emit("TokenExpired")}),X.on("tokenPrivilegeWillExpire",this.TokenPrivilegeWillExpireHandler),X.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",function(_a){aa.emit("MessageFromPeer",{text:_a.text,messageType:ta.MessageType.TEXT},_a.peerId,_a.properties)}),this.session.on("peerRawMessage",function(_a){aa.emit("MessageFromPeer",{rawMessage:_a.raw,description:_a.desc,messageType:ta.MessageType.RAW},_a.peerId,_a.properties)}),X.on("instanceChanged",function(_a){return B=_a}),X.on("peerOnlineStatusChanged",function(_a){var ga=_a.instance.toString()+_a.state,_d=aa.peerStatusSeqLru.get(ga);!_d||_a.seq.greaterThan(_d)?(aa.peerStatusSeqLru.set(ga,_a.seq),_a.state!==aa.subscribedPeerStatusCache[_a.peerId]&&aa.emit("PeersOnlineStatusChanged",x({},_a.peerId,_a.state)),aa.subscribedPeerStatusCache[_a.peerId]=_a.state,clearTimeout(aa.peerUnreachableTimers[ga]),_a.state===ta.PeerOnlineState.UNREACHABLE&&(aa.peerUnreachableTimers[ga]=setTimeout(function(){aa.subscribedPeerStatusCache[_a.peerId]===ta.PeerOnlineState.UNREACHABLE&&(aa.subscribedPeerStatusCache[_a.peerId]=ta.PeerOnlineState.ONLINE,aa.emit("PeersOnlineStatusChanged",x({},_a.peerId,ta.PeerOnlineState.ONLINE)))},3e4))):aa.log("peerOnlineStatusChanged dedup for %s, %d",ga,_a.seq.toNumber())}),X.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),X.on("channelAttributesUpdated",function(_a){var ga=_a.channelId;_a=_a.attributeMaps;for(var _d={},d_=0;d_<_a.length;d_++){var T_=_a[d_],P_=T_.key,g_=T_.ms,j_=T_.value;if(T_=T_.origin,typeof P_!="string"||!P.isLong(g_)||typeof j_!="string"||!Ta(T_))break;_d[P_]=new Blob([j_]).size}aa.channelAttributesCacheLru.set(ga,_d)}),X.on("userJoined",function(_a){if(Object.keys(aa.attributes).length!==0){if(aa.session===void 0)return;aa.session.requestSetLocalUserAttributes(aa.attributes,_a).toPromise()}if(aa.attributeDrafts.size!==0)for(var ga=function(T_,P_){var g_=(T_=P_[T_]).attribute;T_.promise.then(function(){aa.session!==void 0&&aa.session.requestSetLocalUserAttributes(g_,_a).toPromise()})},_d=0,d_=Array.from(aa.attributeDrafts);_d<d_.length;_d++)ga(_d,d_);Object.keys(aa.subscribedPeerStatusCache).length!==0&&X.requestSubscribePeersOnlineStatus(Object.keys(aa.subscribedPeerStatusCache))}),X.on("banEdgeIP",function(_a){aa.banIP(_a)}),this.lastLoginTime=Date.now(),_i.prev=32,_i.next=35,X.loginHandler().toPromise();case 35:_i.next=53;break;case 37:if(_i.prev=37,_i.t1=_i.catch(32),!(_i.t1.name==="loginRespTimeout"&&2>k)){_i.next=46;break}return X.removeAllListeners(),_i.next=43,this.loginImpl({uid:T,instanceId:v,forceLoginTime:k+1});case 43:return _i.abrupt("return");case 46:if(!Ab(_i.t1)){_i.next=49;break}throw this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGIN_TIMEOUT),new Ub(we(this.name,"login",12e3),TB);case 49:if(this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGIN_FAILURE),!Na(_i.t1)){_i.next=52;break}throw _i.t1;case 52:throw new Ja("Login failure",{code:$r,originalError:_i.t1});case 53:this.onConnectionStateChanged(oa.CONNECTED,Rb.LOGIN_SUCCESS);case 54:case"end":return _i.stop()}},f,this,[[6,10],[32,37]])}));return function(f){return l.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(l,f){var E,T=this;l===oa.RECONNECTING&&(this.reconnId+=1),bb("ConnectionStateChange",{elapse:Xa(this.session&&this.session.startTime),lts:P.fromNumber(Date.now()),newState:Vt[l],oldState:Vt[this.connectionState],reason:vF[f],sid:sb(this.session&&this.session.instanceId||P.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},(E=this.context.config.enableCloudProxy)!==null&&E!==void 0&&E),this.connectionState===oa.RECONNECTING&&l===oa.CONNECTED&&(Object.keys(this.subscribedPeerStatusCache).length!==0&&this.session!==void 0&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(Ea(function(v){return md(tl(v.userInfos,"account"),function(w){return!!w.ts})})).subscribe(function(v){v=md(v,function(w,k){return w=w?ta.PeerOnlineState.ONLINE:ta.PeerOnlineState.OFFLINE,T.subscribedPeerStatusCache[k]=w}),T.emit("PeersOnlineStatusChanged",v)}),this.internalEmitter.emit("RECONNECTED")),this.connectionState=l,l!==oa.ABORTED&&l!==oa.DISCONNECTED||(this.pendingPeerStatusSubCount=this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.emit("ConnectionStateChanged",l,f)}},{key:"banIP",value:function(l){var f;this.log("ip banned",l);var E=(f=this.blacklistedIP[l])!==null&&f!==void 0?f:0;this.blacklistedIP[l]=E+1}}]),r}(sc()),Da(W.prototype,"renewToken",[jb],Object.getOwnPropertyDescriptor(W.prototype,"renewToken"),W.prototype),Da(W.prototype,"queryPeersOnlineStatus",[jb],Object.getOwnPropertyDescriptor(W.prototype,"queryPeersOnlineStatus"),W.prototype),Da(W.prototype,"getChannelMemberCount",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getChannelMemberCount"),W.prototype),Da(W.prototype,"setLocalUserAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"setLocalUserAttributes"),W.prototype),Da(W.prototype,"setChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"setChannelAttributes"),W.prototype),Da(W.prototype,"addOrUpdateLocalUserAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"addOrUpdateLocalUserAttributes"),W.prototype),Da(W.prototype,"addOrUpdateChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"addOrUpdateChannelAttributes"),W.prototype),Da(W.prototype,"deleteLocalUserAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"deleteLocalUserAttributesByKeys"),W.prototype),Da(W.prototype,"deleteChannelAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"deleteChannelAttributesByKeys"),W.prototype),Da(W.prototype,"clearLocalUserAttributes",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"clearLocalUserAttributes"),W.prototype),Da(W.prototype,"clearChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"clearChannelAttributes"),W.prototype),Da(W.prototype,"getUserAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getUserAttributes"),W.prototype),Da(W.prototype,"getChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getChannelAttributes"),W.prototype),Da(W.prototype,"getChannelAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getChannelAttributesByKeys"),W.prototype),Da(W.prototype,"getUserAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getUserAttributesByKeys"),W.prototype),Da(W.prototype,"login",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"login"),W.prototype),Da(W.prototype,"logout",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"logout"),W.prototype),Da(W.prototype,"logoutSync",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"logoutSync"),W.prototype),Da(W.prototype,"sendMessageToPeer",[jb],Object.getOwnPropertyDescriptor(W.prototype,"sendMessageToPeer"),W.prototype),Da(W.prototype,"createChannel",[jb],Object.getOwnPropertyDescriptor(W.prototype,"createChannel"),W.prototype),Da(W.prototype,"createLocalInvitation",[jb],Object.getOwnPropertyDescriptor(W.prototype,"createLocalInvitation"),W.prototype),Da(W.prototype,"subscribePeersOnlineStatus",[jb],Object.getOwnPropertyDescriptor(W.prototype,"subscribePeersOnlineStatus"),W.prototype),Da(W.prototype,"unsubscribePeersOnlineStatus",[jb],Object.getOwnPropertyDescriptor(W.prototype,"unsubscribePeersOnlineStatus"),W.prototype),Da(W.prototype,"queryPeersBySubscriptionOption",[jb],Object.getOwnPropertyDescriptor(W.prototype,"queryPeersBySubscriptionOption"),W.prototype),Da(W.prototype,"createMessage",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"createMessage"),W.prototype),W),rm,sm,tm,um,Wt=(rm=/Chrome\/([0-9.]+)/.exec((tm=window)===null||tm===void 0||(um=tm.navigator)===null||um===void 0?void 0:um.userAgent))===null||rm===void 0||(sm=rm[1])===null||sm===void 0?void 0:sm.split(".")[0];if(Wt&&88<=parseInt(Wt,10)&&!Ce()){var vm,ze=document.createElement("video"),Ae=document.createElement("canvas");ze.setAttribute("style","display:none"),ze.setAttribute("muted",""),ze.muted=!0,ze.setAttribute("autoplay",""),ze.autoplay=!0,ze.setAttribute("playsinline",""),Ae.setAttribute("style","display:none"),Ae.setAttribute("width","1"),Ae.setAttribute("height","1"),(vm=Ae.getContext("2d"))===null||vm===void 0||vm.fillRect(0,0,1,1),ze.srcObject=Ae==null?void 0:Ae.captureStream()}var Xt={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},Yt={enableLogUpload:!1,logFilter:Xt.LOG_FILTER_INFO,enableCloudProxy:!1},ue=Wa(Wa({createInstance:function(i){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},s=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(i))throw new ca(["The %s in the arguments is invalid",Object.keys({appId:i})[0]],Or);var u=Object.keys(r).filter(function(k){return!(k in Yt)});if(u.length!==0)throw new ca("Invalid RTM config: ".concat(u.join(", ")),Or);var l=Wa(Wa({},Yt),r);if(s!==void 0&&(!Array.isArray(s)||s.length===0))throw new ca("Invalid area config");if(s!=null){if(!s.every(function(k){return k in ta.LegacyAreaCode}))throw new ca("Invalid area codes: ".concat(s.filter(function(k){return!(k in ta)}).join(", ")));fa=Ve(s.map(function(k){return dE[k]}))}s=Tl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var f=iE(l);u=jE(l);var E=kE(l),T=lE(s,l),v=Xs(s,l),w=v("RTM:DEBUG","<Entry> ");return Qs.rtmConfig=l,f("The Agora RTM Web SDK version is %s","1.5.1"),r.enableCloudProxy&&f("RTM cloud proxy enabled"),r.enableLogUpload&&f("Log upload enabled"),fa&&w("Area is set to %s",Array.from(fa.CODES).map(function(k){return Yf(S).find(function(B){return S[B]===k})}).join(", ")),w("Creating an RtmClient instance"),w('The Git commit ID is "'.concat("v1.5.1-0-g5bbbcd72",'"')),w("The App ID is %s",Yn(i,4,10,"*".repeat(6))),f("The process ID is %s",Og),w("The build is %s","v1.5.1-0-g5bbbcd72"),w("NODE_ENV is %s","production"),new wF(i,{genLogger:v,genTracker:T,info:f,warn:u,logError:E,loggerId:s},l,function(k){for(var B=0,Q=Yf(k);B<Q.length;B++){var X=Q[B];try{var _e=k[X];_e!=null&&(k.enableCloudProxy&&f("RTM cloud proxy enabled"),k.enableLogUpload&&f("Log upload enabled"),l[X]=_e)}catch{throw new ca(["The %s in the arguments is invalid",X],void 0)}}})},BUILD:"v1.5.1-0-g5bbbcd72",VERSION:"1.5.1",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:Og,ConnectionChangeReason:ta.ConnectionChangeReason,ConnectionState:ta.ConnectionState,LocalInvitationFailureReason:ta.LocalInvitationFailureReason,LocalInvitationState:ta.LocalInvitationState,RemoteInvitationFailureReason:ta.RemoteInvitationFailureReason,RemoteInvitationState:ta.RemoteInvitationState,MessageType:ta.MessageType,PeerOnlineState:ta.PeerOnlineState,PeerSubscriptionOption:ta.PeerSubscriptionOption},Xt),{},{setParameter:function(i,r){Object.keys(Ec).includes(i)&&(Ec[i]=r)},getParameter:function(i){return Ec[i]},setArea:function(i){var r=i.areaCodes;if(i=i.excludedArea,!Array.isArray(r)||r.length===0||!r.every(function(s){return s in ta.AreaCode}))throw new ca("Invalid area config");if(i!==void 0&&i===ta.AreaCode.GLOBAL)throw new ca("Excluded area cannot be global");if(i===void 0)fa=Ve(r.map(function(s){return S[s]}));else{if(r.includes(i))throw new ca("Excluded area cannot be in areaCodes");if(!(i in S))throw new ca("Invalid excludedArea:",i);fa=Gv({areas:r.map(function(s){return S[s]}),excludedArea:S[i]})}}});return ue})})(agoraRtmSdk,agoraRtmSdk.exports);var agoraRtmSdkExports=agoraRtmSdk.exports;const AgoraRTM=getDefaultExportFromCjs(agoraRtmSdkExports),appid="a08bedb12d6741fa9309adbad83e0e2c",token=null,rtcUid=Math.floor(Math.random()*2032),rtmUid=String(Math.floor(Math.random()*2032)),getRoomId=()=>{const i=window.location.search,r=new URLSearchParams(i);if(r.get("room"))return r.get("room").toLowerCase()};let roomId=getRoomId()||null;document.getElementById("form").roomname.value=roomId;let audioTracks={localAudioTrack:null,remoteAudioTracks:{}},micMuted=!0,rtcClient,rtmClient,channel,avatar;const initRtm=async i=>{rtmClient=AgoraRTM.createInstance(appid),await rtmClient.login({uid:rtmUid,token}),channel=rtmClient.createChannel(roomId),await channel.join(),await rtmClient.addOrUpdateLocalUserAttributes({name:i,userRtcUid:rtcUid.toString(),userAvatar:avatar}),getChannelMembers(),window.addEventListener("beforeunload",leaveRtmChannel),channel.on("MemberJoined",handleMemberJoined),channel.on("MemberLeft",handleMemberLeft)},initRtc=async()=>{rtcClient=AgoraRTC.createClient({mode:"rtc",codec:"vp8"}),rtcClient.on("user-published",handleUserPublished),rtcClient.on("user-left",handleUserLeft),await rtcClient.join(appid,roomId,token,rtcUid),audioTracks.localAudioTrack=await AgoraRTC.createMicrophoneAudioTrack(),audioTracks.localAudioTrack.setMuted(micMuted),await rtcClient.publish(audioTracks.localAudioTrack),initVolumeIndicator()};let initVolumeIndicator=async()=>{AgoraRTC.setParameter("AUDIO_VOLUME_INDICATION_INTERVAL",200),rtcClient.enableAudioVolumeIndicator(),rtcClient.on("volume-indicator",i=>{i.forEach(r=>{console.log(`UID ${r.uid} Level ${r.level}`);try{let s=document.getElementsByClassName(`avatar-${r.uid}`)[0];r.level>=50?s.style.borderColor="#00ff00":s.style.borderColor="#fff"}catch(s){console.error(s)}})})},handleUserPublished=async(i,r)=>{await rtcClient.subscribe(i,r),r=="audio"&&(audioTracks.remoteAudioTracks[i.uid]=[i.audioTrack],i.audioTrack.play())},handleUserLeft=async i=>{delete audioTracks.remoteAudioTracks[i.uid]},handleMemberJoined=async i=>{let{name:r,userRtcUid:s,userAvatar:u}=await rtmClient.getUserAttributesByKeys(i,["name","userRtcUid","userAvatar"]),l=`
  <div class="speaker user-rtc-${s}" id="${i}">
    <img class="user-avatar avatar-${s}" src="${u}"/>
      <p>${r}</p>
  </div>`;document.getElementById("members").insertAdjacentHTML("beforeend",l)},handleMemberLeft=async i=>{document.getElementById(i).remove()},getChannelMembers=async()=>{let i=await channel.getMembers();for(let r=0;i.length>r;r++){let{name:s,userRtcUid:u,userAvatar:l}=await rtmClient.getUserAttributesByKeys(i[r],["name","userRtcUid","userAvatar"]),f=`
    <div class="speaker user-rtc-${u}" id="${i[r]}">
        <img class="user-avatar avatar-${u}" src="${l}"/>
        <p>${s}</p>
    </div>`;document.getElementById("members").insertAdjacentHTML("beforeend",f)}};const toggleMic=async i=>{micMuted?(i.target.src="icons/mic.svg",i.target.style.backgroundColor="ivory",micMuted=!1):(i.target.src="icons/mic-off.svg",i.target.style.backgroundColor="indianred",micMuted=!0),audioTracks.localAudioTrack.setMuted(micMuted)};let lobbyForm=document.getElementById("form");const enterRoom=async i=>{if(i.preventDefault(),!avatar){alert("Please select an avatar");return}roomId=i.target.roomname.value.toLowerCase(),window.history.replaceState(null,null,`?room=${roomId}`),initRtc();let r=i.target.displayname.value;initRtm(r),lobbyForm.style.display="none",document.getElementById("room-header").style.display="flex",document.getElementById("room-name").innerText=roomId};let leaveRtmChannel=async()=>{await channel.leave(),await rtmClient.logout()},leaveRoom=async()=>{audioTracks.localAudioTrack.stop(),audioTracks.localAudioTrack.close(),rtcClient.unpublish(),rtcClient.leave(),leaveRtmChannel(),document.getElementById("form").style.display="block",document.getElementById("room-header").style.display="none",document.getElementById("members").innerHTML=""};lobbyForm.addEventListener("submit",enterRoom);document.getElementById("leave-icon").addEventListener("click",leaveRoom);document.getElementById("mic-icon").addEventListener("click",toggleMic);const avatars=document.getElementsByClassName("avatar-selection");for(let i=0;avatars.length>i;i++)avatars[i].addEventListener("click",()=>{for(let r=0;avatars.length>r;r++)avatars[r].style.borderColor="#fff",avatars[r].style.opacity=.5;avatar=avatars[i].src,avatars[i].style.borderColor="#00ff00",avatars[i].style.opacity=1});
